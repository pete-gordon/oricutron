cscope 15 $HOME/Documents/Development/retro/oric/oricutron               0000711350
	@6502.c

22 
	~<¡dlib.h
>

23 
	~<¡dio.h
>

24 
	~<¡ršg.h
>

26 
	~"sy¡em.h
"

27 
	~"6502.h
"

29 
	#ILLEGALS


	)

31 
dbg_´štf
Ð*
fmt
, ... );

33 #ià
defšed
(
DEBUG_CPU_TRACE
) && DEBUG_CPU_TRACE > 0

34 
mÚ_Œaûš¡
(
m6502
 *
ýu
);

41 
	$nuÎwr™e
Ð
m6502
 *
ýu
, 
addr
, 
d©a
 )

43 
	}
}

45 
	$nuÎ»ad
Ð
m6502
 *
ýu
, 
addr
 )

48 
	}
}

55 
	$m6502_š™
Ð
m6502
 *
ýu
, *
u£rd©a
, 
SDL_boÞ
 
nukeb»akpošts
 )

57 
i
;

58 
ýu
->
¿¡”cyþes
 = 0;

59 
ýu
->
icyþes
 = 0;

60 
ýu
->
cyþes
 = 0;

61 
ýu
->
wr™e
 = 
nuÎwr™e
;

62 
ýu
->
»ad
 = 
nuÎ»ad
;

64 ifÐ
nukeb»akpošts
 )

66  
i
=0; i<16; i++ )

68 
ýu
->
b»akpošts
[
i
] = -1;

69 
ýu
->
memb»akpošts
[
i
].
æags
 = 0;

71 
ýu
->
ªybp
 = 
SDL_FALSE
;

72 
ýu
->
ªymbp
 = 
SDL_FALSE
;

74 
ýu
->
u£rd©a
 = userdata;

75 
	}
}

79 
	$m6502_»£t
Ð
m6502
 *
ýu
 )

81 
ýu
->
a
 = cpu->
x
 = cpu->
y
 = 0;

82 
ýu
->
¥
 = 0xff;

83 
ýu
->
f_c
 = 0;

84 
ýu
->
f_z
 = 1;

85 
ýu
->
f_i
 = 0;

86 
ýu
->
f_d
 = 0;

87 
ýu
->
f_b
 = 0;

88 
ýu
->
f_v
 = 0;

89 
ýu
->
f_n
 = 0;

90 
ýu
->
pc
 = (ýu->
	`»ad
( cpu, 0xfffd )<<8) | cpu->read( cpu, 0xfffc );

91 
ýu
->
Ï¡pc
 = 0;

92 
ýu
->
nmi
 = 
SDL_FALSE
;

93 
ýu
->
œq
 = 0;

94 
ýu
->
nmicouÁ
 = 0;

95 
	}
}

98 
	#FLAG_ZCN
(
n
è
ýu
->
f_z
 = ((n)&0xff) == 0;\

99 
ýu
->
f_c
 = ((
n
)&0xff00) != 0;\

100 
ýu
->
f_n
 = ((
n
)&0x80è!ð0

	)

102 
	#FLAG_SZCN
(
n
è
ýu
->
f_z
 = ((n)&0xff) == 0;\

103 
ýu
->
f_c
 = ((
n
)&0xff00) == 0;\

104 
ýu
->
f_n
 = ((
n
)&0x80è!ð0

	)

106 
	#FLAG_ZN
(
n
è
ýu
->
f_z
 = (n) == 0;\

107 
ýu
->
f_n
 = ((
n
)&0x80è!ð0

	)

111 
	#DO_ADC
 ifÐ
ýu
->
f_d
 )\

113 
r
 = (
ýu
->
a
&0xf)+(
v
&0xf)+ýu->
f_c
;\

114 ifÐ
r
 > 9 )„ += 6;\

115 
t
 = (
ýu
->
a
>>4)+(
v
>>4)+(
r
>15?1:0);\

116 ifÐ
t
 > 9 ) += 6;\

117 
ýu
->
a
 = (
r
&0xf)|(
t
<<4);\

118 
ýu
->
f_c
 = 
t
>15 ? 1 : 0;\

119 
ýu
->
f_z
 = cpu->
a
!=0;\

120 
ýu
->
f_n
 = cpu->
a
&0x80;\

122 
r
 = 
ýu
->
a
 + 
v
 + cpu->
f_c
;\

123 
ýu
->
f_v
 = (~(ýu->
a
^
v
)&(ýu->a^
r
)è& 
FF_N
 ? 1 : 0;\

124 
	`FLAG_ZCN
(
r
);\

125 
ýu
->
a
 = 
r
;\

126 }

	)

129 
	#DO_AND
 
ýu
->
a
 &ð
v
;\

130 
	`FLAG_ZN
(
ýu
->
a
)

	)

133 
	#DO_ASL
(
s
è
ýu
->
f_c
 = ((s)&0x80) != 0;\

134 
s
 <<= 1;\

135 
	`FLAG_ZN
(
s
);

	)

138 
	#DO_ORA
 
ýu
->
a
 |ð
v
;\

139 
	`FLAG_ZN
(
ýu
->
a
)

	)

142 
	#DO_ROL
(
s
è
r
 = (s<<1)|
ýu
->
f_c
;\

143 
ýu
->
f_c
 = 
r
&0x100 ? 1 : 0;\

144 
s
 = 
r
;\

145 
	`FLAG_ZN
(
s
)

	)

148 
	#DO_ROR
(
s
è
r
 = (s)&1;\

149 
s
 = (s>>1)|(
ýu
->
f_c
<<7);\

150 
ýu
->
f_c
 = 
r
;\

151 
	`FLAG_ZN
(
s
)

	)

154 
	#DO_EOR
 
ýu
->
a
 ^ð
v
;\

155 
	`FLAG_ZN
(
ýu
->
a
)

	)

158 
	#DO_LSR
(
s
è
ýu
->
f_c
 = (s)&0x01;\

159 
s
 >>= 1;\

160 
	`FLAG_ZN
(
s
)

	)

163 
	#DO_SBC
 ifÐ
ýu
->
f_d
 )\

165 
r
 = (
ýu
->
a
&0xfè- (
v
&0xfè- (ýu->
f_c
^1);\

166 ifÐ
r
&0x10 )„ -= 6;\

167 
t
 = (
ýu
->
a
>>4è- (
v
>>4è- ((
r
&0x10)>>4);\

168 ifÐ
t
&0x10 ) -= 6;\

169 
ýu
->
a
 = (
r
&0xf)|(
t
<<4);\

170 
ýu
->
f_c
 = (
t
>15) ? 0 : 1;\

171 
ýu
->
f_z
 = cpu->
a
!=0;\

172 
ýu
->
f_n
 = cpu->
a
&0x80;\

174 
r
 = (
ýu
->
a
 - 
v
è- (ýu->
f_c
^1);\

175 
ýu
->
f_v
 = ((ýu->
a
^
v
)&(ýu->a^
r
)è& 
FF_N
 ? 1 : 0;\

176 
	`FLAG_SZCN
(
r
);\

177 
ýu
->
a
 = 
r
;\

178 }

	)

181 
	#BADDR_ZP
 
baddr
 = 
ýu
->
	`»ad
Ðýu, cpu->
pc
 )

	)

182 
	#BADDR_ZPX
 
baddr
 = (
ýu
->
	`»ad
Ðýu, cpu->
pc
 ) + cpu->
x
)&0xff

	)

183 
	#BADDR_ZPY
 
baddr
 = (
ýu
->
	`»ad
Ðýu, cpu->
pc
 ) + cpu->
y
)&0xff

	)

184 
	#BADDR_ABS
 
baddr
 = (
ýu
->
	`»ad
Ðýu, cpu->
pc
+1 )<<8è| cpu->»adÐýu, cpu->pø)

	)

185 
	#BADDR_ABX
 
baddr
 = ((
ýu
->
	`»ad
Ðýu, cpu->
pc
+1 )<<8è| cpu->»adÐýu, cpu->pø))+ýu->
x


	)

186 
	#BADDR_ABY
 
baddr
 = ((
ýu
->
	`»ad
Ðýu, cpu->
pc
+1 )<<8è| cpu->»adÐýu, cpu->pø))+ýu->
y


	)

187 
	#BADDR_ZIX
 
baddr
 = ()(
ýu
->
	`»ad
Ðýu, cpu->
pc
 )+ýu->
x
); badd¸ð(ýu->»adÐýu, baddr+1 )<<8è| cpu->»adÐýu, badd¸)

	)

188 
	#BADDR_ZIY
 
baddr
 = 
ýu
->
	`»ad
Ðýu, cpu->
pc
 ); badd¸ð((ýu->»adÐýu, baddr+1 )<<8è| cpu->»adÐýu, badd¸))+ýu->
y


	)

190 
	#NBADDR_ZP
 
baddr
 = 
ýu
->
	`»ad
Ðýu, cpu->
ÿlýc
+1 )

	)

191 
	#NBADDR_ZPX
 
baddr
 = (
ýu
->
	`»ad
Ðýu, cpu->
ÿlýc
+1 ) + cpu->
x
)&0xff

	)

192 
	#NBADDR_ZPY
 
baddr
 = (
ýu
->
	`»ad
Ðýu, cpu->
ÿlýc
+1 ) + cpu->
y
)&0xff

	)

193 
	#NBADDR_ABS
 
baddr
 = (
ýu
->
	`»ad
Ðýu, cpu->
ÿlýc
+2 )<<8è| cpu->»adÐýu, cpu->ÿlýc+1 )

	)

194 
	#NBADDR_ABX
 
baddr
 = ((
ýu
->
	`»ad
Ðýu, cpu->
ÿlýc
+2 )<<8è| cpu->»adÐýu, cpu->ÿlýc+1 ))+ýu->
x


	)

195 
	#NBADDR_ABY
 
baddr
 = ((
ýu
->
	`»ad
Ðýu, cpu->
ÿlýc
+2 )<<8è| cpu->»adÐýu, cpu->ÿlýc+1 ))+ýu->
y


	)

196 
	#NBADDR_ZIX
 
baddr
 = ()(
ýu
->
	`»ad
Ðýu, cpu->
ÿlýc
+1 )+ýu->
x
); badd¸ð(ýu->»adÐýu, baddr+1 )<<8è| cpu->»adÐýu, badd¸)

	)

197 
	#NBADDR_ZIY
 
baddr
 = 
ýu
->
	`»ad
Ðýu, cpu->
ÿlýc
+1 ); badd¸ð((ýu->»adÐýu, baddr+1 )<<8è| cpu->»adÐýu, badd¸))+ýu->
y


	)

199 
	#R_BADDR_ZP
 
NBADDR_ZP
; 
¿ddr
 = 
baddr
; 
¾’
 = 1

	)

200 
	#W_BADDR_ZP
 
NBADDR_ZP
; 
waddr
 = 
baddr
; 
wËn
 = 1

	)

201 
	#RW_BADDR_ZP
 
NBADDR_ZP
; 
waddr
 = 
¿ddr
 = 
baddr
; 
wËn
 = 
¾’
 = 1

	)

202 
	#R_BADDR_ZPX
 
NBADDR_ZPX
; 
¿ddr
 = 
baddr
; 
¾’
 = 1

	)

203 
	#W_BADDR_ZPX
 
NBADDR_ZPX
; 
waddr
 = 
baddr
; 
wËn
 = 1

	)

204 
	#RW_BADDR_ZPX
 
NBADDR_ZPX
; 
waddr
 = 
¿ddr
 = 
baddr
; 
wËn
 = 
¾’
 = 1

	)

205 
	#R_BADDR_ZPY
 
NBADDR_ZPY
; 
¿ddr
 = 
baddr
; 
¾’
 = 1

	)

206 
	#W_BADDR_ZPY
 
NBADDR_ZPY
; 
waddr
 = 
baddr
; 
wËn
 = 1

	)

207 
	#RW_BADDR_ZPY
 
NBADDR_ZPY
; 
waddr
 = 
¿ddr
 = 
baddr
; 
wËn
 = 
¾’
 = 1

	)

208 
	#R_BADDR_ABS
 
NBADDR_ABS
; 
¿ddr
 = 
baddr
; 
¾’
 = 1

	)

209 
	#W_BADDR_ABS
 
NBADDR_ABS
; 
waddr
 = 
baddr
; 
wËn
 = 1

	)

210 
	#RW_BADDR_ABS
 
NBADDR_ABS
; 
waddr
 = 
¿ddr
 = 
baddr
; 
wËn
 = 
¾’
 = 1

	)

211 
	#R_BADDR_ABX
 
NBADDR_ABX
; 
¿ddr
 = 
baddr
; 
¾’
 = 1

	)

212 
	#W_BADDR_ABX
 
NBADDR_ABX
; 
waddr
 = 
baddr
; 
wËn
 = 1

	)

213 
	#RW_BADDR_ABX
 
NBADDR_ABX
; 
waddr
 = 
¿ddr
 = 
baddr
; 
wËn
 = 
¾’
 = 1

	)

214 
	#R_BADDR_ABY
 
NBADDR_ABY
; 
¿ddr
 = 
baddr
; 
¾’
 = 1

	)

215 
	#W_BADDR_ABY
 
NBADDR_ABY
; 
waddr
 = 
baddr
; 
wËn
 = 1

	)

216 
	#RW_BADDR_ABY
 
NBADDR_ABY
; 
waddr
 = 
¿ddr
 = 
baddr
; 
wËn
 = 
¾’
 = 1

	)

217 
	#R_BADDR_ZIX
 
NBADDR_ZIX
; 
¿ddr
 = 
baddr
; 
¾’
 = 1

	)

218 
	#W_BADDR_ZIX
 
NBADDR_ZIX
; 
waddr
 = 
baddr
; 
wËn
 = 1

	)

219 
	#RW_BADDR_ZIX
 
NBADDR_ZIX
; 
waddr
 = 
¿ddr
 = 
baddr
; 
wËn
 = 
¾’
 = 1

	)

220 
	#R_BADDR_ZIY
 
NBADDR_ZIY
; 
¿ddr
 = 
baddr
; 
¾’
 = 1

	)

221 
	#W_BADDR_ZIY
 
NBADDR_ZIY
; 
waddr
 = 
baddr
; 
wËn
 = 1

	)

222 
	#RW_BADDR_ZIY
 
NBADDR_ZIY
; 
waddr
 = 
¿ddr
 = 
baddr
; 
wËn
 = 
¾’
 = 1

	)

225 
	#READ_IMM
 
v
=
ýu
->
	`»ad
Ðýu, cpu->
pc
++ )

	)

226 
	#READ_ZP
 
v
=
ýu
->
	`»ad
Ðýu, cpu->»adÐýu, cpu->
pc
++ ) )

	)

227 
	#READ_ZPX
 
v
=
ýu
->
	`»ad
Ðýu, (ýu->»adÐýu, cpu->
pc
++ ) + cpu->
x
)&0xfà)

	)

228 
	#READ_ZPY
 
v
=
ýu
->
	`»ad
Ðýu, (ýu->»adÐýu, cpu->
pc
++ ) + cpu->
y
)&0xfà)

	)

229 
	#READ_ABS
 
v
=
ýu
->
	`»ad
Ðýu, (ýu->»adÐýu, cpu->
pc
+1 )<<8è| cpu->»adÐýu, cpu->pøè); cpu->pc+=2

	)

230 
	#READ_ABX
 
BADDR_ABX
; 
v
 = 
ýu
->
	`»ad
Ðýu, 
baddr
 ); cpu->
pc
+=2

	)

231 
	#READ_ABY
 
BADDR_ABY
; 
v
 = 
ýu
->
	`»ad
Ðýu, 
baddr
 ); cpu->
pc
+=2

	)

232 
	#READ_ZIX
 
BADDR_ZIX
; 
v
 = 
ýu
->
	`»ad
Ðýu, 
baddr
 ); cpu->
pc
++

	)

233 
	#READ_ZIY
 
BADDR_ZIY
; 
v
 = 
ýu
->
	`»ad
Ðýu, 
baddr
 ); cpu->
pc
++

	)

235 
	#KREAD_ZP
 
baddr
 = 
ýu
->
	`»ad
Ðýu, cpu->
pc
++ ); 
v
 = cpu->»adÐýu, badd¸)

	)

236 
	#KREAD_ZPX
 
baddr
 = ()(
ýu
->
	`»ad
Ðýu, cpu->
pc
++ )+ýu->
x
); 
v
 = cpu->»adÐýu, badd¸)

	)

237 
	#KREAD_ABS
 
baddr
 = (
ýu
->
	`»ad
Ðýu, cpu->
pc
+1 )<<8è| cpu->»adÐýu, cpu->pø); 
v
=ýu->»adÐýu, badd¸); cpu->pc+=2

	)

240 
	#WRITE_ZP
(
n
è
ýu
->
	`wr™e
Ðýu, cpu->
	`»ad
Ðýu, cpu->
pc
++ ),‚ )

	)

241 
	#WRITE_ZPX
(
n
è
ýu
->
	`wr™e
Ðýu, (ýu->
	`»ad
Ðýu, cpu->
pc
++ ) + cpu->
x
)&0xff,‚ )

	)

242 
	#WRITE_ZPY
(
n
è
ýu
->
	`wr™e
Ðýu, (ýu->
	`»ad
Ðýu, cpu->
pc
++ ) + cpu->
y
)&0xff,‚ )

	)

243 
	#WRITE_ABS
(
n
è
ýu
->
	`wr™e
Ðýu, (ýu->
	`»ad
Ðýu, cpu->
pc
+1 )<<8è| cpu->»adÐýu, cpu->pø),‚ ); cpu->pc+=2

	)

244 
	#WRITE_ABX
(
n
è
baddr
 = ((
ýu
->
	`»ad
Ðýu, cpu->
pc
+1 )<<8è| cpu->»adÐýu, cpu->pø)); cpu->
	`wr™e
Ðýu, badd¸+ cpu->
x
,‚ ); cpu->pc+=2

	)

245 
	#WRITE_ABY
(
n
è
baddr
 = ((
ýu
->
	`»ad
Ðýu, cpu->
pc
+1 )<<8è| cpu->»adÐýu, cpu->pø)); cpu->
	`wr™e
Ðýu, badd¸+ cpu->
y
,‚ ); cpu->pc+=2

	)

246 
	#WRITE_ZIX
(
n
è
baddr
 = ()(
ýu
->
	`»ad
Ðýu, cpu->
pc
++ )+ýu->
x
); cpu->
	`wr™e
Ðýu, (ýu->»adÐýu, baddr+1 )<<8è| cpu->»adÐýu, badd¸),‚ )

	)

247 
	#WRITE_ZIY
(
n
è
baddr
 = 
ýu
->
	`»ad
Ðýu, cpu->
pc
++ ); badd¸ð(ýu->»adÐýu, baddr+1 )<<8è| cpu->»adÐýu, badd¸); cpu->
	`wr™e
Ðýu, badd¸+ cpu->
y
,‚ )

	)

250 
	#PAGECHECK
(
n
èÐ((
baddr
+n)&0xff00è!ð(baddr&0xff00è)

	)

253 
	#CPAGECHECK
 ((
ýu
->
baddr
&0xff00è!ð(baddr&0xff00))

	)

256 
	#BPAGECHECK
 ( (
ýu
->
baddr
&0xff00è!ð(ýu->
ÿlýc
&0xff00è)

	)

259 
	#BRANCH
(
cÚd™iÚ
èifÐcÚd™iÚ ) 
ýu
->
pc
 = cpu->
baddr
; ýu->pc++;

	)

262 
	#IBRANCH
(
cÚd™iÚ
è
ýu
->
icyþes
 = 2;\

263 ifÐ
cÚd™iÚ
 )\

265 
ýu
->
baddr
 = cpu->
ÿlýc
+2+((sigÃd )ýu->
	`»ad
( cpu, cpu->calcpc+1 ));\

266 
ýu
->
icyþes
++;\

267 ifÐ
BPAGECHECK
 ) 
ýu
->
icyþes
++;\

269 

	)

271 
	#PUSHB
(
n
è
ýu
->
	`wr™e
Ðýu, (ýu->
¥
--)+0x100,‚ )

	)

272 
	#POPB
 
ýu
->
	`»ad
Ðýu, (++ýu->
¥
)+0x100 )

	)

273 
	#PUSHW
(
n
è
	`PUSHB
Ðn>>8 ); PUSHBÐÀ)

	)

274 
	#POPW
(
n
èÀð(
ýu
->
	`»ad
(ýu,((ýu->
¥
+2)&0xff)+0x100)<<8)|ýu->»ad(ýu,((ýu->¥+1)&0xff)+0x100); cpu->¥+=2

	)

279 
SDL_boÞ
 
	$m6502_£t_icyþes
Ð
m6502
 *
ýu
, 
SDL_boÞ
 
dobp
, *
bpmsg
 )

281 
baddr
;

282 
exŒa
 = 0;

283 
i
;

285 ifÐ
ýu
->
nmicouÁ
 > 0 )

287 
ýu
->
nmicouÁ
--;

288 ifÐ!
ýu
->
nmicouÁ
 )

289 
ýu
->
nmi
 = 
SDL_FALSE
;

292 ifÐ
ýu
->
nmi
 )

294 
exŒa
 = 7;

295 
ýu
->
ÿlýc
 = (ýu->
	`»ad
( cpu, 0xfffb )<<8)|cpu->read( cpu, 0xfffa );

296 
ýu
->
ÿlcšt
 = 2;

297 } ifÐÐ
ýu
->
œq
 ) && ( cpu->
f_i
 == 0 ) ) {

298 
exŒa
 = 7;

299 
ýu
->
ÿlýc
 = (ýu->
	`»ad
( cpu, 0xffff )<<8)|cpu->read( cpu, 0xfffe );

300 
ýu
->
ÿlcšt
 = 1;

304 
ýu
->
ÿlýc
 = cpu->
pc
;

305 
ýu
->
ÿlcšt
 = 0;

308 
ýu
->
ÿlcÝ
 = cpu->
	`»ad
Ðýu, cpu->
ÿlýc
 );

309 ifÐ
dobp
 )

311 ifÐ
ýu
->
ªybp
 )

313  
i
=0; i<16; i++ )

315 ifÐÐ
ýu
->
b»akpošts
[
i
] !ð-1 ) && ( cpu->
ÿlýc
 == cpu->breakpoints[i] ) )

317 ifÐ(
ýu
->
b»akpošt_æags
[
i
] & 
MBPF_RESETCYCLES
è=ðMBPF_RESETCYCLES ) cpu->
cyþes
 = 0;

318 ifÐ(
ýu
->
b»akpošt_æags
[
i
] & 
MBPF_RESETCYCLESCONTINUE
è!ðMBPF_RESETCYCLESCONTINUE )  
SDL_TRUE
;

323 ifÐ
ýu
->
ªymbp
 )

325 
waddr
, 
¿ddr
, 
wËn
, 
¾’
;

327 
waddr
 = 
¿ddr
 = 0;

328 
wËn
 = 
¾’
 = 0;

331  
ýu
->
ÿlcÝ
 )

334 
waddr
 = (
ýu
->
¥
+0x100)-3;

335 
wËn
 = 3;

339 
waddr
 = (
ýu
->
¥
+0x100);

340 
wËn
 = 3;

345 
waddr
 = (
ýu
->
¥
+0x100)-1;

346 
wËn
 = 1;

351 
¿ddr
 = 
ýu
->
¥
+0x100;

352 
¾’
 = 1;

356 
¿ddr
 = 
ýu
->
¥
+0x100;

357 
¾’
 = 2;

361 
waddr
 = (
ýu
->
¥
+0x100)-2;

362 
wËn
 = 2;

371 #ifdeà
ILLEGALS


379 
RW_BADDR_ZP
;

388 #ifdeà
ILLEGALS


396 
RW_BADDR_ABS
;

405 #ifdeà
ILLEGALS


413 
RW_BADDR_ABX
;

422 #ifdeà
ILLEGALS


430 
RW_BADDR_ZPX
;

433 #ifdeà
ILLEGALS


440 
RW_BADDR_ABY
;

449 
RW_BADDR_ZIX
;

458 
RW_BADDR_ZIY
;

469 #ifdeà
ILLEGALS


472 
R_BADDR_ZIX
;

483 #ifdeà
ILLEGALS


486 
R_BADDR_ZIY
;

501 #ifdeà
ILLEGALS


504 
R_BADDR_ZP
;

519 #ifdeà
ILLEGALS


522 
R_BADDR_ABS
;

533 
R_BADDR_ZPX
;

544 #ifdeà
ILLEGALS


547 
R_BADDR_ABY
;

558 
R_BADDR_ABX
;

562 #ifdeà
ILLEGALS


565 
R_BADDR_ZPY
;

569 
¿ddr
 = (
ýu
->
	`»ad
Ðýu, cpu->
ÿlýc
+2 )<<8)|cpu->read( cpu, cpu->calcpc+1 );

570 
¾’
 = 2;

574 #ifdeà
ILLEGALS


577 
W_BADDR_ZIX
;

583 #ifdeà
ILLEGALS


586 
W_BADDR_ZP
;

592 #ifdeà
ILLEGALS


595 
W_BADDR_ABS
;

599 
W_BADDR_ZIY
;

604 
W_BADDR_ZPX
;

608 #ifdeà
ILLEGALS


611 
W_BADDR_ZPY
;

615 #ifdeà
ILLEGALS


619 
W_BADDR_ABY
;

623 
W_BADDR_ABX
;

627  
i
=0; i<16; i++ )

629 ifÐÐ
wËn
 !ð0 ) && ( 
ýu
->
memb»akpošts
[
i
].
æags
 & 
MBPF_WRITE
 ) )

631 ifÐÐ
ýu
->
memb»akpošts
[
i
].
addr
 >ð
waddr
 ) &&

632 Ð
ýu
->
memb»akpošts
[
i
].
addr
 < (
waddr
+
wËn
) ) )

634 
	`¥rštf
Ð
bpmsg
, "B»ak oÀWRITEØ$%04X", 
ýu
->
memb»akpošts
[
i
].
addr
 );

635  
SDL_TRUE
;

639 ifÐÐ
¾’
 !ð0 ) && ( 
ýu
->
memb»akpošts
[
i
].
æags
 & 
MBPF_READ
 ) )

641 ifÐÐ
ýu
->
memb»akpošts
[
i
].
addr
 >ð
¿ddr
 ) &&

642 Ð
ýu
->
memb»akpošts
[
i
].
addr
 < (
¿ddr
+
¾’
) ) )

644 
	`¥rštf
Ð
bpmsg
, "B»ak oÀREAD from $%04X", 
ýu
->
memb»akpošts
[
i
].
addr
 );

645  
SDL_TRUE
;

649 ifÐ
ýu
->
memb»akpošts
[
i
].
æags
 & 
MBPF_CHANGE
 )

651 ifÐ
ýu
->
memb»akpošts
[
i
].
Ï¡v®
 !ðýu->
	`»ad
Ðýu, cpu->memb»akpošts[i].
addr
 ) )

653 
ýu
->
memb»akpošts
[
i
].
Ï¡v®
 = cpu->
	`»ad
Ðýu, cpu->memb»akpošts[i].
addr
 );

654 
	`¥rštf
Ð
bpmsg
, "B»ak‡á” $%04X chªged", 
ýu
->
memb»akpošts
[
i
].
addr
 );

655  
SDL_TRUE
;

663  
ýu
->
ÿlcÝ
 )

682 
ýu
->
icyþes
 = 7;

722 
ýu
->
icyþes
 = 6;

748 
ýu
->
icyþes
 = 3;

769 
ýu
->
icyþes
 = 5;

824 
ýu
->
icyþes
 = 2;

867 
ýu
->
icyþes
 = 4;

880 
ýu
->
icyþes
 = 8;

884 
	`IBRANCH
Ð!
ýu
->
f_n
 );

895 
baddr
 = 
ýu
->
	`»ad
Ðýu, cpu->
ÿlýc
+1 );

896 
baddr
 = ((
ýu
->
	`»ad
( cpu, baddr+1 )<<8) | cpu->read( cpu, baddr ));

897 
ýu
->
icyþes
 = 5;

898 
ýu
->
baddr
 = baddr+ýu->
y
;

899 ifÐ
CPAGECHECK
 ) 
ýu
->
icyþes
++;

903 
baddr
 = 
ýu
->
	`»ad
Ðýu, cpu->
ÿlýc
+1 );

904 
baddr
 = ((
ýu
->
	`»ad
( cpu, baddr+1 )<<8) | cpu->read( cpu, baddr ));

905 
ýu
->
icyþes
 = 4;

906 
ýu
->
baddr
 = baddr+ýu->
y
;

907 ifÐ
CPAGECHECK
 ) 
ýu
->
icyþes
++;

919 
NBADDR_ABS
;

920 
ýu
->
icyþes
 = 4;

921 
ýu
->
baddr
 = baddr+ýu->
y
;

922 ifÐ
CPAGECHECK
 ) 
ýu
->
icyþes
++;

939 
NBADDR_ABS
;

940 
ýu
->
icyþes
 = 4;

941 
ýu
->
baddr
 = baddr+ýu->
x
;

942 ifÐ
CPAGECHECK
 ) 
ýu
->
icyþes
++;

946 
	`IBRANCH
Ð
ýu
->
f_n
 );

950 
	`IBRANCH
Ð!
ýu
->
f_v
 );

954 
	`IBRANCH
Ð
ýu
->
f_v
 );

958 
	`IBRANCH
Ð!
ýu
->
f_c
 );

962 
	`IBRANCH
Ð
ýu
->
f_c
 );

966 
	`IBRANCH
Ð!
ýu
->
f_z
 );

970 
	`IBRANCH
Ð
ýu
->
f_z
 );

974 
ýu
->
icyþes
 = 6;

978 
ýu
->
icyþes
 +ð
exŒa
;

979  
SDL_FALSE
;

980 
	}
}

983 
SDL_boÞ
 
	$m6502_š¡
Ð
m6502
 *
ýu
 )

985 
v
;

986 
r
, 
t
, 
baddr
;

989 
ýu
->
cyþes
 +ðýu->
icyþes
;

991 ifÐ
ýu
->
ÿlcšt
 > 0 )

993 
	`PUSHW
Ð
ýu
->
pc
 );

994 
	`PUSHB
Ð
MAKEFLAGSBC
 );

995 
ýu
->
f_d
 = 0;

996 ifÐ
ýu
->
ÿlcšt
 == 2 )

998 
ýu
->
nmi
 = 
SDL_FALSE
;

1000 
ýu
->
f_i
 = 1;

1004 #ià
	`defšed
(
DEBUG_CPU_TRACE
) && DEBUG_CPU_TRACE > 0

1005 
	`mÚ_Œaûš¡
(
ýu
);

1008 
ýu
->
Ï¡pc
 = cpu->
pc
 = cpu->
ÿlýc
;

1009 
ýu
->
pc
++;

1010  
ýu
->
ÿlcÝ
 )

1013 
	`PUSHW
Ð(
ýu
->
pc
+1) );

1014 
	`PUSHB
Ð
MAKEFLAGS
 | (1<<4) );

1015 
ýu
->
f_i
 = 1;

1016 
ýu
->
f_d
 = 0;

1017 
ýu
->
pc
 = (ýu->
	`»ad
( cpu, 0xffff )<<8) | cpu->read( cpu, 0xfffe );

1021 
READ_ZIX
;

1022 
DO_ORA
;

1026 
READ_ZP
;

1027 
DO_ORA
;

1031 
KREAD_ZP
;

1032 
	`DO_ASL
(
v
);

1033 
ýu
->
	`wr™e
Ðýu, 
baddr
, 
v
 );

1037 
	`PUSHB
Ð
MAKEFLAGS
 );

1041 
READ_IMM
;

1042 
DO_ORA
;

1046 
	`DO_ASL
(
ýu
->
a
);

1050 
READ_ABS
;

1051 
DO_ORA
;

1055 
KREAD_ABS
;

1056 
	`DO_ASL
(
v
);

1057 
ýu
->
	`wr™e
Ðýu, 
baddr
, 
v
 );

1061 
	`BRANCH
Ð!
ýu
->
f_n
 );

1065 
v
 = 
ýu
->
	`»ad
Ðýu, cpu->
baddr
 );

1066 
ýu
->
pc
++;

1067 
DO_ORA
;

1071 
READ_ZPX
;

1072 
DO_ORA
;

1076 
KREAD_ZPX
;

1077 
	`DO_ASL
(
v
);

1078 
ýu
->
	`wr™e
Ðýu, 
baddr
, 
v
 );

1082 
ýu
->
f_c
 = 0;

1087 
v
 = 
ýu
->
	`»ad
Ðýu, cpu->
baddr
 );

1088 
ýu
->
pc
+=2;

1089 
DO_ORA
;

1093 
READ_ABX
;

1094 
	`DO_ASL
(
v
);

1095 
ýu
->
	`wr™e
Ðýu, 
baddr
, 
v
 );

1099 
baddr
 = (
ýu
->
	`»ad
Ðýu, cpu->
pc
+1 )<<8) | cpu->read( cpu, cpu->pc );

1100 
	`PUSHW
Ð(
ýu
->
pc
+1) );

1101 
ýu
->
pc
 = 
baddr
;

1105 
READ_ZIX
;

1106 
DO_AND
;

1110 
READ_ZP
;

1111 
ýu
->
f_n
 = 
v
&0x80 ? 1 : 0;

1112 
ýu
->
f_v
 = 
v
&0x40 ? 1 : 0;

1113 
ýu
->
f_z
 = (ýu->
a
&
v
)==0;

1117 
READ_ZP
;

1118 
DO_AND
;

1122 
KREAD_ZP
;

1123 
	`DO_ROL
(
v
);

1124 
ýu
->
	`wr™e
Ðýu, 
baddr
, 
v
 );

1128 
v
 = 
POPB
|(1<<4);

1129 
	`SETFLAGS
(
v
);

1133 
READ_IMM
;

1134 
DO_AND
;

1138 
	`DO_ROL
(
ýu
->
a
);

1142 
READ_ABS
;

1143 
ýu
->
f_n
 = 
v
&0x80 ? 1 : 0;

1144 
ýu
->
f_v
 = 
v
&0x40 ? 1 : 0;

1145 
ýu
->
f_z
 = (ýu->
a
&
v
)==0;

1149 
READ_ABS
;

1150 
DO_AND
;

1154 
KREAD_ABS
;

1155 
	`DO_ROL
(
v
);

1156 
ýu
->
	`wr™e
Ðýu, 
baddr
, 
v
 );

1160 
	`BRANCH
Ð
ýu
->
f_n
 );

1164 
v
 = 
ýu
->
	`»ad
Ðýu, cpu->
baddr
 );

1165 
ýu
->
pc
++;

1166 
DO_AND
;

1170 
READ_ZPX
;

1171 
DO_AND
;

1175 
KREAD_ZPX
;

1176 
	`DO_ROL
(
v
);

1177 
ýu
->
	`wr™e
Ðýu, 
baddr
, 
v
 );

1181 
ýu
->
f_c
 = 1;

1186 
v
 = 
ýu
->
	`»ad
Ðýu, cpu->
baddr
 );

1187 
ýu
->
pc
+=2;

1188 
DO_AND
;

1192 
READ_ABX
;

1193 
	`DO_ROL
(
v
);

1194 
ýu
->
	`wr™e
Ðýu, 
baddr
, 
v
 );

1198 
v
 = 
POPB
;

1199 
	`SETFLAGS
(
v
);

1200 
	`POPW
Ð
ýu
->
pc
 );

1204 
READ_ZIX
;

1205 
DO_EOR
;

1209 
READ_ZP
;

1210 
DO_EOR
;

1214 
KREAD_ZP
;

1215 
	`DO_LSR
(
v
);

1216 
ýu
->
	`wr™e
Ðýu, 
baddr
, 
v
 );

1220 
	`PUSHB
Ð
ýu
->
a
 );

1224 
READ_IMM
;

1225 
DO_EOR
;

1229 
	`DO_LSR
(
ýu
->
a
);

1233 
ýu
->
pc
 = (ýu->
	`»ad
( cpu, cpu->pc+1 )<<8)|cpu->read( cpu, cpu->pc );

1237 
READ_ABS
;

1238 
DO_EOR
;

1242 
KREAD_ABS
;

1243 
	`DO_LSR
(
v
);

1244 
ýu
->
	`wr™e
Ðýu, 
baddr
, 
v
 );

1248 
	`BRANCH
Ð!
ýu
->
f_v
 );

1252 
v
 = 
ýu
->
	`»ad
Ðýu, cpu->
baddr
 );

1253 
ýu
->
pc
++;

1254 
DO_EOR
;

1258 
READ_ZPX
;

1259 
DO_EOR
;

1263 
KREAD_ZPX
;

1264 
	`DO_LSR
(
v
);

1265 
ýu
->
	`wr™e
Ðýu, 
baddr
, 
v
 );

1269 
ýu
->
f_i
 = 0;

1274 
v
 = 
ýu
->
	`»ad
Ðýu, cpu->
baddr
 );

1275 
ýu
->
pc
+=2;

1276 
DO_EOR
;

1280 
READ_ABX
;

1281 
	`DO_LSR
(
v
);

1282 
ýu
->
	`wr™e
Ðýu, 
baddr
, 
v
 );

1286 
	`POPW
Ð
ýu
->
pc
 );

1287 
ýu
->
pc
++;

1291 
READ_ZIX
;

1292 
DO_ADC
;

1296 
READ_ZP
;

1297 
DO_ADC
;

1301 
KREAD_ZP
;

1302 
	`DO_ROR
(
v
);

1303 
ýu
->
	`wr™e
Ðýu, 
baddr
, 
v
 );

1307 
ýu
->
a
 = 
POPB
;

1308 
	`FLAG_ZN
(
ýu
->
a
);

1312 
READ_IMM
;

1313 
DO_ADC
;

1317 
	`DO_ROR
(
ýu
->
a
);

1321 
baddr
 = (
ýu
->
	`»ad
Ðýu, cpu->
pc
+1 )<<8)|cpu->read( cpu, cpu->pc );

1322 
ýu
->
pc
 = (ýu->
	`»ad
Ðýu, 
baddr
+1 )<<8)|cpu->read( cpu, baddr );

1326 
READ_ABS
;

1327 
DO_ADC
;

1331 
KREAD_ABS
;

1332 
	`DO_ROR
(
v
);

1333 
ýu
->
	`wr™e
Ðýu, 
baddr
, 
v
 );

1337 
	`BRANCH
Ð
ýu
->
f_v
 );

1341 
v
 = 
ýu
->
	`»ad
Ðýu, cpu->
baddr
 );

1342 
ýu
->
pc
++;

1343 
DO_ADC
;

1347 
READ_ZPX
;

1348 
DO_ADC
;

1352 
KREAD_ZPX
;

1353 
	`DO_ROR
(
v
);

1354 
ýu
->
	`wr™e
Ðýu, 
baddr
, 
v
 );

1358 
ýu
->
f_i
 = 1;

1363 
v
 = 
ýu
->
	`»ad
Ðýu, cpu->
baddr
 );

1364 
ýu
->
pc
+=2;

1365 
DO_ADC
;

1369 
READ_ABX
;

1370 
	`DO_ROR
(
v
);

1371 
ýu
->
	`wr™e
Ðýu, 
baddr
, 
v
 );

1375 
	`WRITE_ZIX
(
ýu
->
a
);

1379 
	`WRITE_ZP
(
ýu
->
y
);

1383 
	`WRITE_ZP
(
ýu
->
a
);

1387 
	`WRITE_ZP
(
ýu
->
x
);

1391 
ýu
->
y
--;

1392 
	`FLAG_ZN
(
ýu
->
y
);

1396 
ýu
->
a
 = cpu->
x
;

1397 
	`FLAG_ZN
(
ýu
->
a
);

1401 
	`WRITE_ABS
(
ýu
->
y
);

1405 
	`WRITE_ABS
(
ýu
->
a
);

1409 
	`WRITE_ABS
(
ýu
->
x
);

1413 
	`BRANCH
Ð!
ýu
->
f_c
 );

1417 
	`WRITE_ZIY
(
ýu
->
a
);

1421 
	`WRITE_ZPX
(
ýu
->
y
);

1425 
	`WRITE_ZPX
(
ýu
->
a
);

1429 
	`WRITE_ZPY
(
ýu
->
x
);

1433 
ýu
->
a
 = cpu->
y
;

1434 
	`FLAG_ZN
(
ýu
->
a
);

1438 
	`WRITE_ABY
(
ýu
->
a
);

1442 
ýu
->
¥
 = cpu->
x
;

1446 
	`WRITE_ABX
(
ýu
->
a
);

1450 
READ_IMM
;

1451 
ýu
->
y
 = 
v
;

1452 
	`FLAG_ZN
(
ýu
->
y
);

1456 
READ_ZIX
;

1457 
ýu
->
a
 = 
v
;

1458 
	`FLAG_ZN
(
ýu
->
a
);

1462 
READ_IMM
;

1463 
ýu
->
x
 = 
v
;

1464 
	`FLAG_ZN
(
ýu
->
x
);

1468 
READ_ZP
;

1469 
ýu
->
y
 = 
v
;

1470 
	`FLAG_ZN
(
ýu
->
y
);

1474 
READ_ZP
;

1475 
ýu
->
a
 = 
v
;

1476 
	`FLAG_ZN
(
ýu
->
a
);

1480 
READ_ZP
;

1481 
ýu
->
x
 = 
v
;

1482 
	`FLAG_ZN
(
ýu
->
x
);

1486 
ýu
->
y
 = cpu->
a
;

1487 
	`FLAG_ZN
(
ýu
->
y
);

1491 
READ_IMM
;

1492 
ýu
->
a
 = 
v
;

1493 
	`FLAG_ZN
(
ýu
->
a
);

1497 
ýu
->
x
 = cpu->
a
;

1498 
	`FLAG_ZN
(
ýu
->
x
);

1502 
READ_ABS
;

1503 
ýu
->
y
 = 
v
;

1504 
	`FLAG_ZN
(
ýu
->
y
);

1508 
READ_ABS
;

1509 
ýu
->
a
 = 
v
;

1510 
	`FLAG_ZN
(
ýu
->
a
);

1514 
READ_ABS
;

1515 
ýu
->
x
 = 
v
;

1516 
	`FLAG_ZN
(
ýu
->
x
);

1520 
	`BRANCH
Ð
ýu
->
f_c
 );

1524 
ýu
->
a
 = cpu->
	`»ad
Ðýu, cpu->
baddr
 );

1525 
ýu
->
pc
++;

1526 
	`FLAG_ZN
(
ýu
->
a
);

1530 
READ_ZPX
;

1531 
ýu
->
y
 = 
v
;

1532 
	`FLAG_ZN
(
ýu
->
y
);

1536 
READ_ZPX
;

1537 
ýu
->
a
 = 
v
;

1538 
	`FLAG_ZN
(
ýu
->
a
);

1542 
READ_ZPY
;

1543 
ýu
->
x
 = 
v
;

1544 
	`FLAG_ZN
(
ýu
->
x
);

1548 
ýu
->
f_v
 = 0;

1553 
ýu
->
a
 = cpu->
	`»ad
Ðýu, cpu->
baddr
 );

1554 
ýu
->
pc
+=2;

1555 
	`FLAG_ZN
(
ýu
->
a
);

1559 
ýu
->
x
 = cpu->
¥
;

1560 
	`FLAG_ZN
(
ýu
->
x
);

1564 
ýu
->
y
 = cpu->
	`»ad
Ðýu, cpu->
baddr
 );

1565 
ýu
->
pc
+=2;

1566 
	`FLAG_ZN
(
ýu
->
y
);

1570 
ýu
->
x
 = cpu->
	`»ad
Ðýu, cpu->
baddr
 );

1571 
ýu
->
pc
+=2;

1572 
	`FLAG_ZN
(
ýu
->
x
);

1576 
READ_IMM
;

1577 
r
 = 
ýu
->
y
-
v
;

1578 
	`FLAG_SZCN
(
r
);

1582 
READ_ZIX
;

1583 
r
 = 
ýu
->
a
-
v
;

1584 
	`FLAG_SZCN
(
r
);

1588 
READ_ZP
;

1589 
r
 = 
ýu
->
y
-
v
;

1590 
	`FLAG_SZCN
(
r
);

1594 
READ_ZP
;

1595 
r
 = 
ýu
->
a
-
v
;

1596 
	`FLAG_SZCN
(
r
);

1600 
KREAD_ZP
;

1601 
ýu
->
	`wr™e
Ðýu, 
baddr
, --
v
 );

1602 
	`FLAG_ZN
(
v
);

1606 
ýu
->
y
++;

1607 
	`FLAG_ZN
(
ýu
->
y
);

1611 
READ_IMM
;

1612 
r
 = 
ýu
->
a
-
v
;

1613 
	`FLAG_SZCN
(
r
);

1617 
ýu
->
x
--;

1618 
	`FLAG_ZN
(
ýu
->
x
);

1622 
READ_ABS
;

1623 
r
 = 
ýu
->
y
-
v
;

1624 
	`FLAG_SZCN
(
r
);

1628 
READ_ABS
;

1629 
r
 = 
ýu
->
a
-
v
;

1630 
	`FLAG_SZCN
(
r
);

1634 
KREAD_ABS
;

1635 
ýu
->
	`wr™e
Ðýu, 
baddr
, --
v
 );

1636 
	`FLAG_ZN
(
v
);

1640 
	`BRANCH
Ð!
ýu
->
f_z
 );

1644 
r
 = 
ýu
->
a
-ýu->
	`»ad
Ðýu, cpu->
baddr
 );

1645 
ýu
->
pc
++;

1646 
	`FLAG_SZCN
(
r
);

1650 
READ_ZPX
;

1651 
r
 = 
ýu
->
a
-
v
;

1652 
	`FLAG_SZCN
(
r
);

1656 
KREAD_ZPX
;

1657 
ýu
->
	`wr™e
Ðýu, 
baddr
, --
v
 );

1658 
	`FLAG_ZN
(
v
);

1662 
ýu
->
f_d
 = 0;

1667 
r
 = 
ýu
->
a
 - cpu->
	`»ad
Ðýu, cpu->
baddr
 );

1668 
ýu
->
pc
+=2;

1669 
	`FLAG_SZCN
(
r
);

1673 
READ_ABX
;

1674 
ýu
->
	`wr™e
Ðýu, 
baddr
, --
v
 );

1675 
	`FLAG_ZN
(
v
);

1679 
READ_IMM
;

1680 
r
 = 
ýu
->
x
-
v
;

1681 
	`FLAG_SZCN
(
r
);

1685 
READ_ZIX
;

1686 
DO_SBC
;

1690 
READ_ZP
;

1691 
r
 = 
ýu
->
x
-
v
;

1692 
	`FLAG_SZCN
(
r
);

1696 
READ_ZP
;

1697 
DO_SBC
;

1701 
KREAD_ZP
;

1702 
ýu
->
	`wr™e
Ðýu, 
baddr
, ++
v
 );

1703 
	`FLAG_ZN
(
v
);

1707 
ýu
->
x
++;

1708 
	`FLAG_ZN
(
ýu
->
x
);

1712 #ifdeà
ILLEGALS


1715 
READ_IMM
;

1716 
DO_SBC
;

1723 
READ_ABS
;

1724 
r
 = 
ýu
->
x
-
v
;

1725 
	`FLAG_SZCN
(
r
);

1729 
READ_ABS
;

1730 
DO_SBC
;

1734 
KREAD_ABS
;

1735 
ýu
->
	`wr™e
Ðýu, 
baddr
, ++
v
 );

1736 
	`FLAG_ZN
(
v
);

1740 
	`BRANCH
Ð
ýu
->
f_z
 );

1744 
v
 = 
ýu
->
	`»ad
Ðýu, cpu->
baddr
 );

1745 
ýu
->
pc
++;

1746 
DO_SBC
;

1750 
READ_ZPX
;

1751 
DO_SBC
;

1755 
KREAD_ZPX
;

1756 
ýu
->
	`wr™e
Ðýu, 
baddr
, ++
v
 );

1757 
	`FLAG_ZN
(
v
);

1761 
ýu
->
f_d
 = 1;

1766 
v
 = 
ýu
->
	`»ad
Ðýu, cpu->
baddr
 );

1767 
ýu
->
pc
+=2;

1768 
DO_SBC
;

1772 
READ_ABX
;

1773 
ýu
->
	`wr™e
Ðýu, 
baddr
, ++
v
 );

1774 
	`FLAG_ZN
(
v
);

1778 #ifdeà
ILLEGALS


1781 
READ_IMM
;

1782 
DO_AND
;

1783 
ýu
->
f_c
 = cpu->
f_n
;

1787 
v
 = 
ýu
->
a
 & cpu->
x
;

1788 
	`WRITE_ZP
(
v
);

1789 
ýu
->
f_n
 = (
v
&0x80)!=0;

1790 
ýu
->
f_z
 = 
v
!=0;

1794 
v
 = 
ýu
->
a
 & cpu->
x
;

1795 
	`WRITE_ZPY
(
v
);

1796 
ýu
->
f_n
 = (
v
&0x80)!=0;

1797 
ýu
->
f_z
 = 
v
!=0;

1801 
v
 = 
ýu
->
a
 & cpu->
x
;

1802 
	`WRITE_ZIX
(
v
);

1803 
ýu
->
f_n
 = (
v
&0x80)!=0;

1804 
ýu
->
f_z
 = 
v
!=0;

1808 
v
 = 
ýu
->
a
 & cpu->
x
;

1809 
	`WRITE_ABS
(
v
);

1810 
ýu
->
f_n
 = (
v
&0x80)!=0;

1811 
ýu
->
f_z
 = 
v
!=0;

1815 
READ_IMM
;

1816 
ýu
->
a
 = (ýu->a&
v
)>>1;

1817 
ýu
->
f_n
 = (ýu->
a
&0x80) != 0;

1818 
ýu
->
f_z
 = cpu->
a
 != 0;

1819 
ýu
->
a
&0x60)

1821 0x00: 
ýu
->
f_c
=0; cpu->
f_v
=0; ;

1822 0x20: 
ýu
->
f_c
=0; cpu->
f_v
=1; ;

1823 0x60: 
ýu
->
f_c
=1; cpu->
f_v
=0; ;

1824 0x40: 
ýu
->
f_c
=1; cpu->
f_v
=1; ;

1829 
READ_IMM
;

1830 
ýu
->
a
 = (ýu->a&
v
)>>1;

1831 
	`FLAG_ZCN
(
ýu
->
a
);

1835 
READ_IMM
;

1836 
DO_AND
;

1837 
ýu
->
x
 = cpu->
a
;

1842 
r
 = 
ýu
->
x
;

1845 ià((
ýu
->
cyþes
&7)>2)

1846 
r
 &ð(
ýu
->
pc
>>8)+1;

1848 
v
 = 
ýu
->
a
 & 
r
;

1852 ià(((
ýu
->
cyþes
>>8)&7)<2)

1854 
r
 = (r^0xff)&
ýu
->
a
;

1855 
r
 &ð
ýu
->
cyþes
;

1856 
v
 |ð
r
;

1858 ià(
ýu
->
ÿlcÝ
==0x9F)

1860 
	`WRITE_ABY
(
v
);

1864 
	`WRITE_ZIY
(
v
);

1869 
READ_IMM
;

1870 
ýu
->
x
 = (ýu->
a
&ýu->x)-
v
;

1871 
	`FLAG_ZCN
(
ýu
->
x
);

1875 
BADDR_ZP
;

1876 
v
 = 
ýu
->
	`»ad
(ýu, 
baddr
);

1877 
ýu
->
	`wr™e
(ýu, 
baddr
, --
v
);

1878 
	`WRITE_ZP
(--
v
);

1879 
	`FLAG_ZN
(
v
);

1883 
BADDR_ZPX
;

1884 
v
 = 
ýu
->
	`»ad
(ýu, 
baddr
);

1885 
ýu
->
	`wr™e
(ýu, 
baddr
, --
v
);

1886 
	`FLAG_ZN
(
v
);

1890 
BADDR_ABS
;

1891 
v
 = 
ýu
->
	`»ad
(ýu, 
baddr
);

1892 
ýu
->
	`wr™e
(ýu, 
baddr
, --
v
);

1893 
	`FLAG_ZN
(
v
);

1897 
BADDR_ABX
;

1898 
v
 = 
ýu
->
	`»ad
(ýu, 
baddr
);

1899 
ýu
->
	`wr™e
(ýu, 
baddr
, --
v
);

1900 
	`FLAG_ZN
(
v
);

1904 
BADDR_ABY
;

1905 
v
 = 
ýu
->
	`»ad
(ýu, 
baddr
);

1906 
ýu
->
	`wr™e
(ýu, 
baddr
, --
v
);

1907 
	`FLAG_ZN
(
v
);

1911 
BADDR_ZIX
;

1912 
v
 = 
ýu
->
	`»ad
(ýu, 
baddr
);

1913 
ýu
->
	`wr™e
(ýu, 
baddr
, --
v
);

1914 
	`FLAG_ZN
(
v
);

1918 
BADDR_ZIY
;

1919 
v
 = 
ýu
->
	`»ad
(ýu, 
baddr
);

1920 
ýu
->
	`wr™e
(ýu, 
baddr
, --
v
);

1921 
	`FLAG_ZN
(
v
);

1938 
READ_IMM
;

1950 
READ_ABS
;

1959 
READ_ABX
;

1963 
BADDR_ZP
;

1964 
v
 = 
ýu
->
	`»ad
(ýu, 
baddr
);

1965 
ýu
->
	`wr™e
(ýu, 
baddr
, ++
v
);

1966 
r
 = (
ýu
->
a
 - 
v
è- (ýu->
f_c
^1);

1967 
ýu
->
f_v
 = ((ýu->
a
^
v
)&(ýu->a^(
r
&0xff))&0x80) ? 1 : 0;

1968 
	`FLAG_SZCN
(
r
);

1969 
ýu
->
a
 = 
r
;

1970 
ýu
->
pc
++;

1974 
BADDR_ZPX
;

1975 
v
 = 
ýu
->
	`»ad
(ýu, 
baddr
);

1976 
ýu
->
	`wr™e
(ýu, 
baddr
, ++
v
);

1977 
r
 = (
ýu
->
a
 - 
v
è- (ýu->
f_c
^1);

1978 
ýu
->
f_v
 = ((ýu->
a
^
v
)&(ýu->a^(
r
&0xff))&0x80) ? 1 : 0;

1979 
	`FLAG_SZCN
(
r
);

1980 
ýu
->
a
 = 
r
;

1981 
ýu
->
pc
++;

1985 
BADDR_ABS
;

1986 
v
 = 
ýu
->
	`»ad
(ýu, 
baddr
);

1987 
ýu
->
	`wr™e
(ýu, 
baddr
, ++
v
);

1988 
r
 = (
ýu
->
a
 - 
v
è- (ýu->
f_c
^1);

1989 
ýu
->
f_v
 = ((ýu->
a
^
v
)&(ýu->a^(
r
&0xff))&0x80) ? 1 : 0;

1990 
	`FLAG_SZCN
(
r
);

1991 
ýu
->
a
 = 
r
;

1992 
ýu
->
pc
+=2;

1996 
BADDR_ABX
;

1997 
v
 = 
ýu
->
	`»ad
(ýu, 
baddr
);

1998 
ýu
->
	`wr™e
(ýu, 
baddr
, ++
v
);

1999 
r
 = (
ýu
->
a
 - 
v
è- (ýu->
f_c
^1);

2000 
ýu
->
f_v
 = ((ýu->
a
^
v
)&(ýu->a^(
r
&0xff))&0x80) ? 1 : 0;

2001 
	`FLAG_SZCN
(
r
);

2002 
ýu
->
a
 = 
r
;

2003 
ýu
->
pc
+=2;

2007 
BADDR_ABY
;

2008 
v
 = 
ýu
->
	`»ad
(ýu, 
baddr
);

2009 
ýu
->
	`wr™e
(ýu, 
baddr
, ++
v
);

2010 
r
 = (
ýu
->
a
 - 
v
è- (ýu->
f_c
^1);

2011 
ýu
->
f_v
 = ((ýu->
a
^
v
)&(ýu->a^(
r
&0xff))&0x80) ? 1 : 0;

2012 
	`FLAG_SZCN
(
r
);

2013 
ýu
->
a
 = 
r
;

2014 
ýu
->
pc
+=2;

2018 
BADDR_ZIX
;

2019 
v
 = 
ýu
->
	`»ad
(ýu, 
baddr
);

2020 
ýu
->
	`wr™e
(ýu, 
baddr
, ++
v
);

2021 
r
 = (
ýu
->
a
 - 
v
è- (ýu->
f_c
^1);

2022 
ýu
->
f_v
 = ((ýu->
a
^
v
)&(ýu->a^(
r
&0xff))&0x80) ? 1 : 0;

2023 
	`FLAG_SZCN
(
r
);

2024 
ýu
->
a
 = 
r
;

2025 
ýu
->
pc
++;

2029 
BADDR_ZIY
;

2030 
v
 = 
ýu
->
	`»ad
(ýu, 
baddr
);

2031 
ýu
->
	`wr™e
(ýu, 
baddr
, ++
v
);

2032 
r
 = (
ýu
->
a
 - 
v
è- (ýu->
f_c
^1);

2033 
ýu
->
f_v
 = ((ýu->
a
^
v
)&(ýu->a^(
r
&0xff))&0x80) ? 1 : 0;

2034 
	`FLAG_SZCN
(
r
);

2035 
ýu
->
a
 = 
r
;

2036 
ýu
->
pc
++;

2040 
ýu
->
¥
 &ðýu->
	`»ad
Ðýu, cpu->
baddr
 );

2041 
ýu
->
pc
++;

2042 
ýu
->
a
 = cpu->
¥
;

2043 
ýu
->
x
 = cpu->
¥
;

2044 
	`FLAG_ZN
(
ýu
->
a
);

2048 
READ_ZP
;

2049 
ýu
->
a
 = 
v
;

2050 
ýu
->
x
 = 
v
;

2051 
	`FLAG_ZN
(
ýu
->
a
);

2055 
READ_ZPY
;

2056 
ýu
->
a
 = 
v
;

2057 
ýu
->
x
 = 
v
;

2058 
	`FLAG_ZN
(
ýu
->
a
);

2062 
READ_ABS
;

2063 
ýu
->
a
 = 
v
;

2064 
ýu
->
x
 = 
v
;

2065 
	`FLAG_ZN
(
ýu
->
a
);

2069 
ýu
->
a
 = cpu->
	`»ad
Ðýu, cpu->
baddr
 );

2070 
ýu
->
pc
+=2;

2071 
ýu
->
x
 = cpu->
a
;

2072 
	`FLAG_ZN
(
ýu
->
a
);

2076 
READ_ZIX
;

2077 
ýu
->
a
 = 
v
;

2078 
ýu
->
x
 = 
v
;

2079 
	`FLAG_ZN
(
ýu
->
a
);

2083 
ýu
->
a
 = cpu->
	`»ad
Ðýu, cpu->
baddr
 );

2084 
ýu
->
x
 = cpu->
a
;

2085 
ýu
->
pc
++;

2086 
	`FLAG_ZN
(
ýu
->
a
);

2090 
BADDR_ZP
;

2091 
r
 = (
ýu
->
	`»ad
(ýu, 
baddr
)<<1)|ýu->
f_c
;

2092 
ýu
->
f_c
 = (
r
&0x100)!=0;

2093 
ýu
->
	`wr™e
(ýu, 
baddr
, 
r
);

2094 
ýu
->
a
 &ð
r
;

2095 
	`FLAG_ZN
(
ýu
->
a
);

2096 
ýu
->
pc
++;

2100 
BADDR_ZPX
;

2101 
r
 = (
ýu
->
	`»ad
(ýu, 
baddr
)<<1)|ýu->
f_c
;

2102 
ýu
->
f_c
 = (
r
&0x100)!=0;

2103 
ýu
->
	`wr™e
(ýu, 
baddr
, 
r
);

2104 
ýu
->
a
 &ð
r
;

2105 
	`FLAG_ZN
(
ýu
->
a
);

2106 
ýu
->
pc
++;

2110 
BADDR_ABS
;

2111 
r
 = (
ýu
->
	`»ad
(ýu, 
baddr
)<<1)|ýu->
f_c
;

2112 
ýu
->
f_c
 = (
r
&0x100)!=0;

2113 
ýu
->
	`wr™e
(ýu, 
baddr
, 
r
);

2114 
ýu
->
a
 &ð
r
;

2115 
	`FLAG_ZN
(
ýu
->
a
);

2116 
ýu
->
pc
+=2;

2120 
BADDR_ABX
;

2121 
r
 = (
ýu
->
	`»ad
(ýu, 
baddr
)<<1)|ýu->
f_c
;

2122 
ýu
->
f_c
 = (
r
&0x100)!=0;

2123 
ýu
->
	`wr™e
(ýu, 
baddr
, 
r
);

2124 
ýu
->
a
 &ð
r
;

2125 
	`FLAG_ZN
(
ýu
->
a
);

2126 
ýu
->
pc
+=2;

2130 
BADDR_ABY
;

2131 
r
 = (
ýu
->
	`»ad
(ýu, 
baddr
)<<1)|ýu->
f_c
;

2132 
ýu
->
f_c
 = (
r
&0x100)!=0;

2133 
ýu
->
	`wr™e
(ýu, 
baddr
, 
r
);

2134 
ýu
->
a
 &ð
r
;

2135 
	`FLAG_ZN
(
ýu
->
a
);

2136 
ýu
->
pc
+=2;

2140 
BADDR_ZIX
;

2141 
r
 = (
ýu
->
	`»ad
(ýu, 
baddr
)<<1)|ýu->
f_c
;

2142 
ýu
->
f_c
 = (
r
&0x100)!=0;

2143 
ýu
->
	`wr™e
(ýu, 
baddr
, 
r
);

2144 
ýu
->
a
 &ð
r
;

2145 
	`FLAG_ZN
(
ýu
->
a
);

2146 
ýu
->
pc
++;

2150 
BADDR_ZIY
;

2151 
r
 = (
ýu
->
	`»ad
(ýu, 
baddr
)<<1)|ýu->
f_c
;

2152 
ýu
->
f_c
 = (
r
&0x100)!=0;

2153 
ýu
->
	`wr™e
(ýu, 
baddr
, 
r
);

2154 
ýu
->
a
 &ð
r
;

2155 
	`FLAG_ZN
(
ýu
->
a
);

2156 
ýu
->
pc
++;

2160 
BADDR_ZP
;

2161 
r
 = 
ýu
->
	`»ad
(ýu, 
baddr
);

2162 
v
 = (
r
>>1)|(
ýu
->
f_c
<<7);

2163 
ýu
->
f_c
 = 
r
&1;

2164 
ýu
->
	`wr™e
(ýu, 
baddr
, 
v
);

2165 
r
 = 
ýu
->
a
 + 
v
 + cpu->
f_c
;

2166 
ýu
->
f_v
 = ((ýu->
a
^
v
)&(ýu->a^(
r
&0xff))&0x80) ? 1 : 0;

2167 
	`FLAG_ZCN
(
r
);

2168 
ýu
->
a
 = 
r
;

2169 
ýu
->
pc
++;

2173 
BADDR_ZPX
;

2174 
r
 = 
ýu
->
	`»ad
(ýu, 
baddr
);

2175 
v
 = (
r
>>1)|(
ýu
->
f_c
<<7);

2176 
ýu
->
f_c
 = 
r
&1;

2177 
ýu
->
	`wr™e
(ýu, 
baddr
, 
v
);

2178 
r
 = 
ýu
->
a
 + 
v
 + cpu->
f_c
;

2179 
ýu
->
f_v
 = ((ýu->
a
^
v
)&(ýu->a^(
r
&0xff))&0x80) ? 1 : 0;

2180 
	`FLAG_ZCN
(
r
);

2181 
ýu
->
a
 = 
r
;

2182 
ýu
->
pc
++;

2186 
BADDR_ABS
;

2187 
r
 = 
ýu
->
	`»ad
(ýu, 
baddr
);

2188 
v
 = (
r
>>1)|(
ýu
->
f_c
<<7);

2189 
ýu
->
f_c
 = 
r
&1;

2190 
ýu
->
	`wr™e
(ýu, 
baddr
, 
v
);

2191 
r
 = 
ýu
->
a
 + 
v
 + cpu->
f_c
;

2192 
ýu
->
f_v
 = ((ýu->
a
^
v
)&(ýu->a^(
r
&0xff))&0x80) ? 1 : 0;

2193 
	`FLAG_ZCN
(
r
);

2194 
ýu
->
a
 = 
r
;

2195 
ýu
->
pc
+=2;

2199 
BADDR_ABX
;

2200 
r
 = 
ýu
->
	`»ad
(ýu, 
baddr
);

2201 
v
 = (
r
>>1)|(
ýu
->
f_c
<<7);

2202 
ýu
->
f_c
 = 
r
&1;

2203 
ýu
->
	`wr™e
(ýu, 
baddr
, 
v
);

2204 
r
 = 
ýu
->
a
 + 
v
 + cpu->
f_c
;

2205 
ýu
->
f_v
 = ((ýu->
a
^
v
)&(ýu->a^(
r
&0xff))&0x80) ? 1 : 0;

2206 
	`FLAG_ZCN
(
r
);

2207 
ýu
->
a
 = 
r
;

2208 
ýu
->
pc
+=2;

2212 
BADDR_ABY
;

2213 
r
 = 
ýu
->
	`»ad
(ýu, 
baddr
);

2214 
v
 = (
r
>>1)|(
ýu
->
f_c
<<7);

2215 
ýu
->
f_c
 = 
r
&1;

2216 
ýu
->
	`wr™e
(ýu, 
baddr
, 
v
);

2217 
r
 = 
ýu
->
a
 + 
v
 + cpu->
f_c
;

2218 
ýu
->
f_v
 = ((ýu->
a
^
v
)&(ýu->a^(
r
&0xff))&0x80) ? 1 : 0;

2219 
	`FLAG_ZCN
(
r
);

2220 
ýu
->
a
 = 
r
;

2221 
ýu
->
pc
+=2;

2225 
BADDR_ZIX
;

2226 
r
 = 
ýu
->
	`»ad
(ýu, 
baddr
);

2227 
v
 = (
r
>>1)|(
ýu
->
f_c
<<7);

2228 
ýu
->
f_c
 = 
r
&1;

2229 
ýu
->
	`wr™e
(ýu, 
baddr
, 
v
);

2230 
r
 = 
ýu
->
a
 + 
v
 + cpu->
f_c
;

2231 
ýu
->
f_v
 = ((ýu->
a
^
v
)&(ýu->a^(
r
&0xff))&0x80) ? 1 : 0;

2232 
	`FLAG_ZCN
(
r
);

2233 
ýu
->
a
 = 
r
;

2234 
ýu
->
pc
++;

2238 
BADDR_ZIY
;

2239 
r
 = 
ýu
->
	`»ad
(ýu, 
baddr
);

2240 
v
 = (
r
>>1)|(
ýu
->
f_c
<<7);

2241 
ýu
->
f_c
 = 
r
&1;

2242 
ýu
->
	`wr™e
(ýu, 
baddr
, 
v
);

2243 
r
 = 
ýu
->
a
 + 
v
 + cpu->
f_c
;

2244 
ýu
->
f_v
 = ((ýu->
a
^
v
)&(ýu->a^(
r
&0xff))&0x80) ? 1 : 0;

2245 
	`FLAG_ZCN
(
r
);

2246 
ýu
->
a
 = 
r
;

2247 
ýu
->
pc
++;

2251 
BADDR_ZP
;

2252 
r
 = 
ýu
->
	`»ad
(ýu, 
baddr
)<<1;

2253 
ýu
->
f_c
 = (
r
&0x100)!=0;

2254 
ýu
->
	`wr™e
(ýu, 
baddr
, 
r
);

2255 
ýu
->
a
 |ð
r
;

2256 
	`FLAG_ZN
(
ýu
->
a
);

2257 
ýu
->
pc
++;

2261 
BADDR_ZPX
;

2262 
r
 = 
ýu
->
	`»ad
(ýu, 
baddr
)<<1;

2263 
ýu
->
f_c
 = (
r
&0x100)!=0;

2264 
ýu
->
	`wr™e
(ýu, 
baddr
, 
r
);

2265 
ýu
->
a
 |ð
r
;

2266 
	`FLAG_ZN
(
ýu
->
a
);

2267 
ýu
->
pc
++;

2271 
BADDR_ABS
;

2272 
r
 = 
ýu
->
	`»ad
(ýu, 
baddr
)<<1;

2273 
ýu
->
f_c
 = (
r
&0x100)!=0;

2274 
ýu
->
	`wr™e
(ýu, 
baddr
, 
r
);

2275 
ýu
->
a
 |ð
r
;

2276 
	`FLAG_ZN
(
ýu
->
a
);

2277 
ýu
->
pc
+=2;

2281 
BADDR_ABX
;

2282 
r
 = 
ýu
->
	`»ad
(ýu, 
baddr
)<<1;

2283 
ýu
->
f_c
 = (
r
&0x100)!=0;

2284 
ýu
->
	`wr™e
(ýu, 
baddr
, 
r
);

2285 
ýu
->
a
 |ð
r
;

2286 
	`FLAG_ZN
(
ýu
->
a
);

2287 
ýu
->
pc
+=2;

2291 
BADDR_ABY
;

2292 
r
 = 
ýu
->
	`»ad
(ýu, 
baddr
)<<1;

2293 
ýu
->
f_c
 = (
r
&0x100)!=0;

2294 
ýu
->
	`wr™e
(ýu, 
baddr
, 
r
);

2295 
ýu
->
a
 |ð
r
;

2296 
	`FLAG_ZN
(
ýu
->
a
);

2297 
ýu
->
pc
+=2;

2301 
BADDR_ZIX
;

2302 
r
 = 
ýu
->
	`»ad
(ýu, 
baddr
)<<1;

2303 
ýu
->
f_c
 = (
r
&0x100)!=0;

2304 
ýu
->
	`wr™e
(ýu, 
baddr
, 
r
);

2305 
ýu
->
a
 |ð
r
;

2306 
	`FLAG_ZN
(
ýu
->
a
);

2307 
ýu
->
pc
++;

2311 
BADDR_ZIY
;

2312 
r
 = 
ýu
->
	`»ad
(ýu, 
baddr
)<<1;

2313 
ýu
->
f_c
 = (
r
&0x100)!=0;

2314 
ýu
->
	`wr™e
(ýu, 
baddr
, 
r
);

2315 
ýu
->
a
 |ð
r
;

2316 
	`FLAG_ZN
(
ýu
->
a
);

2317 
ýu
->
pc
++;

2321 
BADDR_ZP
;

2322 
v
 = 
ýu
->
	`»ad
(ýu, 
baddr
);

2323 
ýu
->
f_c
 = 
v
&1;

2324 
v
 >>= 1;

2325 
ýu
->
	`wr™e
(ýu, 
baddr
, 
v
);

2326 
ýu
->
a
 ^ð
v
;

2327 
	`FLAG_ZN
(
ýu
->
a
);

2328 
ýu
->
pc
++;

2332 
BADDR_ZPX
;

2333 
v
 = 
ýu
->
	`»ad
(ýu, 
baddr
);

2334 
ýu
->
f_c
 = 
v
&1;

2335 
v
 >>= 1;

2336 
ýu
->
	`wr™e
(ýu, 
baddr
, 
v
);

2337 
ýu
->
a
 ^ð
v
;

2338 
	`FLAG_ZN
(
ýu
->
a
);

2339 
ýu
->
pc
++;

2343 
BADDR_ABS
;

2344 
v
 = 
ýu
->
	`»ad
(ýu, 
baddr
);

2345 
ýu
->
f_c
 = 
v
&1;

2346 
v
 >>= 1;

2347 
ýu
->
	`wr™e
(ýu, 
baddr
, 
v
);

2348 
ýu
->
a
 ^ð
v
;

2349 
	`FLAG_ZN
(
ýu
->
a
);

2350 
ýu
->
pc
+=2;

2354 
BADDR_ABX
;

2355 
v
 = 
ýu
->
	`»ad
(ýu, 
baddr
);

2356 
ýu
->
f_c
 = 
v
&1;

2357 
v
 >>= 1;

2358 
ýu
->
	`wr™e
(ýu, 
baddr
, 
v
);

2359 
ýu
->
a
 ^ð
v
;

2360 
	`FLAG_ZN
(
ýu
->
a
);

2361 
ýu
->
pc
+=2;

2365 
BADDR_ABY
;

2366 
v
 = 
ýu
->
	`»ad
(ýu, 
baddr
);

2367 
ýu
->
f_c
 = 
v
&1;

2368 
v
 >>= 1;

2369 
ýu
->
	`wr™e
(ýu, 
baddr
, 
v
);

2370 
ýu
->
a
 ^ð
v
;

2371 
	`FLAG_ZN
(
ýu
->
a
);

2372 
ýu
->
pc
+=2;

2376 
BADDR_ZIX
;

2377 
v
 = 
ýu
->
	`»ad
(ýu, 
baddr
);

2378 
ýu
->
f_c
 = 
v
&1;

2379 
v
 >>= 1;

2380 
ýu
->
	`wr™e
(ýu, 
baddr
, 
v
);

2381 
ýu
->
a
 ^ð
v
;

2382 
	`FLAG_ZN
(
ýu
->
a
);

2383 
ýu
->
pc
++;

2387 
BADDR_ZIY
;

2388 
v
 = 
ýu
->
	`»ad
(ýu, 
baddr
);

2389 
ýu
->
f_c
 = 
v
&1;

2390 
v
 >>= 1;

2391 
ýu
->
	`wr™e
(ýu, 
baddr
, 
v
);

2392 
ýu
->
a
 ^ð
v
;

2393 
	`FLAG_ZN
(
ýu
->
a
);

2394 
ýu
->
pc
++;

2398 
BADDR_ABY
;

2399 
v
 = 
ýu
->
x
;

2402 ià((
ýu
->
cyþes
&7)>2)

2403 
v
 &ð(
baddr
>>8)+1;

2405 
ýu
->
	`wr™e
(ýu, 
baddr
, 
v
);

2406 
ýu
->
pc
+=2;

2410 
BADDR_ABX
;

2411 
v
 = 
ýu
->
y
;

2414 ià((
ýu
->
cyþes
&7)>2)

2415 
v
 &ð(
baddr
>>8)+1;

2417 
ýu
->
	`wr™e
(ýu, 
baddr
, 
v
);

2418 
ýu
->
pc
+=2;

2422 
READ_IMM
;

2424 
ýu
->
a
 = cpu->
x
 & 
v
;

2427 ià((
ýu
->
cyþes
&7)>5)

2429 
r
 = (
ýu
->
x
^0xff);

2430 
r
 &ð
ýu
->
cyþes
;

2431 
ýu
->
a
 |ð
r
;

2433 
	`FLAG_ZN
(
ýu
->
a
);

2437 
BADDR_ABY
;

2438 
ýu
->
¥
 = cpu->
x
 & cpu->
a
;

2439 
ýu
->
	`wr™e
(ýu, 
baddr
, cpu->
¥
&((baddr>>8)+1));

2440 
ýu
->
pc
+=2;

2444 
ýu
->
pc
 = cpu->
Ï¡pc
;

2445  
SDL_TRUE
;

2449  
SDL_FALSE
;

2450 
	}
}

	@6502.h

23 
	#FB_C
 0

	)

24 
	#FF_C
 (1<<
FB_C
)

	)

25 
	#FB_Z
 1

	)

26 
	#FF_Z
 (1<<
FB_Z
)

	)

27 
	#FB_I
 2

	)

28 
	#FF_I
 (1<<
FB_I
)

	)

29 
	#FB_D
 3

	)

30 
	#FF_D
 (1<<
FB_D
)

	)

31 
	#FB_B
 4

	)

32 
	#FF_B
 (1<<
FB_B
)

	)

33 
	#FB_R
 5

	)

34 
	#FF_R
 (1<<
FB_R
)

	)

35 
	#FB_V
 6

	)

36 
	#FF_V
 (1<<
FB_V
)

	)

37 
	#FB_N
 7

	)

38 
	#FF_N
 (1<<
FB_N
)

	)

41 
	#IRQB_VIA
 0

	)

42 
	#IRQF_VIA
 (1<<
IRQB_VIA
)

	)

43 
	#IRQB_DISK
 1

	)

44 
	#IRQF_DISK
 (1<<
IRQB_DISK
)

	)

45 
	#IRQB_VIA2
 2

	)

46 
	#IRQF_VIA2
 (1<<
IRQB_VIA2
)

	)

47 
	#IRQB_ACIA
 3

	)

48 
	#IRQF_ACIA
 (1<<
IRQB_ACIA
)

	)

51 
	#MBPB_READ
 0

	)

52 
	#MBPF_READ
 (1<<
MBPB_READ
)

	)

53 
	#MBPB_WRITE
 1

	)

54 
	#MBPF_WRITE
 (1<<
MBPB_WRITE
)

	)

55 
	#MBPB_CHANGE
 2

	)

56 
	#MBPF_CHANGE
 (1<<
MBPB_CHANGE
)

	)

57 
	#MBPB_RESETCYCLES
 3

	)

58 
	#MBPF_RESETCYCLES
 (1<<
MBPB_RESETCYCLES
)

	)

59 
	#MBPB_RESETCYCLESCONTINUE
 4

	)

60 
	#MBPF_RESETCYCLESCONTINUE
 (1<<
MBPB_RESETCYCLESCONTINUE
)

	)

63 
	#MAKEFLAGS
 ((
ýu
->
f_n
<<7)|(ýu->
f_v
<<6)|(1<<5)|(ýu->
f_b
<<4)|(ýu->
f_d
<<3)|(ýu->
f_i
<<2)|(ýu->
f_z
<<1)|ýu->
f_c
)

	)

64 
	#MAKEFLAGSBC
 ((
ýu
->
f_n
<<7)|(ýu->
f_v
<<6)|(1<<5)|(ýu->
f_d
<<3)|(ýu->
f_i
<<2)|(ýu->
f_z
<<1)|ýu->
f_c
)

	)

67 
	#SETFLAGS
(
n
è
ýu
->
f_n
=(n&0x80)>>7;\

68 
ýu
->
f_v
=(
n
&0x40)>>6;\

69 
ýu
->
f_b
=(
n
&0x10)>>4;\

70 
ýu
->
f_d
=(
n
&0x08)>>3;\

71 
ýu
->
f_i
=(
n
&0x04)>>2;\

72 
ýu
->
f_z
=(
n
&0x02)>>1;\

73 
ýu
->
f_c
=
n
&0x01

	)

75 
	smemb»akpošt


77 
Ušt8
 
	mæags
;

78 
Ušt8
 
	mÏ¡v®
;

79 
Ušt16
 
	maddr
;

82 
	sm6502


84 
Sšt32
 
	m¿¡”cyþes
;

85 
Ušt32
 
	micyþes
;

86 
Ušt32
 
	mcyþes
;

87 
Ušt16
 
	mpc
, 
	mÏ¡pc
, 
	mÿlýc
, 
	mÿlcšt
, 
	mbaddr
;

88 
SDL_boÞ
 
	mnmi
;

89 (*
	mwr™e
)(
	mm6502
 *,
	mUšt16
,
	mUšt8
);

90 (*
	m»ad
)(
	mm6502
 *,
	mUšt16
);

91 
SDL_boÞ
 
	mªybp
, 
	mªymbp
;

92 
Sšt32
 
	mb»akpošts
[16];

93 
Ušt8
 
	mb»akpošt_æags
[16];

94 
memb»akpošt
 
	mmemb»akpošts
[16];

95 *
	mu£rd©a
;

97 
Ušt8
 
	ma
, 
	mx
, 
	my
, 
	m¥
;

98 
Ušt8
 
	mf_c
, 
	mf_z
, 
	mf_i
, 
	mf_d
, 
	mf_b
, 
	mf_v
, 
	mf_n
;

99 
Ušt8
 
	mœq
, 
	mnmicouÁ
, 
	mÿlcÝ
;

102 
m6502_š™
Ð
m6502
 *
ýu
, *
u£rd©a
, 
SDL_boÞ
 
nukeb»akpošts
 );

103 
m6502_»£t
Ð
m6502
 *
ýu
 );

104 
SDL_boÞ
 
m6502_š¡
Ð
m6502
 *
ýu
 );

105 
SDL_boÞ
 
m6502_£t_icyþes
Ð
m6502
 *
ýu
, SDL_boÞ 
dobp
, *
bpmsg
 );

	@6551.c

22 
	~"sy¡em.h
"

23 
	~"6502.h
"

24 
	~"vŸ.h
"

25 
	~"8912.h
"

26 
	~"gui.h
"

27 
	~"disk.h
"

28 
	~"mÚ™Ü.h
"

29 
	~"6551.h
"

30 
	~"machše.h
"

32 
	#DEBUG_ACIA
 0

	)

35 #ià
DEBUG_ACIA
 == 3

36 #undeà
dbg_´štf


37 
	#dbg_´štf
(
x
...è{ 
	`´štf
(x);…rštf("\n"); }

	)

38 
	#DEBUG_ACIA_STATUS
 1

	)

40 #–ià
DEBUG_ACIA
 == 2

41 #undeà
dbg_´štf


42 
	#dbg_´štf
(
x
...è{ 
	`´štf
(x);…rštf("\n"); }

	)

43 
	#DEBUG_ACIA_STATUS
 0

	)

45 #–ià
DEBUG_ACIA
 == 1

46 
	#DEBUG_ACIA_STATUS
 1

	)

49 
	#DEBUG_ACIA_STATUS
 0

	)

52 #ià
DEBUG_ACIA


53 *
	gwr™”eg_Çmes
[] = { "TXDATA", "RESET", "COMMAND", "CONTROL" };

54 *
	g»ad»g_Çmes
[] = { "RXDATA", "STATUS", "COMMAND", "CONTROL" };

55 *
	g·r™y_modes
[] = { "NONE", "ODD", "NONE", "EVEN", "NONE", "MARK", "NONE", "SPACE" };

56 *
	gtxcÚ_modes
[] = { "TXIRQ=0,RLEV=H", "TXIRQ=1,RLEV=L", "RXIRQ=0,RLEV=L", "RXIRQ=0,RLEV=L,TXBRK" };

57 *
	gbaud_¿‹s
[] = { "EXT", "50", "75", "109.92", "134.58", "150", "300", "600", "1200", "1800", "2400", "3600", "4800", "7200", "9600", "19200" };

58 *
	gb™_nums
[] = { "8", "7", "6", "5" };

62 
Ušt32
 
	gboud¿‹s
[] = { 0, 50, 75, 110, 134, 150, 300, 600, 1200, 1800, 2400, 3600, 4800, 7200, 9600, 19200 };

64 
	$acŸ_upd©e_·¿ms
Ð
acŸ
 *acia )

66 8 - ((
acŸ
->
»gs
[
ACIA_CONTROL
]&
ACONF_WLEN
)>>5))

68 5: 
acŸ
->
b™mask
 = 0x1f; ;

69 6: 
acŸ
->
b™mask
 = 0x3f; ;

70 7: 
acŸ
->
b™mask
 = 0x7f; ;

71 8: : 
acŸ
->
b™mask
 = 0xff; ;

74 
acŸ
->
rx
 = (acŸ->
»gs
[
ACIA_COMMAND
] & 
ACOMF_DTR
)? 
SDL_TRUE
 : 
SDL_FALSE
;

75 
acŸ
->
œqrx
 = (acŸ->
rx
 && 0 =ðÐacŸ->
»gs
[
ACIA_COMMAND
] & 
ACOMF_IRQDIS
 ))? 
SDL_TRUE
 : 
SDL_FALSE
;

77  ( 
acŸ
->
»gs
[
ACIA_COMMAND
] & 
ACOMF_TXCON
 ) >> 2 )

80 
acŸ
->
tx
 = 
SDL_FALSE
;

81 
acŸ
->
œqtx
 = 
SDL_FALSE
;

84 
acŸ
->
tx
 = 
SDL_TRUE
;

85 
acŸ
->
œqtx
 = 
SDL_TRUE
;

88 
acŸ
->
tx
 = 
SDL_TRUE
;

89 
acŸ
->
œqtx
 = 
SDL_FALSE
;

93 
acŸ
->
tx
 = 
SDL_FALSE
;

94 
acŸ
->
œqtx
 = 
SDL_FALSE
;

98 
acŸ
->
echo
 = (acŸ->
»gs
[
ACIA_COMMAND
]&
ACOMF_ECHO
)? 
SDL_TRUE
 : 
SDL_FALSE
;

101 
acŸ
->
äameb™s
 =

103 (8 - ((
acŸ
->
»gs
[
ACIA_CONTROL
]&
ACONF_WLEN
)>>5)) +

104 ((
acŸ
->
»gs
[
ACIA_COMMAND
]>>5)&1) +

105 ((
acŸ
->
»gs
[
ACIA_CONTROL
]&
ACONF_STOPB
) ? 2 : 1);

107 
acŸ
->
boud¿‹
 = 
boud¿‹s
[acŸ->
»gs
[
ACIA_CONTROL
]&
ACONF_BAUD
];

111 if(0 < 
acŸ
->
boud¿‹
)

112 
acŸ
->
äamecyþe
 = ( 115200 * 8680 ) / (‡cŸ->
boud¿‹
 * 1000 );

114 
acŸ
->
äamecyþe
 = 0;

115 
	}
}

117 
	$acŸ_š™
Ð
acŸ
 *acŸ, 
machše
 *
Üic
 )

119 ifÐ
acŸ
->
dÚe
 )

120 
acŸ
->
	`dÚe
(‡cia );

122 
acŸ
->
Üic
 = oric;

123 
acŸ
->
»gs
[
ACIA_RXDATA
] = 0;

124 
acŸ
->
»gs
[
ACIA_TXDATA
] = 0;

125 
acŸ
->
»gs
[
ACIA_STATUS
] = 
ASTF_TXEMPTY
;

126 
acŸ
->
»gs
[
ACIA_COMMAND
] = 
ACOMF_IRQDIS
;

127 
acŸ
->
»gs
[
ACIA_CONTROL
] = 0;

129 
acŸ
->
cyþes
 = 0;

130 
	`acŸ_upd©e_·¿ms
Ð
acŸ
 );

132 
Üic
->
acŸback’d
)

134 
ACIA_TYPE_LOOPBACK
:

135 
	`acŸ_š™_loÝback
Ð
acŸ
 );

137 #ifdeà
BACKEND_MODEM


138 
ACIA_TYPE_MODEM
:

139 
	`acŸ_š™_modem
Ð
acŸ
 );

142 #ifdeà
BACKEND_COM


143 
ACIA_TYPE_COM
:

144 
	`acŸ_š™_com
Ð
acŸ
 );

147 
ACIA_TYPE_NONE
:

149 
	`acŸ_š™_nÚe
Ð
acŸ
 );

152 
	}
}

154 
	$acŸ_þock
Ð
acŸ
 *acŸ, 
cyþes
 )

157 ifÐ0 =ðÐ
acŸ
->
»gs
[
ACIA_CONTROL
] & 
ACONF_SRC
 ))

161 ifÐ0 =ð
acŸ
->
äamecyþe
 )

164 
acŸ
->
cyþes
 += cycles;

165  
acŸ
->
äamecyþe
 <ðacŸ->
cyþes
 )

167 
acŸ
->
cyþes
 -ðacŸ->
äamecyþe
;

170 ifÐ
acŸ
->
tx
 && 0 =ð×cŸ->
»gs
[
ACIA_STATUS
] & 
ASTF_TXEMPTY
) )

172 if(!
acŸ
->
	`put_by‹
ÐacŸ->
»gs
[
ACIA_TXDATA
] ) )

173 
acŸ
->
»gs
[
ACIA_STATUS
] |ð
ASTF_OVRUNERR
;

176 
acŸ
->
»gs
[
ACIA_STATUS
] |ð
ASTF_TXEMPTY
;

177 ifÐ
acŸ
->
œqtx
 )

179 
acŸ
->
»gs
[
ACIA_STATUS
] |ð
ASTF_IRQ
;

180 
acŸ
->
Üic
->
ýu
.
œq
 |ð
IRQF_ACIA
;

182 if(
acŸ
->
echo
)

183 
acŸ
->
	`put_by‹
×cŸ->
»gs
[
ACIA_TXDATA
]);

188 ifÐ
acŸ
-> 
rx
 )

190 
Ušt8
 
d©a
 = 0;

191 ifÐ
acŸ
->
	`has_by‹
(&
d©a
) )

193 
acŸ
->
»gs
[
ACIA_STATUS
] |ð
ASTF_RXDATA
;

194 ifÐ
acŸ
->
œqrx
 )

196 
acŸ
->
»gs
[
ACIA_STATUS
] |ð
ASTF_IRQ
;

197 
acŸ
->
Üic
->
ýu
.
œq
 |ð
IRQF_ACIA
;

204 ifÐ
acŸ
->
¡©
 )

205 
acŸ
->
»gs
[
ACIA_STATUS
] =‡cŸ->
	`¡©
(acia->regs[ACIA_STATUS]);

207 
acŸ
->
»gs
[
ACIA_STATUS
] |ð(
ASTF_CARRIER
|
ASTF_DSR
);

208 
	}
}

210 
	$acŸ_wr™e
Ð
acŸ
 *acŸ, 
Ušt16
 
addr
, 
Ušt8
 
d©a
 )

212 #ià
DEBUG_ACIA


213 
	`dbg_´štf
Ð"ACIA wr™e: (%04Xè%02XØ%s", 
acŸ
->
Üic
->
ýu
.
pc
-1, 
d©a
, 
wr™”eg_Çmes
[
addr
&3] );

215  
addr
 & 3 )

217 
ACIA_RXDATA
:

218 
acŸ
->
»gs
[
ACIA_TXDATA
] = 
d©a
 &‡cŸ->
b™mask
;

219 
acŸ
->
»gs
[
ACIA_STATUS
] &ð~(
ASTF_TXEMPTY
);

222 
ACIA_STATUS
:

223 
acŸ
->
»gs
[
ACIA_COMMAND
] &ð
ACOMF_PARITY
;

224 
acŸ
->
»gs
[
ACIA_COMMAND
] |ð
ACOMF_IRQDIS
;

225 
acŸ
->
»gs
[
ACIA_STATUS
] &ð~(
ASTF_OVRUNERR
);

226 
	`acŸ_upd©e_·¿ms
Ð
acŸ
 );

229 
ACIA_COMMAND
:

230 
acŸ
->
»gs
[
ACIA_COMMAND
] = 
d©a
;

231 
	`acŸ_upd©e_·¿ms
Ð
acŸ
 );

233 #ià
DEBUG_ACIA


234 
	`dbg_´štf
Ð" P¬™y = %s", 
·r™y_modes
[
d©a
>>5] );

235 
	`dbg_´štf
Ð" RX Modð%s", (
d©a
&
ACOMF_ECHO
) ? "ECHO" : "NORMAL" );

236 
	`dbg_´štf
Ð" TXCÚ = %s", 
txcÚ_modes
[(
d©a
&
ACOMF_TXCON
)>>2] );

237 
	`dbg_´štf
Ð" IRQ = %s", (
d©a
&
ACOMF_IRQDIS
) ? "OFF" : "ON" );

238 
	`dbg_´štf
Ð" DTR = %s", (
d©a
&
ACOMF_DTR
) ? "ON" : "OFF" );

242 
ACIA_CONTROL
:

243 
acŸ
->
»gs
[
ACIA_CONTROL
] = 
d©a
;

244 
	`acŸ_upd©e_·¿ms
Ð
acŸ
 );

246 #ià
DEBUG_ACIA


247 
	`dbg_´štf
Ð" Baud = %s", 
baud_¿‹s
[
d©a
&
ACONF_BAUD
] );

248 
	`dbg_´štf
Ð" RXClock = %s", (
d©a
&
ACONF_SRC
) ? "INT" : "EXT" );

249 
	`dbg_´štf
Ð" B™  = %s", 
b™_nums
[(
d©a
&
ACONF_WLEN
)>>5] );

250 
	`dbg_´štf
Ð" StÝb™ ð%d", (
d©a
&
ACONF_STOPB
) ? 2 : 1 );

254 
	}
}

256 
Ušt8
 
	$acŸ_»ad
Ð
acŸ
 *acŸ, 
Ušt16
 
addr
 )

258 
Ušt8
 
d©a
 = 
acŸ
->
»gs
[
addr
&3];

260  
addr
 & 3 )

262 
ACIA_RXDATA
:

263 #ià
DEBUG_ACIA


264 
	`dbg_´štf
Ð"ACIA„—d: (%04Xèäom % (=%02X)", 
acŸ
->
Üic
->
ýu
.
pc
-1, 
»ad»g_Çmes
[
addr
&3], 
d©a
 );

266 
acŸ
->
	`g‘_by‹
Ð&
d©a
 );

267 
d©a
 &ð
acŸ
->
b™mask
;

268 
acŸ
->
»gs
[
ACIA_RXDATA
] = 
d©a
;

269 
acŸ
->
»gs
[
ACIA_STATUS
] &ð~(
ASTF_PARITYERR
|
ASTF_FRAMEERR
|
ASTF_OVRUNERR
);

270 
acŸ
->
»gs
[
ACIA_STATUS
] &ð~(
ASTF_RXDATA
);

273 
ACIA_STATUS
:

274 #ià
DEBUG_ACIA_STATUS


275 
	`dbg_´štf
Ð"ACIA„—d: (%04Xèäom % (=%02X)", 
acŸ
->
Üic
->
ýu
.
pc
-1, 
»ad»g_Çmes
[
addr
&3], 
d©a
 );

278 
acŸ
->
»gs
[
ACIA_STATUS
] &ð~(
ASTF_IRQ
);

279 
acŸ
->
Üic
->
ýu
.
œq
 &ð~(
IRQF_ACIA
);

283 #ià
DEBUG_ACIA


284 
	`dbg_´štf
Ð"ACIA„—d: (%04Xèäom % (=%02X)", 
acŸ
->
Üic
->
ýu
.
pc
-1, 
»ad»g_Çmes
[
addr
&3], 
d©a
 );

289  
d©a
;

290 
	}
}

293 
SDL_boÞ
 
	$acŸ_š™_nÚe
Ð
acŸ
 *acia )

295 
acŸ
->
dÚe
 = 
NULL
;

296 
acŸ
->
¡©
 = 
NULL
;

297 
acŸ
->
has_by‹
 = 
NULL
;

298 
acŸ
->
g‘_by‹
 = 
NULL
;

299 
acŸ
->
put_by‹
 = 
NULL
;

301 
acŸ
->
Üic
->
acŸback’d
 = 
ACIA_TYPE_NONE
;

302  
SDL_TRUE
;

303 
	}
}

	@6551.h

25 
	mACIA_RXDATA
=0,

26 
	mACIA_STATUS
,

27 
	mACIA_COMMAND
,

28 
	mACIA_CONTROL
,

29 
	mACIA_TXDATA
,

30 
	mACIA_LAST


34 
	#ACOMB_DTR
 0

	)

35 
	#ACOMF_DTR
 (1<<
ACOMB_DTR
)

	)

36 
	#ACOMB_IRQDIS
 1

	)

37 
	#ACOMF_IRQDIS
 (1<<
ACOMB_IRQDIS
)

	)

38 
	#ACOMF_TXCON
 0x0c

	)

39 
	#ACOMB_ECHO
 2

	)

40 
	#ACOMF_ECHO
 (1<<
ACOMB_ECHO
)

	)

41 
	#ACOMF_PARITY
 0xe0

	)

44 
	#ACONF_BAUD
 0x0f

	)

45 
	#ACONB_SRC
 4

	)

46 
	#ACONF_SRC
 (1<<
ACONB_SRC
)

	)

47 
	#ACONF_WLEN
 0x60

	)

48 
	#ACONB_STOPB
 7

	)

49 
	#ACONF_STOPB
 (1<<
ACONB_STOPB
)

	)

52 
	#ASTB_PARITYERR
 0

	)

53 
	#ASTF_PARITYERR
 (1<<
ASTB_PARITYERR
)

	)

54 
	#ASTB_FRAMEERR
 1

	)

55 
	#ASTF_FRAMEERR
 (1<<
ASTB_FRAMEERR
)

	)

56 
	#ASTB_OVRUNERR
 2

	)

57 
	#ASTF_OVRUNERR
 (1<<
ASTB_OVRUNERR
)

	)

58 
	#ASTB_RXDATA
 3

	)

59 
	#ASTF_RXDATA
 (1<<
ASTB_RXDATA
)

	)

60 
	#ASTB_TXEMPTY
 4

	)

61 
	#ASTF_TXEMPTY
 (1<<
ASTB_TXEMPTY
)

	)

62 
	#ASTB_CARRIER
 5

	)

63 
	#ASTF_CARRIER
 (1<<
ASTB_CARRIER
)

	)

64 
	#ASTB_DSR
 6

	)

65 
	#ASTF_DSR
 (1<<
ASTB_DSR
)

	)

66 
	#ASTB_IRQ
 7

	)

67 
	#ASTF_IRQ
 (1<<
ASTB_IRQ
)

	)

71 #ifdeà
__LINUX__


72 
	#BACKEND_MODEM


	)

74 #ifdeà
WIN32


75 
	#BACKEND_MODEM


	)

77 #ifdeà
__amigaos4__


78 
	#BACKEND_MODEM


	)

80 #ifdeà
__MORPHOS__


81 
	#BACKEND_MODEM


	)

84 #ifdeà
__LINUX__


85 
	#BACKEND_COM


	)

87 #ifdeà
WIN32


88 
	#BACKEND_COM


	)

93 
	mACIA_TYPE_NONE
 = 0,

94 
	mACIA_TYPE_LOOPBACK
,

95 
	mACIA_TYPE_MODEM
,

96 
	mACIA_TYPE_COM
,

98 
	mACIA_TYPE_LAST


102 
	#ACIA_BACKEND_NAME_LEN
 128

	)

105 
	#ACIA_TYPE_MODEM_DEFAULT_PORT
 23

	)

107 
	sacŸ


109 
machše
 *
	mÜic
;

110 
Ušt8
 
	m»gs
[
ACIA_LAST
];

112 
Ušt32
 
	mcyþes
;

113 
Ušt32
 
	mboud¿‹
;

114 
Ušt32
 
	mäameb™s
;

115 
Ušt32
 
	mäamecyþe
;

117 
Ušt8
 
	mb™mask
;

119 
SDL_boÞ
 
	mrx
;

120 
SDL_boÞ
 
	mœqrx
;

121 
SDL_boÞ
 
	mtx
;

122 
SDL_boÞ
 
	mœqtx
;

124 
SDL_boÞ
 
	mecho
;

127 
Ušt8
 (*
¡©
)(Ušt8 
	m¡©
);

128 
SDL_boÞ
 (*
has_by‹
)(
Ušt8
* 
	md©a
);

129 
SDL_boÞ
 (*
g‘_by‹
)(
Ušt8
* 
	md©a
);

130 
SDL_boÞ
 (*
put_by‹
)(
Ušt8
 
	md©a
);

131 (*
	mdÚe
)(
acŸ
* 
	macŸ
);

134 
acŸ_š™
Ð
acŸ
 *acŸ, 
machše
 *
Üic
 );

135 
acŸ_þock
Ð
acŸ
 *acŸ, 
cyþes
 );

136 
acŸ_wr™e
Ð
acŸ
 *acŸ, 
Ušt16
 
addr
, 
Ušt8
 
d©a
 );

137 
Ušt8
 
acŸ_»ad
Ð
acŸ
 *acŸ, 
Ušt16
 
addr
 );

140 
SDL_boÞ
 
acŸ_š™_nÚe
Ð
acŸ
*‡cia );

141 
SDL_boÞ
 
acŸ_š™_loÝback
Ð
acŸ
*‡cia );

142 #ifdeà
BACKEND_MODEM


143 
SDL_boÞ
 
acŸ_š™_modem
Ð
acŸ
*‡cia );

145 #ifdeà
BACKEND_COM


146 
SDL_boÞ
 
acŸ_š™_com
Ð
acŸ
*‡cia );

	@6551_com.c

22 
	~"sy¡em.h
"

23 
	~"6502.h
"

24 
	~"vŸ.h
"

25 
	~"8912.h
"

26 
	~"gui.h
"

27 
	~"disk.h
"

28 
	~"mÚ™Ü.h
"

29 
	~"6551.h
"

30 
	~"machše.h
"

32 #ifdeà
BACKEND_COM


34 
machše
* 
	gÜic
 = 
NULL
;

36 
	gcom_baud¿‹
 = 115200;

37 
	gcom_b™s
 = 8;

38 
	gcom_·r™y
 = 'N';

39 
	gcom_¡Ýb™s
 = 1;

40 
	gcom_Çme
[
ACIA_BACKEND_NAME_LEN
];

43 
SDL_boÞ
 
com_v®id©e_·¿m
();

44 
SDL_boÞ
 
com_Ý’
();

45 
SDL_boÞ
 
com_þo£
();

46 
SDL_boÞ
 
com_wr™e
(
Ušt8
 
d©a
);

47 
SDL_boÞ
 
com_»ad
(
Ušt8
* 
d©a
);

48 
SDL_boÞ
 
com_³ek
(
Ušt8
* 
d©a
);

50 
	$com_dÚe
Ð
acŸ
*‡cia )

52 
	`com_þo£
();

53 
	`acŸ_š™_nÚe
Ð
acŸ
 );

54 
	}
}

56 
Ušt8
 
	$com_¡©
(
Ušt8
 
¡©
)

58  (
¡©
 | (
ASTF_CARRIER
|
ASTF_DSR
));

59 
	}
}

61 
SDL_boÞ
 
	$com_has_by‹
(
Ušt8
* 
d©a
)

63  
	`com_³ek
(
d©a
);

64 
	}
}

66 
SDL_boÞ
 
	$com_g‘_by‹
(
Ušt8
* 
d©a
)

68  
	`com_»ad
(
d©a
);

69 
	}
}

71 
SDL_boÞ
 
	$com_put_by‹
(
Ušt8
 
d©a
)

73  
	`com_wr™e
(
d©a
);

74 
	}
}

76 
SDL_boÞ
 
	$acŸ_š™_com
Ð
acŸ
*‡cia )

78 
Üic
 = 
acŸ
->oric;

80 
acŸ
->
dÚe
 = 
com_dÚe
;

81 
acŸ
->
¡©
 = 
com_¡©
;

82 
acŸ
->
has_by‹
 = 
com_has_by‹
;

83 
acŸ
->
g‘_by‹
 = 
com_g‘_by‹
;

84 
acŸ
->
put_by‹
 = 
com_put_by‹
;

87 if(5 =ð
	`ssÿnf
(
Üic
->
acŸback’dÇme
, "com:%d,%d,%c,%d,%s",

88 &
com_baud¿‹
, &
com_b™s
, &
com_·r™y
, &
com_¡Ýb™s
, 
com_Çme
))

91 if(
	`com_v®id©e_·¿m
())

93 if(
	`com_Ý’
())

95 
Üic
->
acŸback’d
 = 
ACIA_TYPE_COM
;

96  
SDL_TRUE
;

102 
	`acŸ_š™_nÚe
Ð
acŸ
 );

103  
SDL_FALSE
;

104 
	}
}

108 
	#COM_FIFO_SIZE
 4096

	)

109 
	gcom_fifo
 = 0;

110 
Ušt8
 
	gcom_fifo_buf
[
COM_FIFO_SIZE
];

113 #ià
defšed
(
__LINUX__
è|| defšed(
__APPLE__
)

114 
	~<‹rmios.h
>

115 
	~<¡dio.h
>

116 
	~<uni¡d.h
>

117 
	~<fúŽ.h
>

118 
	~<sys/sigÇl.h
>

119 
	~<sys/ioùl.h
>

120 
	~<sys/ty³s.h
>

122 
	#mš
(
a
,
b
è((×)<(b))?×):(b))

	)

124 
	gcom_fd
 = -1;

125 
	gcom_·¿m
 = 0;

127 
SDL_boÞ
 
	$com_v®id©e_·¿m
()

129 
com_·¿m
 = 0;

130 
com_baud¿‹
)

132 50: 
com_·¿m
 = 
B50
; ;

133 75: 
com_·¿m
 = 
B75
; ;

134 110: 
com_·¿m
 = 
B110
; ;

135 134: 
com_·¿m
 = 
B134
; ;

136 150: 
com_·¿m
 = 
B150
; ;

137 300: 
com_·¿m
 = 
B300
; ;

138 600: 
com_·¿m
 = 
B600
; ;

139 1200: 
com_·¿m
 = 
B1200
; ;

140 1800: 
com_·¿m
 = 
B1800
; ;

141 2400: 
com_·¿m
 = 
B2400
; ;

143 4800: 
com_·¿m
 = 
B4800
; ;

145 9600: 
com_·¿m
 = 
B9600
; ;

146 19200: 
com_·¿m
 = 
B19200
; ;

147 38400: 
com_·¿m
 = 
B38400
; ;

148 57600: 
com_·¿m
 = 
B57600
; ;

149 115200: 
com_·¿m
 = 
B115200
; ;

151  
SDL_FALSE
;

154 
com_b™s
)

156 5: 
com_·¿m
 |ð
CS5
; ;

157 6: 
com_·¿m
 |ð
CS6
; ;

158 7: 
com_·¿m
 |ð
CS7
; ;

159 8: 
com_·¿m
 |ð
CS8
; ;

161  
SDL_FALSE
;

164 
	`tÞow”
(
com_·r™y
))

167 'o': 
com_·¿m
 |ð
PARENB
|
PARODD
; ;

168 'e': 
com_·¿m
 |ð
PARENB
; ;

170  
SDL_FALSE
;

173 
com_¡Ýb™s
)

175 2: 
com_·¿m
 |ð
CSTOPB
; ;

178  
SDL_FALSE
;

181 
com_·¿m
 |ð(
CLOCAL
|
CREAD
);

182  
SDL_TRUE
;

183 
	}
}

185 
SDL_boÞ
 
	$com_Ý’
()

187 
‹rmios
 
ÝtiÚs
;

189 
com_fifo
 = 0;

191 
com_fd
 = 
	`Ý’
(
com_Çme
, 
O_RDWR
 | 
O_NOCTTY
 | 
O_NDELAY
);

192 ifÐ-1 =ð
com_fd
 )

195  
SDL_FALSE
;

198 
	`fúŽ
(
com_fd
, 
F_SETFL
, 
FNDELAY
);

200 
	`tcg‘©Œ
(
com_fd
, &
ÝtiÚs
);

201 
ÝtiÚs
.
c_cæag
 = 
com_·¿m
;

202 
	`tc£‰r
(
com_fd
, 
TCSANOW
, &
ÝtiÚs
);

204  
SDL_TRUE
;

205 
	}
}

207 
SDL_boÞ
 
	$com_þo£
()

209 ifÐ-1 !ð
com_fd
 )

210 
	`þo£
Ð
com_fd
 );

211 
com_fd
 = -1;

212  
SDL_TRUE
;

213 
	}
}

215 
SDL_boÞ
 
	$com_wr™e
(
Ušt8
 
d©a
)

217 ifÐ-1 !ð
com_fd
 )

219 ifÐ0 < 
	`wr™e
(
com_fd
, &
d©a
, 1) )

220  
SDL_TRUE
;

222  
SDL_FALSE
;

223 
	}
}

225 
	$com_fžl_fifo
()

227 ifÐ
com_fifo
 < 
COM_FIFO_SIZE
 )

229 
Ën
 = 0;

230 ifÐ-1 !ð
	`ioùl
(
com_fd
, 
FIONREAD
, &
Ën
) )

232 
Ën
 = 
	`mš
Ö’, 
COM_FIFO_SIZE
 - 
com_fifo
);

233 
Ën
 = ()
	`»ad
Ð
com_fd
, 
com_fifo_buf
 + 
com_fifo
,†en);

234 
com_fifo
 +ð
Ën
;

237 
	}
}

239 
SDL_boÞ
 
	$com_»ad
(
Ušt8
* 
d©a
)

241 ifÐ-1 !ð
com_fd
 )

243 
	`com_fžl_fifo
();

245 ifÐ0 < 
com_fifo
 )

247 *
d©a
 = 
com_fifo_buf
[0];

248 
	`memmove
(
com_fifo_buf
, com_fifo_buf+1, --
com_fifo
);

249  
SDL_TRUE
;

252  
SDL_FALSE
;

253 
	}
}

255 
SDL_boÞ
 
	$com_³ek
(
Ušt8
* 
d©a
)

257 ifÐ-1 !ð
com_fd
 )

259 
	`com_fžl_fifo
();

261 ifÐ0 < 
com_fifo
 )

263 *
d©a
 = 
com_fifo_buf
[0];

264  
SDL_TRUE
;

267  
SDL_FALSE
;

268 
	}
}

271 #ifdeà
WIN32


272 
	#WIN32_LEAN_AND_MEAN


	)

273 
	~<wšdows.h
>

274 
	~<¡dlib.h
>

275 #iâdeà
_MSC_VER


276 
	~<io.h
>

278 
	~<¡dio.h
>

279 
	~<¡ršg.h
>

280 
	~<sys/ty³s.h
>

281 
	~<sys/¡©.h
>

282 
	~<fúŽ.h
>

284 
HANDLE
 
	gcom_fd
 = 
INVALID_HANDLE_VALUE
;

285 
DCB
 
	gcom_dcb
;

287 
SDL_boÞ
 
	$com_v®id©e_·¿m
()

289 
	`mem£t
(&
com_dcb
, 0, (com_dcb));

290 
com_baud¿‹
)

294 110: 
com_dcb
.
BaudR©e
 = 
CBR_110
; ;

297 300: 
com_dcb
.
BaudR©e
 = 
CBR_300
; ;

298 600: 
com_dcb
.
BaudR©e
 = 
CBR_600
; ;

299 1200: 
com_dcb
.
BaudR©e
 = 
CBR_1200
; ;

301 2400: 
com_dcb
.
BaudR©e
 = 
CBR_2400
; ;

303 4800: 
com_dcb
.
BaudR©e
 = 
CBR_4800
; ;

305 9600: 
com_dcb
.
BaudR©e
 = 
CBR_9600
; ;

306 19200: 
com_dcb
.
BaudR©e
 = 
CBR_19200
; ;

307 38400: 
com_dcb
.
BaudR©e
 = 
CBR_38400
; ;

308 57600: 
com_dcb
.
BaudR©e
 = 
CBR_57600
; ;

309 115200: 
com_dcb
.
BaudR©e
 = 
CBR_115200
; ;

311  
SDL_FALSE
;

314 
com_b™s
)

319 8: 
com_dcb
.
By‹Size
 = 
com_b™s
; ;

321  
SDL_FALSE
;

324 
	`tÞow”
(
com_·r™y
))

326 'n': 
com_dcb
.
fP¬™y
 = 0; com_dcb.
P¬™y
 = 0; ;

327 'o': 
com_dcb
.
fP¬™y
 = 1; com_dcb.
P¬™y
 = 1; ;

328 'e': 
com_dcb
.
fP¬™y
 = 1; com_dcb.
P¬™y
 = 2; ;

330  
SDL_FALSE
;

333 
com_¡Ýb™s
)

335 2: 
com_dcb
.
StÝB™s
 = 2; ;

336 1: 
com_dcb
.
StÝB™s
 = 0; ;

338  
SDL_FALSE
;

341  
SDL_TRUE
;

342 
	}
}

344 
SDL_boÞ
 
	$com_Ý’
()

346 
DCB
 
dcb
;

347 
COMMTIMEOUTS
 
com_timeouts
;

349 
com_fd
 = 
	`C»©eFže
(
com_Çme
, 
GENERIC_READ
|
GENERIC_WRITE
, 0,0, 
OPEN_EXISTING
, 0,0);

350 iàÐ
INVALID_HANDLE_VALUE
 =ð
com_fd
 )

351  
SDL_FALSE
;

353 ià(!
	`G‘CommS‹
(
com_fd
, &
dcb
) )

355 
	`com_þo£
();

356  
SDL_FALSE
;

359 
dcb
.
BaudR©e
 = 
com_dcb
.BaudRate;

360 
dcb
.
By‹Size
 = 
com_dcb
.ByteSize;

361 
dcb
.
fP¬™y
 = 
com_dcb
.fParity;

362 
dcb
.
P¬™y
 = 
com_dcb
.Parity;

363 
dcb
.
StÝB™s
 = 
com_dcb
.StopBits;

365 
dcb
.
fOutxCtsFlow
=
FALSE
;

366 
dcb
.
fOutxD¤Flow
=
FALSE
;

367 
dcb
.
fDŒCÚŒÞ
=
DTR_CONTROL_DISABLE
;

368 
dcb
.
fTXCÚtšueOnXoff
=
TRUE
;

370 
	`memmove
(&
com_dcb
, &
dcb
, (com_dcb));

372 ià(!
	`S‘CommS‹
(
com_fd
, &
com_dcb
) )

374 
	`com_þo£
();

375  
SDL_FALSE
;

378 
com_timeouts
.
R—dIÁ”v®Timeout
=0;

379 
com_timeouts
.
R—dTÙ®TimeoutCÚ¡ªt
=0;

380 
com_timeouts
.
R—dTÙ®TimeoutMuÉl›r
=0;

381 
com_timeouts
.
Wr™eTÙ®TimeoutCÚ¡ªt
=0;

382 
com_timeouts
.
Wr™eTÙ®TimeoutMuÉl›r
=0;

383 
	`S‘CommTimeouts
Ð
com_fd
, &
com_timeouts
 );

385  
SDL_TRUE
;

386 
	}
}

388 
SDL_boÞ
 
	$com_þo£
()

390 iàÐ
INVALID_HANDLE_VALUE
 !ð
com_fd
 )

391 
	`Clo£HªdË
Ð
com_fd
 );

392 
com_fd
 = 
INVALID_HANDLE_VALUE
;

393  
SDL_TRUE
;

394 
	}
}

396 
SDL_boÞ
 
	$com_wr™e
(
Ušt8
 
d©a
)

398 ifÐ
INVALID_HANDLE_VALUE
 !ð
com_fd
 )

400 
DWORD
 
Ën
 = 0;

401 ifÐ0 < 
	`Wr™eFže
Ð
com_fd
, &
d©a
, 1, &
Ën
, 
NULL
) )

402  
SDL_TRUE
;

404  
SDL_FALSE
;

405 
	}
}

407 
	$com_fžl_fifo
()

409 ifÐ
com_fifo
 < 
COM_FIFO_SIZE
 )

411 
DWORD
 
”r
;

412 
COMSTAT
 
com_¡
;

413 
	`CË¬CommE¼Ü
Ð
com_fd
, &
”r
, &
com_¡
 );

414 ifÐ0 < (è
com_¡
.
cbInQue
 )

416 
DWORD
 
Ën
 = 
	`mš
Ð
com_¡
.
cbInQue
, 
COM_FIFO_SIZE
 - 
com_fifo
 );

417 ifÐ0 < 
	`R—dFže
Ð
com_fd
, 
com_fifo_buf
 + 
com_fifo
, 
Ën
, &Ën, 
NULL
) )

419 
com_fifo
 +ð
Ën
;

423 
	}
}

425 
SDL_boÞ
 
	$com_»ad
(
Ušt8
* 
d©a
)

427 ifÐ
INVALID_HANDLE_VALUE
 !ð
com_fd
 )

429 
	`com_fžl_fifo
();

431 ifÐ0 < 
com_fifo
 )

433 *
d©a
 = 
com_fifo_buf
[0];

434 
	`memmove
(
com_fifo_buf
, com_fifo_buf+1, 
com_fifo
-1);

435 
com_fifo
--;

436  
SDL_TRUE
;

439  
SDL_FALSE
;

440 
	}
}

442 
SDL_boÞ
 
	$com_³ek
(
Ušt8
* 
d©a
)

444 ifÐ
INVALID_HANDLE_VALUE
 !ð
com_fd
 )

446 
	`com_fžl_fifo
();

448 ifÐ0 < 
com_fifo
 )

450 *
d©a
 = 
com_fifo_buf
[0];

451  
SDL_TRUE
;

454  
SDL_FALSE
;

455 
	}
}

	@6551_loopback.c

22 
	~"sy¡em.h
"

23 
	~"6502.h
"

24 
	~"vŸ.h
"

25 
	~"8912.h
"

26 
	~"gui.h
"

27 
	~"disk.h
"

28 
	~"mÚ™Ü.h
"

29 
	~"6551.h
"

30 
	~"machše.h
"

32 
	#LOOPBACK_BUF_SIZE
 16

	)

33 
Ušt8
 
	gloÝback_buf
[
LOOPBACK_BUF_SIZE
];

34 
	gloÝback_š
 = 0;

35 
	gloÝback_out
 = 0;

37 
	$loÝback_dÚe
Ð
acŸ
*‡cia )

39 
	`acŸ_š™_nÚe
Ð
acŸ
 );

40 
	}
}

42 
Ušt8
 
	$loÝback_¡©
(
Ušt8
 
¡©
)

45  (
¡©
 & ~(
ASTF_CARRIER
|
ASTF_DSR
));

46 
	}
}

48 
SDL_boÞ
 
	$loÝback_has_by‹
(
Ušt8
* 
d©a
)

50 
loÝback_out_w¿p
 = (
loÝback_out
 < 
loÝback_š
)?†oÝback_ouˆ+ 
LOOPBACK_BUF_SIZE
 :†oopback_out;

52 if(
loÝback_š
 < 
loÝback_out_w¿p
)

54 *
d©a
 = 
loÝback_buf
[
loÝback_š
];

55  
SDL_TRUE
;

57  
SDL_FALSE
;

58 
	}
}

60 
SDL_boÞ
 
	$loÝback_g‘_by‹
(
Ušt8
* 
d©a
)

62 
loÝback_out_w¿p
 = (
loÝback_out
 < 
loÝback_š
)?†oÝback_ouˆ+ 
LOOPBACK_BUF_SIZE
 :†oopback_out;

64 if(
loÝback_š
 < 
loÝback_out_w¿p
)

66 *
d©a
 = 
loÝback_buf
[
loÝback_š
];

67 
loÝback_š
++;

68 if(
LOOPBACK_BUF_SIZE
 <ð
loÝback_š
)

69 
loÝback_š
 = 0;

70  
SDL_TRUE
;

72  
SDL_FALSE
;

73 
	}
}

75 
SDL_boÞ
 
	$loÝback_put_by‹
(
Ušt8
 
d©a
)

77 
loÝback_out_w¿p
 = (
loÝback_out
 < 
loÝback_š
)?†oÝback_ouˆ+ 
LOOPBACK_BUF_SIZE
 :†oopback_out;

79 if(
loÝback_out_w¿p
 + 1 =ð
loÝback_š
)

80  
SDL_FALSE
;

82 
loÝback_buf
[
loÝback_out
] = 
d©a
;

83 
loÝback_out
++;

84 if(
LOOPBACK_BUF_SIZE
 <ð
loÝback_out
)

85 
loÝback_out
 = 0;

87  
SDL_TRUE
;

88 
	}
}

90 
SDL_boÞ
 
	$acŸ_š™_loÝback
Ð
acŸ
*‡cia )

92 
loÝback_š
 = 0;

93 
loÝback_out
 = 0;

94 
acŸ
->
dÚe
 = 
loÝback_dÚe
;

95 
acŸ
->
¡©
 = 
loÝback_¡©
;

96 
acŸ
->
has_by‹
 = 
loÝback_has_by‹
;

97 
acŸ
->
g‘_by‹
 = 
loÝback_g‘_by‹
;

98 
acŸ
->
put_by‹
 = 
loÝback_put_by‹
;

100 
acŸ
->
Üic
->
acŸback’d
 = 
ACIA_TYPE_LOOPBACK
;

101  
SDL_TRUE
;

102 
	}
}

	@6551_modem.c

22 #ifdeà
__MINGW32__


24 
	#_WIN32_WINNT
 0x0501

	)

27 #ifdeà
_MSC_VER


29 #´agm¨
comm’t
(
lib
, "Ws2_32.lib")

30 
	~<¡ršg.h
>

31 
	~<ùy³.h
>

32 
	~<¡dlib.h
>

35 
	~"sy¡em.h
"

36 
	~"6502.h
"

37 
	~"vŸ.h
"

38 
	~"8912.h
"

39 
	~"gui.h
"

40 
	~"disk.h
"

41 
	~"mÚ™Ü.h
"

42 
	~"6551.h
"

43 
	~"machše.h
"

45 #ifdeà
BACKEND_MODEM


47 
machše
* 
	gÜic
 = 
NULL
;

49 
	#CMD_BUF_SIZE
 4

	)

50 
Ušt8
 
	gmdm_cmd_buf
[
CMD_BUF_SIZE
];

53 
Ušt32
 
	gmdm_time_buf
[
CMD_BUF_SIZE
];

55 
	#DATA_BUF_SIZE
 4096

	)

56 
	gmdm_š
 = 0;

57 
Ušt8
 
	gmdm_š_buf
[
DATA_BUF_SIZE
];

58 
	gmdm_out
 = 0;

59 
Ušt8
 
	gmdm_out_buf
[
DATA_BUF_SIZE
];

61 
SDL_boÞ
 
	gcÚÃùed
 = 
SDL_FALSE
;

62 
SDL_boÞ
 
	gli¡’šg
 = 
SDL_FALSE
;

63 
SDL_boÞ
 
	gesÿ³d
 = 
SDL_FALSE
;

65 
	g¤v_sck
 = -1;

66 
	gút_sck
 = -1;

69 
SDL_boÞ
 
sock‘_š™
();

70 
sock‘_dÚe
();

71 
sock‘_ü—‹
(* 
sock
, 
domaš
);

72 
sock‘_bšd
(
sock
, 
pÜt
, 
domaš
);

73 
sock‘_li¡’
(
sock
);

74 
sock‘_acû±
(
sock
, * 
sck
);

75 
sock‘_cÚÃù
(
sock
, cÚ¡ * 

, 
pÜt
, 
domaš
);

76 
sock‘_wr™e
(
sock
, cÚ¡ * 
d©a
, 
Ën
);

77 
sock‘_»ad
(
sock
, * 
d©a
, * 
Ën
);

78 
sock‘_þo£
(
sock
);

80 * 
	$Œim
(* 
lše
)

82 if(
lše
 && *line)

84 
l
 = ()
	`¡¾’
(
lše
);

85 0 <ð
l
 && 
lše
[l-1] == ' ')

86 
lše
[--
l
] = '\0';

87 0 <ð
l
 && 
lše
[0] == ' ')

88 
	`memmove
(
lše
,†še+1, 
l
--);

90  
lše
;

91 
	}
}

93 
	$£nd_¡r
(cÚ¡ * 
s
)

95 
s
 && *s)

97 
mdm_out_buf
[
mdm_out
] = *
s
++;

98 
mdm_out
++;

99 if(
mdm_out
 =ð
DATA_BUF_SIZE
)

101 
	`memmove
(
mdm_out_buf
, mdm_out_buf+1, 
DATA_BUF_SIZE
-1);

102 
mdm_š
--;

105 
	}
}

107 
	$£nd_»¥Úû
(cÚ¡ * 
s
)

109 
	`£nd_¡r
("\r\n");

110 if(
s
 && *s)

112 
	`£nd_¡r
(
s
);

113 
	`£nd_¡r
("\r\n");

115 
	}
}

117 
	$£nd_»¥Úû_ok
()

119 
	`£nd_»¥Úû
("OK");

120 
	}
}

122 
	$£nd_»¥Úû_”rÜ
()

124 
	`£nd_»¥Úû
("ERROR");

125 
	}
}

127 
	$mdm_hªgup
()

129 
cÚÃùed
 = 
SDL_FALSE
;

130 
esÿ³d
 = 
SDL_FALSE
;

131 
	`sock‘_þo£
(
út_sck
);

132 
út_sck
 = -1;

133 
	}
}

135 
	$mdm_ªsw”off
()

137 ifÐ
li¡’šg
 )

139 
li¡’šg
 = 
SDL_FALSE
;

140 
	`sock‘_þo£
(
¤v_sck
);

141 
¤v_sck
 = -1;

143 
	}
}

145 
	$mdm_ªsw”Ú
()

147 ifÐ!
li¡’šg
 )

149 if(
	`sock‘_ü—‹
(&
¤v_sck
, 
Üic
->
acŸback’dcfgdomaš
) &&

150 
	`sock‘_bšd
(
¤v_sck
, 
Üic
->
acŸback’dcfgpÜt
, oric->
acŸback’dcfgdomaš
) &&

151 
	`sock‘_li¡’
(
¤v_sck
))

152 
li¡’šg
 = 
SDL_TRUE
;

154 
	}
}

156 
	$mdm_cÚÃù
(cÚ¡ * 
s
)

158 

[1024];

159 * 
p
 = 
NULL
;

160 
pÜt
 = 0;

162 
	`¡rýy
(

, 
s
);

163 
	`Œim
(

);

164 
p
 = 
	`¡¼chr
(

, ':');

166 if(
p
)

168 
pÜt
 = 
	`©oi
(
p
+1);

169 
p
[0] = '\0';

172 if(
pÜt
 =ð0èpÜˆð
ACIA_TYPE_MODEM_DEFAULT_PORT
;

174 ifÐ
	`sock‘_ü—‹
(&
út_sck
, 
Üic
->
acŸback’dcfgdomaš
) )

176 if(
	`sock‘_cÚÃù
(
út_sck
, 

, 
pÜt
, 
Üic
->
acŸback’dcfgdomaš
))

178 
	`£nd_»¥Úû
("CONNECT");

179 
cÚÃùed
 = 
SDL_TRUE
;

183 
	`£nd_»¥Úû
("BUSY");

186 
	`£nd_»¥Úû
("NO DIALTINE");

188 
	`mdm_hªgup
();

189 
	}
}

191 
	$·r£_commªd
(cÚ¡ * 
s
)

193 if(!
s
)

196 ifÐ
esÿ³d
 )

198 if('\0' =ð
s
[0])

199 
	`£nd_»¥Úû
("");

200 if(!
	`¡rÿ£cmp
("ATA", 
s
))

201 
esÿ³d
 = 
SDL_FALSE
;

202 if(!
	`¡rÿ£cmp
("ATO", 
s
))

203 
esÿ³d
 = 
SDL_FALSE
;

204 if(!
	`¡rÿ£cmp
("ATH1", 
s
))

205 
esÿ³d
 = 
SDL_FALSE
;

206 if(!
	`¡rÿ£cmp
("ATH0", 
s
))

208 
	`mdm_hªgup
();

209 
	`£nd_»¥Úû_ok
();

211 if(!
	`¡ºÿ£cmp
("ATZ", 
s
, 3))

213 
	`mdm_hªgup
();

214 
	`£nd_»¥Úû_ok
();

217 
	`£nd_»¥Úû_”rÜ
();

221 if('\0' =ð
s
[0])

222 
	`£nd_»¥Úû
("");

223 if(!
	`¡rÿ£cmp
("AT", 
s
))

224 
	`£nd_»¥Úû_ok
();

225 if(!
	`¡rÿ£cmp
("ATA", 
s
))

227 
	`mdm_ªsw”Ú
();

228 ifÐ!
li¡’šg
 )

229 
	`£nd_»¥Úû_”rÜ
();

231 
	`£nd_»¥Úû
("AUTOANSWER ON");

233 if(!
	`¡ºÿ£cmp
("ATS0=", 
s
, 5))

235 * 
p
 = 
	`Œim
(
	`¡rdup
(
s
+5));

236 
Ú
 = 
	`©oi
(
p
);

237 
	`ä“
(
p
);

239 if(0<
Ú
)

241 
	`mdm_ªsw”Ú
();

242 ifÐ!
li¡’šg
 )

243 
	`£nd_»¥Úû_”rÜ
();

245 
	`£nd_»¥Úû
("AUTOANSWER ON");

249 
	`mdm_ªsw”off
();

250 
	`£nd_»¥Úû
("AUTOANSWER OFF");

253 if(!
	`¡rÿ£cmp
("ATS0?", 
s
))

255 ifÐ
li¡’šg
 )

256 
	`£nd_»¥Úû
("AUTOANSWER ON");

258 
	`£nd_»¥Úû
("AUTOANSWER OFF");

260 if(!
	`¡rÿ£cmp
("ATH0", 
s
))

262 
	`mdm_hªgup
();

263 
	`£nd_»¥Úû_ok
();

265 if(!
	`¡rÿ£cmp
("ATH1", 
s
))

266 
	`£nd_»¥Úû_ok
();

267 if(!
	`¡ºÿ£cmp
("ATZ", 
s
, 3))

268 
	`£nd_»¥Úû_ok
();

269 if(!
	`¡ºÿ£cmp
("AT&F", 
s
, 4))

270 
	`£nd_»¥Úû_ok
();

271 if(!
	`¡ºÿ£cmp
("ATD", 
s
, 3))

273 
s
 = s + 3;

274 
	`tÞow”
(*
s
))

278 
s
++;

281 if(*
s
)

282 
	`mdm_cÚÃù
(
s
);

284 
	`£nd_»¥Úû_”rÜ
();

287 
	`£nd_»¥Úû_”rÜ
();

289 
	}
}

291 
	$modem_dÚe
Ð
acŸ
*‡cia )

293 
	`mdm_hªgup
();

295 
	`sock‘_þo£
(
¤v_sck
);

296 
¤v_sck
 = -1;

298 
	`sock‘_dÚe
();

300 
	}
}

302 
Ušt8
 
	$modem_¡©
(
Ušt8
 
¡©
)

304 ifÐ
cÚÃùed
 && !
esÿ³d
 )

306 
Ën
 = 
DATA_BUF_SIZE
 - 
mdm_out
;

307 if(0 < 
Ën
)

309 if(!
	`sock‘_»ad
(
út_sck
, 
mdm_out_buf
 + 
mdm_out
, &
Ën
))

311 
	`mdm_hªgup
();

312 
	`£nd_»¥Úû
("NO CARRIER");

315 
mdm_out
 +ð
Ën
;

319 ifÐ!
cÚÃùed
 && 
li¡’šg
 )

321 if(
	`sock‘_acû±
(
¤v_sck
, &
út_sck
))

323 
	`£nd_»¥Úû
("CONNECT");

324 
cÚÃùed
 = 
SDL_TRUE
;

328 ifÐ
cÚÃùed
 )

329  (
¡©
 & ~(
ASTF_CARRIER
|
ASTF_DSR
));

331 ifÐ
li¡’šg
 )

332  (
¡©
 & ~(
ASTF_DSR
));

334  (
¡©
 | (
ASTF_CARRIER
|
ASTF_DSR
));

335 
	}
}

337 
SDL_boÞ
 
	$modem_has_by‹
(
Ušt8
* 
d©a
)

339 if(0 < 
mdm_out
)

341 *
d©a
 = 
mdm_out_buf
[0];

342  
SDL_TRUE
;

345  
SDL_FALSE
;

346 
	}
}

348 
SDL_boÞ
 
	$modem_g‘_by‹
(
Ušt8
* 
d©a
)

350 if(0 < 
mdm_out
)

352 *
d©a
 = 
mdm_out_buf
[0];

353 
	`memmove
(
mdm_out_buf
, mdm_out_buf+1, 
mdm_out
);

354 
mdm_out
--;

355  
SDL_TRUE
;

358  
SDL_FALSE
;

359 
	}
}

361 
	$mdm_esÿ³
(
Ušt8
 
d©a
)

363 
mdm_cmd_buf
[0] = mdm_cmd_buf[1];

364 
mdm_cmd_buf
[1] = mdm_cmd_buf[2];

365 
mdm_cmd_buf
[2] = mdm_cmd_buf[3];

366 
mdm_cmd_buf
[3] = 
d©a
;

368 
mdm_time_buf
[0] = mdm_time_buf[1];

369 
mdm_time_buf
[1] = mdm_time_buf[2];

370 
mdm_time_buf
[2] = mdm_time_buf[3];

371 
mdm_time_buf
[3] = 
	`SDL_G‘Ticks
();

373 ifÐ
mdm_cmd_buf
[1] == '+' && mdm_cmd_buf[2] == '+' && mdm_cmd_buf[3] == '+')

375 if(1000 < (
mdm_time_buf
[3] - mdm_time_buf[0]))

377 
esÿ³d
 = 
SDL_TRUE
;

380 
	}
}

382 
SDL_boÞ
 
	$modem_put_by‹
(
Ušt8
 
d©a
)

384 ifÐ
cÚÃùed
 && !
esÿ³d
 )

386 if(!
	`sock‘_wr™e
(
út_sck
, &
d©a
, 1))

388 
	`mdm_hªgup
();

389 
	`£nd_»¥Úû
("NO CARRIER");

391 
	`mdm_esÿ³
(
d©a
);

395 
mdm_š_buf
[
mdm_š
] = 
d©a
;

396 
mdm_š
++;

397 if(
mdm_š
 =ð
DATA_BUF_SIZE
)

399 
	`memmove
(
mdm_š_buf
, mdm_š_buf+1, 
DATA_BUF_SIZE
-1);

400 
mdm_š
--;

406 if(
d©a
 == 0x08 || data == 0x7f || data == 0x7e)

408 
mdm_š
)

413 
mdm_š
 = 0;

416 
mdm_š
 -= 2;

420 if(
d©a
 == 0x0d)

422 
mdm_š_buf
[
mdm_š
-1] = 0x00;

423 
	`·r£_commªd
((cÚ¡ *)
mdm_š_buf
);

424 
mdm_š
 = 0;

429 if(
mdm_out
 < 
DATA_BUF_SIZE
)

430 
mdm_out_buf
[
mdm_out
++] = 
d©a
;

433  
SDL_TRUE
;

434 
	}
}

436 
SDL_boÞ
 
	$acŸ_š™_modem
Ð
acŸ
*‡cia )

438 
Üic
 = 
acŸ
->oric;

440 
mdm_š
 = 0;

441 
mdm_out
 = 0;

443 
mdm_š_buf
[0] = 0x00;

444 
mdm_out_buf
[0] = 0x00;

445 
	`mem£t
(
mdm_cmd_buf
, 0, (
Ušt8
)*
CMD_BUF_SIZE
);

446 
	`mem£t
(
mdm_time_buf
, 0, (
Ušt32
)*
CMD_BUF_SIZE
);

448 
acŸ
->
dÚe
 = 
modem_dÚe
;

449 
acŸ
->
¡©
 = 
modem_¡©
;

450 
acŸ
->
has_by‹
 = 
modem_has_by‹
;

451 
acŸ
->
g‘_by‹
 = 
modem_g‘_by‹
;

452 
acŸ
->
put_by‹
 = 
modem_put_by‹
;

454 
¤v_sck
 = -1;

455 
út_sck
 = -1;

457 
cÚÃùed
 = 
SDL_FALSE
;

458 
li¡’šg
 = 
SDL_FALSE
;

459 
esÿ³d
 = 
SDL_FALSE
;

461 if(
	`sock‘_š™
())

463 
Üic
->
acŸback’d
 = 
ACIA_TYPE_MODEM
;

464  
SDL_TRUE
;

468 
	`acŸ_š™_nÚe
Ð
acŸ
 );

469  
SDL_FALSE
;

470 
	}
}

474 
	~<¡dio.h
>

475 
	~<¡dlib.h
>

476 
	~<time.h
>

479 #ià
defšed
(
__amigaos4__
è|| defšed(
__MORPHOS__
)

480 
	~<sys/sock‘.h
>

481 
	~<sys/fúŽ.h
>

482 
	~<Ãtš‘/š.h
>

483 
	~<Ãtdb.h
>

484 
	#_»cvd©a
(
a
, 
b
, 
c
è
	`»cv
×, b, c, 0)

	)

485 
	#_þo£sock‘
 
þo£


	)

486 #ià
defšed
(
__MORPHOS__
)

487 
Lib¿ry
 *
	gSock‘Ba£
;

488 
	tsockËn_t
;

489 *
	$š‘_Áß
(
š_addr
 
n
)

491 
a
[ "XXX.XXX.XXX.XXX"];

492 *
p
 = (*)&
n
;

494 
	`¢´štf
(
a
, ‡, "%d.%d.%d.%d", 
p
[0]&0xff,…[1]&0xff,…[2]&0xff,…[3]&0xff);

495  
a
;

496 
	}
}

500 #ià
defšed
(
__LINUX__
è|| defšed(
__APPLE__
)

501 
	~<sys/sock‘.h
>

502 
	~<sys/un.h
>

503 
	~<¬·/š‘.h
>

504 
	~<Ãtdb.h
>

505 
	~<fúŽ.h
>

506 
	#_»cvd©a
(
a
, 
b
, 
c
è
	`»ad
×, b, c)

	)

507 
	#_þo£sock‘
 
þo£


	)

510 #ifdeà
__APPLE__


511 
	~<sys/time.h
>

514 #ifdeà
WIN32


515 
	#WIN32_LEAN_AND_MEAN


	)

516 
	~<wšsock2.h
>

517 
	~<ws2tý.h
>

518 
	#_»cvd©a
(
a
, 
b
, 
c
è
	`»cv
×, b, c, 0)

	)

519 
	#_þo£sock‘
 
þo£sock‘


	)

522 
SDL_boÞ
 
	gsock‘_š™Ÿlized
 = 
SDL_FALSE
;

524 
SDL_boÞ
 
	$sock‘_š™
()

526 if(!
sock‘_š™Ÿlized
)

528 #ifdeà
WIN32


529 
WSADATA
 
w§d©a
;

530 ifÐ(
	`WSAS¹up
(
	`MAKEWORD
(2,2), &
w§d©a
è=ð
SOCKET_ERROR
) ||

531 (
	`WSAS¹up
(
	`MAKEWORD
(1,1), &
w§d©a
è=ð
SOCKET_ERROR
) )

532  
SDL_FALSE
;

534 #ifdeà
__MORPHOS__


535 ifÐ!(
Sock‘Ba£
 = 
	`OldO³nLib¿ry
("bsdsocket.library")) )

536  
SDL_FALSE
;

539 
sock‘_š™Ÿlized
 = 
SDL_TRUE
;

540  
SDL_TRUE
;

541 
	}
}

543 
	$sock‘_dÚe
()

545 #ifdeà
WIN32


546 
	`WSACËªup
();

548 #ifdeà
__MORPHOS__


549 ifÐ
Sock‘Ba£
 )

550 
	`Clo£Lib¿ry
(
Sock‘Ba£
);

552 
	}
}

554 
	$sock‘_ü—‹
(* 
sock
, 
domaš
)

556 
Ú
 = 1;

557 #ià
	`defšed
(
__amigaos4__
è|| defšed(
__MORPHOS__
)

558 
domaš
 = 
AF_INET
;

560 ià(
domaš
 == 6)

561 
domaš
 = 
AF_INET6
;

563 
domaš
 = 
AF_INET
;

565 *
sock
 = 
	`sock‘
(
domaš
, 
SOCK_STREAM
, 0);

566 if(*
sock
 == -1)

569 if(
	`£tsockÝt
(*
sock
, 
SOL_SOCKET
, 
SO_REUSEADDR
, (cÚ¡ *è&
Ú
, (on)) == -1)

571 #ifdeà
__APPLE__


572 if(
	`£tsockÝt
(*
sock
, 
SOL_SOCKET
, 
SO_REUSEPORT
, (cÚ¡ *è&
Ú
, (on)) == -1)

577 
	}
}

582 
	$sock‘_bšd
(
sock
, 
pÜt
, 
domaš
)

585 #ifdeà
NO_GETADDRINFO


586 
sockaddr_š
 
¤v_addr
;

587 
	`mem£t
((*)&
¤v_addr
, 0, (srv_addr));

588 
¤v_addr
.
sš_çmžy
 = 
AF_INET
;

589 
¤v_addr
.
sš_addr
.
s_addr
 = 
	`htÚl
(
INADDR_ANY
);

590 
¤v_addr
.
sš_pÜt
 = 
	`htÚs
(
pÜt
);

592 if(
	`bšd
(
sock
, (
sockaddr
*è&
¤v_addr
, (srv_addr)) == -1) {

593 
	`³¼Ü
("socket_bind, bindƒrror: ");

597 
addršfo
 
hšts
, *
»s
, *
»s§ve
;

598 
£rviû
[
NI_MAXSERV
];

599 
n
;

601 
	`mem£t
(&
hšts
, 0, (hints));

602 
hšts
.
ai_æags
 = 
AI_PASSIVE
;

603 ià(
domaš
 == 6)

604 
hšts
.
ai_çmžy
 = 
AF_INET6
;

606 
hšts
.
ai_çmžy
 = 
AF_INET
;

607 
hšts
.
ai_sockty³
 = 
SOCK_STREAM
;

609 
	`¥rštf
(
£rviû
, "%d", 
pÜt
);

611 iàÐ(
n
 = 
	`g‘addršfo
(
NULL
, 
£rviû
, &
hšts
, &
»s
)) != 0) {

612 
	`´štf
("sock‘_bšd, g‘addršfØ”rÜ: %s", 
	`gai_¡»¼Ü
(
n
));

615 
»s§ve
 = 
»s
;

619 ià(
	`bšd
(
sock
, 
»s
->
ai_addr
,„es->
ai_add¾’
) == 0)

621 }  (
»s
 =„es->
ai_Ãxt
è!ð
NULL
);

623 
	`ä“addršfo
(
»s§ve
);

625 ià(
»s
 =ð
NULL
) {

626 
	`³¼Ü
("socket_bind, bindƒrror: ");

632 #ià
	`defšed
(
__LINUX__
è|| defšed(
__APPLE__
è|| defšed(
__amigaos4__
è|| defšed(
__MORPHOS__
)

633 
	`fúŽ
(
sock
, 
F_SETFL
, fúŽ(sock, 
F_GETFL
, 0è| 
O_NONBLOCK
);

636 #ifdeà
WIN32


637 
u_lÚg
 
imode
 = 1;

638 
	`ioùlsock‘
(
sock
, 
FIONBIO
, &
imode
);

641 
	}
}

643 
	$sock‘_li¡’
(
sock
)

645 if(
	`li¡’
(
sock
, 1) == -1)

649 
	}
}

651 
	$sock‘_acû±
(
sock
, * 
sck
)

653 #ià
	`defšed
(
__amigaos4__
è|| defšed(
__MORPHOS__
)

654 
sockaddr_š
 
þi_addr
;

656 
sockaddr_¡Üage
 
þi_addr
;

658 
sockËn_t
 
þi_addr_Ën
 = (
þi_addr
);

660 *
sck
 = 
	`acû±
(
sock
, (
sockaddr
*è&
þi_addr
, (
sockËn_t
*è&
þi_addr_Ën
);

661 if(*
sck
 == -1)

665 #ià
	`defšed
(
__LINUX__
è|| defšed(
__amigaos4__
è|| defšed(
__MORPHOS__
)

666 
	`fúŽ
(*
sck
, 
F_SETFL
, fúŽ(*sck, 
F_GETFL
, 0è| 
O_NONBLOCK
);

669 #ià
	`defšed
(
WIN32
)

670 
u_lÚg
 
imode
 = 1;

671 
	`ioùlsock‘
(*
sck
, 
FIONBIO
, &
imode
);

676 
	}
}

678 
	$sock‘_wr™e
(
sock
, cÚ¡ * 
d©a
, 
Ën
)

680 if(
	`£nd
(
sock
, (*)
d©a
, 
Ën
, 0) == -1)

683 
	}
}

685 
	$sock‘_»ad
(
sock
, * 
d©a
, * 
Ën
)

687 
»t
 = ()
	`_»cvd©a
(
sock
, (*)
d©a
, *
Ën
);

688 *
Ën
 = 0;

689 if(0 =ð
»t
)

691 if(0 < 
»t
)

692 *
Ën
 = 
»t
;

694 
	}
}

696 #ifdeà
NO_GETADDRINFO


697 
	$ho¡Çme_to_
(cÚ¡ * 
ho¡
, * 

, 
Ën
)

699 
ho¡’t
 *
he
 = 
	`g‘ho¡byÇme
Ð(*)
ho¡
 );

700 ifÐ
NULL
 !ð
he
 )

702 
š_addr
 **
addr_li¡
 = (š_add¸**è
he
->
h_addr_li¡
;

703 ifÐ
NULL
 !ð
addr_li¡
[0] )

705 
	`¡ºýy
(

, 
	`š‘_Áß
(*
addr_li¡
[0]), 
Ën
);

709 
	`¡ºýy
(

, 
ho¡
, 
Ën
);

710 
	}
}

713 
	$sock‘_cÚÃù
(
sock
, cÚ¡ * 
ho¡
, 
pÜt
, 
domaš
)

715 #ifdeà
NO_GETADDRINFO


716 

[64];

717 
sockaddr_š
 
addr
;

718 
addr
.
sš_çmžy
 = 
AF_INET
;

719 
addr
.
sš_pÜt
 = 
	`htÚs
(
pÜt
);

721 
	`ho¡Çme_to_
(
ho¡
, 

, 64);

722 
addr
.
sš_addr
.
s_addr
 = 
	`š‘_addr
((*)

);

724 if(
	`cÚÃù
(
sock
, (
sockaddr
*è&
addr
, (addr)) != 0) {

725 
	`³¼Ü
("socket_connect, connectƒrror: ");

729 
addršfo
 
hšts
, *
»s
, *
»s§ve
;

730 
£rviû
[
NI_MAXSERV
];

731 
n
;

733 
	`mem£t
(&
hšts
, 0, (hints));

734 ià(
domaš
 == 6)

735 
hšts
.
ai_çmžy
 = 
AF_INET6
;

737 
hšts
.
ai_çmžy
 = 
AF_INET
;

738 
hšts
.
ai_sockty³
 = 
SOCK_STREAM
;

740 
	`¥rštf
(
£rviû
, "%d", 
pÜt
);

742 iàÐ(
n
 = 
	`g‘addršfo
(
ho¡
, 
£rviû
, &
hšts
, &
»s
)) != 0) {

743 
	`´štf
("sock‘_cÚÃù, g‘addršfØ”rÜ: %s", 
	`gai_¡»¼Ü
(
n
));

746 
»s§ve
 = 
»s
;

750 ià(
	`cÚÃù
(
sock
, 
»s
->
ai_addr
,„es->
ai_add¾’
) == 0)

752 }  (
»s
 =„es->
ai_Ãxt
è!ð
NULL
);

754 
	`ä“addršfo
(
»s§ve
);

756 ià(
»s
 =ð
NULL
) {

757 
	`³¼Ü
("socket_bind, connectƒrror: ");

762 #ià
	`defšed
(
__LINUX__
è|| defšed(
__APPLE__
è|| defšed(
__amigaos4__
è|| defšed(
__MORPHOS__
)

763 
	`fúŽ
(
sock
, 
F_SETFL
, fúŽ(sock, 
F_GETFL
, 0è| 
O_NONBLOCK
);

766 #ifdeà
WIN32


767 
u_lÚg
 
imode
 = 1;

768 
	`ioùlsock‘
(
sock
, 
FIONBIO
, &
imode
);

772 
	}
}

774 
	$sock‘_þo£
(
sock
)

776 if(
	`_þo£sock‘
(
sock
) == -1)

780 
	}
}

	@8912.c

22 
	#TONETIME
 8

	)

23 
	#NOISETIME
 8

	)

24 
	#ENVTIME
 16

	)

26 
	~<¡dio.h
>

27 
	~<¡dlib.h
>

28 
	~<¡ršg.h
>

30 
	~"sy¡em.h
"

31 
	~"6502.h
"

32 
	~"8912.h
"

33 
	~"vŸ.h
"

34 
	~"gui.h
"

35 
	~"disk.h
"

36 
	~"mÚ™Ü.h
"

37 
	~"6551.h
"

38 
	~"machše.h
"

39 
	~"avi.h
"

41 #ifdeà
__amigaos4__


42 
	~<´Ùo/exec.h
>

45 
SDL_AudioS³c
 
	gobšed
;

46 
Ušt32
 
	gcyþe¥”§m¶e
;

48 
SDL_AudioCVT
 
	gcvt
;

49 
Sšt16
 
	gaudioÿpbuf
[
AUDIO_BUFLEN
];

50 
avi_hªdË
 *
vidÿp
;

52 
Sšt16
 
soundsž’û
;

53 
SDL_boÞ
 
soundavažabË
, 
soundÚ
, 
w¬p¥“d
;

57 *
	gkeyqueue
 = 
NULL
;

58 
	gkeysqueued
 = 0, 
	gkqoffs
 = 0;

61 
Sšt32
 
	gvÞb
[] = { 0, 513/4, 828/4, 1239/4, 1923/4, 3238/4, 4926/4, 9110/4, 10344/4, 17876/4, 24682/4, 30442/4, 38844/4, 47270/4, 56402/4, 65535/4};

66 
	gesh­e0
[] = { 15,14,13,12,11,10, 9, 8, 7, 6, 5, 4, 3, 2, 1, 0, 128+15 };

67 
	gesh­e4
[] = { 0, 1, 2, 3, 4, 5, 6, 7, 8, 9,10,11,12,13,14,15, 0, 128+16 };

68 
	gesh­e8
[] = { 15,14,13,12,11,10, 9, 8, 7, 6, 5, 4, 3, 2, 1, 0, 128+0 };

69 
	gesh­eA
[] = { 15,14,13,12,11,10, 9, 8, 7, 6, 5, 4, 3, 2, 1, 0, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9,10,11,12,13,14,15, 128+0 };

70 
	gesh­eB
[] = { 15,14,13,12,11,10, 9, 8, 7, 6, 5, 4, 3, 2, 1, 0, 15, 128+16 };

71 
	gesh­eC
[] = { 0, 1, 2, 3, 4, 5, 6, 7, 8, 9,10,11,12,13,14,15, 128+0 };

72 
	gesh­eD
[] = { 0, 1, 2, 3, 4, 5, 6, 7, 8, 9,10,11,12,13,14,15, 128+15 };

73 
	gesh­eE
[] = { 0, 1, 2, 3, 4, 5, 6, 7, 8, 9,10,11,12,13,14,15,15,14,13,12,11,10, 9, 8, 7, 6, 5, 4, 3, 2, 1, 0, 128+0 };

75 *
	gesh­es
[] = { 
esh­e0
,

76 
esh­e0
,

77 
esh­e0
,

78 
esh­e0
,

79 
esh­e4
,

80 
esh­e4
,

81 
esh­e4
,

82 
esh­e4
,

83 
esh­e8
,

84 
esh­e0
,

85 
esh­eA
,

86 
esh­eB
,

87 
esh­eC
,

88 
esh­eD
,

89 
esh­eE
,

90 
esh­e4
 };

93 
SDL_COMPAT_KEY
 *
	gkeyb
;

97 
SDL_COMPAT_KEY
 
	gqwkb
[] = { '7' , 'n' , '5' , 'v' , 
SDLK_RCTRL
 , '1' , 'x' , '3' ,

98 'j' , 't' , 'r' , 'f' , 0 , 
SDLK_ESCAPE
, 'q' , 'd' ,

99 'm' , '6' , 'b' , '4' , 
SDLK_LCTRL
 , 'z' , '2' , 'c' ,

101 
SDLK_SPACE
 , ',' , '.' , 
SDLK_UP
 , 
SDLK_LSHIFT
, 
SDLK_LEFT
 , 
SDLK_DOWN
 , 
SDLK_RIGHT
 ,

102 'u' , 'i' , 'o' , 'p' , 
SDLK_LALT
 , 
SDLK_BACKSPACE
, ']' , '[' ,

103 'y' , 'h' , 'g' , 'e' , 
SDLK_RALT
 , 'a' , 's' , 'w' ,

104 '8' , 'l' , '0' , '/' , 
SDLK_RSHIFT
, 
SDLK_RETURN
, '`' , 
SDLK_EQUALS
 };

107 
SDL_COMPAT_KEY
 
	gazkb
[] = { '7' , 'n' , '5' , 'v' , 
SDLK_RCTRL
 , '1' , 'x' , '3' ,

108 'j' , 't' , 'r' , 'f' , 0 , 
SDLK_ESCAPE
, 'a' , 'd' ,

109 'm' , '6' , 'b' , '4' , 
SDLK_LCTRL
 , 'w' , '2' , 'c' ,

111 
SDLK_SPACE
 , ',' , '.' , 
SDLK_UP
 , 
SDLK_LSHIFT
, 
SDLK_LEFT
 , 
SDLK_DOWN
 , 
SDLK_RIGHT
 ,

112 'u' , 'i' , 'o' , 'p' , 
SDLK_LALT
 , 
SDLK_BACKSPACE
, ']' , '[' ,

113 'y' , 'h' , 'g' , 'e' , 
SDLK_RALT
 , 'q' , 's' , 'z' ,

114 '8' , 'l' , '0' , '/' , 
SDLK_RSHIFT
, 
SDLK_RETURN
, '`' , 
SDLK_EQUALS
 };

117 
SDL_COMPAT_KEY
 
	gqzkb
[] = { '7' , 'n' , '5' , 'v' , 
SDLK_RCTRL
 , '1' , 'x' , '3' ,

118 'j' , 't' , 'r' , 'f' , 0 , 
SDLK_ESCAPE
, 'q' , 'd' ,

119 'm' , '6' , 'b' , '4' , 
SDLK_LCTRL
 , 'y' , '2' , 'c' ,

121 
SDLK_SPACE
 , ',' , '.' , 
SDLK_UP
 , 
SDLK_LSHIFT
, 
SDLK_LEFT
 , 
SDLK_DOWN
 , 
SDLK_RIGHT
 ,

122 'u' , 'i' , 'o' , 'p' , 
SDLK_LALT
 , 
SDLK_BACKSPACE
, ']' , '[' ,

123 'z' , 'h' , 'g' , 'e' , 
SDLK_RALT
 , 'a' , 's' , 'w' ,

124 '8' , 'l' , '0' , '/' , 
SDLK_RSHIFT
, 
SDLK_RETURN
, '`' , 
SDLK_EQUALS
 };

128 
	$queuekeys
Ð*
¡r
 )

130 ifÐ
¡r
 )

132 
Ën
 = ()
	`¡¾’
Ð
¡r
 );

133 ifÐ
keyqueue
 )

135 
keyqueue
 = 
	`»®loc
(keyqueue, 
	`¡¾’
(keyqueueè+ 
Ën
 + 1);

136 
	`¡rÿt
(
keyqueue
, 
¡r
);

137 
keysqueued
 +ð
Ën
;

141 
keyqueue
 = 
	`¡rdup
Ð
¡r
 );

142 
keysqueued
 = 
Ën
;

143 
kqoffs
 = 0;

146 
	}
}

151 
Ušt32
 
	$ay¿nd
Ð
ay8912
 *
ay
 )

153 
Ušt32
 
rb™
 = (
ay
->
ºd¿ck
&1) ^ ((ay->rndrack>>2)&1);

154 
ay
->
ºd¿ck
 = (ay->ºd¿ck>>1)|(
rb™
<<16);

155  
rb™
&1;

156 
	}
}

158 
	$ay_audiÙicktock
Ð
ay8912
 *
ay
, 
Ušt32
 
cyþes
 )

160 
Sšt32
 
i
;

161 
Sšt32
 
ouut
;

164  
cyþes
 > 0 )

167 ifÐ(++
ay
->
ùn
è>ðay->
noi£³r
 )

170 
ay
->
cu¼noi£
 ^ð
	`ay¿nd
(‡y );

173 
ay
->
ùn
 = 0;

176 
ay
->
Ãwnoi£
 = 
SDL_TRUE
;

180  
i
=0; i<3; i++ )

182 ifÐ!
ay
->
tÚ•”
[
i
] )

184 ifÐ!
ay
->
sign
[
i
] )

186 
ay
->
sign
[
i
] = 1;

187 
ay
->
Ãwout
 |ð(1<<
i
);

193 ifÐ(++
ay
->
ù
[
i
]è>ðay->
tÚ•”
[i] )

196 
ay
->
ù
[
i
] = 0;

199 
ay
->
sign
[
i
] ^= 1;

202 
ay
->
Ãwout
 |ð(1<<
i
);

207 ifÐÐ
ay
->
Ãwnoi£
 ) && ( !ay->
noi£b™
[
i
] ) )

208 
ay
->
Ãwout
 |ð(1<<
i
);

212 ifÐ(++
ay
->
ùe
è>ðay->
’v³r
 )

215 
ay
->
ùe
 = 0;

218 
ay
->
’vpos
++;

221 ifÐ
ay
->
’vb
[ay->
’vpos
]&0x80 )

222 
ay
->
’vpos
 =‡y->
’vb
[ay->envpos]&0x7f;

225  
i
=0; i<3; i++ )

228 ifÐ
ay
->
»gs
[
AY_CHA_AMP
+
i
]&0x10 )

231 
ay
->
vÞ
[
i
] = 
vÞb
[ay->
’vb
[ay->
’vpos
]];

234 
ay
->
Ãwout
 |ð(1<<
i
);

240 
cyþes
--;

243 ifÐ!
ay
->
Ãwout
 ) ;

246 
ouut
 = 
soundsž’û
;

249  
i
=0; i<3; i++ )

252 ifÐ
ay
->
Ãwout
 & (1<<
i
) )

253 
ay
->
out
[
i
] = (×y->
tÚeb™
[i]|ay->
sign
[i])&×y->
noi£b™
[i]|ay->
cu¼noi£
)è*‡y->
vÞ
[i];

256 
ouut
 +ð
ay
->
out
[
i
];

259 
ay
->
Ãwout
 = 0;

262 ifÐ
ouut
 > 32767 ) output = 32767;

264 
ay
->
ouut
 = output;

265 
	}
}

267 
	$ay_dowr™e
Ð
ay8912
 *
ay
, 
aywr™e
 *
aw
 )

269 
Sšt32
 
i
;

271  
aw
->
»g
 )

273 
AY_CHA_PER_L
:

274 
AY_CHA_PER_H
:

275 
ay
->
»gs
[
aw
->
»g
] =‡w->
v®
;

276 
ay
->
tÚ•”
[0] = ((×y->
»gs
[
AY_CHA_PER_H
]&0xf)<<8)|ay->»gs[
AY_CHA_PER_L
]è* 
TONETIME
;

279 
AY_CHB_PER_L
:

280 
AY_CHB_PER_H
:

281 
ay
->
»gs
[
aw
->
»g
] =‡w->
v®
;

282 
ay
->
tÚ•”
[1] = ((×y->
»gs
[
AY_CHB_PER_H
]&0xf)<<8)|ay->»gs[
AY_CHB_PER_L
]è* 
TONETIME
;

285 
AY_CHC_PER_L
:

286 
AY_CHC_PER_H
:

287 
ay
->
»gs
[
aw
->
»g
] =‡w->
v®
;

288 
ay
->
tÚ•”
[2] = ((×y->
»gs
[
AY_CHC_PER_H
]&0xf)<<8)|ay->»gs[
AY_CHC_PER_L
]è* 
TONETIME
;

291 
AY_STATUS
:

292 
ay
->
»gs
[
aw
->
»g
] =‡w->
v®
;

293 
ay
->
tÚeb™
[0] = (
aw
->
v®
&0x01)?1:0;

294 
ay
->
tÚeb™
[1] = (
aw
->
v®
&0x02)?1:0;

295 
ay
->
tÚeb™
[2] = (
aw
->
v®
&0x04)?1:0;

296 
ay
->
noi£b™
[0] = (
aw
->
v®
&0x08)?1:0;

297 
ay
->
noi£b™
[1] = (
aw
->
v®
&0x10)?1:0;

298 
ay
->
noi£b™
[2] = (
aw
->
v®
&0x20)?1:0;

299 
ay
->
Ãwout
 = 7;

302 
AY_NOISE_PER
:

303 
ay
->
»gs
[
aw
->
»g
] =‡w->
v®
;

304 
ay
->
noi£³r
 = (ay->
»gs
[
AY_NOISE_PER
]&0x1fè* 
NOISETIME
;

307 
AY_CHA_AMP
:

308 
AY_CHB_AMP
:

309 
AY_CHC_AMP
:

310 
ay
->
»gs
[
aw
->
»g
] =‡w->
v®
;

311 
i
 = 
aw
->
»g
-
AY_CHA_AMP
;

312 if(
aw
->
v®
&0x10)

313 
ay
->
vÞ
[
i
] = 
vÞb
[ay->
’vb
[ay->
’vpos
]];

315 
ay
->
vÞ
[
i
] = 
vÞb
[
aw
->
v®
&0xf];

316 
ay
->
Ãwout
 |ð(1<<
i
);

319 
AY_ENV_PER_L
:

320 
AY_ENV_PER_H
:

321 
ay
->
»gs
[
aw
->
»g
] =‡w->
v®
;

322 
ay
->
’v³r
 = (×y->
»gs
[
AY_ENV_PER_H
]<<8)|ay->»gs[
AY_ENV_PER_L
])*
ENVTIME
;

325 
AY_ENV_CYCLE
:

326 ifÐ
aw
->
v®
 != 0xff )

328 
ay
->
»gs
[
aw
->
»g
] =‡w->
v®
;

329 
ay
->
’vb
 = 
esh­es
[
aw
->
v®
&0xf];

330 
ay
->
’vpos
 = 0;

331  
i
=0; i<3; i++ )

333 ifÐ
ay
->
»gs
[
AY_CHA_AMP
+
i
]&0x10 )

335 
ay
->
vÞ
[
i
] = 
vÞb
[ay->
’vb
[ay->
’vpos
]];

336 
ay
->
Ãwout
 |ð(1<<
i
);

342 
	}
}

344 
	$ay_æushlog
Ð
ay8912
 *
ay
 )

346 
i
;

348 
i
=0; i<
ay
->
logged
; i++)

349 
	`ay_dowr™e
Ð
ay
, &ay->
wr™–og
[
i
] );

350 
ay
->
logged
 = 0;

351 
	}
}

357 
	$ay_ÿÎback
Ð*
dummy
, 
Sšt8
 *
¡»am
, 
Ëngth
 )

359 
Ušt16
 *
out
;

360 
Sšt16
 
fout
;

361 
Sšt32
 
i
, 
j
, 
logc
, 
Žogc
;

362 
ay8912
 *
ay
 = (ay8912 *)
dummy
;

363 
Sšt32
 
dÿdju¡ave
, 
dÿdju¡max
;

364 
SDL_boÞ
 
³noi£
;

365 
aùu®_Ëngth
;

367 
logc
 = 0;

368 
Žogc
 = 0;

369 
dÿdju¡ave
 = 0;

370 
dÿdju¡max
 = 
soundsž’û
;

372 
³noi£
 = 
ay
->
Üic
->³noi£ && ((!ay->Üic->
³turbo
)||×y->Üic->
¿w³
));

373 ifÐ!
³noi£
 ) 
ay
->
³out
 = 0;

375 
out
 = (
Ušt16
 *)
¡»am
;

376 
cvt
.
buf
 = (
Ušt8
 *)
¡»am
;

378 
aùu®_Ëngth
 = 
Ëngth
/(2*(
Ušt16
));

379 
aùu®_Ëngth
 = (aùu®_Ëngth < 
AUDIO_BUFLEN
)?‡ctual_length : AUDIO_BUFLEN;

380 
aùu®_Ëngth
 = (aùu®_Ëngth < 
obšed
.
§m¶es
)?‡ctual_length : obtained.samples;

382  
i
=0,
j
=0; i<
aùu®_Ëngth
; i++ )

384 
ay
->
ccyc
 =‡y->
ccyþe
>>
FPBITS
;

386  ( 
logc
 < 
ay
->
logged
 ) && (‡y->
ccyc
 >ðay->
wr™–og
[logc].
cyþe
 ) )

387 
	`ay_dowr™e
Ð
ay
, &ay->
wr™–og
[
logc
++] );

389 ifÐ
³noi£
 )

391  ( 
Žogc
 < 
ay
->
Žogged
 ) && (‡y->
ccyc
 >ðay->
³log
[Žogc].
cyþe
 ) )

392 
ay
->
³out
 =‡y->
³log
[
Žogc
++].
v®
 * 8192;

395 ifÐ
ay
->
ccyc
 >‡y->
Ï¡cyc
 )

397 
	`ay_audiÙicktock
Ð
ay
,‡y->
ccyc
-ay->
Ï¡cyc
 );

398 
ay
->
Ï¡cyc
 =‡y->
ccyc
;

401 
fout
 = 
ay
->
ouut
 +‡y->
³out
;

402 
out
[
j
++] = 
fout
;

403 
out
[
j
++] = 
fout
;

404 ifÐ
vidÿp
 ) 
audioÿpbuf
[
i
] = 
fout
;

406 ifÐ
fout
 > 
dÿdju¡max
 ) dcadjustmax = fout;

407 
dÿdju¡ave
 +ð
fout
;

409 
ay
->
ccyþe
 +ð
cyþe¥”§m¶e
;

412 
dÿdju¡ave
 /ð(
Ëngth
/4);

414 ifÐ(
dÿdju¡max
-
dÿdju¡ave
) > 32767 )

415 
dÿdju¡ave
 = -(32767-
dÿdju¡max
);

417 ifÐ
dÿdju¡ave
 )

419  
i
=0, 
j
=0; i<
aùu®_Ëngth
; i++ )

421 
out
[
j
++] -ð
dÿdju¡ave
;

422 
out
[
j
++] -ð
dÿdju¡ave
;

423 ifÐ
vidÿp
 ) 
audioÿpbuf
[
i
] -ð
dÿdju¡ave
;

427 ifÐ
vidÿp
 )

429 #ià
SDL_BYTEORDER
 =ð
SDL_BIG_ENDIAN


430  
i
=0; i<(
Ëngth
/4); i++ )

431 
audioÿpbuf
[
i
] = 
	`SDL_Sw­16
(‡udiocapbuf[i] );

433 
	`avi_addaudio
Ð&
vidÿp
, 
audioÿpbuf
, 
Ëngth
/2 );

436 ià(
ay
->
logged
 > 
logc
)

438 
	`memmove
(&
ay
->
wr™–og
[0], &ay->wr™–og[
logc
], (ay->
logged
-logc) * (ay->writelog[0]));

439 
ay
->
logged
 -ð
logc
;

440 
i
=0; i<
ay
->
logged
; i++)

441 
ay
->
wr™–og
[
i
].
cyþe
 -ðay->
Ï¡cyc
;

444 ià(
ay
->
logged
 > 150)

445 
	`ay_æushlog
Ð
ay
 );

449 
ay
->
logged
 = 0;

452 ifÐ
³noi£
 )

454  
Žogc
 < 
ay
->
Žogged
 )

455 
ay
->
³out
 =‡y->
³log
[
Žogc
++].
v®
 * 8192;

458 
	`SDL_CÚv”tAudio
(&
cvt
);

460 
ay
->
ccyþe
 -ð×y->
Ï¡cyc
<<
FPBITS
);

461 
ay
->
Ï¡cyc
 = 0;

462 
ay
->
Ãwlogcyþe
 =‡y->
ccyþe
>>
FPBITS
;

463 
ay
->
do_logcyþe_»£t
 = 
SDL_TRUE
;

465 
ay
->
Žogged
 = 0;

466 
	}
}

472 
	$ay_ticktock
Ð
ay8912
 *
ay
, 
cyþes
 )

475 ifÐÐ
keyqueue
 ) && ( 
keysqueued
 ) && (!
ay
->
Üic
->
ýu
.
œq
) )

477 ifÐ
kqoffs
 >ð
keysqueued
 )

479 
	`ä“
(
keyqueue
);

480 
keyqueue
 = 
NULL
;

481 
keysqueued
 = 0;

482 
kqoffs
 = 0;

484  
ay
->
Üic
->
ty³
 )

486 
MACH_ATMOS
:

487 
MACH_PRAVETZ
:

488 ifÐÐ
ay
->
Üic
->
ýu
.
pc
 =ð0xeb78 ) && (‡y->Üic->
romÚ
 ) )

490 
ay
->
Üic
->
ýu
.
a
 = 
keyqueue
[
kqoffs
++];

491 
ay
->
Üic
->
ýu
.
	`wr™e
( &ay->oric->cpu, 0x2df, 0 );

492 
ay
->
Üic
->
ýu
.
f_n
 = 1;

493 
ay
->
Üic
->
ýu
.
ÿlýc
 = 0xeb88;

494 
ay
->
Üic
->
ýu
.
ÿlcÝ
 =‡y->Üic->ýu.
	`»ad
Ð&ay->Üic->ýu,‡y->Üic->ýu.
ÿlýc
 );

498 
MACH_ORIC1
:

499 
MACH_ORIC1_16K
:

500 ifÐÐ
ay
->
Üic
->
ýu
.
pc
 =ð0xe905 ) && (‡y->Üic->
romÚ
 ) )

502 
ay
->
Üic
->
ýu
.
a
 = 
keyqueue
[
kqoffs
++];

503 
ay
->
Üic
->
ýu
.
	`wr™e
( &ay->oric->cpu, 0x2df, 0 );

504 
ay
->
Üic
->
ýu
.
f_n
 = 1;

505 
ay
->
Üic
->
ýu
.
ÿlýc
 = 0xe915;

506 
ay
->
Üic
->
ýu
.
ÿlcÝ
 =‡y->Üic->ýu.
	`»ad
Ð&ay->Üic->ýu,‡y->Üic->ýu.
ÿlýc
 );

514 ifÐ
ay
->
Üic
->
auto_jasmš_»£t
 )

516 ià(
ay
->
Üic
->
driv‘y³
 =ð
DRV_JASMIN
)

518  
ay
->
Üic
->
ty³
 )

520 
MACH_ATMOS
:

521 
MACH_PRAVETZ
:

522 ifÐÐ
ay
->
Üic
->
ýu
.
pc
 =ð0xeb78 ) && (‡y->Üic->
romÚ
 ) )

524 
ay
->
Üic
->
ýu
.
	`wr™e
( &ay->oric->cpu, 0x3fb, 1 );

525 
	`£ŒomÚ
Ð
ay
->
Üic
 );

526 
	`m6502_»£t
Ð&
ay
->
Üic
->
ýu
 );

527 
	`m6502_£t_icyþes
Ð&
ay
->
Üic
->
ýu
, 
SDL_FALSE
, 
NULL
 );

528 
	`vŸ_š™
Ð&
ay
->
Üic
->
vŸ
,‡y->Üic, 
VIA_MAIN
 );

529 
ay
->
Üic
->
auto_jasmš_»£t
 = 
SDL_FALSE
;

533 
MACH_ORIC1
:

534 
MACH_ORIC1_16K
:

535 ifÐÐ
ay
->
Üic
->
ýu
.
pc
 =ð0xe905 ) && (‡y->Üic->
romÚ
 ) )

537 
ay
->
Üic
->
ýu
.
	`wr™e
( &ay->oric->cpu, 0x3fb, 1 );

538 
	`£ŒomÚ
Ð
ay
->
Üic
 );

539 
	`m6502_»£t
Ð&
ay
->
Üic
->
ýu
 );

540 
	`m6502_£t_icyþes
Ð&
ay
->
Üic
->
ýu
, 
SDL_FALSE
, 
NULL
 );

541 
	`vŸ_š™
Ð&
ay
->
Üic
->
vŸ
,‡y->Üic, 
VIA_MAIN
 );

542 
ay
->
Üic
->
auto_jasmš_»£t
 = 
SDL_FALSE
;

549 
ay
->
Üic
->
auto_jasmš_»£t
 = 
SDL_FALSE
;

553 ifÐ
ay
->
keyb™d–ay
 > 0 )

555 ifÐ
cyþes
 >ð
ay
->
keyb™d–ay
 )

557 
ay
->
keyb™d–ay
 = 0;

558 
	`ay_upd©e_keyb™s
Ð
ay
 );

560 
ay
->
keyb™d–ay
 -ð
cyþes
;

564 ifÐ
ay
->
do_logcyþe_»£t
 )

566 
ay
->
logcyþe
 =‡y->
Ãwlogcyþe
;

567 
ay
->
do_logcyþe_»£t
 = 
SDL_FALSE
;

569 
ay
->
logcyþe
 +ð
cyþes
;

570 
	}
}

572 
	$ay_lockaudio
Ð
ay8912
 *
ay
 )

574 ifÐ
ay
->
audiÞocked
 ) ;

575 ifÐÐ
ay
->
Üic
->
emu_mode
 !ð
EM_RUNNING
 ) || ( !
soundÚ
 ) || ( 
w¬p¥“d
 ) ) ;

576 
	`SDL_LockAudio
();

577 
ay
->
audiÞocked
 = 
SDL_TRUE
;

578 
	}
}

580 
	$ay_uÆockaudio
Ð
ay8912
 *
ay
 )

582 ifÐ!
ay
->
audiÞocked
 ) ;

583 
	`SDL_UÆockAudio
();

584 
ay
->
audiÞocked
 = 
SDL_FALSE
;

585 
	}
}

591 
SDL_boÞ
 
	$ay_š™
Ð
ay8912
 *
ay
, 
machše
 *
Üic
 )

593 
i
;

595  
Üic
->
keym­
 )

597 
KMAP_AZERTY
: 
keyb
 = 
azkb
; ;

598 
KMAP_QWERTZ
: 
keyb
 = 
qzkb
; ;

599 : 
keyb
 = 
qwkb
; ;

603  
i
=0; i<8; i++ )

604 
ay
->
key¡©es
[
i
] = 
SDL_FALSE
;

607  
i
=0; i<
NUM_AY_REGS
; i++ )

608 
ay
->
»gs
[
i
] = 0;

611  
i
=0; i<3; i++ )

613 
ay
->
ù
[
i
] = 0;

614 
ay
->
out
[
i
] = 0;

615 
ay
->
sign
[
i
] = 0;

616 
ay
->
tÚeb™
[
i
] = 1;

617 
ay
->
noi£b™
[
i
] = 1;

618 
ay
->
vÞ
[
i
] = 0;

620 
ay
->
Ãwout
 = 7;

621 
ay
->
Ãwnoi£
 = 
SDL_TRUE
;

622 
ay
->
ùn
 = 0;

623 
ay
->
ùe
 = 0;

625 
ay
->
’vb
 = 
esh­e0
;

626 
ay
->
’vpos
 = 0;

628 
ay
->
bmode
 = 0;

629 
ay
->
üeg
 = 0;

630 
ay
->
Üic
 = oric;

631 
ay
->
soundÚ
 = 
soundavažabË
 && soundÚ && (!
w¬p¥“d
);

632 
ay
->
cu¼noi£
 = 0;

633 
ay
->
ºd¿ck
 = 1;

634 
ay
->
logged
 = 0;

635 
ay
->
logcyþe
 = 0;

636 
ay
->
do_logcyþe_»£t
 = 
SDL_FALSE
;

637 
ay
->
ouut
 = 
soundsž’û
;

638 
ay
->
Ï¡cyc
 = 0;

639 
ay
->
ccyc
 = 0;

640 
ay
->
ccyþe
 = 0;

641 
ay
->
Žogged
 = 0;

642 
ay
->
³out
 = 0;

643 
ay
->
keyb™d–ay
 = 0;

644 
ay
->
audiÞocked
 = 
SDL_FALSE
;

645 ifÐ
soundavažabË
 )

646 
	`SDL_Pau£Audio
( 0 );

649 
	`SDL_BuždAudioCVT
(&
cvt
, 
AUDIO_S16SYS
, 2, 
AUDIO_FREQ
, 
obšed
.
fÜm©
, obšed.
chªÃls
, obšed.
äeq
);

650 
cvt
.
Ën
 = 
obšed
.
§m¶es
 * (
Sšt16
è* obšed.
chªÃls
;

653  
SDL_TRUE
;

654 
	}
}

659 
	$ay_upd©e_keyb™s
Ð
ay8912
 *
ay
 )

661 
ay
->
cu¼keyoffs
 =‡y->
Üic
->
vŸ
.
	`»ad_pÜt_b
( &ay->oric->via ) & 0x7;

663 ifÐ(
ay
->
”egs
[
AY_STATUS
]&0x40) == 0 )

665 
ay
->
Üic
->
vŸ
.
	`wr™e_pÜt_b
( &ay->oric->via, 0x08, 0x00 );

669 ifÐ
ay
->
key¡©es
[ay->
cu¼keyoffs
] & (ay->
”egs
[
AY_PORT_A
]^0xff) )

670 
ay
->
Üic
->
vŸ
.
	`wr™e_pÜt_b
( &ay->oric->via, 0x08, 0x08 );

672 
ay
->
Üic
->
vŸ
.
	`wr™e_pÜt_b
( &ay->oric->via, 0x08, 0x00 );

673 
	}
}

678 
	$ay_key´ess
Ð
ay8912
 *
ay
, 
SDL_COMPAT_KEY
 
key
, 
SDL_boÞ
 
down
 )

680 
i
;

683 ifÐ
key
 == 0 ) ;

686  
i
=0; i<64; i++ )

687 ifÐ
keyb
[
i
] =ð
key
 ) ;

690 ifÐ
i
 == 64 ) ;

693 ifÐ
down
 )

694 
ay
->
key¡©es
[
i
>>3] |= (1<<(i&7));

696 
ay
->
key¡©es
[
i
>>3] &= ~(1<<(i&7));

699 ifÐ
ay
->
cu¼keyoffs
 =ð(
i
>>3) )

701 ifÐ
ay
->
key¡©es
[ay->
cu¼keyoffs
] & (ay->
”egs
[
AY_PORT_A
]^0xff) )

702 
ay
->
Üic
->
vŸ
.
	`wr™e_pÜt_b
( &ay->oric->via, 0x08, 0x08 );

704 
ay
->
Üic
->
vŸ
.
	`wr™e_pÜt_b
( &ay->oric->via, 0x08, 0x00 );

706 
	}
}

711 
	$ay_mode£t
Ð
ay8912
 *
ay
 )

713 
v
, 
Ï¡s6
=0;

715 ifÐ(
ay
->
bmode
 !ð
AYBMF_BC1
è&& (ay->
Üic
->
pÜ_ay
 != 0xff) )

717 
ay
->
Üic
->
pÜ_ay
 = 0xff;

718 ifÐ
ay
->
Üic
->
pÜ_is_ay
 )

719 
ay
->
Üic
->
vŸ
.
	`wr™e_pÜt_a
( &ay->oric->via, 0xff, 0xff );

722  
ay
->
bmode
 )

724 
AYBMF_BC1
:

725 
ay
->
Üic
->
pÜ_ay
 = (ay->
üeg
>=
NUM_AY_REGS
è? 0 :‡y->
”egs
[ay->creg];

726 
ay
->
Üic
->
vŸ
.
	`wr™e_pÜt_a
Ð&ay->Üic->vŸ, 0xff,‡y->Üic->
pÜ_ay
 );

727 
ay
->
Üic
->
pÜ_is_ay
 = 
SDL_TRUE
;

730 
AYBMF_BDIR
:

731 ifÐ
ay
->
üeg
 >ð
NUM_AY_REGS
 ) ;

732 
v
 = 
ay
->
Üic
->
vŸ
.
	`»ad_pÜt_a
( &ay->oric->via );

734 ifÐ
ay
->
üeg
 =ð
AY_STATUS
 )

735 
Ï¡s6
 = 
ay
->
”egs
[
AY_STATUS
] & 0x40;

737 ifÐÐ
ay
->
üeg
 !ð
AY_ENV_CYCLE
 ) || ( 
v
 != 0xff ) )

738 
ay
->
”egs
[ay->
üeg
] = 
v
;

740  
ay
->
üeg
 )

742 
AY_STATUS
:

743 ifÐ(
ay
->
”egs
[
AY_STATUS
]&0x40è!ð
Ï¡s6
 )

745 
ay
->
keyb™d–ay
 = 3;

747 
AY_CHA_PER_L
:

748 
AY_CHA_PER_H
:

749 
AY_CHB_PER_L
:

750 
AY_CHB_PER_H
:

751 
AY_CHC_PER_L
:

752 
AY_CHC_PER_H
:

753 
AY_NOISE_PER
:

754 
AY_CHA_AMP
:

755 
AY_CHB_AMP
:

756 
AY_CHC_AMP
:

757 
AY_ENV_PER_L
:

758 
AY_ENV_PER_H
:

759 
AY_ENV_CYCLE
:

760 ifÐÐ!
soundÚ
 ) || ( 
w¬p¥“d
 ) )

762 
aywr™e
 
wr™’ow
;

764 
	`ay_æushlog
Ð
ay
 );

765 
wr™’ow
.
cyþe
 = 0;

766 
wr™’ow
.
»g
 = 
ay
->
üeg
;

767 
wr™’ow
.
v®
 = 
v
;

768 
	`ay_dowr™e
Ð
ay
, &
wr™’ow
 );

772 
	`ay_lockaudio
Ð
ay
 );

774 ifÐ
ay
->
do_logcyþe_»£t
 )

776 
ay
->
logcyþe
 =‡y->
Ãwlogcyþe
;

777 
ay
->
do_logcyþe_»£t
 = 
SDL_FALSE
;

780 ifÐ
ay
->
logged
 >ð
WRITELOG_SIZE
 )

781 
	`ay_æushlog
Ð
ay
 );

783 
ay
->
wr™–og
[ay->
logged
 ].
cyþe
 =‡y->
logcyþe
;

784 
ay
->
wr™–og
[ay->
logged
 ].
»g
 =‡y->
üeg
;

785 
ay
->
wr™–og
[ay->
logged
++].
v®
 = 
v
;

788 
AY_PORT_A
:

789 
ay
->
keyb™d–ay
 = 3;

794 
AYBMF_BDIR
|
AYBMF_BC1
:

795 
ay
->
üeg
 =‡y->
Üic
->
vŸ
.
	`»ad_pÜt_a
( &ay->oric->via );

798 
	}
}

800 
	$ay_£t_bcmode
Ð
ay8912
 *
ay
, 
bc1
, 
bdœ
 )

802 
ay
->
bmode
 = (
bc1
?
AYBMF_BC1
:0)|(
bdœ
?
AYBMF_BDIR
:0);

803 
	`ay_mode£t
Ð
ay
 );

804 
	}
}

806 
	$ay_£t_bc1
Ð
ay8912
 *
ay
, 
¡©e
 )

808 ifÐ
¡©e
 )

809 
ay
->
bmode
 |ð
AYBMF_BC1
;

811 
ay
->
bmode
 &ð~
AYBMF_BC1
;

812 
	`ay_mode£t
Ð
ay
 );

813 
	}
}

815 
	$ay_£t_bdœ
Ð
ay8912
 *
ay
, 
¡©e
 )

817 ifÐ
¡©e
 )

818 
ay
->
bmode
 |ð
AYBMF_BDIR
;

820 
ay
->
bmode
 &ð~
AYBMF_BDIR
;

821 
	`ay_mode£t
Ð
ay
 );

822 
	}
}

	@8912.h

24 
	#FPBITS
 10

	)

27 #iâdeà
AUDIO_BUFLEN


28 
	#AUDIO_BUFLEN
 2048

	)

31 
	#WRITELOG_SIZE
 (
AUDIO_BUFLEN
*12)

	)

32 
	#TAPELOG_SIZE
 (
AUDIO_BUFLEN
)

	)

34 
	#CYCLESPERSECOND
 (312*64*50)

	)

39 
	#AYBMB_BC1
 0

	)

40 
	#AYBMF_BC1
 (1<<
AYBMB_BC1
)

	)

41 
	#AYBMB_BDIR
 1

	)

42 
	#AYBMF_BDIR
 (1<<
AYBMB_BDIR
)

	)

47 
	mAY_CHA_PER_L
 = 0,

48 
	mAY_CHA_PER_H
,

49 
	mAY_CHB_PER_L
,

50 
	mAY_CHB_PER_H
,

51 
	mAY_CHC_PER_L
,

52 
	mAY_CHC_PER_H
,

53 
	mAY_NOISE_PER
,

54 
	mAY_STATUS
,

55 
	mAY_CHA_AMP
,

56 
	mAY_CHB_AMP
,

57 
	mAY_CHC_AMP
,

58 
	mAY_ENV_PER_L
,

59 
	mAY_ENV_PER_H
,

60 
	mAY_ENV_CYCLE
,

61 
	mAY_PORT_A
,

62 
	mNUM_AY_REGS


65 
	saywr™e


67 
Ušt32
 
	mcyþe
;

68 
Ušt8
 
	m»g
;

69 
Ušt8
 
	mv®
;

72 
	sŠchªge


74 
Ušt32
 
	mcyþe
;

75 
Ušt8
 
	mv®
;

78 
	say8912


80 
Ušt8
 
	mbmode
, 
	müeg
;

81 
Ušt8
 
	m»gs
[
NUM_AY_REGS
], 
	m”egs
[NUM_AY_REGS];

82 
SDL_boÞ
 
	mkey¡©es
[8], 
	mÃwnoi£
;

83 
SDL_boÞ
 
	msoundÚ
;

84 
SDL_boÞ
 
	m³noi£Ú
;

85 
Ušt32
 
	mtÚ•”
[3], 
	mnoi£³r
, 
	m’v³r
;

86 
Ušt16
 
	mtÚeb™
[3], 
	mnoi£b™
[3], 
	mvÞ
[3], 
	mÃwout
;

87 
Sšt32
 
	mù
[3], 
	mùn
, 
	mùe
;

88 
Ušt32
 
	mtÚ•os
[3], 
	mtÚe¡•
[3];

89 
Sšt32
 
	msign
[3], 
	mout
[3], 
	m’vpos
;

90 *
	m’vb
;

91 
machše
 *
	mÜic
;

92 
Ušt32
 
	mcu¼noi£
, 
	mºd¿ck
;

93 
Sšt16
 
	mouut
;

94 
Sšt16
 
	m³out
;

95 
Ušt32
 
	mccyþe
, 
	mÏ¡cyc
, 
	mccyc
;

96 
Ušt32
 
	mkeyb™d–ay
, 
	mcu¼keyoffs
;

98 
SDL_boÞ
 
	maudiÞocked
;

99 
SDL_boÞ
 
	mdo_logcyþe_»£t
;

100 
Sšt32
 
	mlogged
, 
	mŽogged
;

101 
Ušt32
 
	mlogcyþe
, 
	mÃwlogcyþe
;

102 
aywr™e
 
	mwr™–og
[
WRITELOG_SIZE
];

103 
Šchªge
 
	m³log
[
TAPELOG_SIZE
];

106 
queuekeys
Ð*
¡r
 );

108 
SDL_boÞ
 
ay_š™
Ð
ay8912
 *
ay
, 
machše
 *
Üic
 );

109 
ay_ÿÎback
Ð*
dummy
, 
Sšt8
 *
¡»am
, 
Ëngth
 );

110 
ay_ticktock
Ð
ay8912
 *
ay
, 
cyþes
 );

111 
ay_upd©e_keyb™s
Ð
ay8912
 *
ay
 );

112 
ay_key´ess
Ð
ay8912
 *
ay
, 
SDL_COMPAT_KEY
 
key
, 
SDL_boÞ
 
down
 );

114 
ay_£t_bc1
Ð
ay8912
 *
ay
, 
¡©e
 );

115 
ay_£t_bdœ
Ð
ay8912
 *
ay
, 
¡©e
 );

116 
ay_£t_bcmode
Ð
ay8912
 *
ay
, 
bc1
, 
bdœ
 );

117 
ay_mode£t
Ð
ay8912
 *
ay
 );

119 
ay_lockaudio
Ð
ay8912
 *
ay
 );

120 
ay_uÆockaudio
Ð
ay8912
 *
ay
 );

121 
ay_æushlog
Ð
ay8912
 *
ay
 );

	@XCode/Oricutron/Oricutron/SDLMain.h

8 #iâdeà
_SDLMaš_h_


9 
	#_SDLMaš_h_


	)

11 #impÜˆ<
Cocß
/Cocß.
h
>

13 @
š‹rçû
 
	gSDLMaš
 : 
NSObjeù


14 @
’d


	@avi.c

23 
	~<¡dio.h
>

24 
	~<¡dlib.h
>

25 
	~<m©h.h
>

26 
	~<¡ršg.h
>

28 
	~"sy¡em.h
"

29 
	~"avi.h
"

32 
SDL_AudioS³c
 
obšed
;

35 
SDL_boÞ
 
	$wr™e32l
Ð
SDL_boÞ
 
¡žlok
, 
avi_hªdË
 *
ah
, 
Ušt32
 
v®
, Ušt32 *
»m
 )

37 ifÐ!
¡žlok
 )  
SDL_FALSE
;

38 ifÐ
»m
 ) (*»mèð
ah
->
csize
;

39 
ah
->
csize
 += 4;

40 
	`_MAKE_LE32
(
v®
);

41  (
	`fwr™e
Ð&
v®
, 4, 1, 
ah
->
f
 ) == 1);

42 
	}
}

45 
SDL_boÞ
 
	$wr™e16l
Ð
SDL_boÞ
 
¡žlok
, 
avi_hªdË
 *
ah
, 
Ušt16
 
v®
, 
Ušt32
 *
»m
 )

47 ifÐ!
¡žlok
 )  
SDL_FALSE
;

48 ifÐ
»m
 ) (*»mèð
ah
->
csize
;

49 
ah
->
csize
 += 2;

50 
	`_MAKE_LE16
(
v®
);

51  (
	`fwr™e
Ð&
v®
, 2, 1, 
ah
->
f
 ) == 1);

52 
	}
}

56 
SDL_boÞ
 
	$wr™e¡r
Ð
SDL_boÞ
 
¡žlok
, 
avi_hªdË
 *
ah
, *
¡r
, 
Ušt32
 *
»m
 )

58 
Sšt32
 
i
 = ()
	`¡¾’
Ð
¡r
 );

59 ifÐ!
¡žlok
 )  
SDL_FALSE
;

60 ifÐ
»m
 ) (*»mèð
ah
->
csize
;

61 
ah
->
csize
 +ð
i
;

62  (
	`fwr™e
Ð
¡r
, 
i
, 1, 
ah
->
f
 ) == 1);

63 
	}
}

66 
SDL_boÞ
 
	$£ek_wr™e32l
Ð
SDL_boÞ
 
¡žlok
, 
avi_hªdË
 *
ah
, 
Ušt32
 
offs
, Ušt32 
v®
 )

68 ifÐ!
¡žlok
 )  
SDL_FALSE
;

69 ifÐ
offs
 =ð0 )  
SDL_TRUE
;

70 
	`f£ek
Ð
ah
->
f
, 
offs
, 
SEEK_SET
 );

71 
	`_MAKE_LE32
(
v®
);

72  (
	`fwr™e
Ð&
v®
, 4, 1, 
ah
->
f
 ) == 1);

73 
	}
}

76 
SDL_boÞ
 
	$wr™eblk
Ð
SDL_boÞ
 
¡žlok
, 
avi_hªdË
 *
ah
, 
Ušt8
 *
blk
, 
Ušt32
 
blkËn
 )

78 ifÐ!
¡žlok
 )  
SDL_FALSE
;

79 
ah
->
csize
 +ð
blkËn
;

80  (
	`fwr™e
Ð
blk
, 
blkËn
, 1, 
ah
->
f
 ) == 1);

81 
	}
}

84 
SDL_boÞ
 
	$wr™ebyt
Ð
SDL_boÞ
 
¡žlok
, 
avi_hªdË
 *
ah
, 
Ušt8
 
v®
 )

86 ifÐ!
¡žlok
 )  
SDL_FALSE
;

87 
ah
->
csize
 += 1;

88  (
	`fwr™e
Ð&
v®
, 1, 1, 
ah
->
f
 ) == 1);

89 
	}
}

91 
	#AVIFLAGS
 (
AVIF_ISINTERLEAVED
|
AVIF_WASCAPTUREFILE
)

	)

92 
avi_hªdË
 *
	$avi_Ý’
Ð*
fž’ame
, 
Ušt8
 *
·l
, 
SDL_boÞ
 
dosound
, 
is50hz
 )

94 
avi_hªdË
 *
ah
;

95 
SDL_boÞ
 
ok
;

96 
Sšt32
 
i
;

98 
ah
 = 
	`m®loc
ÐÐ
avi_hªdË
 ) );

99 ifÐ!
ah
 )  
NULL
;

101 
	`mem£t
Ð
ah
, 0, Ð
avi_hªdË
 ) );

103 
ah
->
f
 = 
	`fÝ’
Ð
fž’ame
, "wb" );

104 ifÐ!
ah
->
f
 )

106 
	`ä“
Ð
ah
 );

107  
NULL
;

110 
ah
->
do¢d
 = 
dosound
;

111 
ah
->
csize
 = 0;

112 
ah
->
is50hz
 = is50hz;

114 
ok
 = 
SDL_TRUE
;

115 
ok
 &ð
	`wr™e¡r
Ðok, 
ah
, "RIFF" , 
NULL
 );

116 
ok
 &ð
	`wr™e32l
Ðok, 
ah
, 0, &ah->
offs_riffsize
 );

117 
ok
 &ð
	`wr™e¡r
Ðok, 
ah
, "AVI " , 
NULL
 );

118 
ok
 &ð
	`wr™e¡r
Ðok, 
ah
, "LIST" , 
NULL
 );

119 
ok
 &ð
	`wr™e32l
Ðok, 
ah
, 0, &ah->
offs_hd¾size
 );

120 
ok
 &ð
	`wr™e¡r
Ðok, 
ah
, "hd¾" , 
NULL
 );

122 
ok
 &ð
	`wr™e¡r
Ðok, 
ah
, "avih" , 
NULL
 );

123 
ok
 &ð
	`wr™e32l
Ðok, 
ah
, 56, 
NULL
 );

124 
ok
 &ð
	`wr™e32l
Ðok, 
ah
,
is50hz
?20000:16667,&ah->
offs_u¥”äm
);

125 
ok
 &ð
	`wr™e32l
Ðok, 
ah
, 0, 
NULL
 );

126 
ok
 &ð
	`wr™e32l
Ðok, 
ah
, 0, 
NULL
 );

127 
ok
 &ð
	`wr™e32l
Ðok, 
ah
, 
AVIFLAGS
, 
NULL
 );

128 
ok
 &ð
	`wr™e32l
Ðok, 
ah
, 0, &ah->
offs_äames
 );

129 
ok
 &ð
	`wr™e32l
Ðok, 
ah
, 0, 
NULL
 );

130 
ok
 &ð
	`wr™e32l
Ðok, 
ah
,‡h->
do¢d
?2:1, 
NULL
 );

131 
ok
 &ð
	`wr™e32l
Ðok, 
ah
, 0, 
NULL
 );

132 
ok
 &ð
	`wr™e32l
Ðok, 
ah
, 240, 
NULL
 );

133 
ok
 &ð
	`wr™e32l
Ðok, 
ah
, 224, 
NULL
 );

134 
ok
 &ð
	`wr™e32l
Ðok, 
ah
, 0, 
NULL
 );

135 
ok
 &ð
	`wr™e32l
Ðok, 
ah
, 0, 
NULL
 );

136 
ok
 &ð
	`wr™e32l
Ðok, 
ah
, 0, 
NULL
 );

137 
ok
 &ð
	`wr™e32l
Ðok, 
ah
, 0, 
NULL
 );

139 
ok
 &ð
	`wr™e¡r
Ðok, 
ah
, "LIST" , 
NULL
 );

140 
ok
 &ð
	`wr™e32l
Ðok, 
ah
,4+8+56+8+40+8*4, 
NULL
 );

141 
ok
 &ð
	`wr™e¡r
Ðok, 
ah
, "¡¾" , 
NULL
 );

143 
ok
 &ð
	`wr™e¡r
Ðok, 
ah
, "¡rh" , 
NULL
 );

144 
ok
 &ð
	`wr™e32l
Ðok, 
ah
, 56, 
NULL
 );

145 
ok
 &ð
	`wr™e¡r
Ðok, 
ah
, "vids" , 
NULL
 );

146 
ok
 &ð
	`wr™e¡r
Ðok, 
ah
, "MRLE" , 
NULL
 );

147 
ok
 &ð
	`wr™e32l
Ðok, 
ah
, 0, 
NULL
 );

148 
ok
 &ð
	`wr™e32l
Ðok, 
ah
, 0, 
NULL
 );

149 
ok
 &ð
	`wr™e32l
Ðok, 
ah
, 0, 
NULL
 );

150 
ok
 &ð
	`wr™e32l
Ðok, 
ah
, 1000000, 
NULL
 );

151 
ok
 &ð
	`wr™e32l
Ðok, 
ah
,
is50hz
?50000000:60000000,&ah->
offs_äm¿‹
);

152 
ok
 &ð
	`wr™e32l
Ðok, 
ah
, 0, 
NULL
 );

153 
ok
 &ð
	`wr™e32l
Ðok, 
ah
, 0, &ah->
offs_äames2
 );

154 
ok
 &ð
	`wr™e32l
Ðok, 
ah
, 0, 
NULL
 );

155 
ok
 &ð
	`wr™e32l
Ðok, 
ah
, 10000, 
NULL
 );

156 
ok
 &ð
	`wr™e32l
Ðok, 
ah
, 0, 
NULL
 );

157 
ok
 &ð
	`wr™e32l
Ðok, 
ah
, 0, 
NULL
 );

158 
ok
 &ð
	`wr™e32l
Ðok, 
ah
, 0, 
NULL
 );

160 
ok
 &ð
	`wr™e¡r
Ðok, 
ah
, "¡rf" , 
NULL
 );

161 
ok
 &ð
	`wr™e32l
Ðok, 
ah
, 40+8*4, 
NULL
 );

162 
ok
 &ð
	`wr™e32l
Ðok, 
ah
, 40, 
NULL
 );

163 
ok
 &ð
	`wr™e32l
Ðok, 
ah
, 240, 
NULL
 );

164 
ok
 &ð
	`wr™e32l
Ðok, 
ah
, 224, 
NULL
 );

165 
ok
 &ð
	`wr™e16l
Ðok, 
ah
, 1, 
NULL
 );

166 
ok
 &ð
	`wr™e16l
Ðok, 
ah
, 8, 
NULL
 );

167 
ok
 &ð
	`wr™e32l
Ðok, 
ah
, 1, 
NULL
 );

168 
ok
 &ð
	`wr™e32l
Ðok, 
ah
, 240*244, 
NULL
 );

169 
ok
 &ð
	`wr™e32l
Ðok, 
ah
, 0, 
NULL
 );

170 
ok
 &ð
	`wr™e32l
Ðok, 
ah
, 0, 
NULL
 );

171 
ok
 &ð
	`wr™e32l
Ðok, 
ah
, 8, 
NULL
 );

172 
ok
 &ð
	`wr™e32l
Ðok, 
ah
, 8, 
NULL
 );

174  
i
=0; i<8; i++ )

176 
ok
 &ð
	`wr™ebyt
Ðok, 
ah
, 
·l
[
i
*3+2] );

177 
ok
 &ð
	`wr™ebyt
Ðok, 
ah
, 
·l
[
i
*3+1] );

178 
ok
 &ð
	`wr™ebyt
Ðok, 
ah
, 
·l
[
i
*3+0] );

179 
ok
 &ð
	`wr™ebyt
Ðok, 
ah
, 0 );

182 ifÐ
ah
->
do¢d
 )

184 
ok
 &ð
	`wr™e¡r
Ðok, 
ah
, "LIST" , 
NULL
 );

185 
ok
 &ð
	`wr™e32l
Ðok, 
ah
, 4+8+56+8+16, 
NULL
 );

186 
ok
 &ð
	`wr™e¡r
Ðok, 
ah
, "¡¾" , 
NULL
 );

188 
ok
 &ð
	`wr™e¡r
Ðok, 
ah
, "¡rh" , 
NULL
 );

189 
ok
 &ð
	`wr™e32l
Ðok, 
ah
, 56, 
NULL
 );

190 
ok
 &ð
	`wr™e¡r
Ðok, 
ah
, "auds" , 
NULL
 );

191 
ok
 &ð
	`wr™e32l
Ðok, 
ah
, 0, 
NULL
 );

192 
ok
 &ð
	`wr™e32l
Ðok, 
ah
, 0, 
NULL
 );

193 
ok
 &ð
	`wr™e32l
Ðok, 
ah
, 0, 
NULL
 );

194 
ok
 &ð
	`wr™e32l
Ðok, 
ah
, 0, 
NULL
 );

195 
ok
 &ð
	`wr™e32l
Ðok, 
ah
, 1, 
NULL
 );

196 
ok
 &ð
	`wr™e32l
Ðok, 
ah
,
obšed
.
äeq
, 
NULL
 );

197 
ok
 &ð
	`wr™e32l
Ðok, 
ah
, 0, 
NULL
 );

198 
ok
 &ð
	`wr™e32l
Ðok, 
ah
, 0, &ah->
offs_audiÞ’
 );

199 
ok
 &ð
	`wr™e32l
Ðok, 
ah
, 0, 
NULL
 );

200 
ok
 &ð
	`wr™e32l
Ðok, 
ah
, 10000, 
NULL
 );

201 
ok
 &ð
	`wr™e32l
Ðok, 
ah
, 2, 
NULL
 );

202 
ok
 &ð
	`wr™e32l
Ðok, 
ah
, 0, 
NULL
 );

203 
ok
 &ð
	`wr™e32l
Ðok, 
ah
, 0, 
NULL
 );

205 
ok
 &ð
	`wr™e¡r
Ðok, 
ah
, "¡rf" , 
NULL
 );

206 
ok
 &ð
	`wr™e32l
Ðok, 
ah
, 16, 
NULL
 );

207 
ok
 &ð
	`wr™e16l
Ðok, 
ah
, 1, 
NULL
 );

208 
ok
 &ð
	`wr™e16l
Ðok, 
ah
, 1, 
NULL
 );

209 
ok
 &ð
	`wr™e32l
Ðok, 
ah
,
obšed
.
äeq
, 
NULL
 );

210 
ok
 &ð
	`wr™e32l
Ðok, 
ah
,
obšed
.
äeq
*2, 
NULL
 );

211 
ok
 &ð
	`wr™e16l
Ðok, 
ah
, 2, 
NULL
 );

212 
ok
 &ð
	`wr™e16l
Ðok, 
ah
, 16, 
NULL
 );

215 
ah
->
hd¾size
 =‡h->
csize
 -‡h->
offs_hd¾size
 - 4;

217 
ok
 &ð
	`wr™e¡r
Ðok, 
ah
, "LIST" , 
NULL
 );

218 
ok
 &ð
	`wr™e32l
Ðok, 
ah
, 0, &ah->
offs_movisize
 );

219 
ok
 &ð
	`wr™e¡r
Ðok, 
ah
, "movi" , 
NULL
 );

221 ifÐ!
ok
 )

223 
	`ä“
Ð
ah
 );

224  
NULL
;

227 
ah
->
äames
 = 0;

228 
ah
->
äam—dju¡
 = 0;

229 
ah
->
audiÞ’
 = 0;

230 
ah
->
movisize
 = 0;

231 
ah
->
Ï¡äamev®id
 = 
SDL_FALSE
;

232 
ah
->
time_¡¬t
 = 0;

234  
ah
;

235 
	}
}

237 
Ušt32
 
	$¾e_puix–s
Ð
avi_hªdË
 *
ah
, 
Ušt8
 *
¤cd©a
, 
Ušt32
 
¾ec
, Ušt32 
¤cc
, Ušt32 
Ëngth
 )

239 
Ušt32
 
c
, 
chunk”
;

241 ifÐ
Ëngth
 =ð0 )  
¾ec
;

243  
Ëngth
 > 254 )

246 
chunk”
 = (
Ëngth
<258) ? 250 : 254;

247 
¾ec
 = 
	`¾e_puix–s
Ð
ah
, 
¤cd©a
,„Ëc, 
¤cc
, 
chunk”
 );

248 
¤cc
 +ð
chunk”
;

249 
Ëngth
 -ð
chunk”
;

253 ifÐ
Ëngth
 < 3 )

255  
Ëngth
 > 0 )

257 
ah
->
¾ed©a
[
¾ec
++] = 0x01;

258 
ah
->
¾ed©a
[
¾ec
++] = 
¤cd©a
[
¤cc
++];

259 
Ëngth
--;

261  
¾ec
;

264 
c
 = 
Ëngth
;

266 
ah
->
¾ed©a
[
¾ec
++] = 0x00;

267 
ah
->
¾ed©a
[
¾ec
++] = 
Ëngth
;

268  
c
 > 0 )

270 
ah
->
¾ed©a
[
¾ec
++] = 
¤cd©a
[
¤cc
++];

271 
c
--;

274 ifÐ
Ëngth
 & 1 )

275 
ah
->
¾ed©a
[
¾ec
++] = 0;

277  
¾ec
;

278 
	}
}

281 
	#NOABS
 0xffffffff

	)

282 
Ušt32
 
	$¾e_’code
Ð
avi_hªdË
 *
ah
, 
Ušt8
 *
¤cd©a
, 
Ušt32
 
¾ec
, Ušt32 
eÞ
 )

284 
Ušt32
 
¤cc
, 
runc
, 
ab¥os
, 
chunk”
;

285 
Ušt8
 
thiscÞ
;

287 ifÐ
eÞ
 == 0 )

289 
ah
->
¾ed©a
[
¾ec
++] = 0x00;

290 
ah
->
¾ed©a
[
¾ec
++] = 0x00;

291  
¾ec
;

294 
¤cc
 = 0;

295 
ab¥os
 = 
NOABS
;

296  
¤cc
 < 
eÞ
 )

299 
thiscÞ
 = 
¤cd©a
[
¤cc
];

302 ifÐ
¤cc
 =ð
eÞ
-1 )

305 ifÐ
ab¥os
 !ð
NOABS
 ) 
¾ec
 = 
	`¾e_puix–s
Ð
ah
, 
¤cd©a
,„Ëc,‡b¥os, 
¤cc
-abspos );

308 
ah
->
¾ed©a
[
¾ec
++] = 0x01;

309 
ah
->
¾ed©a
[
¾ec
++] = 
thiscÞ
;

311 
ah
->
¾ed©a
[
¾ec
++] = 0x00;

312 
ah
->
¾ed©a
[
¾ec
++] = 0x00;

313  
¾ec
;

316 
runc
 = 1;

317  
¤cd©a
[
¤cc
+
runc
] =ð
thiscÞ
 )

319 
runc
++;

320 ifÐ(
¤cc
+
runc
è>ð
eÞ
 ) ;

324 ifÐ
runc
 < 2 )

327 ifÐ
ab¥os
 =ð
NOABS
 )‡b¥o ð
¤cc
;

330 
¤cc
++;

335 ifÐ
ab¥os
 !ð
NOABS
 )

337 
¾ec
 = 
	`¾e_puix–s
Ð
ah
, 
¤cd©a
,„Ëc, 
ab¥os
, 
¤cc
-abspos );

338 
ab¥os
 = 
NOABS
;

342 
¤cc
 +ð
runc
;

344  
runc
 > 255 )

346 
chunk”
 = (
runc
<258) ? 250 : 255;

347 
ah
->
¾ed©a
[
¾ec
++] = 
chunk”
;

348 
ah
->
¾ed©a
[
¾ec
++] = 
thiscÞ
;

349 
runc
 -ð
chunk”
;

352 
ah
->
¾ed©a
[
¾ec
++] = 
runc
;

353 
ah
->
¾ed©a
[
¾ec
++] = 
thiscÞ
;

356 ifÐ
ab¥os
 !ð
NOABS
 ) 
¾ec
 = 
	`¾e_puix–s
Ð
ah
, 
¤cd©a
,„Ëc,‡b¥os, 
¤cc
-abspos );

357 
ah
->
¾ed©a
[
¾ec
++] = 0x00;

358 
ah
->
¾ed©a
[
¾ec
++] = 0x00;

359  
¾ec
;

360 
	}
}

362 
SDL_boÞ
 
	$avi_addäame
Ð
avi_hªdË
 **
ah
, 
Ušt8
 *
¤cd©a
 )

364 
SDL_boÞ
 
ok
;

365 
Sšt32
 
i
, 
x
, 
Ï¡lše
, 
Ï¡x
;

366 
Ušt32
 
size
;

368 
Ï¡lše
 = 0;

369 ifÐ(*
ah
)->
Ï¡äamev®id
 )

372  
i
=0; i<224; i++ )

374  
x
=0; x<240; x++ )

376 ifÐ(*
ah
)->
Ï¡äame
[
i
*240+
x
] !ð
¤cd©a
[i*240+x] )

379 ifÐ
x
<240 ) ;

381 
Ï¡lše
 = 
i
;

384 ifÐ
Ï¡lše
 == 224 )

386 
size
 = 0;

387 (*
ah
)->
¾ed©a
[
size
++] = 0x00;

388 (*
ah
)->
¾ed©a
[
size
++] = 0x01;

390  
i
=223,
size
=0; i>=
Ï¡lše
; i-- )

392 
Ï¡x
 = 240;

393 ifÐ(*
ah
)->
Ï¡äamev®id
 )

396  
x
=239; x>=0; x-- )

398 ifÐ(*
ah
)->
Ï¡äame
[
i
*240+
x
] !ð
¤cd©a
[i*240+x] )

401 
Ï¡x
 = 
x
+1;

403 
size
 = 
	`¾e_’code
Ð*
ah
, &
¤cd©a
[
i
*240], size, 
Ï¡x
 );

405 (*
ah
)->
¾ed©a
[
size
-1] = 0x01;

408 
	`memýy
Ð(*
ah
)->
Ï¡äame
, 
¤cd©a
, 240*224 );

409 (*
ah
)->
Ï¡äamev®id
 = 
SDL_TRUE
;

411 
ok
 = 
SDL_TRUE
;

412 
ok
 &ð
	`wr™e¡r
Ðok, *
ah
, "00dc", 
NULL
 );

413 
ok
 &ð
	`wr™e32l
Ðok, *
ah
, 
size
, 
NULL
 );

414 
ok
 &ð
	`wr™eblk
Ðok, *
ah
, (*ah)->
¾ed©a
, 
size
 );

416 (*
ah
)->
movisize
 +ð
size
 + 8;

417 (*
ah
)->
äames
++;

419 ifÐ!
ok
 )

421 
	`avi_þo£
Ð
ah
 );

422  
SDL_FALSE
;

425 ifÐ!(*
ah
)->
time_¡¬t
 )

427 (*
ah
)->
time_¡¬t
 = 
	`SDL_G‘Ticks
();

430  
SDL_TRUE
;

431 
	}
}

433 
SDL_boÞ
 
	$avi_addaudio
Ð
avi_hªdË
 **
ah
, 
Sšt16
 *
audiod©a
, 
Ušt32
 
audiosize
 )

435 
SDL_boÞ
 
ok
;

437 ifÐ!(*
ah
)->
do¢d
 )  
SDL_TRUE
;

439 
ok
 = 
SDL_TRUE
;

440 
ok
 &ð
	`wr™e¡r
Ðok, *
ah
, "01wb", 
NULL
 );

441 
ok
 &ð
	`wr™e32l
Ðok, *
ah
, 
audiosize
, 
NULL
 );

442 
ok
 &ð
	`wr™eblk
Ðok, *
ah
, (
Ušt8
 *)
audiod©a
, 
audiosize
 );

444 (*
ah
)->
movisize
 +ð
audiosize
+8;

445 (*
ah
)->
audiÞ’
 +ð
audiosize
;

447 ifÐ!
ok
 )

449 
	`avi_þo£
Ð
ah
 );

450  
SDL_FALSE
;

453  
SDL_TRUE
;

454 
	}
}

456 
	$avi_þo£
Ð
avi_hªdË
 **
ah
 )

458 
SDL_boÞ
 
ok
;

459 
Ušt32
 
time_’d
 = 
	`SDL_G‘Ticks
();

460 
time_ms
, 
¿‹
, 
u¥”äm
;

462 ifÐÐ!
ah
 ) || (!(*ah)) ) ;

464 ifÐ(*
ah
)->
f
 )

466 
ok
 = 
SDL_TRUE
;

467 
ok
 &ð
	`£ek_wr™e32l
Ðok, *
ah
, (*ah)->
offs_riffsize
, (*ah)->
csize
-8 );

468 
ok
 &ð
	`£ek_wr™e32l
Ðok, *
ah
, (*ah)->
offs_hd¾size
, (*ah)->
hd¾size
 );

469 
ok
 &ð
	`£ek_wr™e32l
Ðok, *
ah
, (*ah)->
offs_äames
, (*ah)->
äames
 );

470 
ok
 &ð
	`£ek_wr™e32l
Ðok, *
ah
, (*ah)->
offs_äames2
, (*ah)->
äames
 );

471 
ok
 &ð
	`£ek_wr™e32l
Ðok, *
ah
, (*ah)->
offs_movisize
, (*ah)->
movisize
 );

472 
ok
 &ð
	`£ek_wr™e32l
Ðok, *
ah
, (*ah)->
offs_audiÞ’
, (*ah)->
audiÞ’
 );

474 
time_ms
 = ()(
time_’d
 - (*
ah
)->
time_¡¬t
);

476 
¿‹
 = (()((*
ah
)->
äames
è* 1000000000.0fè/ 
time_ms
;

477 
u¥”äm
 = (
time_ms
*1000.0fè/ (()(*
ah
)->
äames
);

479 
ok
 &ð
	`£ek_wr™e32l
Ðok, *
ah
, (*ah)->
offs_äm¿‹
, (
Ušt32
)(
¿‹
 + .5) );

480 
ok
 &ð
	`£ek_wr™e32l
Ðok, *
ah
, (*ah)->
offs_u¥”äm
, (
Ušt32
)(
u¥”äm
 + .5) );

482 
	`fþo£
Ð(*
ah
)->
f
 );

484 
	`ä“
Ð(*
ah
) );

485 *
ah
 = 
NULL
;

486 
	}
}

	@avi.h

21 
	#AVIF_HASINDEX
 0x00000010

	)

22 
	#AVIF_MUSTUSEINDEX
 0x00000020

	)

23 
	#AVIF_ISINTERLEAVED
 0x00000100

	)

24 
	#AVIF_TRUSTCKTYPE
 0x00000800

	)

25 
	#AVIF_WASCAPTUREFILE
 0x00010000

	)

26 
	#AVIF_COPYRIGHTED
 0x00020000

	)

28 
	savi_hªdË


30 
FILE
 *
	mf
;

31 
Ušt32
 
	mcsize
;

32 
Ušt32
 
	mäames
, 
	mäam—dju¡
;

33 
Ušt32
 
	mhd¾size
;

34 
Ušt32
 
	mmovisize
;

35 
Ušt32
 
	maudiÞ’
;

36 
Ušt32
 
	moffs_riffsize
;

37 
Ušt32
 
	moffs_hd¾size
;

38 
Ušt32
 
	moffs_äames
;

39 
Ušt32
 
	moffs_äames2
;

40 
Ušt32
 
	moffs_movisize
;

41 
Ušt32
 
	moffs_audiÞ’
;

42 
Ušt32
 
	moffs_u¥”äm
;

43 
Ušt32
 
	moffs_äm¿‹
;

44 
Ušt32
 
	mtime_¡¬t
;

46 
SDL_boÞ
 
	mdo¢d
;

47 
SDL_boÞ
 
	mÏ¡äamev®id
;

48 
Ušt8
 
	m¾ed©a
[240*224*4];

49 
Ušt8
 
	mÏ¡äame
[240*224];

53 
	mis50hz
;

56 
avi_hªdË
 *
avi_Ý’
Ð*
fž’ame
, 
Ušt8
 *
·l
, 
SDL_boÞ
 
dosound
, 
is50hz
 );

57 
SDL_boÞ
 
avi_addäame
Ð
avi_hªdË
 **
ah
, 
Ušt8
 *
¤cd©a
 );

58 
SDL_boÞ
 
avi_addaudio
Ð
avi_hªdË
 **
ah
, 
Sšt16
 *
audiod©a
, 
Ušt32
 
audiosize
 );

59 
avi_þo£
Ð
avi_hªdË
 **
ah
 );

	@disk.c

31 
	#MICRODISC_FUDGE


	)

33 
	~<¡dio.h
>

34 
	~<¡dlib.h
>

35 
	~<¡ršg.h
>

37 
	~"sy¡em.h
"

38 
	~"6502.h
"

39 
	~"vŸ.h
"

40 
	~"8912.h
"

41 
	~"gui.h
"

42 
	~"disk.h
"

43 
	~"disk_´av‘z.h
"

44 
	~"mÚ™Ü.h
"

45 
	~"6551.h
"

46 
	~"machše.h
"

47 
	~"msgbox.h
"

48 
	~"fž”eq.h
"

50 
diskfže
[], 
disk·th
[], 
fž‘mp
[];

51 
‹Ëdiskfže
[], 
‹Ëdisk·th
[];

52 
´avdiskfže
[], 
´avdisk·th
[];

53 
SDL_boÞ
 
»äeshdisks
;

55 
	#GENERAL_DISK_DEBUG
 0

	)

56 
	#DEBUG_SECTOR_DUMP
 0

	)

58 #ià
DEBUG_SECTOR_DUMP


59 
	g£ùÜdump¡r
[64];

60 
	g£ùÜdumpcouÁ
;

63 #ifdeà
MICRODISC_FUDGE


64 
miüodisc_£tšŒq
Ð*
md
 );

67 
Ušt16
 
	$ÿlc_üc
Ð
Ušt16
 
üc
, 
Ušt8
 
v®ue
)

69 
üc
 = (()(crc >> 8)) | (crc << 8);

70 
üc
 ^ð
v®ue
;

71 
üc
 ^= (()(crc & 0xff)) >> 4;

72 
üc
 ^= (crc << 8) << 4;

73 
üc
 ^= ((crc & 0xff) << 4) << 1;

74  
üc
;

75 
	}
}

78 
	$disk_pÝup
Ð
machše
 *
Üic
, 
drive
 )

80 
tmp
[40];

81 ifÐ!
Üic
->
diskÇme
[
drive
][0] )

83 
	`do_pÝup
Ð
Üic
, "\x14\x15\x13" );

87 
	`¥rštf
Ð
tmp
, "\x14\x15""%d %-16s", 
drive
, 
Üic
->
diskÇme
[drive] );

88 
	`do_pÝup
Ð
Üic
, 
tmp
 );

89 
	}
}

92 
	$diskimage_ä“
Ð
machše
 *
Üic
, 
diskimage
 **
dimg
 )

94 *
d·th
, *
dfže
;

96 ifÐ!(*
dimg
) ) ;

98 ifÐ
Üic
->
ty³
 !ð
MACH_TELESTRAT
 )

100 
Üic
->
driv‘y³
)

102 
DRV_PRAVETZ
:

103 
d·th
 = 
´avdisk·th
;

104 
dfže
 = 
´avdiskfže
;

108 
d·th
 = 
disk·th
;

109 
dfže
 = 
diskfže
;

113 
d·th
 = 
‹Ëdisk·th
;

114 
dfže
 = 
‹Ëdiskfže
;

117 ifÐ(*
dimg
)->
modif›d
 )

119 
modmsg
[128];

120 
	`¥rštf
Ð
modmsg
, "Thdisk iÀdriv%d i modif›d.\nWould you†iktØ§vthchªges?", (*
dimg
)->
driv’um
 );

121 ifÐ
	`msgbox
Ð
Üic
, 
MSGBOX_YES_NO
, 
modmsg
 ) )

123 
	`¥rštf
Ð
modmsg
, "Savdisk %d", (*
dimg
)->
driv’um
 );

124 ifÐ
	`fž”eque¡”
Ð
Üic
, 
modmsg
, 
d·th
, 
dfže
, 
FR_DISKSAVE
 ) )

126 
	`još·th
Ð
d·th
, 
dfže
 );

127 
	`diskimage_§ve
Ð
Üic
, 
fž‘mp
, (*
dimg
)->
driv’um
 );

132 ifÐ(*
dimg
)->
¿wimage
 ) 
	`ä“
( (*dimg)->rawimage );

133 
	`ä“
Ð*
dimg
 );

134 (*
dimg
èð
NULL
;

135 
	}
}

138 
Ušt32
 
	$diskimage_¿wšt
Ð
diskimage
 *
dimg
, 
Ušt32
 
off£t
 )

140 ifÐ!
dimg
 )  0;

141 ifÐÐ!
dimg
->
¿wimage
 ) || ( dimg->
¿wimag–’
 < 4 ) )  0;

142 ifÐ
off£t
 > (
dimg
->
¿wimag–’
-4) )  0;

144  (
dimg
->
¿wimage
[
off£t
+3]<<24)|(dimg->rawimage[offset+2]<<16)|(dimg->rawimage[offset+1]<<8)|dimg->rawimage[offset];

145 
	}
}

150 
diskimage
 *
	$diskimage_®loc
Ð
Ušt32
 
¿wimgËn
 )

152 
diskimage
 *
dimg
;

153 
Ušt8
 *
buf
=
NULL
;

155 ifÐ
¿wimgËn
 )

157 
buf
 = 
	`m®loc
Ð
¿wimgËn
 );

158 ifÐ!
buf
 )  
NULL
;

161 
dimg
 = 
	`m®loc
ÐÐ
diskimage
 ) );

162 ifÐ!
dimg
 )

164 
	`ä“
Ð
buf
 );

165  
NULL
;

168 
dimg
->
driv’um
 = -1;

169 
dimg
->
numŒacks
 = 0;

170 
dimg
->
numsides
 = 0;

171 
dimg
->
geom‘ry
 = 0;

172 
dimg
->
ÿchedŒack
 = -1;

173 
dimg
->
ÿchedside
 = -1;

174 
dimg
->
num£ùÜs
 = 0;

175 
dimg
->
¿wimage
 = 
buf
;

176 
dimg
->
¿wimag–’
 = 
¿wimgËn
;

177 
dimg
->
modif›d
 = 
SDL_FALSE
;

178 
dimg
->
modif›d_time
 = 0;

179  
dimg
;

180 
	}
}

183 
	$disk_ejeù
Ð
machše
 *
Üic
, 
drive
 )

185 
	`diskimage_ä“
Ð
Üic
, &Üic->
wddisk
.
disk
[
drive
] );

186 
Üic
->
´av‘z
.
drv
[
drive
].
pimg
 = 
NULL
;

187 
Üic
->
´av‘z
.
drv
[
drive
].
by‹
 = 0;

188 
Üic
->
´av‘z
.
drv
[
drive
].
dœty
 = 
SDL_FALSE
;

189 
Üic
->
´av‘z
.
drv
[
drive
].
h®f_Œack
 = 0;

190 
Üic
->
diskÇme
[
drive
][0] = 0;

191 
	`disk_pÝup
Ð
Üic
, 
drive
 );

192 
	}
}

198 
	$diskimage_ÿch‘¿ck
Ð
diskimage
 *
dimg
, 
Œack
, 
side
 )

200 
Ušt8
 *
±r
, *
eÙ
;

201 
Ušt32
 
£ùÜcouÁ
, 
n
;

204 ifÐÐ
dimg
->
ÿchedŒack
 =ð
Œack
 ) &&

205 Ð
dimg
->
ÿchedside
 =ð
side
 ) )

209  
n
=0;‚<32;‚++ )

211 
dimg
->
£ùÜ
[
n
].
id_±r
 = 
NULL
;

212 
dimg
->
£ùÜ
[
n
].
d©a_±r
 = 
NULL
;

214 
dimg
->
num£ùÜs
 = 0;

215 
dimg
->
ÿchedŒack
 = -1;

216 
dimg
->
ÿchedside
 = -1;

218 ifÐ
side
 >ð
dimg
->
numsides
 )

222 
±r
 = &
dimg
->
¿wimage
[(
side
*dimg->
numŒacks
+
Œack
)*6400+256];

223 
eÙ
 = &
±r
[6400];

226 
£ùÜcouÁ
 = 0;

227  
±r
 < 
eÙ
 )

230  (
±r
<
eÙ
) && (ptr[0]!=0xfe) )…tr++;

233 ifÐ
±r
 >ð
eÙ
 ) ;

236 
dimg
->
£ùÜ
[
£ùÜcouÁ
].
id_±r
 = 
±r
;

237 
dimg
->
£ùÜ
[
£ùÜcouÁ
].
d©a_±r
 = 
NULL
;

238 
£ùÜcouÁ
++;

241 
n
 = 
±r
[4];

244 
±r
+=7;

247  (
±r
<
eÙ
) && (ptr[0]!=0xfb) && (ptr[0]!=0xf8) )…tr++;

248 ifÐ
±r
 >ð
eÙ
 ) ;

251 
dimg
->
£ùÜ
[
£ùÜcouÁ
-1].
d©a_±r
 = 
±r
;

254 
±r
 +ð(1<<(
n
+7))+3;

257 ifÐ0 < 
£ùÜcouÁ
 )

260 
dimg
->
num£ùÜs
 = 
£ùÜcouÁ
;

261 
dimg
->
ÿchedŒack
 = 
Œack
;

262 
dimg
->
ÿchedside
 = 
side
;

264 
	}
}

270 
SDL_boÞ
 
	$diskimage_§ve
Ð
machše
 *
Üic
, *
âame
, 
drive
 )

272 
FILE
 *
f
;

275 ifÐ!
Üic
->
wddisk
.
disk
[
drive
] )  
SDL_FALSE
;

277 ifÐ
Üic
->
driv‘y³
 =ð
DRV_PRAVETZ
 )

278 
	`disk_´av‘z_wr™e_image
(&
Üic
->
´av‘z
.
drv
[
drive
]);

281 
f
 = 
	`fÝ’
Ð
âame
, "wb" );

282 ifÐ!
f
 )

284 
	`do_pÝup
Ð
Üic
, "\x14\x15Save failed" );

285  
SDL_FALSE
;

289 ifÐ
	`fwr™e
Ð
Üic
->
wddisk
.
disk
[
drive
]->
¿wimage
, oric->wddisk.disk[drive]->
¿wimag–’
, 1, 
f
 ) != 1 )

291 
	`fþo£
Ð
f
 );

292 
	`do_pÝup
Ð
Üic
, "\x14\x15Save failed" );

293  
SDL_FALSE
;

297 
	`fþo£
Ð
f
 );

300 ifÐ
âame
 !ð
Üic
->
wddisk
.
disk
[
drive
]->
fž’ame
 )

302 
	`¡ºýy
Ð
Üic
->
wddisk
.
disk
[
drive
]->
fž’ame
, 
âame
, 4096+512 );

303 
Üic
->
wddisk
.
disk
[
drive
]->
fž’ame
[4096+511] = 0;

307 
Üic
->
wddisk
.
disk
[
drive
]->
modif›d
 = 
SDL_FALSE
;

308 
Üic
->
wddisk
.
disk
[
drive
]->
modif›d_time
 = 0;

311 
»äeshdisks
 = 
SDL_TRUE
;

312  
SDL_TRUE
;

313 
	}
}

316 
SDL_boÞ
 
	$diskimage_lßd
Ð
machše
 *
Üic
, *
âame
, 
drive
 )

318 
FILE
 *
f
;

319 
Ušt32
 
Ën
;

322 
f
 = 
	`fÝ’
Ð
âame
, "rb" );

323 ifÐ!
f
 )  
SDL_FALSE
;

326 
	`disk_ejeù
Ð
Üic
, 
drive
 );

329 
	`f£ek
Ð
f
, 0, 
SEEK_END
 );

330 
Ën
 = ()
	`á–l
Ð
f
 );

331 
	`f£ek
Ð
f
, 0, 
SEEK_SET
 );

334 ifÐ
Ën
 <= 0 )

336 
	`fþo£
Ð
f
 );

337  
SDL_FALSE
;

341 
Üic
->
wddisk
.
disk
[
drive
] = 
	`diskimage_®loc
Ð
Ën
 );

342 ifÐ!
Üic
->
wddisk
.
disk
[
drive
] )

344 
	`do_pÝup
Ð
Üic
, "\x14\x15""Out of memory" );

345 
	`fþo£
Ð
f
 );

346  
SDL_FALSE
;

350 ifÐ
	`ä—d
Ð
Üic
->
wddisk
.
disk
[
drive
]->
¿wimage
, 
Ën
, 1, 
f
 ) != 1 )

352 
	`fþo£
Ð
f
 );

353 
	`disk_ejeù
Ð
Üic
, 
drive
 );

354 
	`do_pÝup
Ð
Üic
, "\x14\x15""Readƒrror" );

355  
SDL_FALSE
;

358 
	`fþo£
Ð
f
 );

360 ifÐ
Üic
->
driv‘y³
 =ð
DRV_PRAVETZ
 )

362 
Ušt16
 
t_idx
;

363 
Ušt16
 
s_idx
;

364 
Ušt16
 
sb_idx
;

365 
Ušt16
 
tb_idx
;

367 
Üic
->
´av‘z
.
drv
[
drive
].
pimg
 = oric->
wddisk
.
disk
[drive];

369 ifÐ
drive
 >= 2 )

371 
	`disk_ejeù
Ð
Üic
, 
drive
 );

372 
	`do_pÝup
Ð
Üic
, "\x14\x15""Invalid drive‚umber" );

373  
SDL_FALSE
;

376 ifÐ
Ën
 != 143360 )

378 
	`disk_ejeù
Ð
Üic
, 
drive
 );

379 
	`do_pÝup
Ð
Üic
, "\x14\x15""Invalid…ravetz disk image" );

380  
SDL_FALSE
;

384 
t_idx
 = 0;_idx < 
PRAV_TRACKS_PER_DISK
;_idx++)

386 
tb_idx
 = 0;

388 
s_idx
 = 0; s_idx < 
PRAV_SECTORS_PER_TRACK
; s_idx++)

390 
sb_idx
 = 0; sb_idx < 
PRAV_RAW_BYTES_PER_SECTOR
; sb_idx++, 
tb_idx
++)

392 
Üic
->
´av‘z
.
drv
[
drive
].
image
[
t_idx
][
tb_idx
] =

393 
	`disk_´av‘z_image_¿w_by‹
(
Üic
, 
drive
, 
t_idx
, 
s_idx
, 
sb_idx
);

397 
tb_idx
 < 
PRAV_RAW_TRACK_SIZE
)

399 
Üic
->
´av‘z
.
drv
[
drive
].
image
[
t_idx
][
tb_idx
] = 0xFF;

400 
tb_idx
++;

404 
Üic
->
´av‘z
.
drv
[
drive
].
by‹
 = 0;

405 
Üic
->
´av‘z
.
drv
[
drive
].
h®f_Œack
 = 0;

410 ifÐ
	`¡ºcmp
Ð(*)
Üic
->
wddisk
.
disk
[
drive
]->
¿wimage
, "MFM_DISK", 8 ) != 0 )

412 
	`disk_ejeù
Ð
Üic
, 
drive
 );

413 
	`do_pÝup
Ð
Üic
, "\x14\x15""Invalid disk image" );

414  
SDL_FALSE
;

418 
Üic
->
wddisk
.
disk
[
drive
]->
driv’um
 = drive;

419 
Üic
->
wddisk
.
disk
[
drive
]->
numsides
 = 
	`diskimage_¿wšt
( oric->wddisk.disk[drive], 8 );

420 
Üic
->
wddisk
.
disk
[
drive
]->
numŒacks
 = 
	`diskimage_¿wšt
( oric->wddisk.disk[drive], 12 );

421 
Üic
->
wddisk
.
disk
[
drive
]->
geom‘ry
 = 
	`diskimage_¿wšt
( oric->wddisk.disk[drive], 16 );

424 ifÐÐ
Üic
->
wddisk
.
disk
[
drive
]->
numsides
 < 1 ) ||

425 Ð
Üic
->
wddisk
.
disk
[
drive
]->
numsides
 > 2 ) )

427 
	`disk_ejeù
Ð
Üic
, 
drive
 );

428 
	`do_pÝup
Ð
Üic
, "\x14\x15""Invalid disk image" );

429  
SDL_FALSE
;

434 
Üic
->
wddisk
.
disk
[
drive
]->
modif›d
 = 
SDL_FALSE
;

435 
Üic
->
wddisk
.
disk
[
drive
]->
modif›d_time
 = 0;

438 
	`¡ºýy
Ð
Üic
->
wddisk
.
disk
[
drive
]->
fž’ame
, 
âame
, 4096+512 );

439 
Üic
->
wddisk
.
disk
[
drive
]->
fž’ame
[4096+511] = 0;

442 ifÐ
	`¡¾’
Ð
âame
 ) > 31 )

444 
	`¡ºýy
Ð
Üic
->
diskÇme
[
drive
], &
âame
[
	`¡¾’
(fname)-31], 32 );

445 
Üic
->
diskÇme
[
drive
][0] = 22;

447 
	`¡ºýy
Ð
Üic
->
diskÇme
[
drive
], 
âame
, 32 );

449 
Üic
->
diskÇme
[
drive
][31] = 0;

452 
	`disk_pÝup
Ð
Üic
, 
drive
 );

455 
»äeshdisks
 = 
SDL_TRUE
;

456  
SDL_TRUE
;

457 
	}
};

461 
	$wd17xx_dummy
Ð*
nÙhšg
 )

463 
	}
}

466 
	$wd17xx_š™
Ð
wd17xx
 *
wd
 )

468 
wd
->
r_¡©us
 = 0;

469 
wd
->
r_Œack
 = 0;

470 
wd
->
r_£ùÜ
 = 0;

471 
wd
->
r_d©a
 = 0;

472 
wd
->
c_drive
 = 0;

473 
wd
->
c_side
 = 0;

474 
wd
->
c_Œack
 = 0;

475 
wd
->
c_£ùÜ
 = 0;

476 
wd
->
Ï¡_¡•_š
 = 
SDL_FALSE
;

477 
wd
->
£tšŒq
 = 
wd17xx_dummy
;

478 
wd
->
þršŒq
 = 
wd17xx_dummy
;

479 
wd
->
šŒq¬g
 = 
NULL
;

480 
wd
->
£tdrq
 = 
wd17xx_dummy
;

481 
wd
->
þrdrq
 = 
wd17xx_dummy
;

482 
wd
->
drq¬g
 = 
NULL
;

483 
wd
->
cu¼’tÝ
 = 
COP_NUFFINK
;

484 
wd
->
d–ayedšt
 = 0;

485 
wd
->
d–ayeddrq
 = 0;

486 
wd
->
di¡©us
 = -1;

487 
wd
->
dd¡©us
 = -1;

488 
»äeshdisks
 = 
SDL_TRUE
;

489 
	}
}

492 
	$wd17xx_ticktock
Ð
wd17xx
 *
wd
, 
cyþes
 )

494 #ifdeà
MICRODISC_FUDGE


495 ià((
wd
->
cu¼’tÝ
 =ð
COP_READ_SECTORS_FUDGE
) ||

496 (
wd
->
cu¼’tÝ
 =ð
COP_READ_SECTOR_FUDGE
))

498 ià(
wd
->
disk
[wd->
c_drive
])

500 
wd
->
cu¼offs
 = 0;

501 
wd
->
cu¼£ùÜ
 = 
	`wd17xx_fšd_£ùÜ
Ðwd, wd->
r_£ùÜ
 );

502 ifÐ!
wd
->
cu¼£ùÜ
 )

504 
wd
->
r_¡©us
 = 
WSF_RNF
;

505 
wd
->
	`þrdrq
Ðwd->
drq¬g
 );

506 
wd
->
	`£tšŒq
Ðwd->
šŒq¬g
 );

507 
wd
->
cu¼’tÝ
 = 
COP_NUFFINK
;

508 
»äeshdisks
 = 
SDL_TRUE
;

509 #ià
GENERAL_DISK_DEBUG


510 
	`dbg_´štf
Ð"DISK: SeùÜ %d‚Ù found.", 
wd
->
r_£ùÜ
 );

515 
wd
->
cu¼£þ’
 = 1<<(wd->
cu¼£ùÜ
->
id_±r
[4]+7);

516 
wd
->
r_¡©us
 = 
WSF_BUSY
|
WSF_NOTREADY
;

517 
wd
->
d–ayeddrq
 = 60;

518 
wd
->
cu¼’tÝ
 = (wd->cu¼’tÝ =ð
COP_READ_SECTORS_FUDGE
è? 
COP_READ_SECTORS
 : 
COP_READ_SECTOR
;

519 
wd
->
üc
 = 0xe295;

520 
»äeshdisks
 = 
SDL_TRUE
;

521 #ià
DEBUG_SECTOR_DUMP


522 
£ùÜdumpcouÁ
 = 0;

523 
£ùÜdump¡r
[0] = 0;

531 ifÐ
wd
->
d–ayedšt
 > 0 )

534 
wd
->
d–ayedšt
 -ð
cyþes
;

537 ifÐ
wd
->
d–ayedšt
 <= 0 )

540 
wd
->
d–ayedšt
 = 0;

543 ifÐ
wd
->
di¡©us
 != -1 )

546 
wd
->
r_¡©us
 = wd->
di¡©us
;

547 
wd
->
di¡©us
 = -1;

551 
wd
->
	`£tšŒq
Ðwd->
šŒq¬g
 );

552 #ià
GENERAL_DISK_DEBUG


553 
	`dbg_´štf
( "DISK: Delayed INTRQ" );

559 ifÐ
wd
->
d–ayeddrq
 > 0 )

562 
wd
->
d–ayeddrq
 -ð
cyþes
;

565 ifÐ
wd
->
d–ayeddrq
 <= 0 )

568 
wd
->
d–ayeddrq
 = 0;

571 ifÐ
wd
->
dd¡©us
 != -1 )

574 
wd
->
r_¡©us
 = wd->
dd¡©us
;

575 
wd
->
dd¡©us
 = -1;

579 
wd
->
r_¡©us
 |ð
WSF_DRQ
;

580 
wd
->
	`£tdrq
Ðwd->
drq¬g
 );

583 
	}
}

586 
	$wd17xx_£ek_Œack
Ð
wd17xx
 *
wd
, 
Ušt8
 
Œack
, 
SDL_boÞ
 
dofudge
 )

589 ifÐ
wd
->
disk
[wd->
c_drive
] )

592 ifÐ
Œack
 >ð
wd
->
disk
[wd->
c_drive
]->
numŒacks
 )

594 
Œack
 = (
wd
->
disk
[wd->
c_drive
]->
numŒacks
>0)?wd->disk[wd->c_drive]->numtracks-1:0;

595 
wd
->
di¡©us
 = 
WSFI_HEADL
|
WSFI_SEEKERR
;

599 
wd
->
di¡©us
 = 
WSFI_HEADL
|
WSFI_PULSE
;

603 
	`diskimage_ÿch‘¿ck
Ð
wd
->
disk
[wd->
c_drive
], 
Œack
, wd->
c_side
 );

606 
wd
->
c_Œack
 = 
Œack
;

607 
wd
->
c_£ùÜ
 = 0;

608 
wd
->
r_Œack
 = 
Œack
;

614 
wd
->
d–ayedšt
 = 20;

615 ifÐ
wd
->
c_Œack
 =ð0 ) wd->
di¡©us
 |ð
WSFI_TRK0
;

616 #ià
GENERAL_DISK_DEBUG


617 
	`dbg_´štf
Ð"DISK: AˆŒack %u (%u seùÜs)", 
Œack
, 
wd
->
disk
[wd->
c_drive
]->
num£ùÜs
 );

624 
wd
->
	`£tšŒq
Ðwd->
šŒq¬g
 );

625 
wd
->
r_Œack
 = 0;

627 #ià
GENERAL_DISK_DEBUG


628 
	`dbg_´štf
( "DISK: Seek fail" );

631 #ifdeà
MICRODISC_FUDGE


633 ià((
dofudge
è&& (
wd
->
£tšŒq
 =ð
miüodisc_£tšŒq
))

635 
wd
->
r_¡©us
 = 0x44;

641 
wd
->
r_¡©us
 = 
WSF_NOTREADY
|
WSFI_SEEKERR
;

642 
	}
}

647 
mfm£ùÜ
 *
	$wd17xx_fšd_£ùÜ
Ð
wd17xx
 *
wd
, 
Ušt8
 
£cid
 )

649 
»vs
=0;

650 
diskimage
 *
dimg
;

653 
dimg
 = 
wd
->
disk
[wd->
c_drive
];

656 ifÐ!
dimg
 )  
NULL
;

659 
	`diskimage_ÿch‘¿ck
Ð
dimg
, 
wd
->
c_Œack
, wd->
c_side
 );

662 ifÐ
dimg
->
num£ùÜs
 < 1 )

663  
NULL
;

668  
»vs
 < 2 )

671 
wd
->
c_£ùÜ
 = (wd->c_£ùÜ+1)%
dimg
->
num£ùÜs
;

674 ifÐ!
wd
->
c_£ùÜ
 )

676 
»vs
++;

677 
wd
->
r_¡©us
 |ð
WSFI_PULSE
;

681 ifÐ
dimg
->
£ùÜ
[
wd
->
c_£ùÜ
].
id_±r
[3] =ð
£cid
 )

682  &
dimg
->
£ùÜ
[
wd
->
c_£ùÜ
];

686 #ià
GENERAL_DISK_DEBUG


687 
	`dbg_´štf
Ð"Couldn'ˆfšd seùÜ %u", 
£cid
 );

689  
NULL
;

690 
	}
}

694 
mfm£ùÜ
 *
	$wd17xx_fœ¡_£ùÜ
Ð
wd17xx
 *
wd
 )

696 
diskimage
 *
dimg
;

698 
dimg
 = 
wd
->
disk
[wd->
c_drive
];

701 ifÐ!
dimg
 )  
NULL
;

704 
	`diskimage_ÿch‘¿ck
Ð
dimg
, 
wd
->
c_Œack
, wd->
c_side
 );

707 ifÐ
dimg
->
num£ùÜs
 < 1 )

708  
NULL
;

711 
wd
->
c_£ùÜ
 = 0;

712 
wd
->
r_¡©us
 = 
WSFI_PULSE
;

715  &
dimg
->
£ùÜ
[
wd
->
c_£ùÜ
];

716 
	}
}

719 
mfm£ùÜ
 *
	$wd17xx_Ãxt_£ùÜ
Ð
wd17xx
 *
wd
 )

721 
diskimage
 *
dimg
;

723 
dimg
 = 
wd
->
disk
[wd->
c_drive
];

726 ifÐ!
dimg
 )  
NULL
;

729 
	`diskimage_ÿch‘¿ck
Ð
dimg
, 
wd
->
c_Œack
, wd->
c_side
 );

732 ifÐ
dimg
->
num£ùÜs
 < 1 )

733  
NULL
;

736 
wd
->
c_£ùÜ
 = (wd->c_£ùÜ+1)%
dimg
->
num£ùÜs
;

739 ifÐ!
wd
->
c_£ùÜ
 ) wd->
r_¡©us
 |ð
WSFI_PULSE
;

742  &
dimg
->
£ùÜ
[
wd
->
c_£ùÜ
];

743 
	}
}

746 
	$wd17xx_»ad
Ð
wd17xx
 *
wd
, 
addr
 )

749  
addr
 )

752 
wd
->
	`þršŒq
Ðwd->
šŒq¬g
 );

753  
wd
->
r_¡©us
;

756  
wd
->
r_Œack
;

759  
wd
->
r_£ùÜ
;

763  
wd
->
cu¼’tÝ
 )

765 #ifdeà
MICRODISC_FUDGE


766 
COP_READ_SECTOR_FUDGE
:

767 
COP_READ_SECTORS_FUDGE
:

771 
COP_READ_SECTOR
:

772 
COP_READ_SECTORS
:

774 ifÐ!
wd
->
cu¼£ùÜ
 )

777 
wd
->
r_¡©us
 &ð~
WSF_DRQ
;

778 
wd
->
r_¡©us
 |ð
WSF_RNF
;

779 
wd
->
	`þrdrq
Ðwd->
drq¬g
 );

780 
wd
->
cu¼’tÝ
 = 
COP_NUFFINK
;

781 
»äeshdisks
 = 
SDL_TRUE
;

786 ifÐ
wd
->
cu¼offs
 =ð0 ) wd->
£ùy³
 = (wd->
cu¼£ùÜ
->
d©a_±r
[wd->cu¼offs++]==0xf8)?
WSFR_RECTYP
:0x00;

789 
wd
->
r_d©a
 = wd->
cu¼£ùÜ
->
d©a_±r
[wd->
cu¼offs
++];

790 
wd
->
üc
 = 
	`ÿlc_üc
Ðwd->üc, wd->
r_d©a
 );

793 
wd
->
r_¡©us
 &ð~
WSF_DRQ
;

794 
wd
->
	`þrdrq
Ðwd->
drq¬g
 );

796 #ià
DEBUG_SECTOR_DUMP


797 
	`¥rštf
Ð&
£ùÜdump¡r
[
£ùÜdumpcouÁ
*2], "%02X", 
wd
->
r_d©a
 );

798 
£ùÜdump¡r
[34+
£ùÜdumpcouÁ
] = ((
wd
->
r_d©a
>31)&&(wd->r_data<127)) ? wd->r_data : '.';

799 
£ùÜdumpcouÁ
++;

800 ifÐ
£ùÜdumpcouÁ
 >= 16 )

802 
£ùÜdump¡r
[32] = ' ';

803 
£ùÜdump¡r
[33] = '\'';

804 
£ùÜdump¡r
[50] = '\'';

805 
£ùÜdump¡r
[51] = 0;

806 
	`dbg_´štf
Ð"%s", 
£ùÜdump¡r
 );

807 
£ùÜdumpcouÁ
 = 0;

812 ifÐ
wd
->
cu¼offs
 > wd->
cu¼£þ’
 )

815 #ià
DEBUG_SECTOR_DUMP


816 ifÐ
£ùÜdumpcouÁ
 )

818 
£ùÜdump¡r
[33] = '\'';

819 
£ùÜdump¡r
[34+
£ùÜdumpcouÁ
] = '\'';

820 
£ùÜdump¡r
[35+
£ùÜdumpcouÁ
] = 0;

821  
£ùÜdumpcouÁ
*=2; sectordumpcount<33; sectordumpcount++ )

822 
£ùÜdump¡r
[
£ùÜdumpcouÁ
*2] = ' ';

823 
	`dbg_´štf
Ð"%s", 
£ùÜdump¡r
 );

824 
£ùÜdumpcouÁ
 = 0;

830 ifÐ
wd
->
cu¼’tÝ
 =ð
COP_READ_SECTORS
 )

832 #ià
GENERAL_DISK_DEBUG


833 
	`dbg_´štf
( "Next sector..." );

836 
wd
->
r_£ùÜ
++;

837 
wd
->
cu¼offs
 = 0;

838 
wd
->
cu¼£ùÜ
 = 
	`wd17xx_fšd_£ùÜ
Ðwd, wd->
r_£ùÜ
 );

839 
wd
->
üc
 = 0xe295;

843 ifÐ!
wd
->
cu¼£ùÜ
 )

845 
wd
->
d–ayedšt
 = 20;

846 
wd
->
di¡©us
 = wd->
£ùy³
;

847 
wd
->
cu¼’tÝ
 = 
COP_NUFFINK
;

848 
wd
->
r_¡©us
 &ð(~
WSF_DRQ
);

849 
wd
->
	`þrdrq
Ðwd->
drq¬g
 );

850 
»äeshdisks
 = 
SDL_TRUE
;

857 
wd
->
d–ayeddrq
 = 180;

862 
wd
->
d–ayedšt
 = 32;

863 
wd
->
di¡©us
 = wd->
£ùy³
;

864 
wd
->
cu¼’tÝ
 = 
COP_NUFFINK
;

865 
wd
->
r_¡©us
 &ð(~
WSF_DRQ
);

866 
wd
->
	`þrdrq
Ðwd->
drq¬g
 );

867 
»äeshdisks
 = 
SDL_TRUE
;

869 
wd
->
d–ayeddrq
 = 32;

873 
COP_READ_ADDRESS
:

874 ifÐ!
wd
->
cu¼£ùÜ
 )

876 
wd
->
r_¡©us
 &ð~
WSF_DRQ
;

877 
wd
->
	`þrdrq
Ðwd->
drq¬g
 );

878 
wd
->
cu¼’tÝ
 = 
COP_NUFFINK
;

879 
»äeshdisks
 = 
SDL_TRUE
;

882 ifÐ
wd
->
cu¼offs
 =ð0 ) wd->
r_£ùÜ
 = wd->
cu¼£ùÜ
->
id_±r
[1];

883 
wd
->
r_d©a
 = wd->
cu¼£ùÜ
->
id_±r
[++wd->
cu¼offs
];

884 
wd
->
r_¡©us
 &ð~
WSF_DRQ
;

885 
wd
->
	`þrdrq
Ðwd->
drq¬g
 );

886 ifÐ
wd
->
cu¼offs
 >= 6 )

888 
wd
->
d–ayedšt
 = 20;

889 
wd
->
di¡©us
 = 0;

890 
wd
->
cu¼’tÝ
 = 
COP_NUFFINK
;

891 
»äeshdisks
 = 
SDL_TRUE
;

893 
wd
->
d–ayeddrq
 = 32;

898  
wd
->
r_d©a
;

902 
	}
}

904 
SDL_boÞ
 
	gÏ¡_¡•_š
 = 
SDL_FALSE
;

905 
	$wd17xx_wr™e
Ð
machše
 *
Üic
, 
wd17xx
 *
wd
, 
addr
, 
d©a
 )

907  
addr
 )

910 
wd
->
	`þršŒq
Ðwd->
šŒq¬g
 );

911  
d©a
 & 0xe0 )

914  
d©a
 & 0x10 )

917 #ià
GENERAL_DISK_DEBUG


918 
	`dbg_´štf
Ð"DISK: (%04XèRe¡Üe", 
Üic
->
ýu
.
pc
-1 );

920 
wd
->
r_¡©us
 = 
WSF_BUSY
;

921 ifÐ
d©a
 & 8 ) 
wd
->
r_¡©us
 |ð
WSFI_HEADL
;

922 
	`wd17xx_£ek_Œack
Ð
wd
, 0, 
Üic
->
ýu
.
ÿlýc
 == 0xe3a1 );

923 
wd
->
cu¼’tÝ
 = 
COP_NUFFINK
;

924 
»äeshdisks
 = 
SDL_TRUE
;

928 #ià
GENERAL_DISK_DEBUG


929 
	`dbg_´štf
Ð"DISK: (%04XèS“k", 
Üic
->
ýu
.
pc
-1 );

931 
wd
->
r_¡©us
 = 
WSF_BUSY
;

932 ifÐ
d©a
 & 8 ) 
wd
->
r_¡©us
 |ð
WSFI_HEADL
;

933 
	`wd17xx_£ek_Œack
Ð
wd
, wd->
r_d©a
, 
SDL_FALSE
 );

934 
wd
->
cu¼’tÝ
 = 
COP_NUFFINK
;

935 
»äeshdisks
 = 
SDL_TRUE
;

941 #ià
GENERAL_DISK_DEBUG


942 
	`dbg_´štf
Ð"DISK: (%04XèS‹p", 
Üic
->
ýu
.
pc
-1 );

944 
wd
->
r_¡©us
 = 
WSF_BUSY
;

945 ifÐ
d©a
 & 8 ) 
wd
->
r_¡©us
 |ð
WSFI_HEADL
;

946 ifÐ
Ï¡_¡•_š
 )

947 
	`wd17xx_£ek_Œack
Ð
wd
, wd->
c_Œack
+1, 
SDL_FALSE
 );

949 
	`wd17xx_£ek_Œack
Ð
wd
, wd->
c_Œack
 > 0 ? wd->c_Œack-1 : 0, 
SDL_FALSE
 );

950 
wd
->
cu¼’tÝ
 = 
COP_NUFFINK
;

951 
»äeshdisks
 = 
SDL_TRUE
;

955 #ià
GENERAL_DISK_DEBUG


956 
	`dbg_´štf
Ð"DISK: (%04XèS‹p-IÀ(%d,%d)", 
Üic
->
ýu
.
pc
-1, 
wd
->
c_Œack
, wd->c_track+1 );

958 
wd
->
r_¡©us
 = 
WSF_BUSY
;

959 ifÐ
d©a
 & 8 ) 
wd
->
r_¡©us
 |ð
WSFI_HEADL
;

960 
	`wd17xx_£ek_Œack
Ð
wd
, wd->
c_Œack
+1, 
SDL_FALSE
 );

961 
Ï¡_¡•_š
 = 
SDL_TRUE
;

962 
wd
->
cu¼’tÝ
 = 
COP_NUFFINK
;

963 
»äeshdisks
 = 
SDL_TRUE
;

967 #ià
GENERAL_DISK_DEBUG


968 
	`dbg_´štf
( "DISK: Step-Out" );

970 
wd
->
r_¡©us
 = 
WSF_BUSY
;

971 ifÐ
d©a
 & 8 ) 
wd
->
r_¡©us
 |ð
WSFI_HEADL
;

972 ifÐ
wd
->
c_Œack
 > 0 )

973 
	`wd17xx_£ek_Œack
Ð
wd
, wd->
c_Œack
-1, 
SDL_FALSE
 );

974 
Ï¡_¡•_š
 = 
SDL_FALSE
;

975 
wd
->
cu¼’tÝ
 = 
COP_NUFFINK
;

976 
»äeshdisks
 = 
SDL_TRUE
;

980 #ià
GENERAL_DISK_DEBUG


981  
Üic
->
driv‘y³
 )

983 
DRV_MICRODISC
:

984 
	`dbg_´štf
Ð"DISK: (%04XèR—d seùÜ %u (CODE=%02X,ROM=%s,EPROM=%s)", 
Üic
->
ýu
.
pc
-1, 
wd
->
r_£ùÜ
, 
d©a
, oric->
romdis
?"OFF":"ON", oric->
md
.
diskrom
?"ON":"OFF" );

988 
	`dbg_´štf
Ð"DISK: (%04XèR—d seùÜ %u (CODE=%02X)", 
Üic
->
ýu
.
pc
-1, 
wd
->
r_£ùÜ
, 
d©a
 );

992 #ifdeà
MICRODISC_FUDGE


993 ià(!
wd
->
disk
[wd->
c_drive
])

995 
wd
->
cu¼’tÝ
 = (
d©a
&0x10è? 
COP_READ_SECTORS_FUDGE
 : 
COP_READ_SECTOR_FUDGE
;

1000 
wd
->
cu¼offs
 = 0;

1001 
wd
->
cu¼£ùÜ
 = 
	`wd17xx_fšd_£ùÜ
Ðwd, wd->
r_£ùÜ
 );

1002 ifÐ!
wd
->
cu¼£ùÜ
 )

1004 
wd
->
r_¡©us
 = 
WSF_RNF
;

1005 
wd
->
	`þrdrq
Ðwd->
drq¬g
 );

1006 
wd
->
	`£tšŒq
Ðwd->
šŒq¬g
 );

1007 
wd
->
cu¼’tÝ
 = 
COP_NUFFINK
;

1008 
»äeshdisks
 = 
SDL_TRUE
;

1009 #ià
GENERAL_DISK_DEBUG


1010 
	`dbg_´štf
Ð"DISK: SeùÜ %d‚Ù found.", 
wd
->
r_£ùÜ
 );

1016 
wd
->
cu¼£þ’
 = 1<<(wd->
cu¼£ùÜ
->
id_±r
[4]+7);

1017 
wd
->
r_¡©us
 = 
WSF_BUSY
|
WSF_NOTREADY
;

1018 
wd
->
d–ayeddrq
 = 60;

1019 
wd
->
cu¼’tÝ
 = (
d©a
&0x10è? 
COP_READ_SECTORS
 : 
COP_READ_SECTOR
;

1020 
wd
->
üc
 = 0xe295;

1021 
»äeshdisks
 = 
SDL_TRUE
;

1022 #ià
DEBUG_SECTOR_DUMP


1023 
£ùÜdumpcouÁ
 = 0;

1024 
£ùÜdump¡r
[0] = 0;

1029 #ià
GENERAL_DISK_DEBUG


1030  
Üic
->
driv‘y³
 )

1032 
DRV_MICRODISC
:

1033 
	`dbg_´štf
Ð"DISK: (%04XèWr™£ùÜ %u (CODE=%02X,ROM=%s,EPROM=%s)", 
Üic
->
ýu
.
pc
-1, 
wd
->
r_£ùÜ
, 
d©a
, oric->
romdis
?"OFF":"ON", oric->
md
.
diskrom
?"ON":"OFF" );

1037 
	`dbg_´štf
Ð"DISK: (%04XèWr™£ùÜ %u (CODE=%02X)", 
Üic
->
ýu
.
pc
-1, 
wd
->
r_£ùÜ
, 
d©a
 );

1041 
wd
->
cu¼offs
 = 0;

1042 
wd
->
cu¼£ùÜ
 = 
	`wd17xx_fšd_£ùÜ
Ðwd, wd->
r_£ùÜ
 );

1043 ifÐ!
wd
->
cu¼£ùÜ
 )

1045 
wd
->
r_¡©us
 = 
WSF_RNF
;

1046 
wd
->
	`þrdrq
Ðwd->
drq¬g
 );

1047 
wd
->
	`£tšŒq
Ðwd->
šŒq¬g
 );

1048 
wd
->
cu¼’tÝ
 = 
COP_NUFFINK
;

1049 
»äeshdisks
 = 
SDL_TRUE
;

1050 #ià
GENERAL_DISK_DEBUG


1051 
	`dbg_´štf
Ð"DISK: SeùÜ %d‚Ù found.", 
wd
->
r_£ùÜ
 );

1057 
wd
->
cu¼£þ’
 = 1<<(wd->
cu¼£ùÜ
->
id_±r
[4]+7);

1058 
wd
->
r_¡©us
 = 
WSF_BUSY
|
WSF_NOTREADY
;

1059 
wd
->
d–ayeddrq
 = 500;

1060 
wd
->
cu¼’tÝ
 = (
d©a
&0x10è? 
COP_WRITE_SECTORS
 : 
COP_WRITE_SECTOR
;

1061 
wd
->
üc
 = 0xe295;

1062 
»äeshdisks
 = 
SDL_TRUE
;

1066  
d©a
 & 0x10 )

1069 #ià
GENERAL_DISK_DEBUG


1070 
	`dbg_´štf
Ð"DISK: (%04XèR—d‡dd»ss", 
Üic
->
ýu
.
pc
-1 );

1072 
wd
->
cu¼offs
 = 0;

1073 ifÐ!
wd
->
cu¼£ùÜ
 )

1074 
wd
->
cu¼£ùÜ
 = 
	`wd17xx_fœ¡_£ùÜ
( wd );

1076 
wd
->
cu¼£ùÜ
 = 
	`wd17xx_Ãxt_£ùÜ
( wd );

1078 ifÐ!
wd
->
cu¼£ùÜ
 )

1080 
wd
->
r_¡©us
 = 
WSF_RNF
;

1081 
wd
->
	`þrdrq
Ðwd->
drq¬g
 );

1082 
wd
->
cu¼’tÝ
 = 
COP_NUFFINK
;

1083 
wd
->
	`£tšŒq
Ðwd->
šŒq¬g
 );

1084 
»äeshdisks
 = 
SDL_TRUE
;

1085 #ià
GENERAL_DISK_DEBUG


1086 
	`dbg_´štf
( "DISK: No sectors onhisrack?" );

1091 #ià
GENERAL_DISK_DEBUG


1092 
	`dbg_´štf
( "DISK: %02X,%02X,%02X,%02X,%02X,%02X",

1093 
wd
->
cu¼£ùÜ
->
id_±r
[1],

1094 
wd
->
cu¼£ùÜ
->
id_±r
[2],

1095 
wd
->
cu¼£ùÜ
->
id_±r
[3],

1096 
wd
->
cu¼£ùÜ
->
id_±r
[4],

1097 
wd
->
cu¼£ùÜ
->
id_±r
[5],

1098 
wd
->
cu¼£ùÜ
->
id_±r
[6] );

1100 
wd
->
r_¡©us
 = 
WSF_NOTREADY
|
WSF_BUSY
|
WSF_DRQ
;

1101 
wd
->
	`£tdrq
Ðwd->
drq¬g
 );

1102 
wd
->
cu¼’tÝ
 = 
COP_READ_ADDRESS
;

1103 
»äeshdisks
 = 
SDL_TRUE
;

1107 #ià
GENERAL_DISK_DEBUG


1108 
	`dbg_´štf
Ð"DISK: (%04XèFÜû iÁ", 
Üic
->
ýu
.
pc
-1 );

1110 
wd
->
r_¡©us
 = 0;

1111 
wd
->
	`þrdrq
Ðwd->
drq¬g
 );

1112 
wd
->
	`£tšŒq
Ðwd->
šŒq¬g
 );

1113 
wd
->
d–ayedšt
 = 0;

1114 
wd
->
d–ayeddrq
 = 0;

1115 
wd
->
cu¼’tÝ
 = 
COP_NUFFINK
;

1116 
»äeshdisks
 = 
SDL_TRUE
;

1122  
d©a
 & 0x10 )

1125 #ià
GENERAL_DISK_DEBUG


1126 
	`dbg_´štf
Ð"DISK: (%04XèR—d¿ck", 
Üic
->
ýu
.
pc
-1 );

1128 
wd
->
cu¼’tÝ
 = 
COP_READ_TRACK
;

1129 
»äeshdisks
 = 
SDL_TRUE
;

1133 #ià
GENERAL_DISK_DEBUG


1134 
	`dbg_´štf
Ð"DISK: (%04XèWr™Œack", 
Üic
->
ýu
.
pc
-1 );

1136 
wd
->
cu¼’tÝ
 = 
COP_WRITE_TRACK
;

1137 
»äeshdisks
 = 
SDL_TRUE
;

1145 
wd
->
r_Œack
 = 
d©a
;

1149 
wd
->
r_£ùÜ
 = 
d©a
;

1153 
wd
->
r_d©a
 = 
d©a
;

1155  
wd
->
cu¼’tÝ
 )

1157 
COP_WRITE_SECTOR
:

1158 
COP_WRITE_SECTORS
:

1159 ifÐ!
wd
->
cu¼£ùÜ
 )

1161 
wd
->
r_¡©us
 &ð~
WSF_DRQ
;

1162 
wd
->
r_¡©us
 |ð
WSF_RNF
;

1163 
wd
->
	`þrdrq
Ðwd->
drq¬g
 );

1164 
wd
->
cu¼’tÝ
 = 
COP_NUFFINK
;

1165 
»äeshdisks
 = 
SDL_TRUE
;

1168 ifÐ
wd
->
cu¼offs
 =ð0 ) wd->
cu¼£ùÜ
->
d©a_±r
[wd->curroffs++]=0xfb;

1169 
wd
->
cu¼£ùÜ
->
d©a_±r
[wd->
cu¼offs
++] = wd->
r_d©a
;

1170 
wd
->
üc
 = 
	`ÿlc_üc
Ðwd->üc, wd->
r_d©a
 );

1171 ifÐ!
wd
->
disk
[wd->
c_drive
]->
modif›d
 ) 
»äeshdisks
 = 
SDL_TRUE
;

1172 
wd
->
disk
[wd->
c_drive
]->
modif›d
 = 
SDL_TRUE
;

1173 
wd
->
disk
[wd->
c_drive
]->
modif›d_time
 = 0;

1174 
wd
->
r_¡©us
 &ð~
WSF_DRQ
;

1175 
wd
->
	`þrdrq
Ðwd->
drq¬g
 );

1177 ifÐ
wd
->
cu¼offs
 > wd->
cu¼£þ’
 )

1179 
wd
->
cu¼£ùÜ
->
d©a_±r
[wd->
cu¼offs
++] = wd->
üc
>>8;

1180 
wd
->
cu¼£ùÜ
->
d©a_±r
[wd->
cu¼offs
++] = wd->
üc
;

1181 ifÐ
wd
->
cu¼’tÝ
 =ð
COP_WRITE_SECTORS
 )

1183 #ià
GENERAL_DISK_DEBUG


1184 
	`dbg_´štf
( "Next sector..." );

1187 
wd
->
r_£ùÜ
++;

1188 
wd
->
cu¼offs
 = 0;

1189 
wd
->
cu¼£ùÜ
 = 
	`wd17xx_fšd_£ùÜ
Ðwd, wd->
r_£ùÜ
 );

1190 
wd
->
üc
 = 0xe295;

1192 ifÐ!
wd
->
cu¼£ùÜ
 )

1194 
wd
->
d–ayedšt
 = 20;

1195 
wd
->
di¡©us
 = wd->
£ùy³
;

1196 
wd
->
cu¼’tÝ
 = 
COP_NUFFINK
;

1197 
wd
->
r_¡©us
 &ð(~
WSF_DRQ
);

1198 
wd
->
	`þrdrq
Ðwd->
drq¬g
 );

1199 
»äeshdisks
 = 
SDL_TRUE
;

1202 
wd
->
d–ayeddrq
 = 180;

1206 
wd
->
d–ayedšt
 = 32;

1207 
wd
->
di¡©us
 = wd->
£ùy³
;

1208 
wd
->
cu¼’tÝ
 = 
COP_NUFFINK
;

1209 
wd
->
r_¡©us
 &ð(~
WSF_DRQ
);

1210 
wd
->
	`þrdrq
Ðwd->
drq¬g
 );

1211 
»äeshdisks
 = 
SDL_TRUE
;

1213 
wd
->
d–ayeddrq
 = 32;

1219 
	}
}

1221 
	$miüodisc_£tdrq
Ð*
md
 )

1223 
miüodisc
 *
mdp
 = (miüodisø*)
md
;

1224 
mdp
->
drq
 = 0;

1225 
	}
}

1227 
	$miüodisc_þrdrq
Ð*
md
 )

1229 
miüodisc
 *
mdp
 = (miüodisø*)
md
;

1230 
mdp
->
drq
 = 
MF_DRQ
;

1231 
	}
}

1233 
	$miüodisc_£tšŒq
Ð*
md
 )

1235 
miüodisc
 *
mdp
 = (miüodisø*)
md
;

1237 
mdp
->
šŒq
 = 0;

1238 ifÐ
mdp
->
¡©us
 & 
MDSF_INTENA
 )

1239 
mdp
->
Üic
->
ýu
.
œq
 |ð
IRQF_DISK
;

1240 
	}
}

1242 
	$miüodisc_þršŒq
Ð*
md
 )

1244 
miüodisc
 *
mdp
 = (miüodisø*)
md
;

1246 
mdp
->
šŒq
 = 
MDSF_INTRQ
;

1247 
mdp
->
Üic
->
ýu
.
œq
 &ð~
IRQF_DISK
;

1248 
	}
}

1250 
	$miüodisc_š™
Ð
miüodisc
 *
md
, 
wd17xx
 *
wd
, 
machše
 *
Üic
 )

1252 
	`wd17xx_š™
Ð
wd
 );

1253 
wd
->
£tšŒq
 = 
miüodisc_£tšŒq
;

1254 
wd
->
þršŒq
 = 
miüodisc_þršŒq
;

1255 
wd
->
šŒq¬g
 = (*)
md
;

1256 
wd
->
£tdrq
 = 
miüodisc_£tdrq
;

1257 
wd
->
þrdrq
 = 
miüodisc_þrdrq
;

1258 
wd
->
drq¬g
 = (*)
md
;

1260 
md
->
¡©us
 = 0;

1261 
md
->
šŒq
 = 0;

1262 
md
->
drq
 = 0;

1263 
md
->
wd
 = wd;

1264 
md
->
Üic
 = oric;

1265 
md
->
diskrom
 = 
SDL_TRUE
;

1266 
	}
}

1268 
	$miüodisc_ä“
Ð
miüodisc
 *
md
 )

1270 
i
;

1271  
i
=0; i<
MAX_DRIVES
; i++ )

1272 
	`disk_ejeù
Ð
md
->
Üic
, 
i
 );

1273 
	}
}

1275 
	$miüodisc_»ad
Ð
miüodisc
 *
md
, 
addr
 )

1278 ifÐÐ
addr
 >= 0x310 ) && (‡ddr < 0x314 ) )

1279  
	`wd17xx_»ad
Ð
md
->
wd
, 
addr
&3 );

1281  
addr
 )

1284  
md
->
šŒq
|0x7f;

1287  
md
->
drq
|0x7f;

1290  
	`vŸ_»ad
Ð&
md
->
Üic
->
vŸ
, 
addr
 );

1294 
	}
}

1296 
	$miüodisc_wr™e
Ð
miüodisc
 *
md
, 
addr
, 
d©a
 )

1299 ifÐÐ
addr
 >= 0x310 ) && (‡ddr < 0x314 ) )

1301 
	`wd17xx_wr™e
Ð
md
->
Üic
, md->
wd
, 
addr
&3, 
d©a
 );

1305  
addr
 )

1308 
md
->
¡©us
 = 
d©a
;

1311 ifÐÐ
d©a
&
MDSF_INTENA
 ) && ( 
md
->
šŒq
 == 0 ) )

1313 
md
->
Üic
->
ýu
.
œq
 |ð
IRQF_DISK
;

1315 
md
->
Üic
->
ýu
.
œq
 &ð~
IRQF_DISK
;

1318 
md
->
wd
->
c_drive
 = (
d©a
&
MDSF_DRIVE
)>>5;

1319 
md
->
wd
->
c_side
 = (
d©a
&
MDSF_SIDE
) ? 1 : 0;

1320 
md
->
Üic
->
romdis
 = (
d©a
&
MDSF_ROMDIS
è? 
SDL_FALSE
 : 
SDL_TRUE
;

1321 
md
->
diskrom
 = (
d©a
&
MDSF_EPROM
è? 
SDL_FALSE
 : 
SDL_TRUE
;

1325 
md
->
drq
 = (
d©a
&
MF_DRQ
);

1329 
	`vŸ_wr™e
Ð&
md
->
Üic
->
vŸ
, 
addr
, 
d©a
 );

1332 
	}
}

1334 
	$jasmš_£tdrq
Ð*
j
 )

1336 
jasmš
 *
jp
 = (jasmš *)
j
;

1337 
jp
->
Üic
->
ýu
.
œq
 |ð
IRQF_DISK
;

1338 
	}
}

1340 
	$jasmš_þrdrq
Ð*
j
 )

1342 
jasmš
 *
jp
 = (jasmš *)
j
;

1343 
jp
->
Üic
->
ýu
.
œq
 &ð~
IRQF_DISK
;

1344 
	}
}

1346 
	$jasmš_£tšŒq
Ð*
j
 )

1348 
	}
}

1350 
	$jasmš_þršŒq
Ð*
j
 )

1352 
	}
}

1354 
	$jasmš_š™
Ð
jasmš
 *
j
, 
wd17xx
 *
wd
, 
machše
 *
Üic
 )

1356 
	`wd17xx_š™
Ð
wd
 );

1357 
wd
->
£tšŒq
 = 
jasmš_£tšŒq
;

1358 
wd
->
þršŒq
 = 
jasmš_þršŒq
;

1359 
wd
->
šŒq¬g
 = (*)
j
;

1360 
wd
->
£tdrq
 = 
jasmš_£tdrq
;

1361 
wd
->
þrdrq
 = 
jasmš_þrdrq
;

1362 
wd
->
drq¬g
 = (*)
j
;

1364 
j
->
Þay
 = 0;

1365 
j
->
romdis
 = 0;

1366 
j
->
wd
 = wd;

1367 
j
->
Üic
 = oric;

1368 
	}
}

1370 
	$jasmš_ä“
Ð
jasmš
 *
j
 )

1372 
i
;

1373  
i
=0; i<
MAX_DRIVES
; i++ )

1374 
	`disk_ejeù
Ð
j
->
Üic
, 
i
 );

1375 
	}
}

1377 
	$jasmš_»ad
Ð
jasmš
 *
j
, 
addr
 )

1380 ifÐÐ
addr
 >= 0x3f4 ) && (‡ddr < 0x3f8 ) )

1381  
	`wd17xx_»ad
Ð
j
->
wd
, 
addr
&3 );

1383  
addr
 )

1386  
j
->
wd
->
c_side
 ? 1 : 0;

1396  
j
->
Þay
;

1399  
j
->
romdis
;

1403  
	`vŸ_»ad
Ð&
j
->
Üic
->
vŸ
, 
addr
 );

1407 
	}
}

1409 
	$jasmš_wr™e
Ð
jasmš
 *
j
, 
addr
, 
d©a
 )

1411 ifÐÐ
addr
 >= 0x3f4 ) && (‡ddr < 0x3f8 ) )

1413 
	`wd17xx_wr™e
Ð
j
->
Üic
, j->
wd
, 
addr
&3, 
d©a
 );

1417  
addr
 )

1420 
j
->
wd
->
c_side
 = 
d©a
&1;

1428 
j
->
Þay
 = 
d©a
&1;

1432 
j
->
romdis
 = 
d©a
&1;

1433 
j
->
Üic
->
romdis
 = (
d©a
!=0è? 
SDL_TRUE
 : 
SDL_FALSE
;

1440 
j
->
wd
->
c_drive
 = 
addr
&3;

1444 
	`vŸ_wr™e
Ð&
j
->
Üic
->
vŸ
, 
addr
, 
d©a
 );

1447 
	}
}

1450 
	$´av‘z_š™
Ð
´av‘z
 *
p
, 
machše
 *
Üic
 )

1452 
i
;

1454 
p
->
Þay
 = 0;

1455 
p
->
romdis
 = 1;

1456 
p
->
ex‹nsiÚ
 = 0;

1457 
p
->
Üic
 = oric;

1459  
i
=0; i<
MAX_DRIVES
; i++)

1461 
p
->
drv
[
i
].
wr™e_»ady
 = 0x80;

1462 
p
->
drv
[
i
].
vÞume
 = 254;

1463 
p
->
drv
[
i
].
£Ëù
 = 0;

1464 
p
->
drv
[
i
].
mÙÜ_Ú
 = 0;

1465 
p
->
drv
[
i
].
pimg
 = 
NULL
;

1467 
	}
}

1469 
	$´av‘z_ä“
Ð
´av‘z
 *
p
 )

1471 
i
;

1472  
i
=0; i<
MAX_DRIVES
; i++ )

1473 
	`disk_ejeù
Ð
p
->
Üic
, 
i
 );

1474 
	}
}

1476 
	$´av‘z_»ad
Ð
´av‘z
 *
p
, 
addr
 )

1478 
d©a
 = 0;

1479 
d©a
 = 
	`disk_´av‘z_»ad
Ð
p
->
Üic
, 
addr
 );

1480 
p
->
Üic
->
wddisk
.
cu¼’tÝ
 =…->
drv
[p->Üic->wddisk.
c_drive
].
mÙÜ_Ú
 ? 
COP_READ_SECTOR
 : 
COP_NUFFINK
;

1481  
d©a
;

1482 
	}
}

1484 
	$´av‘z_wr™e
Ð
´av‘z
 *
p
, 
addr
, 
d©a
 )

1486 
	`disk_´av‘z_wr™e
Ð
p
->
Üic
, 
addr
, 
d©a
 );

1487 
p
->
Üic
->
wddisk
.
cu¼’tÝ
 =…->
drv
[p->Üic->wddisk.
c_drive
].
mÙÜ_Ú
 ? 
COP_READ_SECTOR
 : 
COP_NUFFINK
;

1488 
	}
}

	@disk.h

23 
	#MAX_DRIVES
 4

	)

26 
	#MDSB_INTENA
 0

	)

27 
	#MDSF_INTENA
 (1<<
MDSB_INTENA
)

	)

28 
	#MDSB_ROMDIS
 1

	)

29 
	#MDSF_ROMDIS
 (1<<
MDSB_ROMDIS
)

	)

30 
	#MDSB_DENSITY
 3

	)

31 
	#MDSF_DENSITY
 (1<<
MDSB_DENSITY
)

	)

32 
	#MDSB_SIDE
 4

	)

33 
	#MDSF_SIDE
 (1<<
MDSB_SIDE
)

	)

34 
	#MDSF_DRIVE
 0x60

	)

35 
	#MDSB_EPROM
 7

36 
	#MDSF_EPROM
 (1<<
MDSB_EPROM
)

	)

37 
	#MDSB_INTRQ
 7

38 
	#MDSF_INTRQ
 (1<<
MDSB_INTRQ
)

	)

41 
	#MB_DRQ
 7

	)

42 
	#MF_DRQ
 (1<<
MB_DRQ
)

	)

47 
	#WSB_BUSY
 0

	)

48 
	#WSF_BUSY
 (1<<
WSB_BUSY
)

	)

49 
	#WSBI_PULSE
 1

	)

50 
	#WSFI_PULSE
 (1<<
WSBI_PULSE
)

51 
	#WSB_DRQ
 1

	)

52 
	#WSF_DRQ
 (1<<
WSB_DRQ
)

	)

53 
	#WSBI_TRK0
 2

	)

54 
	#WSFI_TRK0
 (1<<
WSBI_TRK0
)

55 
	#WSB_LOSTDAT
 2

	)

56 
	#WSF_LOSTDAT
 (1<<
WSB_LOSTDAT
)

	)

57 
	#WSB_CRCERR
 3

	)

58 
	#WSF_CRCERR
 (1<<
WSB_CRCERR
)

	)

59 
	#WSBI_SEEKERR
 4

	)

60 
	#WSFI_SEEKERR
 (1<<
WSBI_SEEKERR
)

61 
	#WSB_RNF
 4

	)

62 
	#WSF_RNF
 (1<<
WSB_RNF
)

	)

63 
	#WSBI_HEADL
 5

	)

64 
	#WSFI_HEADL
 (1<<
WSBI_HEADL
)

65 
	#WSBR_RECTYP
 5

	)

66 
	#WSFR_RECTYP
 (1<<
WSBR_RECTYP
)

67 
	#WSB_WRITEERR
 5

	)

68 
	#WSF_WRITEERR
 (1<<
WSB_WRITEERR
)

	)

69 
	#WSB_WRPROT
 6

	)

70 
	#WSF_WRPROT
 (1<<
WSB_WRPROT
)

	)

71 
	#WSB_NOTREADY
 7

	)

72 
	#WSF_NOTREADY
 (1<<
WSB_NOTREADY
)

	)

75 
	#PRAV_DISK_OFFSET
 0x310

	)

77 
	#PRAV_SECTORS_PER_TRACK
 16

	)

78 
	#PRAV_BYTES_PER_SECTOR
 256

	)

79 
	#PRAV_RAW_BYTES_PER_SECTOR
 374

	)

80 
	#PRAV_TRACKS_PER_DISK
 35

	)

81 
	#PRAV_RAW_TRACK_SIZE
 6200

	)

86 
	mCOP_NUFFINK
=0,

87 
	mCOP_READ_TRACK
,

88 
	mCOP_READ_SECTOR
,

89 
	mCOP_READ_SECTORS
,

90 
	mCOP_WRITE_TRACK
,

91 
	mCOP_WRITE_SECTOR
,

92 
	mCOP_WRITE_SECTORS
,

93 
	mCOP_READ_ADDRESS
,

94 #ifdeà
MICRODISC_FUDGE


95 
	mCOP_READ_SECTOR_FUDGE
,

96 
	mCOP_READ_SECTORS_FUDGE


103 
	smfm£ùÜ


105 
Ušt8
 *
	mid_±r
;

106 
Ušt8
 *
	md©a_±r
;

113 
	sdiskimage


115 
Sšt16
 
	mdriv’um
;

116 
Ušt32
 
	mnumŒacks
;

117 
Ušt32
 
	mnumsides
;

118 
Ušt32
 
	mgeom‘ry
;

119 
Sšt16
 
	mÿchedŒack
;

120 
Sšt16
 
	mÿchedside
;

121 
Ušt32
 
	mnum£ùÜs
;

122 
mfm£ùÜ
 
	m£ùÜ
[32];

123 
Ušt8
 *
	m¿wimage
;

124 
Ušt32
 
	m¿wimag–’
;

125 
SDL_boÞ
 
	mmodif›d
;

126 
Sšt32
 
	mmodif›d_time
;

127 
	mfž’ame
[4096+512];

131 
	swd17xx


133 
Ušt8
 
	mr_¡©us
;

134 
Ušt8
 
	mr_Œack
;

135 
Ušt8
 
	mr_£ùÜ
;

136 
Ušt8
 
	mr_d©a
;

137 
Ušt8
 
	mc_drive
;

138 
Ušt8
 
	mc_side
;

139 
Ušt8
 
	mc_Œack
;

140 
Ušt8
 
	mc_£ùÜ
;

141 
Ušt8
 
	m£ùy³
;

142 
SDL_boÞ
 
	mÏ¡_¡•_š
;

143 (*
	m£tšŒq
)(*);

144 (*
	mþršŒq
)(*);

145 *
	mšŒq¬g
;

146 (*
	m£tdrq
)(*);

147 (*
	mþrdrq
)(*);

148 *
	mdrq¬g
;

149 
diskimage
 *
	mdisk
[
MAX_DRIVES
];

150 
	mcu¼’tÝ
;

151 
mfm£ùÜ
 *
	mcu¼£ùÜ
;

152 
	mcu¼£þ’
;

153 
	mcu¼offs
;

154 
	md–ayedšt
;

155 
	md–ayeddrq
;

156 
	mdi¡©us
;

157 
	mdd¡©us
;

158 
Ušt16
 
	müc
;

162 
	smiüodisc


164 
Ušt8
 
	m¡©us
;

165 
Ušt8
 
	mšŒq
;

166 
Ušt8
 
	mdrq
;

167 
wd17xx
 *
	mwd
;

168 
machše
 *
	mÜic
;

169 
SDL_boÞ
 
	mdiskrom
;

174 
	sjasmš


176 
Ušt8
 
	mÞay
;

177 
Ušt8
 
	mromdis
;

178 
wd17xx
 *
	mwd
;

179 
machše
 *
	mÜic
;

183 
	s´av‘z_drive


185 
Ušt8
 
	mimage
[
PRAV_TRACKS_PER_DISK
][
PRAV_RAW_TRACK_SIZE
];

186 
Ušt8
 
	mvÞume
;

187 
Ušt8
 
	m£Ëù
;

188 
Ušt8
 
	mmÙÜ_Ú
;

189 
Ušt8
 
	mwr™e_»ady
;

190 
Ušt16
 
	mby‹
;

191 
Ušt16
 
	mh®f_Œack
;

192 
Ušt8
 *
	m£ùÜ_±r
;

193 
SDL_boÞ
 
	mdœty
;

194 
diskimage
 *
	mpimg
;

195 
SDL_boÞ
 
	m´Ù
;

198 
	s´av‘z


200 
Ušt8
 
	mÞay
;

201 
Ušt8
 
	mromdis
;

202 
Ušt16
 
	mex‹nsiÚ
;

203 
machše
 *
	mÜic
;

204 
´av‘z_drive
 
	mdrv
[
MAX_DRIVES
];

208 
SDL_boÞ
 
diskimage_lßd
Ð
machše
 *
Üic
, *
âame
, 
drive
 );

209 
SDL_boÞ
 
diskimage_§ve
Ð
machše
 *
Üic
, *
âame
, 
drive
 );

210 
diskimage_ÿch‘¿ck
Ð
diskimage
 *
dimg
, 
Œack
, 
side
 );

211 
mfm£ùÜ
 *
wd17xx_fšd_£ùÜ
Ð
wd17xx
 *
wd
, 
Ušt8
 
£cid
 );

214 
wd17xx_ticktock
Ð
wd17xx
 *
wd
, 
cyþes
 );

217 
miüodisc_š™
Ð
miüodisc
 *
md
, 
wd17xx
 *
wd
, 
machše
 *
Üic
 );

218 
miüodisc_ä“
Ð
miüodisc
 *
md
 );

219 
miüodisc_»ad
Ð
miüodisc
 *
md
, 
addr
 );

220 
miüodisc_wr™e
Ð
miüodisc
 *
md
, 
addr
, 
d©a
 );

223 
jasmš_š™
Ð
jasmš
 *
j
, 
wd17xx
 *
wd
, 
machše
 *
Üic
 );

224 
jasmš_ä“
Ð
jasmš
 *
j
 );

225 
jasmš_»ad
Ð
jasmš
 *
j
, 
addr
 );

226 
jasmš_wr™e
Ð
jasmš
 *
j
, 
addr
, 
d©a
 );

229 
´av‘z_š™
Ð
´av‘z
 *
p
, 
machše
 *
Üic
 );

230 
´av‘z_ä“
Ð
´av‘z
 *
p
 );

231 
´av‘z_»ad
Ð
´av‘z
 *
p
, 
addr
 );

232 
´av‘z_wr™e
Ð
´av‘z
 *
p
, 
addr
, 
d©a
 );

	@disk_pravetz.c

26 
	~<¡dio.h
>

27 
	~<¡dlib.h
>

28 
	~<¡ršg.h
>

30 
	~"sy¡em.h
"

31 
	~"6502.h
"

32 
	~"vŸ.h
"

33 
	~"8912.h
"

34 
	~"gui.h
"

35 
	~"disk.h
"

36 
	~"disk_´av‘z.h
"

37 
	~"mÚ™Ü.h
"

38 
	~"6551.h
"

39 
	~"machše.h
"

41 
	#GENERAL_DISK_DEBUG
 0

	)

43 #ià
GENERAL_DISK_DEBUG


44 
	gÏ¡_Œack
 = -1;

45 
	gÏ¡_£ùÜ
 = -1;

48 
Ušt8
 
disk_´av‘z_»ad_£Ëùed
(
machše
 *
Üic
);

49 
disk_´av‘z_wr™e_£Ëùed
(
machše
 *
Üic
, 
Ušt8
 
d©a
);

50 
disk_´av‘z_sw™ch
(
machše
 *
Üic
, 
Ušt16
 
addr
);

52 
Ušt8
 
	$disk_´av‘z_»ad
(
machše
 *
Üic
, 
Ušt16
 
addr
)

54 
	`disk_´av‘z_sw™ch
(
Üic
, 
addr
-
PRAV_DISK_OFFSET
);

56  (!(
addr
 & 1))? 
	`disk_´av‘z_»ad_£Ëùed
(
Üic
) : 0;

57 
	}
}

59 
	$disk_´av‘z_wr™e
(
machše
 *
Üic
, 
Ušt16
 
addr
, 
Ušt8
 
d©a
)

61 
	`disk_´av‘z_sw™ch
(
Üic
, 
addr
-
PRAV_DISK_OFFSET
);

63 if(
addr
 & 1)

65 
	`disk_´av‘z_wr™e_£Ëùed
(
Üic
, 
d©a
);

67 
	}
}

70 
	gš‹¾—ve
[16] =

76 
	gŒª¦©e
[256] =

112 
	$disk_´av‘z_upd©e_pos™iÚ
 (
´av‘z_drive
 *
drv
)

114 ià(
drv
->
mÙÜ_Ú
)

116 
drv
->
by‹
 = (1 + drv->by‹è% 
PRAV_RAW_TRACK_SIZE
;

118 
	}
}

120 
Ušt8
 
	$disk_´av‘z_image_¿w_by‹
(
machše
 *
Üic
, 
drive
, 
Ušt16
 
t_idx
, Ušt16 
s_idx
, Ušt16 
b_idx
)

122 
f_pos
;

124 
Ušt8
 
Þd
;

125 
Ušt8
 
eÜ
;

126 
Ušt8
 
¿w
;

127 
Ušt8
 
check
;

129 
´av‘z_drive
 *
drv
 = &
Üic
->
´av‘z
.drv[
drive
];

131 
¿w
 = 0xFF;

133 
b_idx
)

165 
check
 = 
drv
->
vÞume
;

166  0xAA | (
drv
->
vÞume
 >> 1);

170  0xAA | 
drv
->
vÞume
;

174 
check
 ^ð
t_idx
;

175  0xAA | (
t_idx
 >> 1);

179  0xAA | 
t_idx
;

183 
check
 ^ð
s_idx
;

184  0xAA | (
s_idx
 >> 1);

188  0xAA | 
s_idx
;

192  0xAA | (
check
 >> 1);

196  0xAA | 
check
;

215 
eÜ
 = 0;

218 
f_pos
 = (256 * 16 * 
t_idx
è+ (256 * 
š‹¾—ve
[
s_idx
]);

219 ià(
drv
->
pimg
)

220 
drv
->
£ùÜ_±r
 = &drv->
pimg
->
¿wimage
[
f_pos
];

222 
drv
->
£ùÜ_±r
 = 
NULL
;

227  
Œª¦©e
[
eÜ
 & 0x3F];

230 
b_idx
 -= 28;

232 ià(
b_idx
 >= 0x56)

235 
Þd
 = 
drv
->
£ùÜ_±r
[
b_idx
 - 0x56];

236 
Þd
 = old >> 2;

237 
eÜ
 ^ð
Þd
;

238 
¿w
 = 
Œª¦©e
[
eÜ
 & 0x3F];

239 
eÜ
 = 
Þd
;

244 
Þd
 = (
drv
->
£ùÜ_±r
[
b_idx
] & 0x01) << 1;

245 
Þd
 |ð(
drv
->
£ùÜ_±r
[
b_idx
] & 0x02) >> 1;

246 
Þd
 |ð(
drv
->
£ùÜ_±r
[
b_idx
 + 0x56] & 0x01) << 3;

247 
Þd
 |ð(
drv
->
£ùÜ_±r
[
b_idx
 + 0x56] & 0x02) << 1;

248 
Þd
 |ð(
drv
->
£ùÜ_±r
[
b_idx
 + 0xAC] & 0x01) << 5;

249 
Þd
 |ð(
drv
->
£ùÜ_±r
[
b_idx
 + 0xAC] & 0x02) << 3;

250 
eÜ
 ^ð
Þd
;

251 
¿w
 = 
Œª¦©e
[
eÜ
 & 0x3F];

252 
eÜ
 = 
Þd
;

257  
¿w
;

258 
	}
}

265 
Ušt8
 
	$disk_´av‘z_»adby‹
(
machše
 *
Üic
)

267 
´av‘z_drive
 *
drv
 = &
Üic
->
´av‘z
.drv[Üic->
wddisk
.
c_drive
];

270 ià(!
drv
->
pimg
)

273 
	`disk_´av‘z_upd©e_pos™iÚ
(
drv
);

276 #ià
GENERAL_DISK_DEBUG


277 if(
Ï¡_£ùÜ
 !ð
drv
->
by‹
 / 
PRAV_RAW_BYTES_PER_SECTOR
 || 
Ï¡_Œack
 !ðdrv->
h®f_Œack
)

279 
	`´štf
("{R} fdu: T:%.2d S:%.2X.%.3d [%.2X]\n",

280 
drv
->
h®f_Œack
 / 2,

281 
drv
->
by‹
 / 
PRAV_RAW_BYTES_PER_SECTOR
,

282 
drv
->
by‹
 % 
PRAV_RAW_BYTES_PER_SECTOR
,

283 
drv
->
image
[drv->
h®f_Œack
 / 2][drv->
by‹
]);

284 
Ï¡_£ùÜ
 = 
drv
->
by‹
 / 
PRAV_RAW_BYTES_PER_SECTOR
;

285 
Ï¡_Œack
 = 
drv
->
h®f_Œack
;

290  
drv
->
image
[drv->
h®f_Œack
 / 2][drv->
by‹
];

291 
	}
}

298 
Ušt8
 
	$disk_´av‘z_»ad_£Ëùed
(
machše
 *
Üic
)

300 
´av‘z_drive
 *
drv
 = &
Üic
->
´av‘z
.drv[Üic->
wddisk
.
c_drive
];

302 ià(!
drv
->
wr™e_»ady
)

304 
drv
->
wr™e_»ady
 = 0x80;

307 
drv
->
£Ëù
)

310  
	`disk_´av‘z_»adby‹
(
Üic
);

313  
drv
->
´Ù
 | drv->
mÙÜ_Ú
;

316  
drv
->
wr™e_»ady
;

320 
	}
}

322 
Ušt8
 
	g‹mp_£ùÜ_bufãr
[
PRAV_BYTES_PER_SECTOR
 + 2];

324 
	$disk_´av‘z_wr™e_image
(
´av‘z_drive
 *
d_±r
)

326 
Ušt8
 
eÜ
;

327 
Ušt8
 
s_idx
;

329 
£ùÜ_£¬ch_couÁ
;

331 
t_idx
;

332 
b_idx
;

333 
tb_idx
;

334 
£ùÜ_couÁ
, 
f_pos
;

336 ià(!
d_±r
)

339 ià(!
d_±r
->
dœty
)

342 
tb_idx
 = 0;

343 
t_idx
 = 0;_idx < 
PRAV_TRACKS_PER_DISK
;_idx++)

345 
£ùÜ_couÁ
 = 16;

347 
fšd_£ùÜ
:

351 
£ùÜ_£¬ch_couÁ
 = 0;

352 0xD5 !ð
d_±r
->
image
[
t_idx
][
tb_idx
])

354 
tb_idx
 = (tb_idx + 1è% 
PRAV_RAW_TRACK_SIZE
;

355 ià(++
£ùÜ_£¬ch_couÁ
 > 
PRAV_RAW_TRACK_SIZE
) ;

358 
tb_idx
 = (tb_idx + 1è% 
PRAV_RAW_TRACK_SIZE
;

359 ià(0xAA !ð
d_±r
->
image
[
t_idx
][
tb_idx
])

361 
tb_idx
 = (tb_idx + 1è% 
PRAV_RAW_TRACK_SIZE
;

362 
fšd_£ùÜ
;

365 
tb_idx
 = (tb_idx + 1è% 
PRAV_RAW_TRACK_SIZE
;

366 ià(0x96 !ð
d_±r
->
image
[
t_idx
][
tb_idx
])

368 
tb_idx
 = (tb_idx + 1è% 
PRAV_RAW_TRACK_SIZE
;

369 
fšd_£ùÜ
;

375 
tb_idx
 = (tb_idx + 5è% 
PRAV_RAW_TRACK_SIZE
;

378 
s_idx
 = 0x55 | (
d_±r
->
image
[
t_idx
][
tb_idx
] << 1);

379 
tb_idx
 = (tb_idx + 1è% 
PRAV_RAW_TRACK_SIZE
;

380 
s_idx
 &ð
d_±r
->
image
[
t_idx
][
tb_idx
];

381 
tb_idx
 = (tb_idx + 1è% 
PRAV_RAW_TRACK_SIZE
;

385 0xD5 !ð
d_±r
->
image
[
t_idx
][
tb_idx
])

386 
tb_idx
 = (tb_idx + 1è% 
PRAV_RAW_TRACK_SIZE
;

388 
tb_idx
 = (tb_idx + 1è% 
PRAV_RAW_TRACK_SIZE
;

389 ià(0xAA !ð
d_±r
->
image
[
t_idx
][
tb_idx
])

391 
tb_idx
 = (tb_idx + 1è% 
PRAV_RAW_TRACK_SIZE
;

392 
fšd_£ùÜ
;

395 
tb_idx
 = (tb_idx + 1è% 
PRAV_RAW_TRACK_SIZE
;

396 ià(0xAD !ð
d_±r
->
image
[
t_idx
][
tb_idx
])

398 
tb_idx
 = (tb_idx + 1è% 
PRAV_RAW_TRACK_SIZE
;

399 
fšd_£ùÜ
;

404 
tb_idx
 = (tb_idx + 1è% 
PRAV_RAW_TRACK_SIZE
;

405 
eÜ
 = 0;

407 
b_idx
 = 0; b_idx < 342; b_idx++)

409 
eÜ
 ^ð
Œª¦©e
[
d_±r
->
image
[
t_idx
][
tb_idx
]];

410 
tb_idx
 = (tb_idx + 1è% 
PRAV_RAW_TRACK_SIZE
;

412 ià(
b_idx
 >= 0x56)

415 
‹mp_£ùÜ_bufãr
[
b_idx
 - 0x56] |ð(
eÜ
 << 2);

420 
‹mp_£ùÜ_bufãr
[
b_idx
] = (
eÜ
 & 0x01) << 1;

421 
‹mp_£ùÜ_bufãr
[
b_idx
] |ð(
eÜ
 & 0x02) >> 1;

422 
‹mp_£ùÜ_bufãr
[
b_idx
 + 0x56] = (
eÜ
 & 0x04) >> 1;

423 
‹mp_£ùÜ_bufãr
[
b_idx
 + 0x56] |ð(
eÜ
 & 0x08) >> 3;

424 
‹mp_£ùÜ_bufãr
[
b_idx
 + 0xAC] = (
eÜ
 & 0x10) >> 3;

425 
‹mp_£ùÜ_bufãr
[
b_idx
 + 0xAC] |ð(
eÜ
 & 0x20) >> 5;

430 
f_pos
 = (
PRAV_BYTES_PER_SECTOR
 * 
PRAV_SECTORS_PER_TRACK
 * 
t_idx
) +

431 (
PRAV_BYTES_PER_SECTOR
 * 
š‹¾—ve
[
s_idx
]);

433 
	`memýy
(&
d_±r
->
pimg
->
¿wimage
[
f_pos
], 
‹mp_£ùÜ_bufãr
, 
PRAV_BYTES_PER_SECTOR
);

434 
d_±r
->
pimg
->
modif›d
 = 
SDL_TRUE
;

435 
d_±r
->
pimg
->
modif›d_time
 = 0;

436 
£ùÜ_couÁ
--;

438 ià(
£ùÜ_couÁ
)

439 
fšd_£ùÜ
;

442 
d_±r
->
dœty
 = 
SDL_FALSE
;

443 
	}
}

449 
	$disk_´av‘z_wr™eby‹
(
machše
 *
Üic
, 
Ušt8
 
w_by‹
)

451 
´av‘z_drive
 *
drv
 = &
Üic
->
´av‘z
.drv[Üic->
wddisk
.
c_drive
];

452 
	`disk_´av‘z_upd©e_pos™iÚ
(
drv
);

455 ià(!
drv
->
pimg
)

458 ià(
drv
->
´Ù
)

462 ià(
w_by‹
 < 0x96)

465 
drv
->
dœty
 = 
SDL_TRUE
;

466 
drv
->
image
[drv->
h®f_Œack
 / 2][drv->
by‹
] = 
w_by‹
;

469 #ià
GENERAL_DISK_DEBUG


470 if(
Ï¡_£ùÜ
 !ð
drv
->
by‹
 / 
PRAV_RAW_BYTES_PER_SECTOR
 || 
Ï¡_Œack
 !ðdrv->
h®f_Œack
)

472 
	`´štf
("{W} fdu: T:%.2d S:%.2X.%.3d [%.2X]\n",

473 
drv
->
h®f_Œack
 / 2,

474 
drv
->
by‹
 / 
PRAV_RAW_BYTES_PER_SECTOR
,

475 
drv
->
by‹
 % 
PRAV_RAW_BYTES_PER_SECTOR
,

476 
w_by‹
);

477 
Ï¡_£ùÜ
 = 
drv
->
by‹
 / 
PRAV_RAW_BYTES_PER_SECTOR
;

478 
Ï¡_Œack
 = 
drv
->
h®f_Œack
;

482 
	}
}

489 
	$disk_´av‘z_wr™e_£Ëùed
(
machše
 *
Üic
, 
Ušt8
 
w_by‹
)

491 
´av‘z_drive
 *
drv
 = &
Üic
->
´av‘z
.drv[Üic->
wddisk
.
c_drive
];

493 ià(3 =ð
drv
->
£Ëù
)

495 ià(
drv
->
mÙÜ_Ú
)

497 ià(
drv
->
wr™e_»ady
)

499 
	`disk_´av‘z_wr™eby‹
(
Üic
, 
w_by‹
);

500 
drv
->
wr™e_»ady
 = 0;

504 
	}
}

506 
	$disk_´av‘z_sw™ch
 (
machše
 *
Üic
, 
Ušt16
 
addr
)

508 
´av‘z_drive
 *
drv
 = &
Üic
->
´av‘z
.drv[Üic->
wddisk
.
c_drive
];

510 
addr
 & 0xF)

513 
drv
->
mÙÜ_Ú
 = 0;

514 
	`disk_´av‘z_wr™e_image
(
drv
);

518 
drv
->
mÙÜ_Ú
 = 0x20;

524 ià(
Üic
->
wddisk
.
c_drive
 !ð(
addr
&1))

526 
	`disk_´av‘z_wr™e_image
(
drv
);

527 
Üic
->
wddisk
.
c_drive
 = 
addr
&1;

532 
drv
->
£Ëù
 &= 0xFE;

536 
drv
->
£Ëù
 |= 0x01;

540 
drv
->
£Ëù
 &= 0xFD;

544 
drv
->
£Ëù
 |= 0x02;

549 
pha£
 = (
addr
 & 0x06) >> 1;

552 ià(
addr
 & 0x01)

554 
pha£
 += 4;

555 
pha£
 -ð(
drv
->
h®f_Œack
 % 4);

556 
pha£
 %= 4;

558 ià(1 =ð
pha£
)

560 ià(
drv
->
h®f_Œack
 < (2 * 
PRAV_TRACKS_PER_DISK
 - 2))

562 
drv
->
h®f_Œack
++;

565 ià(3 =ð
pha£
)

567 ià(
drv
->
h®f_Œack
 > 0)

569 
drv
->
h®f_Œack
--;

576 
	}
}

	@disk_pravetz.h

26 #iâdeà
__disk_´av‘z_h__


27 
	#__disk_´av‘z_h__


	)

29 
Ušt8
 
disk_´av‘z_»ad
(
machše
 *
Üic
, 
Ušt16
 
addr
);

30 
disk_´av‘z_wr™e
(
machše
 *
Üic
, 
Ušt16
 
addr
, 
Ušt8
 
d©a
);

31 
Ušt8
 
disk_´av‘z_image_¿w_by‹
(
machše
 *
Üic
, 
drive
, 
Ušt16
 
t_idx
, Ušt16 
s_idx
, Ušt16 
b_idx
);

32 
disk_´av‘z_wr™e_image
(
´av‘z_drive
 *
d_±r
);

	@filereq.h

24 
	mFR_DISKLOAD
=0,

25 
	mFR_DISKSAVE
,

26 
	mFR_TAPELOAD
,

27 
	mFR_TAPESAVETAP
,

28 
	mFR_TAPESAVEORT
,

29 
	mFR_ROMS
,

30 
	mFR_SNAPSHOTLOAD
,

31 
	mFR_SNAPSHOTSAVE
,

32 
	mFR_KEYMAPPINGLOAD
,

33 
	mFR_KEYMAPPINGSAVE
,

34 
	mFR_OTHER


37 
SDL_boÞ
 
š™_fž”eque¡”
Ð
machše
 *
Üic
 );

38 
shut_fž”eque¡”
Ð
machše
 *
Üic
 );

39 
SDL_boÞ
 
fž”eque¡”
Ð
machše
 *
Üic
, *
t™Ë
, *
·th
, *
âame
, 
ty³
 );

	@filereq_amiga.c

22 
	#__USE_INLINE__


	)

24 
	~<¡dlib.h
>

25 
	~<uni¡d.h
>

27 
	~<´Ùo/exec.h
>

28 
	~<´Ùo/dos.h
>

29 
	~<´Ùo/a¦.h
>

31 
	~"sy¡em.h
"

32 
	~"6502.h
"

33 
	~"vŸ.h
"

34 
	~"8912.h
"

35 
	~"disk.h
"

36 
	~"gui.h
"

37 
	~"mÚ™Ü.h
"

38 
	~"6551.h
"

39 
	~"machše.h
"

40 
	~"fž”eq.h
"

42 
Lib¿ry
 *
	gA¦Ba£
 = 
NULL
;

43 
FžeReque¡”
 *
	g»q
 = 
NULL
;

45 #ifdeà
__amigaos4__


46 
A¦IFaû
 *
	gIA¦
 = 
NULL
;

49 
SDL_boÞ
 
	$š™_fž”eque¡”
Ð
machše
 *
Üic
 )

51 
A¦Ba£
 = 
	`O³nLib¿ry
Ð(
CONST_STRPTR
)
A¦Name
, 39 );

52 ifÐ!
A¦Ba£
 )  
SDL_FALSE
;

54 #ifdeà
__amigaos4__


55 
IA¦
 = (
A¦IFaû
 *)
	`G‘IÁ”çû
Ð
A¦Ba£
, "maš", 1, 
NULL
 );

56 ifÐ!
IA¦
 )  
SDL_FALSE
;

59 
»q
 = (
FžeReque¡”
 *)
	`AÎocA¦Reque¡Tags
Ð
ASL_FžeReque¡
, 
TAG_DONE
 );

60 ifÐ!
»q
 )  
SDL_FALSE
;

62  
SDL_TRUE
;

63 
	}
}

65 
	$shut_fž”eque¡”
Ð
machše
 *
Üic
 )

67 ifÐ
»q
 ) 
	`F»eA¦Reque¡
(„eq );

68 #ifdeà
__amigaos4__


69 ifÐ
IA¦
 ) 
	`DrÝIÁ”çû
Ð(
IÁ”çû
 *)IAsl );

71 ifÐ
A¦Ba£
 ) 
	`Clo£Lib¿ry
( AslBase );

72 
	}
}

74 
SDL_boÞ
 
	$fž”eque¡”
Ð
machše
 *
Üic
, *
t™Ë
, *
·th
, *
âame
, 
ty³
 )

76 *
·t
, 
µ©
[16*2+2];

77 
BOOL
 
do§vemode
 = 
FALSE
;

79  
ty³
 )

81 
FR_DISKSAVE
:

82 
do§vemode
 = 
TRUE
;

83 
FR_DISKLOAD
:

84 
·t
 = "#?.dsk";

87 
FR_TAPESAVETAP
:

88 
do§vemode
 = 
TRUE
;

89 
·t
 = "#?.tap";

92 
FR_TAPESAVEORT
:

93 
do§vemode
 = 
TRUE
;

94 
·t
 = "#?.ort";

97 
FR_TAPELOAD
:

98 
·t
 = "#?.(tap|ort|wav)";

101 
FR_ROMS
:

102 
·t
 = "#?.rom";

105 
FR_SNAPSHOTSAVE
:

106 
do§vemode
 = 
TRUE
;

107 
FR_SNAPSHOTLOAD
:

108 
·t
 = "#?.sna";

111 
FR_KEYMAPPINGSAVE
:

112 
do§vemode
 = 
TRUE
;

113 
FR_KEYMAPPINGLOAD
:

114 
·t
 = "#?.kma";

118 
·t
 = 
NULL
;

122 ifÐ
·t
 ) 
	`P¬£P©‹ºNoCa£
Ð(
CONST_STRPTR
í©, (
UBYTE
 *)
µ©
, 16*2+2 );

124 ifÐ!
	`A¦Reque¡Tags
Ð
»q
,

125 
ASLFR_T™ËText
, 
t™Ë
,

126 
ASLFR_In™ŸlD¿w”
, 
·th
,

127 
ASLFR_In™ŸlFže
, 
âame
,

128 
ASLFR_DoP©‹ºs
, 
·t
 !ð
NULL
,

129 
ASLFR_RejeùIcÚs
, 
TRUE
,

130 
ASLFR_DoSaveMode
, 
do§vemode
,

131 
·t
 ? 
ASLFR_Acû±P©‹º
 : 
TAG_IGNORE
, 
µ©
,

132 
·t
 ? 
ASLFR_In™ŸlP©‹º
 : 
TAG_IGNORE
,…at,

133 
TAG_DONE
 ) )

134  
SDL_FALSE
;

136 
	`¡ºýy
Ð
·th
, (cÚ¡ *)
»q
->
ä_D¿w”
, 4096 );…ath[4095] = 0;

137 
	`¡ºýy
Ð
âame
, (cÚ¡ *)
»q
->
ä_Fže
, 512 ); fname[511] = 0;

139  
SDL_TRUE
;

140 
	}
}

	@filereq_beos.cpp

22 
	~<¡dio.h
>

23 
	~<¡dlib.h
>

24 
	~<¡ršg.h
>

25 
	~<uni¡d.h
>

27 
	~<FžePª–.h
>

28 
	~<LoÝ”.h
>

29 
	~<Mes£ng”.h
>

30 
	~<P©h.h
>

33 
	~"sy¡em.h
"

34 
	~"6502.h
"

35 
	~"vŸ.h
"

36 
	~"8912.h
"

37 
	~"disk.h
"

38 
	~"gui.h
"

39 
	~"mÚ™Ü.h
"

40 
	~"6551.h
"

41 
	~"machše.h
"

42 
	~"fž”eq.h
"

46 þas 
	cPª–LoÝ”
 : 
public
 
BLoÝ”
 {

47 
public
:

48 
Pª–LoÝ”
();

49 
vœtu®
 ~
Pª–LoÝ”
();

50 
vœtu®
 
Mes§geReûived
(
BMes§ge
* 
mes§ge
);

52 
Wa™
();

53 
SDL_boÞ
 
	$DoIt
(ècÚ¡ {  
fDoIt
; };

54 
	$G‘Ref
(
’Œy_»f
 &
»f
ècÚ¡ {„eàð
fRef
; 
	}
};

56 
´iv©e
:

57 
£m_id
 
fSem
;

58 
’Œy_»f
 
fRef
;

59 
SDL_boÞ
 
fDoIt
;

63 
	gPª–LoÝ”
::
	$Pª–LoÝ”
()

64 : 
	`BLoÝ”
("PanelLooper"),

65 
	$fDoIt
(
SDL_FALSE
)

67 
fSem
 = 
	`ü—‹_£m
(0, "PanelLooper†ock");

68 
	}
}

71 
	gPª–LoÝ”
::~
	$Pª–LoÝ”
()

73 
	`d–‘e_£m
(
fSem
);

74 
	}
}

78 
	gPª–LoÝ”
::
	$Mes§geReûived
(
BMes§ge
* 
mes§ge
)

81 
mes§ge
->
wh©
) {

82 
B_SAVE_REQUESTED
:

83 
mes§ge
->
	`FšdRef
("»fs", &
fRef
);

84 
fDoIt
 = 
SDL_TRUE
;

86 
B_REFS_RECEIVED
:

87 
mes§ge
->
	`FšdRef
("»fs", &
fRef
);

88 
fDoIt
 = 
SDL_TRUE
;

90 
B_CANCEL
:

94 
	`»Ëa£_£m
(
fSem
);

95 
	}
}

99 
	gPª–LoÝ”
::
	$Wa™
()

101 
	`acquœe_£m
(
fSem
);

102 
	}
}

105 
SDL_boÞ
 
	$š™_fž”eque¡”
Ð
machše
 *
Üic
 )

107  
SDL_TRUE
;

108 
	}
}

110 
	$shut_fž”eque¡”
Ð
machše
 *
Üic
 )

112 
	}
}

114 
SDL_boÞ
 
	$fž”eque¡”
Ð
machše
 *
Üic
, *
t™Ë
, *
·th
, *
âame
, 
ty³
 )

116 
BFžePª–
 *
·Ãl
;

117 
Pª–LoÝ”
 *
loÝ”
 = 
Ãw
 
	`Pª–LoÝ”
();

118 
loÝ”
->
	`Run
();

119 
SDL_boÞ
 
»t
;

121 *
·t
;

122 
boÞ
 
do§vemode
 = 
çl£
;

124  
ty³
 )

126 
FR_DISKSAVE
:

127 
do§vemode
 = 
Œue
;

128 
FR_DISKLOAD
:

129 
·t
 = "*.dsk";

133 
FR_TAPESAVETAP
:

134 
FR_TAPESAVEORT
:

135 
do§vemode
 = 
Œue
;

136 
FR_TAPELOAD
:

137 
·t
 = "*.tap";

140 
FR_ROMS
:

141 
·t
 = "*.rom";

144 
FR_SNAPSHOTSAVE
:

145 
do§vemode
 = 
Œue
;

146 
FR_SNAPSHOTLOAD
:

147 
·t
 = "*.sna";

150 
FR_KEYMAPPINGSAVE
:

151 
do§vemode
 = 
Œue
;

152 
FR_KEYMAPPINGLOAD
:

153 
·t
 = "*.kma";

157 
·t
 = 
NULL
;

163 
·Ãl
 = 
Ãw
 
	`BFžePª–
(
do§vemode
 ? 
B_SAVE_PANEL
 : 
B_OPEN_PANEL
);

164 
·Ãl
->
	`S‘T¬g‘
(
	`BMes£ng”
(
loÝ”
));

166 ià(
·th
)

167 
·Ãl
->
	`S‘Pª–DœeùÜy
(
·th
);

169 
·Ãl
->
	`Show
();

171 
loÝ”
->
	`Wa™
();

172 
»t
 = 
loÝ”
->
	`DoIt
();

173 
’Œy_»f
 
»f
;

174 
loÝ”
->
	`G‘Ref
(
»f
);

176 
d–‘e
 
·Ãl
;

177 
loÝ”
->
	`Lock
();

178 
loÝ”
->
	`Qu™
();

180 ià(
»t
) {

181 
BP©h
 
	`p
(&
»f
);

182 
	`¡ºýy
Ð
âame
, 
p
.
	`L—f
(), 512 ); 
·th
[511] = 0;

183 
p
.
	`G‘P¬’t
(&p);

184 
	`¡ºýy
Ð
·th
, 
p
.
	`P©h
(), 4096 );…ath[4095] = 0;

187  
»t
;

188 
	}
}

	@filereq_gtk.c

22 
	~<¡dlib.h
>

23 
	~<¡dio.h
>

24 
	~<¡ršg.h
>

25 
	~<uni¡d.h
>

26 
	~<dœ’t.h
>

27 
	~<sys/¡©.h
>

29 
	~<gtk/gtk.h
>

31 
	~"sy¡em.h
"

32 
	~"6502.h
"

33 
	~"vŸ.h
"

34 
	~"8912.h
"

35 
	~"gui.h
"

36 
	~"disk.h
"

37 
	~"mÚ™Ü.h
"

38 
	~"6551.h
"

39 
	~"machše.h
"

40 
	~"fž”eq.h
"

42 
SDL_boÞ
 
fuÎsü“n
;

43 
toggËfuÎsü“n
Ð
machše
 *
Üic
, 
osdm’u™em
 *
m™em
, 
dummy
 );

45 
SDL_boÞ
 
	$š™_fž”eque¡”
Ð
machše
 *
Üic
 )

47 
	`gtk_š™
(0, 
NULL
);

48  
SDL_TRUE
;

49 
	}
}

51 
	$shut_fž”eque¡”
Ð
machše
 *
Üic
 )

53 
	}
}

61 
SDL_boÞ
 
	$fž”eque¡”
Ð
machše
 *
Üic
, *
t™Ë
, *
·th
, *
âame
, 
ty³
 )

63 
GtkWidg‘
 *
dŸlog
;

64 
SDL_boÞ
 
»suÉ
 = 
SDL_FALSE
;

65 
GtkFžeChoo£rAùiÚ
 
aùiÚ
 = 
GTK_FILE_CHOOSER_ACTION_OPEN
;

66 
GtkFžeFž‹r
 *
fž‹r
 = 
NULL
, *
®lfž‹r
 = 
	`gtk_fže_fž‹r_Ãw
();

67 
SDL_boÞ
 
was_fuÎsü“n
 = 
fuÎsü“n
;

69 ià(
fuÎsü“n
)

70 
	`toggËfuÎsü“n
(
Üic
, 
NULL
, 0);

72 
	`gtk_fže_fž‹r_£t_Çme
(
®lfž‹r
, "All files");

73 
	`gtk_fže_fž‹r_add_·‰”n
(
®lfž‹r
, "*");

75  
ty³
 )

77 
FR_DISKSAVE
:

78 
aùiÚ
 = 
GTK_FILE_CHOOSER_ACTION_SAVE
;

79 
FR_DISKLOAD
:

80 
fž‹r
 = 
	`gtk_fže_fž‹r_Ãw
();

81 
	`gtk_fže_fž‹r_£t_Çme
(
fž‹r
, "Disk images");

82 
	`gtk_fže_fž‹r_add_·‰”n
(
fž‹r
, "*.[Dd][Ss][Kk]");

85 
FR_TAPESAVETAP
:

86 
aùiÚ
 = 
GTK_FILE_CHOOSER_ACTION_SAVE
;

87 
fž‹r
 = 
	`gtk_fže_fž‹r_Ãw
();

88 
	`gtk_fže_fž‹r_£t_Çme
(
fž‹r
, ".tap files");

89 
	`gtk_fže_fž‹r_add_·‰”n
(
fž‹r
, "*.[Tt][Aa][Pp]");

92 
FR_TAPESAVEORT
:

93 
aùiÚ
 = 
GTK_FILE_CHOOSER_ACTION_SAVE
;

94 
fž‹r
 = 
	`gtk_fže_fž‹r_Ãw
();

95 
	`gtk_fže_fž‹r_£t_Çme
(
fž‹r
, ".ort files");

96 
	`gtk_fže_fž‹r_add_·‰”n
(
fž‹r
, "*.[Oo][Rr][Tt]");

99 
FR_TAPELOAD
:

100 
fž‹r
 = 
	`gtk_fže_fž‹r_Ãw
();

101 
	`gtk_fže_fž‹r_£t_Çme
(
fž‹r
, "Tape images");

102 
	`gtk_fže_fž‹r_add_·‰”n
(
fž‹r
, "*.[Tt][Aa][Pp]");

103 
	`gtk_fže_fž‹r_add_·‰”n
(
fž‹r
, "*.[Ww][Aa][Vv]");

104 
	`gtk_fže_fž‹r_add_·‰”n
(
fž‹r
, "*.[Oo][Rr][Tt]");

107 
FR_ROMS
:

108 
fž‹r
 = 
	`gtk_fže_fž‹r_Ãw
();

109 
	`gtk_fže_fž‹r_£t_Çme
(
fž‹r
, "ROM images");

110 
	`gtk_fže_fž‹r_add_·‰”n
(
fž‹r
, "*.[Rr][Oo][Mm]");

113 
FR_SNAPSHOTSAVE
:

114 
aùiÚ
 = 
GTK_FILE_CHOOSER_ACTION_SAVE
;

115 
FR_SNAPSHOTLOAD
:

116 
fž‹r
 = 
	`gtk_fže_fž‹r_Ãw
();

117 
	`gtk_fže_fž‹r_£t_Çme
(
fž‹r
, "Snapshot files");

118 
	`gtk_fže_fž‹r_add_·‰”n
(
fž‹r
, "*.[Ss][Nn][Aa]");

121 
FR_KEYMAPPINGSAVE
:

122 
aùiÚ
 = 
GTK_FILE_CHOOSER_ACTION_SAVE
;

123 
FR_KEYMAPPINGLOAD
:

124 
fž‹r
 = 
	`gtk_fže_fž‹r_Ãw
();

125 
	`gtk_fže_fž‹r_£t_Çme
(
fž‹r
, "Keyboard Mapping files");

126 
	`gtk_fže_fž‹r_add_·‰”n
(
fž‹r
, "*.[Kk][Mm][Aa]");

133 
dŸlog
 = 
	`gtk_fže_choo£r_dŸlog_Ãw
(
t™Ë
,

134 
NULL
,

135 
aùiÚ
,

136 #ià
GTK_MAJOR_VERSION
 <= 2

137 
GTK_STOCK_CANCEL
, 
GTK_RESPONSE_CANCEL
,

138 
GTK_STOCK_OPEN
, 
GTK_RESPONSE_ACCEPT
,

140 "_Cªûl", 
GTK_RESPONSE_CANCEL
,

141 "_O³n", 
GTK_RESPONSE_ACCEPT
,

143 
NULL
);

145 
	`gtk_fže_choo£r_£t_cu¼’t_fÞd”
(
	`GTK_FILE_CHOOSER
(
dŸlog
), 
·th
);

146 ià(
aùiÚ
 =ð
GTK_FILE_CHOOSER_ACTION_SAVE
)

147 
	`gtk_fže_choo£r_£t_cu¼’t_Çme
(
	`GTK_FILE_CHOOSER
(
dŸlog
), 
âame
);

149 ià(
fž‹r
)

150 
	`gtk_fže_choo£r_add_fž‹r
(
	`GTK_FILE_CHOOSER
(
dŸlog
), 
fž‹r
);

151 
	`gtk_fže_choo£r_add_fž‹r
(
	`GTK_FILE_CHOOSER
(
dŸlog
), 
®lfž‹r
);

153 ià(
	`gtk_dŸlog_run
(
	`GTK_DIALOG
 (
dŸlog
)è=ð
GTK_RESPONSE_ACCEPT
)

155 *
fž’ame
;

156 
i
;

157 
fž’ame
 = 
	`gtk_fže_choo£r_g‘_fž’ame
 (
	`GTK_FILE_CHOOSER
 (
dŸlog
));

158 
	`¡ºýy
Ð
·th
, 
fž’ame
, 4096 );…ath[4095] = 0;

159 
i
 = 
	`¡¾’
(
·th
)-1;

160 
i
 >= 0)

162 ià(
·th
[
i
] =ð
PATHSEP
) ;

163 
i
--;

165 
	`¡ºýy
Ð
âame
, &
·th
[
i
+1], 512 ); fname[511] = 0;

166 
·th
[
i
+1] = 0;

167 
	`g_ä“
(
fž’ame
);

168 
»suÉ
 = 
SDL_TRUE
;

171 
	`gtk_widg‘_de¡roy
(
dŸlog
);

172 
	`gtk_ev’ts_³ndšg
())

173 
	`gtk_maš_™”©iÚ
();

175 ià(
was_fuÎsü“n
)

176 
	`toggËfuÎsü“n
(
Üic
, 
NULL
, 0);

178  
»suÉ
;

179 
	}
}

	@filereq_sdl.c

22 
	~<¡dlib.h
>

23 
	~<¡dio.h
>

24 
	~<¡ršg.h
>

25 #iâdeà
_MSC_VER


26 
	~<dœ’t.h
>

28 
	~<sys/¡©.h
>

30 
	~"sy¡em.h
"

31 
	~"6502.h
"

32 
	~"vŸ.h
"

33 
	~"8912.h
"

34 
	~"gui.h
"

35 
	~"disk.h
"

36 
	~"mÚ™Ü.h
"

37 
	~"6551.h
"

38 
	~"machše.h
"

39 
	~"fž”eq.h
"

42 
SDL_Surçû
 *
sü“n
;

43 
‹xtzÚe
 *
tz
[
NUM_TZ
];

46 
	säq_’t


48 
	mÇme
[512];

49 
	mshowÇme
[40];

50 
SDL_boÞ
 
	misdœ
;

54 
	säq_‹xtbox


56 *
	mbuf
;

57 
	mx
, 
	my
, 
	mw
;

58 
	mmaxËn
, 
	m¦’
, 
	mýos
, 
	mvpos
;

62 
äq_‹xtbox
 
	gäeqf_tbox
[] = { { 
NULL
, 7, 28, 32, 4096, 0, 0, 0 },

63 { 
NULL
, 7, 30, 32, 512, 0, 0, 0 } };

66 
	gäeqf_size
=0, 
	gäeqf_u£d
=0, 
	gäeqf_cgad
=2;

67 
äq_’t
 *
	gäeqfžes
=
NULL
;

68 
	gäeqf_þicktime
=0;

70 
SDL_boÞ
 
	$š™_fž”eque¡”
Ð
machše
 *
Üic
 )

72 ifÐ!
	`®loc_‹xtzÚe
Ð
Üic
, 
TZ_FILEREQ
, 160, 48, 40, 32, "Fžes" ) )  
SDL_FALSE
;

74  
SDL_TRUE
;

75 
	}
}

77 
	$shut_fž”eque¡”
Ð
machše
 *
Üic
 )

79 
	`ä“_‹xtzÚe
Ð
Üic
, 
TZ_FILEREQ
 );

80 
	}
}

83 
	$fž”eq_»nd”
Ð
machše
 *
Üic
 )

85 
Üic
->
	`»nd”_begš
( oric );

87 
Üic
->
	`»nd”_video
ÐÜic, 
SDL_TRUE
 );

88 
Üic
->
	`»nd”_‹xtzÚe
ÐÜic, 
TZ_FILEREQ
 );

90 
Üic
->
	`»nd”_’d
( oric );

91 
	}
}

94 
	$fž”eq_add’t
Ð
SDL_boÞ
 
isdœ
, *
Çme
, *
showÇme
 )

96 
äq_’t
 *
tmpf
;

97 
i
, 
j
;

100 ifÐÐ!
äeqfžes
 ) || ( 
äeqf_u£d
 >ð
äeqf_size
 ) )

103 
tmpf
 = (
äq_’t
 *)
	`»®loc
Ð
äeqfžes
, Ðäq_’ˆè* (
äeqf_size
+8) );

104 ifÐ!
tmpf
 ) ;

106 
äeqfžes
 = 
tmpf
;

107 
äeqf_size
 += 8;

111 
j
 = 0;

112 ifÐ
äeqf_u£d
 > 0 )

114 ifÐ
isdœ
 )

116  
j
=1; j<
äeqf_u£d
; j++ )

118 ifÐ
	`¡rÿ£cmp
Ð
Çme
, 
äeqfžes
[
j
].name ) <= 0 ) ;

119 ifÐ!
äeqfžes
[
j
].
isdœ
 ) ;

122  
j
=1; j<
äeqf_u£d
; j++ )

123 ifÐ!
äeqfžes
[
j
].
isdœ
 ) ;

125  ; 
j
<
äeqf_u£d
; j++ )

126 ifÐ
	`¡rÿ£cmp
Ð
Çme
, 
äeqfžes
[
j
].name ) <= 0 ) ;

130 ifÐ
j
 < 
äeqf_u£d
 )

132  
i
=
äeqf_u£d
; i>
j
; i-- )

133 
äeqfžes
[
i
] = freqfiles[i-1];

138 
äeqfžes
[
j
].
isdœ
 = isdir;

139 
	`¡ºýy
Ð
äeqfžes
[
j
].
Çme
,‚ame, 512 );

140 
	`¡ºýy
Ð
äeqfžes
[
j
].
showÇme
, showname, 38 );

141 
äeqfžes
[
j
].
Çme
[511] = 0;

142 
äeqfžes
[
j
].
showÇme
[37] = 0;

145 
äeqf_u£d
++;

146 
	}
}

149 
SDL_boÞ
 
	$fž”eq_sÿn
Ð*
·th
 )

151 
DIR
 *
dh
;

152 
dœ’t
 *
de
;

153 
¡©
 
sb
;

154 *
odœ
, *
©h
;

156 
©h
 = 
·th
;

157 #iâdeà
__amigaos4__


158 ifÐ!
·th
[0] )

159 
©h
 = ".";

162 
äeqf_u£d
 = 0;

164 
dh
 = 
	`Ý’dœ
Ð
©h
 );

165 ifÐ!
dh
 )  
SDL_FALSE
;

167 
odœ
 = 
	`g‘cwd
Ð
NULL
, 0 );

168 
	`chdœ
Ð
©h
 );

170 
	`fž”eq_add’t
Ð
SDL_TRUE
, "", "[Parent]" );

172  ( 
de
 = 
	`»addœ
Ð
dh
 ) ) )

174 ifÐÐ
	`¡rcmp
Ð
de
->
d_Çme
, "." ) == 0 ) ||

175 Ð
	`¡rcmp
Ð
de
->
d_Çme
, ".." ) == 0 ) )

177 
	`¡©
Ð
de
->
d_Çme
, &
sb
 );

178 
	`fž”eq_add’t
Ð
	`S_ISDIR
(
sb
.
¡_mode
), 
de
->
d_Çme
, de->d_name );

181 
	`þo£dœ
Ð
dh
 );

183 
	`chdœ
Ð
odœ
 );

184 
	`ä“
Ð
odœ
 );

185  
SDL_TRUE
;

186 
	}
}

189 
	$fž”eq_showfžes
Ð
off£t
, 
cfže
 )

191 
i
, 
j
, 
o
;

194 ifÐ
äeqf_cgad
 != 2 )

195 
cfže
 = -1;

197  
i
=0; i<26; i++ )

200 ifÐ(
i
+
off£t
è< 
äeqf_u£d
 )

201 
	`tz£tcÞ
Ð
tz
[
TZ_FILEREQ
], 
äeqfžes
[
i
+
off£t
].
isdœ
 ? 1 : 0, (i+off£t)==
cfže
 ? 7 : 6 );

203 
	`tz£tcÞ
Ð
tz
[
TZ_FILEREQ
], 0, 6 );

206 
o
 = (
i
+1)*
tz
[
TZ_FILEREQ
]->
w
+1;

207  
j
=0; j<38; j++, 
o
++ )

209 
tz
[
TZ_FILEREQ
]->
fc
[
o
] =z[TZ_FILEREQ]->
cfc
;

210 
tz
[
TZ_FILEREQ
]->
bc
[
o
] =z[TZ_FILEREQ]->
cbc
;

211 
tz
[
TZ_FILEREQ
]->
tx
[
o
] = 32;

214 ifÐ(
i
+
off£t
è>ð
äeqf_u£d
 )

218 
	`tz¡½os
Ð
tz
[
TZ_FILEREQ
], 1, 
i
+1, 
äeqfžes
[i+
off£t
].
showÇme
 );

220 
	}
}

223 
	$fž”eq_£‰box
Ð
äq_‹xtbox
 *
tb
, *
buf
 )

226 
tb
->
buf
 = buf;

227 
tb
->
¦’
 = 
	`¡¾’
Ð
buf
 );

230 
tb
->
ýos
 =b->
¦’
;

231 
tb
->
vpos
 =b->
¦’
 > (tb->
w
-1) ?b->slen-(tb->w-1) : 0;

232 
	}
}

235 
	$fž”eq_d¿wtbox
Ð
äq_‹xtbox
 *
tb
, 
SDL_boÞ
 
aùive
 )

237 
i
, 
j
, 
o
;

239 
	`tz£tcÞ
Ð
tz
[
TZ_FILEREQ
], 0, 
aùive
 ? 7 : 6 );

240 
o
 = (
tb
->
y
*
tz
[
TZ_FILEREQ
]->
w
)+tb->
x
;

241  
i
=0,
j
=
tb
->
vpos
; i<tb->
w
; i++, 
o
++, j++ )

243 ifÐÐ
aùive
 ) && ( 
j
==
tb
->
ýos
 ) )

245 
tz
[
TZ_FILEREQ
]->
fc
[
o
] =z[TZ_FILEREQ]->
cbc
;

246 
tz
[
TZ_FILEREQ
]->
bc
[
o
] =z[TZ_FILEREQ]->
cfc
;

248 
tz
[
TZ_FILEREQ
]->
fc
[
o
] =z[TZ_FILEREQ]->
cfc
;

249 
tz
[
TZ_FILEREQ
]->
bc
[
o
] =z[TZ_FILEREQ]->
cbc
;

251 ifÐ
j
 < 
tb
->
¦’
 )

252 
tz
[
TZ_FILEREQ
]->
tx
[
o
] = 
tb
->
buf
[
j
];

254 
tz
[
TZ_FILEREQ
]->
tx
[
o
] = 32;

256 
	}
}

260 
	$fž”eq_£tfž‘box
Ð
cfže
, *
âame
 )

262 ifÐÐ
cfže
 < 0 ) || ( cfž>ð
äeqf_u£d
 ) ||

263 Ð
äeqfžes
[
cfže
].
isdœ
 ) )

265 
âame
[0] = 0;

266 
äeqf_tbox
[1].
ýos
=0;

267 
äeqf_tbox
[1].
vpos
=0;

268 
äeqf_tbox
[1].
¦’
=0;

272 
	`¡ºýy
Ð
âame
, 
äeqfžes
[
cfže
].
Çme
, 512 );

273 
âame
[511] = 0;

274 
	`fž”eq_£‰box
Ð&
äeqf_tbox
[1], 
âame
 );

275 
	}
}

279 
	mACTION_NONE
 = 0,

280 
	mACTION_SELECTITEM
,

281 
	mACTION_PAGEUP
,

282 
	mACTION_PAGEDOWN


291 
SDL_boÞ
 
	$fž”eque¡”
Ð
machše
 *
Üic
, *
t™Ë
, *
·th
, *
âame
, 
ty³
 )

293 
SDL_Ev’t
 
ev’t
;

294 
äq_‹xtbox
 *
tb
;

295 
tÝ
=0,
cfže
=0,
i
,
mx
,
my
,
mþick
;

296 
SDL_boÞ
 
shiáy
 = 
SDL_FALSE
, 
wasunicode
;

297 
dßùiÚ
;

299 
wasunicode
 = 
	`SDL_COMPAT_EÇbËUNICODE
Ð
SDL_TRUE
 );

300 
	`SDL_COMPAT_EÇbËKeyR•—t
Ð
SDL_DEFAULT_REPEAT_DELAY
, 
SDL_DEFAULT_REPEAT_INTERVAL
 );

302 
	`fž”eq_£‰box
Ð&
äeqf_tbox
[0], 
·th
 );

303 
	`fž”eq_£‰box
Ð&
äeqf_tbox
[1], 
âame
 );

305 
	`tz£‰™Ë
Ð
tz
[
TZ_FILEREQ
], 
t™Ë
 );

306 
	`tz£tcÞ
Ð
tz
[
TZ_FILEREQ
], 2, 3 );

307 
	`tz¡½os
Ð
tz
[
TZ_FILEREQ
], 1, 28, "Path:" );

308 
	`tz¡½os
Ð
tz
[
TZ_FILEREQ
], 1, 30, "File:" );

310 ifÐ!
	`fž”eq_sÿn
Ð
·th
 ) )

312 ifÐ
·th
[0] )

314 
·th
[0] = 0;

315 
	`fž”eq_£‰box
Ð&
äeqf_tbox
[0], 
·th
 );

316 ifÐ!
	`fž”eq_sÿn
Ð
·th
 ) )

318 
	`SDL_COMPAT_EÇbËUNICODE
Ð
wasunicode
 );

319 
	`SDL_COMPAT_EÇbËKeyR•—t
Ð
wasunicode
 ? 
SDL_DEFAULT_REPEAT_DELAY
 : 0, wasunicod? 
SDL_DEFAULT_REPEAT_INTERVAL
 : 0 );

320  
SDL_FALSE
;

323 
	`SDL_COMPAT_EÇbËUNICODE
Ð
wasunicode
 );

324 
	`SDL_COMPAT_EÇbËKeyR•—t
Ð
wasunicode
 ? 
SDL_DEFAULT_REPEAT_DELAY
 : 0, wasunicod? 
SDL_DEFAULT_REPEAT_INTERVAL
 : 0 );

325  
SDL_FALSE
;

328 
	`fž”eq_showfžes
Ð
tÝ
, 
cfže
 );

329 
	`fž”eq_d¿wtbox
Ð&
äeqf_tbox
[0], 
äeqf_cgad
==0 );

330 
	`fž”eq_d¿wtbox
Ð&
äeqf_tbox
[1], 
äeqf_cgad
==1 );

331 
	`fž”eq_»nd”
Ð
Üic
 );

335 ifÐ!
	`SDL_Wa™Ev’t
Ð&
ev’t
 ) )

337 
	`SDL_COMPAT_EÇbËUNICODE
Ð
wasunicode
 );

338 
	`SDL_COMPAT_EÇbËKeyR•—t
Ð
wasunicode
 ? 
SDL_DEFAULT_REPEAT_DELAY
 : 0, wasunicod? 
SDL_DEFAULT_REPEAT_INTERVAL
 : 0 );

339  
SDL_FALSE
;

342 
mx
 = -1;

343 
my
 = -1;

344 
mþick
 = 0;

345 
dßùiÚ
 = 
ACTION_NONE
;

346  
ev’t
.
ty³
 )

348 
SDL_MOUSEMOTION
:

349 
mx
 = (
ev’t
.
mÙiÚ
.
x
 - 
tz
[
TZ_FILEREQ
]->x)/8;

350 
my
 = (
ev’t
.
mÙiÚ
.
y
 - 
tz
[
TZ_FILEREQ
]->y)/12;

353 
SDL_MOUSEBUTTONDOWN
:

354 ifÐ
ev’t
.
bu‰Ú
.bu‰Ú =ð
SDL_BUTTON_LEFT
 )

356 
mx
 = (
ev’t
.
bu‰Ú
.
x
 - 
tz
[
TZ_FILEREQ
]->x)/8;

357 
my
 = (
ev’t
.
bu‰Ú
.
y
 - 
tz
[
TZ_FILEREQ
]->y)/12;

358 
mþick
 = 
	`SDL_G‘Ticks
();

363  
ev’t
.
ty³
 )

365 
SDL_COMPAT_ACTIVEEVENT
:

366 if(
	`SDL_COMPAT_IsAµFocu£d
Ð&
ev’t
 ) ) {

367 
	`fž”eq_»nd”
Ð
Üic
 );

371 
SDL_MOUSEBUTTONDOWN
:

372 ifÐÐ
mx
 < 1 ) || ( mx > 38 ) )

375 ifÐÐ
my
 == 28 ) || ( my == 30 ) )

377 
äeqf_cgad
 = (
my
-28)/2;

378 
	`fž”eq_showfžes
Ð
tÝ
, 
cfže
 );

379 
	`fž”eq_d¿wtbox
Ð&
äeqf_tbox
[0], 
äeqf_cgad
==0 );

380 
	`fž”eq_d¿wtbox
Ð&
äeqf_tbox
[1], 
äeqf_cgad
==1 );

381 
	`fž”eq_»nd”
Ð
Üic
 );

385 ifÐÐ
my
 < 1 ) || ( my > 26 ) )

388 
äeqf_cgad
 = 2;

390 
i
 = (
my
-1)-
tÝ
;

391 ifÐ
i
 >ð
äeqf_u£d
 ) i = freqf_used-1;

393 ifÐ
cfže
 !ð
i
 )

395 
cfže
 = 
i
;

396 
	`fž”eq_£tfž‘box
Ð
cfže
, 
âame
 );

397 
	`fž”eq_showfžes
Ð
tÝ
, 
cfže
 );

398 
	`fž”eq_d¿wtbox
Ð&
äeqf_tbox
[1], 0 );

399 
	`fž”eq_»nd”
Ð
Üic
 );

400 
äeqf_þicktime
 = 
mþick
;

404 ifÐÐ
äeqf_þicktime
 == 0 ) ||

405 Ð(
mþick
-
äeqf_þicktime
) >= 2000 ) )

407 
äeqf_þicktime
 = 
mþick
;

411 
äeqf_þicktime
 = 0;

412 
dßùiÚ
 = 
ACTION_SELECTITEM
;

415 
SDL_KEYUP
:

416  
ev’t
.
key
.
keysym
.
sym
 )

418 
SDLK_LSHIFT
:

419 
SDLK_RSHIFT
:

420 
shiáy
 = 
SDL_FALSE
;

423 
SDLK_ESCAPE
:

424 
	`SDL_COMPAT_EÇbËUNICODE
Ð
wasunicode
 );

425 
	`SDL_COMPAT_EÇbËKeyR•—t
Ð
wasunicode
 ? 
SDL_DEFAULT_REPEAT_DELAY
 : 0, wasunicod? 
SDL_DEFAULT_REPEAT_INTERVAL
 : 0 );

426  
SDL_FALSE
;

428 
SDLK_RETURN
:

429 
SDLK_KP_ENTER
:

430  
äeqf_cgad
 )

433 
cfže
 = 
tÝ
 = 0;

434 ifÐ!
	`fž”eq_sÿn
Ð
·th
 ) )

436 ifÐ
·th
[0] )

438 
·th
[0] = 0;

439 
	`fž”eq_£‰box
Ð&
äeqf_tbox
[0], 
·th
 );

440 ifÐ!
	`fž”eq_sÿn
Ð
·th
 ) )

442 
	`SDL_COMPAT_EÇbËUNICODE
Ð
wasunicode
 );

443 
	`SDL_COMPAT_EÇbËKeyR•—t
Ð
wasunicode
 ? 
SDL_DEFAULT_REPEAT_DELAY
 : 0, wasunicod? 
SDL_DEFAULT_REPEAT_INTERVAL
 : 0 );

444  
SDL_FALSE
;

447 
	`SDL_COMPAT_EÇbËUNICODE
Ð
wasunicode
 );

448 
	`SDL_COMPAT_EÇbËKeyR•—t
Ð
wasunicode
 ? 
SDL_DEFAULT_REPEAT_DELAY
 : 0, wasunicod? 
SDL_DEFAULT_REPEAT_INTERVAL
 : 0 );

449  
SDL_FALSE
;

452 
	`fž”eq_showfžes
Ð
tÝ
, 
cfže
 );

453 
	`fž”eq_d¿wtbox
Ð&
äeqf_tbox
[0], 
äeqf_cgad
==0 );

454 
	`fž”eq_d¿wtbox
Ð&
äeqf_tbox
[1], 
äeqf_cgad
==1 );

455 
	`fž”eq_»nd”
Ð
Üic
 );

459 
	`SDL_COMPAT_EÇbËUNICODE
Ð
wasunicode
 );

460 
	`SDL_COMPAT_EÇbËKeyR•—t
Ð
wasunicode
 ? 
SDL_DEFAULT_REPEAT_DELAY
 : 0, wasunicod? 
SDL_DEFAULT_REPEAT_INTERVAL
 : 0 );

461  
SDL_TRUE
;

464 
dßùiÚ
 = 
ACTION_SELECTITEM
;

474 
SDL_KEYDOWN
:

475  
ev’t
.
key
.
keysym
.
sym
 )

477 
SDLK_LSHIFT
:

478 
SDLK_RSHIFT
:

479 
shiáy
 = 
SDL_TRUE
;

482 
SDLK_TAB
:

483 ifÐ
shiáy
 )

484 
äeqf_cgad
 = (freqf_cgad+2)%3;

486 
äeqf_cgad
 = (freqf_cgad+1)%3;

487 
	`fž”eq_showfžes
Ð
tÝ
, 
cfže
 );

488 
	`fž”eq_d¿wtbox
Ð&
äeqf_tbox
[0], 
äeqf_cgad
==0 );

489 
	`fž”eq_d¿wtbox
Ð&
äeqf_tbox
[1], 
äeqf_cgad
==1 );

490 
	`fž”eq_»nd”
Ð
Üic
 );

493 
SDLK_UP
:

494 ifÐ
äeqf_cgad
 != 2 )

496 
äeqf_cgad
 = 2;

497 
	`fž”eq_showfžes
Ð
tÝ
, 
cfže
 );

498 
	`fž”eq_d¿wtbox
Ð&
äeqf_tbox
[0], 
äeqf_cgad
==0 );

499 
	`fž”eq_d¿wtbox
Ð&
äeqf_tbox
[1], 
äeqf_cgad
==1 );

500 
	`fž”eq_»nd”
Ð
Üic
 );

504 ifÐ
cfže
 <= 0 ) ;

505 ifÐ
shiáy
 )

507 
dßùiÚ
 = 
ACTION_PAGEUP
;

510 
cfže
--;

511 ifÐ
cfže
 < 
tÝ
 )op = cfile;

512 
	`fž”eq_£tfž‘box
Ð
cfže
, 
âame
 );

513 
	`fž”eq_showfžes
Ð
tÝ
, 
cfže
 );

514 
	`fž”eq_d¿wtbox
Ð&
äeqf_tbox
[1], 
SDL_FALSE
 );

515 
	`fž”eq_»nd”
Ð
Üic
 );

518 
SDLK_DOWN
:

519 ifÐ
äeqf_cgad
 != 2 )

521 
äeqf_cgad
 = 2;

522 
	`fž”eq_showfžes
Ð
tÝ
, 
cfže
 );

523 
	`fž”eq_d¿wtbox
Ð&
äeqf_tbox
[0], 
äeqf_cgad
==0 );

524 
	`fž”eq_d¿wtbox
Ð&
äeqf_tbox
[1], 
äeqf_cgad
==1 );

525 
	`fž”eq_»nd”
Ð
Üic
 );

529 ifÐ
cfže
 >ð(
äeqf_u£d
-1) ) ;

530 ifÐ
shiáy
 )

532 
dßùiÚ
 = 
ACTION_PAGEDOWN
;

535 
cfže
++;

536 ifÐ
cfže
 > (
tÝ
+25) )op = cfile-25;

537 
	`fž”eq_£tfž‘box
Ð
cfže
, 
âame
 );

538 
	`fž”eq_showfžes
Ð
tÝ
, 
cfže
 );

539 
	`fž”eq_d¿wtbox
Ð&
äeqf_tbox
[1], 
SDL_FALSE
 );

540 
	`fž”eq_»nd”
Ð
Üic
 );

543 
SDLK_PAGEUP
:

544 ifÐ
äeqf_cgad
 != 2 )

546 
äeqf_cgad
 = 2;

547 
	`fž”eq_showfžes
Ð
tÝ
, 
cfže
 );

548 
	`fž”eq_d¿wtbox
Ð&
äeqf_tbox
[0], 
äeqf_cgad
==0 );

549 
	`fž”eq_d¿wtbox
Ð&
äeqf_tbox
[1], 
äeqf_cgad
==1 );

550 
	`fž”eq_»nd”
Ð
Üic
 );

554 
dßùiÚ
 = 
ACTION_PAGEUP
;

557 
SDLK_PAGEDOWN
:

558 ifÐ
äeqf_cgad
 != 2 )

560 
äeqf_cgad
 = 2;

561 
	`fž”eq_showfžes
Ð
tÝ
, 
cfže
 );

562 
	`fž”eq_d¿wtbox
Ð&
äeqf_tbox
[0], 
äeqf_cgad
==0 );

563 
	`fž”eq_d¿wtbox
Ð&
äeqf_tbox
[1], 
äeqf_cgad
==1 );

564 
	`fž”eq_»nd”
Ð
Üic
 );

568 
dßùiÚ
 = 
ACTION_PAGEDOWN
;

571 
SDLK_BACKSPACE
:

572 ifÐ
äeqf_cgad
 == 2 ) ;

573 
tb
 = &
äeqf_tbox
[
äeqf_cgad
];

574 ifÐ
tb
->
ýos
 < 1 ) ;

575  
i
=
tb
->
ýos
-1; i<tb->
¦’
; i++ )

576 
tb
->
buf
[
i
] =b->buf[i+1];

577 
tb
->
¦’
--;

578 ifÐ
tb
->
¦’
 < 0 )

580 
tb
->
¦’
 = 0;

581 
tb
->
ýos
 = 0;

584 
SDLK_LEFT
:

585 ifÐ
äeqf_cgad
 == 2 ) ;

586 
tb
 = &
äeqf_tbox
[
äeqf_cgad
];

587 ifÐ
tb
->
ýos
 > 0 )b->cpos--;

588 ifÐ
tb
->
ýos
 <b->
vpos
 )b->vpos =b->cpos;

589 ifÐ
tb
->
ýos
 >ðÑb->
vpos
+tb->
w
) )b->vpos =b->cpos-(tb->w-1);

590 ifÐ
tb
->
vpos
 < 0 )b->vpos = 0;

591 
	`fž”eq_d¿wtbox
Ð
tb
, 
SDL_TRUE
 );

592 
	`fž”eq_»nd”
Ð
Üic
 );

595 
SDLK_RIGHT
:

596 ifÐ
äeqf_cgad
 == 2 ) ;

597 
tb
 = &
äeqf_tbox
[
äeqf_cgad
];

598 ifÐ
tb
->
ýos
 <b->
¦’
 )b->cpos++;

599 ifÐ
tb
->
ýos
 <b->
vpos
 )b->vpos =b->cpos;

600 ifÐ
tb
->
ýos
 >ðÑb->
vpos
+tb->
w
) )b->vpos =b->cpos-(tb->w-1);

601 ifÐ
tb
->
vpos
 < 0 )b->vpos = 0;

602 
	`fž”eq_d¿wtbox
Ð
tb
, 
SDL_TRUE
 );

603 
	`fž”eq_»nd”
Ð
Üic
 );

606 
SDLK_DELETE
:

607 ifÐ
äeqf_cgad
 == 2 ) ;

608 
tb
 = &
äeqf_tbox
[
äeqf_cgad
];

609 ifÐ
tb
->
ýos
 >ðtb->
¦’
 ) ;

610  
i
=
tb
->
ýos
; i<tb->
¦’
; i++ )

611 
tb
->
buf
[
i
] =b->buf[i+1];

612 
tb
->
¦’
--;

613 ifÐ
tb
->
¦’
 < 0 )

615 
tb
->
¦’
 = 0;

616 
tb
->
ýos
 = 0;

618 
	`fž”eq_d¿wtbox
Ð
tb
, 
SDL_TRUE
 );

619 
	`fž”eq_»nd”
Ð
Üic
 );

626  
	`SDL_COMPAT_G‘KeysymUnicode
Ð
ev’t
.
key
.
keysym
 ) )

629 ifÐ
äeqf_cgad
 == 2 ) ;

631 ifÐÐ
	`SDL_COMPAT_G‘KeysymUnicode
Ð
ev’t
.
key
.
keysym
 ) > 31 ) && ( SDL_COMPAT_GetKeysymUnicode(ƒvent.key.keysym ) < 127 ) )

633 
tb
 = &
äeqf_tbox
[
äeqf_cgad
];

634 ifÐ
tb
->
¦’
 >ðÑb->
maxËn
-1) ) ;

635  
i
=
tb
->
¦’
; i>ñb->
ýos
; i-- )

636 
tb
->
buf
[
i
] =b->buf[i-1];

637 
tb
->
buf
[tb->
ýos
] = 
	`SDL_COMPAT_G‘KeysymUnicode
Ð
ev’t
.
key
.
keysym
 );

638 
tb
->
¦’
++;

639 
tb
->
ýos
++;

640 
tb
->
buf
[tb->
ýos
] = 0;

641 ifÐ
tb
->
ýos
 <b->
vpos
 )b->vpos =b->cpos;

642 ifÐ
tb
->
ýos
 >ðÑb->
vpos
+tb->
w
) )b->vpos =b->cpos-(tb->w-1);

643 ifÐ
tb
->
vpos
 < 0 )b->vpos = 0;

644 
	`fž”eq_d¿wtbox
Ð
tb
, 
SDL_TRUE
 );

645 
	`fž”eq_»nd”
Ð
Üic
 );

651 
SDL_QUIT
:

652 
	`£‹mumode
Ð
Üic
, 
NULL
, 
EM_PLEASEQUIT
 );

653  
SDL_FALSE
;

659  
dßùiÚ
 )

661 
ACTION_PAGEUP
:

662 ifÐ
cfže
 > 
tÝ
 )

664 
cfže
 = 
tÝ
;

666 
tÝ
 -= 25;

667 ifÐ
tÝ
 < 0 )op = 0;

668 
cfže
 = 
tÝ
;

670 
	`fž”eq_showfžes
Ð
tÝ
, 
cfže
 );

671 
	`fž”eq_d¿wtbox
Ð&
äeqf_tbox
[0], 
äeqf_cgad
==0 );

672 
	`fž”eq_d¿wtbox
Ð&
äeqf_tbox
[1], 
äeqf_cgad
==1 );

673 
	`fž”eq_»nd”
Ð
Üic
 );

676 
ACTION_PAGEDOWN
:

677 ifÐ
cfže
 < (
tÝ
+25) )

679 
cfže
 = 
tÝ
+25;

681 
cfže
 += 25;

683 ifÐ
cfže
 > (
äeqf_u£d
-1) ) cfile = freqf_used-1;

684 
tÝ
 = 
cfže
-25;

685 ifÐ
tÝ
 < 0 )op = 0;

686 
	`fž”eq_showfžes
Ð
tÝ
, 
cfže
 );

687 
	`fž”eq_d¿wtbox
Ð&
äeqf_tbox
[0], 
äeqf_cgad
==0 );

688 
	`fž”eq_d¿wtbox
Ð&
äeqf_tbox
[1], 
äeqf_cgad
==1 );

689 
	`fž”eq_»nd”
Ð
Üic
 );

692 
ACTION_SELECTITEM
:

693 ifÐ
äeqf_u£d
 <= 0 ) ;

694 ifÐ
cfže
<=0 )

696 
i
 = 
	`¡¾’
Ð
·th
 )-1;

697 ifÐ
i
<=0 ) ;

698 ifÐ
·th
[
i
] =ð
PATHSEP
 ) i--;

699  
i
 > -1 )

701 ifÐ
·th
[
i
] =ð
PATHSEP
 ) ;

702 
i
--;

704 ifÐ
i
==-1 ) i++;

705 
·th
[
i
] = 0;

706 } ifÐ
äeqfžes
[
cfže
].
isdœ
 ) {

707 
i
 = 
	`¡¾’
Ð
·th
 )-1;

708 ifÐ
i
 < 0 )

710 
i
++;

712 ifÐ
·th
[
i
] !ð
PATHSEP
 )

713 
i
++;

715 ifÐ
i
 > 0 ) 
·th
[i++] = 
PATHSEP
;

716 
	`¡ºýy
Ð&
·th
[
i
], 
äeqfžes
[
cfže
].
Çme
, 4096-i );

717 
·th
[4095] = 0;

719 
	`SDL_COMPAT_EÇbËUNICODE
Ð
wasunicode
 );

720 
	`SDL_COMPAT_EÇbËKeyR•—t
Ð
wasunicode
 ? 
SDL_DEFAULT_REPEAT_DELAY
 : 0, wasunicod? 
SDL_DEFAULT_REPEAT_INTERVAL
 : 0 );

721  
SDL_TRUE
;

723 
cfže
 = 
tÝ
 = 0;

724 
	`fž”eq_£‰box
Ð&
äeqf_tbox
[0], 
·th
 );

725 ifÐ!
	`fž”eq_sÿn
Ð
·th
 ) )

727 ifÐ
·th
[0] )

729 
·th
[0] = 0;

730 
	`fž”eq_£‰box
Ð&
äeqf_tbox
[0], 
·th
 );

731 ifÐ!
	`fž”eq_sÿn
Ð
·th
 ) )

733 
	`SDL_COMPAT_EÇbËUNICODE
Ð
wasunicode
 );

734 
	`SDL_COMPAT_EÇbËKeyR•—t
Ð
wasunicode
 ? 
SDL_DEFAULT_REPEAT_DELAY
 : 0, wasunicod? 
SDL_DEFAULT_REPEAT_INTERVAL
 : 0 );

735  
SDL_FALSE
;

738 
	`SDL_COMPAT_EÇbËUNICODE
Ð
wasunicode
 );

739 
	`SDL_COMPAT_EÇbËKeyR•—t
Ð
wasunicode
 ? 
SDL_DEFAULT_REPEAT_DELAY
 : 0, wasunicod? 
SDL_DEFAULT_REPEAT_INTERVAL
 : 0 );

740  
SDL_FALSE
;

743 
	`fž”eq_showfžes
Ð
tÝ
, 
cfže
 );

744 
	`fž”eq_d¿wtbox
Ð&
äeqf_tbox
[0], 
äeqf_cgad
==0 );

745 
	`fž”eq_d¿wtbox
Ð&
äeqf_tbox
[1], 
äeqf_cgad
==1 );

746 
	`fž”eq_»nd”
Ð
Üic
 );

751 
	`SDL_COMPAT_EÇbËUNICODE
Ð
wasunicode
 );

752 
	`SDL_COMPAT_EÇbËKeyR•—t
Ð
wasunicode
 ? 
SDL_DEFAULT_REPEAT_DELAY
 : 0, wasunicod? 
SDL_DEFAULT_REPEAT_INTERVAL
 : 0 );

753  
SDL_FALSE
;

754 
	}
}

	@filereq_win32.c

22 
	~<¡dio.h
>

23 
	~<¡dlib.h
>

24 
	~<wšdows.h
>

26 
	#WANT_WMINFO


	)

28 
	~"sy¡em.h
"

29 
	~"6502.h
"

30 
	~"vŸ.h
"

31 
	~"8912.h
"

32 
	~"disk.h
"

33 
	~"gui.h
"

34 
	~"mÚ™Ü.h
"

35 
	~"6551.h
"

36 
	~"machše.h
"

37 
	~"fž”eq.h
"

39 
SDL_boÞ
 
	$š™_fž”eque¡”
Ð
machše
 *
Üic
 )

41  
SDL_TRUE
;

42 
	}
}

44 
	$shut_fž”eque¡”
Ð
machše
 *
Üic
 )

46 
	}
}

48 
SDL_boÞ
 
	$fž”eque¡”
Ð
machše
 *
Üic
, *
t™Ë
, *
·th
, *
âame
, 
ty³
 )

50 
SDL_SysWMšfo
 
wmi
;

51 
OPENFILENAME
 
oâ
;

52 
HWND
 
hwnd
;

53 
tmp
[4096];

54 
i
;

55 *
odœ
;

57 
	`¡rýy
Ð
tmp
, 
âame
 );

59 
hwnd
 = 
NULL
;

60 
	`SDL_VERSION
(&
wmi
.
v”siÚ
);

61 ià(
	`SDL_COMPAT_G‘WMInfo
(&
wmi
))

62 #ià
SDL_MAJOR_VERSION
 == 1

63 
hwnd
 = (
HWND
)
wmi
.
wšdow
;

65 
hwnd
 = (
HWND
)
wmi
.
šfo
.
wš
.
wšdow
;

68 
	`Z”oMemÜy
Ð&
oâ
, ( ofn ) );

69 
oâ
.
lSŒuùSize
 = ( ofn );

70 
oâ
.
hwndOwÃr
 = 
hwnd
;

71 
oâ
.
Í¡rFže
 = 
âame
;

72 
oâ
.
nMaxFže
 = 4096;

74 
oâ
.
FÏgs
 = 
OFN_PATHMUSTEXIST
 | 
OFN_FILEMUSTEXIST
;

75  
ty³
 )

77 
FR_DISKSAVE
:

78 
oâ
.
FÏgs
 = 
OFN_PATHMUSTEXIST
;

79 
FR_DISKLOAD
:

80 
oâ
.
Í¡rFž‹r
 = "All Files\0*.*\0Disk Images (*.dsk)\0*.DSK\0";

81 
oâ
.
nFž‹rIndex
 = 2;

84 
FR_TAPESAVETAP
:

85 
oâ
.
FÏgs
 = 
OFN_PATHMUSTEXIST
;

86 
oâ
.
Í¡rFž‹r
 = "All Files\0*.*\0Tape Images (*.tap)\0*.TAP\0";

87 
oâ
.
nFž‹rIndex
 = 2;

90 
FR_TAPESAVEORT
:

91 
oâ
.
FÏgs
 = 
OFN_PATHMUSTEXIST
;

92 
oâ
.
Í¡rFž‹r
 = "All Files\0*.*\0Raw Tape Images (*.ort)\0*.ORT\0";

93 
oâ
.
nFž‹rIndex
 = 2;

96 
FR_TAPELOAD
:

97 
oâ
.
Í¡rFž‹r
 = "All Files\0*.*\0Tape Images (*.tap, *.ort, *.wav)\0*.TAP;*.ORT;*.WAV\0";

98 
oâ
.
nFž‹rIndex
 = 2;

101 
FR_ROMS
:

102 
oâ
.
Í¡rFž‹r
 = "All Files\0*.*\0Rom Images (*.rom)\0*.ROM\0";

103 
oâ
.
nFž‹rIndex
 = 2;

106 
FR_SNAPSHOTSAVE
:

107 
oâ
.
FÏgs
 = 
OFN_PATHMUSTEXIST
;

108 
FR_SNAPSHOTLOAD
:

109 
oâ
.
Í¡rFž‹r
 = "All Files\0*.*\0Snapshot files (*.sna)\0*.SNA\0";

110 
oâ
.
nFž‹rIndex
 = 2;

113 
FR_KEYMAPPINGSAVE
:

114 
oâ
.
FÏgs
 = 
OFN_PATHMUSTEXIST
;

115 
FR_KEYMAPPINGLOAD
:

116 
oâ
.
Í¡rFž‹r
 = "All Files\0*.*\0Keyboard Mapping files (*.kma)\0*.KMA\0";

117 
oâ
.
nFž‹rIndex
 = 2;

121 
oâ
.
Í¡rFž‹r
 = "All Files\0*.*";

122 
oâ
.
nFž‹rIndex
 = 1;

126 
oâ
.
Í¡rFžeT™Ë
 = 
NULL
;

127 
oâ
.
nMaxFžeT™Ë
 = 0;

128 
oâ
.
Í¡rIn™ŸlDœ
 = 
·th
;

130 
odœ
 = 
	`g‘cwd
Ð
NULL
, 0 );

132  
ty³
 )

134 
FR_SNAPSHOTSAVE
:

135 
FR_DISKSAVE
:

136 ifÐ!
	`G‘SaveFžeName
Ð&
oâ
 ) )

138 
	`chdœ
Ð
odœ
 );

139 
	`ä“
Ð
odœ
 );

140  
SDL_FALSE
;

145 ifÐ!
	`G‘O³nFžeName
Ð&
oâ
 ) )

147 
	`chdœ
Ð
odœ
 );

148 
	`ä“
Ð
odœ
 );

149  
SDL_FALSE
;

154 
	`chdœ
Ð
odœ
 );

155 
	`ä“
Ð
odœ
 );

157 
i
 = 
	`¡¾’
Ð
oâ
.
Í¡rFže
 );

158 ifÐ!
i
 )  
SDL_FALSE
;

160 
i
--;

161  
oâ
.
Í¡rFže
[
i
] !ð
PATHSEP
 )

163 ifÐ
i
 == 0 ) ;

164 
i
--;

167 ifÐÐ
oâ
.
Í¡rFže
[
i
] =ð
PATHSEP
 ) && ( i < (
	`¡¾’
(ofn.lpstrFile)-1) ) )

169 
oâ
.
Í¡rFže
[
i
] = 0;

170 
	`¡rýy
Ð
·th
, 
oâ
.
Í¡rFže
 );

171 
	`¡ºýy
Ð
âame
, &
oâ
.
Í¡rFže
[
i
+1], 512 );

172 
âame
[511] = 0;

174 
·th
[0] = 0;

175 
	`¡ºýy
Ð
âame
, 
oâ
.
Í¡rFže
, 512 );

176 
âame
[511] = 0;

179  
SDL_TRUE
;

180 
	}
}

	@font.c

22 
	gthefÚt
[] = { 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,

	@gui.c

28 
	~<¡dlib.h
>

29 
	~<¡ršg.h
>

30 
	~<¡d¬g.h
>

31 
	~<¡dio.h
>

32 
	~<sys/¡©.h
>

34 #ifdeà
__amigaos4__


35 
	~<´Ùo/dos.h
>

38 #ià
defšed
(
__MORPHOS__
è|| defšed(
__AROS__
)

39 
	~<´Ùo/exec.h
>

40 
	~<´Ùo/Ý’u¾.h
>

44 
	~"sy¡em.h
"

45 
	~"6502.h
"

46 
	~"vŸ.h
"

47 
	~"8912.h
"

48 
	~"gui.h
"

49 
	~"disk.h
"

50 
	~"mÚ™Ü.h
"

51 
	~"6551.h
"

52 
	~"machše.h
"

53 
	~"fž”eq.h
"

54 
	~"»nd”_sw.h
"

55 
	~"»nd”_sw8.h
"

56 
	~"»nd”_gl.h
"

57 
	~"»nd”_nuÎ.h
"

58 
	~"uÏ.h
"

59 
	~"³.h
"

60 
	~"joy¡ick.h
"

61 
	~"¢­shÙ.h
"

62 
	~"msgbox.h
"

63 
	~"keybßrd.h
"

65 
	~"¶ugšs/ch376/ch376.h
"

66 
	~"¶ugšs/ch376/Üic_ch376_¶ugš.h
"

68 
SDL_boÞ
 
fuÎsü“n
;

70 
	g³·th
[4096], 
	g³fže
[512];

71 
	gdisk·th
[4096], 
	gdiskfže
[512];

72 
	g‹Ëdisk·th
[4096], 
	g‹Ëdiskfže
[512];

73 
	g´avdisk·th
[4096], 
	g´avdiskfže
[512];

74 
©mo¤omfže
[];

75 
Üic1romfže
[];

76 
mdisüomfže
[];

77 
jasmÄomfže
[];

78 
´av‘zromfže
[2][1024];

79 
‹Ëbªkfžes
[8][1024];

80 
	g¢­·th
[4096], 
	g¢­fže
[512];

81 
	gm­pšg·th
[4096], 
	gm­pšgfže
[512];

82 
	gfž‘mp
[4096+512+4];

84 
SDL_boÞ
 
	g»äesh¡©us
 = 
SDL_TRUE
, 
	g»äeshdisks
 = SDL_TRUE, 
	g»äeshavi
 = SDL_TRUE, 
	g»äesh³
 = SDL_TRUE,

85 
	g»äeshkeybßrd
 = 
SDL_TRUE
;

86 
avi_hªdË
 *
vidÿp
;

88 
SDL_boÞ
 
Ãed_sdl_qu™
;

89 
SDL_AudioS³c
 
obšed
;

90 
Ušt32
 
cyþe¥”§m¶e
;

93 
	#GIMG_W_DISK
 18

	)

94 
	#GIMG_W_TAPE
 20

	)

95 
	#GIMG_W_AVIR
 16

	)

98 
guiimg
 
	ggimgs
[
NUM_GIMG
] = {

99 { 
IMAGEPREFIX
"disk_ejeùed.bmp", 
GIMG_W_DISK
, 16, 
NULL
 },

100 { 
IMAGEPREFIX
"disk_idË.bmp", 
GIMG_W_DISK
, 16, 
NULL
 },

101 { 
IMAGEPREFIX
"disk_aùive.bmp", 
GIMG_W_DISK
, 16, 
NULL
 },

102 { 
IMAGEPREFIX
"disk_modif›d.bmp", 
GIMG_W_DISK
, 16, 
NULL
 },

103 { 
IMAGEPREFIX
"disk_modaùive.bmp", 
GIMG_W_DISK
, 16, 
NULL
 },

104 { 
IMAGEPREFIX
"³_ejeùed.bmp", 
GIMG_W_TAPE
, 16, 
NULL
 },

105 { 
IMAGEPREFIX
"³_·u£.bmp", 
GIMG_W_TAPE
, 16, 
NULL
 },

106 { 
IMAGEPREFIX
"³_¶ay.bmp", 
GIMG_W_TAPE
, 16, 
NULL
 },

107 { 
IMAGEPREFIX
"³_¡Ý.bmp", 
GIMG_W_TAPE
, 16, 
NULL
 },

108 { 
IMAGEPREFIX
"³_»cÜd.bmp", 
GIMG_W_TAPE
, 16, 
NULL
 },

109 { 
IMAGEPREFIX
"avœec.bmp", 
GIMG_W_AVIR
, 16, 
NULL
 },

110 { 
IMAGEPREFIX
"gfx_Üic1kbd.bmp", 640, 240, 
NULL
 },

111 { 
IMAGEPREFIX
"gfx_©moskbd.bmp", 640, 240, 
NULL
 },

112 { 
IMAGEPREFIX
"gfx_´av‘zkbd.bmp", 640, 240, 
NULL
 }};

114 
SDL_boÞ
 
	gsoundavažabË
, 
	gsoundÚ
;

115 #ià
defšed
(
__lšux__
)

116 
Sšt16
 
	gsoundsž’û
 = 0;

118 
Sšt16
 
	gsoundsž’û
 = -32768;

120 
SDL_boÞ
 
miüodisüom_v®id
, 
jasmšrom_v®id
, 
´av‘zrom_v®id
;

123 
	#GIMG_POS_SBARY
 (480-16)

	)

124 
	#GIMG_POS_TAPEX
 (640-4-
GIMG_W_TAPE
)

	)

125 
	#GIMG_POS_DISKX
 (
GIMG_POS_TAPEX
-(6+(
GIMG_W_DISK
*4)))

	)

126 
	#GIMG_POS_AVIRECX
 (
GIMG_POS_DISKX
-(6+
GIMG_W_AVIR
))

	)

129 
	gsg·l
[] = { 0x00, 0x00, 0x00,

154 
	gg_fÜegroundc
[] = { 0, 0, 1, 1, 0, 2, 1 };

155 
	gg_backgroundc
[] = { 10, 10, 0, 0, 14, 3, 0 };

156 
	gg_fÜegroundc£l
[] = { 1, 1, 0, 0, 0, 1, 0 };

157 
	gg_backgroundc£l
[] = { 11, 11, 12, 13, 15, 5, 9 };

158 
	gg_m’u_scheme
 = 5;

162 
‹xtzÚe
 *
	gtz
[
NUM_TZ
];

165 
	gv¥tmp
[
VSPTMPSIZE
];

168 
Ušt32
 
äam‘im—ve
;

169 
SDL_boÞ
 
	gw¬p¥“d
=
SDL_FALSE
;

172 
osdm’u
 *
	gcm’u
 = 
NULL
;

173 
	gcm’u™em
 = 0;

175 * 
	gacŸback’ds
[
ACIA_TYPE_LAST
] = {

182 
	gacŸback’dÏb–
[32];

184 
	$m’ufc
(
SDL_boÞ
 
bS–eùed
è{  (bS–eùed ? 
g_fÜegroundc£l
[
g_m’u_scheme
] : 
g_fÜegroundc
[g_m’u_scheme]); 
	}
}

185 
	$m’ubc
(
SDL_boÞ
 
bS–eùed
è{  (bS–eùed ? 
g_backgroundc£l
[
g_m’u_scheme
] : 
g_backgroundc
[g_m’u_scheme]); 
	}
}

188 
toggË³noi£
Ð
machše
 *
Üic
, 
osdm’u™em
 *
m™em
, 
dummy
 );

189 
toggËsound
Ð
machše
 *
Üic
, 
osdm’u™em
 *
m™em
, 
dummy
 );

190 
š£¹³
Ð
machše
 *
Üic
, 
osdm’u™em
 *
m™em
, 
dummy
 );

191 
š£¹disk
Ð
machše
 *
Üic
, 
osdm’u™em
 *
m™em
, 
drive
 );

192 
»£tÜic
Ð
machše
 *
Üic
, 
osdm’u™em
 *
m™em
, 
dummy
 );

193 
toggË³turbo
Ð
machše
 *
Üic
, 
osdm’u™em
 *
m™em
, 
dummy
 );

194 
toggËch376
(
machše
 *
Üic
, 
osdm’u™em
 *
m™em
, 
dummy
);

195 
toggËautowšd
Ð
machše
 *
Üic
, 
osdm’u™em
 *
m™em
, 
dummy
 );

196 
toggËautoš¤t
Ð
machše
 *
Üic
, 
osdm’u™em
 *
m™em
, 
dummy
 );

197 
toggËsymbÞ§uto
Ð
machše
 *
Üic
, 
osdm’u™em
 *
m™em
, 
dummy
 );

198 
toggËÿ£syms
Ð
machše
 *
Üic
, 
osdm’u™em
 *
m™em
, 
dummy
 );

199 
toggËvsynchack
Ð
machše
 *
Üic
, 
osdm’u™em
 *
m™em
, 
dummy
 );

200 
sw­_»nd”_mode
Ð
machše
 *
Üic
, 
osdm’u™em
 *
m™em
, 
Ãw»nd”mode
 );

201 
toggË¬©io
Ð
machše
 *
Üic
, 
osdm’u™em
 *
m™em
, 
dummy
 );

202 
toggËh¡»tch
Ð
machše
 *
Üic
, 
osdm’u™em
 *
m™em
, 
dummy
 );

203 
toggË·lgho¡
Ð
machše
 *
Üic
, 
osdm’u™em
 *
m™em
, 
dummy
 );

204 
toggËsÿÆšes
Ð
machše
 *
Üic
, 
osdm’u™em
 *
m™em
, 
dummy
 );

205 
toggËligh’
Ð
machše
 *
Üic
, 
osdm’u™em
 *
m™em
, 
dummy
 );

206 
toggËacŸback’d
Ð
machše
 *
Üic
, 
osdm’u™em
 *
m™em
, 
dummy
 );

207 
£tov”þock
Ð
machše
 *
Üic
, 
osdm’u™em
 *
m™em
, 
dummy
 );

208 
§ve¢­
Ð
machše
 *
Üic
, 
osdm’u™em
 *
m™em
, 
dummy
 );

209 
lßd¢­
Ð
machše
 *
Üic
, 
osdm’u™em
 *
m™em
, 
dummy
 );

210 
toggËkeybßrd
Ð
machše
 *
Üic
, 
osdm’u™em
 *
m™em
, 
dummy
 );

211 
defšem­pšg
Ð
machše
 *
Üic
, 
osdm’u™em
 *
m™em
, 
dummy
 );

212 
toggË¡ickykeys
Ð
machše
 *
Üic
, 
osdm’u™em
 *
m™em
, 
dummy
 );

213 
§vem­pšg
Ð
machše
 *
Üic
, 
osdm’u™em
 *
m™em
, 
dummy
 );

214 
lßdm­pšg
Ð
machše
 *
Üic
, 
osdm’u™em
 *
m™em
, 
dummy
 );

215 
»£tm­pšg
Ð
machše
 *
Üic
, 
osdm’u™em
 *
m™em
, 
dummy
 );

216 #ifdeà
__CBCOPY__


217 
þbd_cÝy_gui
Ð
machše
 *
Üic
, 
osdm’u™em
 *
m™em
, 
dummy
 );

219 #ifdeà
__CBPASTE__


220 
þbd_·¡e_gui
Ð
machše
 *
Üic
, 
osdm’u™em
 *
m™em
, 
dummy
 );

226 
osdm’u™em
 
	gmaš™ems
[] = { { "In£¹­e...", "T", 't', 
š£¹³
, 0, 0 },

227 { "Sav³ ouut...", "[F9]", 
SDLK_F9
, 
toggË³ÿp
, 0, 0 },

228 { "In£¹ disk 0...", "0", 
SDLK_0
, 
š£¹disk
, 0, 0 },

229 { "In£¹ disk 1...", "1", 
SDLK_1
, 
š£¹disk
, 1, 0 },

230 { "In£¹ disk 2...", "2", 
SDLK_2
, 
š£¹disk
, 2, 0 },

231 { "In£¹ disk 3...", "3", 
SDLK_3
, 
š£¹disk
, 3, 0 },

232 { 
OSDMENUBAR
, 
NULL
, 0, NULL, 0, 0 },

233 { "Sav¢­shÙ...", 
NULL
, 0, 
§ve¢­
, 0, 0 },

234 { "Lßd sÇpshÙ...", 
NULL
, 0, 
lßd¢­
, 0, 0 },

235 #ià
defšed
(
__CBCOPY__
è|| defšed(
__CBPASTE__
)

236 { 
OSDMENUBAR
, 
NULL
, 0, NULL, 0, 0 },

238 #ià
defšed
(
__CBCOPY__
)

239 { "CÝyØþbßrd", "[F11]",
SDLK_F11
, 
þbd_cÝy_gui
, 0, 0 },

241 #ià
defšed
(
__CBPASTE__
)

242 { "Pa¡äom clbßrd", "[F12]",
SDLK_F12
, 
þbd_·¡e_gui
,0, 0 },

244 { 
OSDMENUBAR
, 
NULL
, 0, NULL, 0, 0 },

245 { "H¬dw¬ÝtiÚs...", "H", 'h', 
gÙom’u
, 1, 0 },

246 { "AudiØÝtiÚs...", "A", 'a', 
gÙom’u
, 2, 0 },

247 { "VideØÝtiÚs...", "V", 'v', 
gÙom’u
, 4, 0 },

248 { "Keybßrd o±iÚs...", "K", 'k', 
gÙom’u
, 7, 0 },

249 { "Debug o±iÚs...", "D", 'd', 
gÙom’u
, 3, 0 },

250 { "Ov”þock o±iÚs...", "C", 'c', 
gÙom’u
, 6, 0 },

251 { 
OSDMENUBAR
, 
NULL
, 0, NULL, 0, 0 },

252 { "MÚ™Ü", "[F2]", 
SDLK_F2
, 
£‹mumode
, 
EM_DEBUG
, 0 },

253 { "Re£ˆBu‰Ú NMI", "[F3]", 
SDLK_F3
, 
soá»£tÜic
, 0, 0 },

254 { "H¬d Re£t", "[F4]", 
SDLK_F4
, 
»£tÜic
, 0, 0 },

255 { "Back", "\x17", 
SDLK_BACKSPACE
,
£‹mumode
, 
EM_RUNNING
, 0 },

256 { 
OSDMENUBAR
, 
NULL
, 0, NULL, 0, 0 },

257 { "About", 
NULL
, 0, 
gÙom’u
, 5, 0 },

258 { 
OSDMENUBAR
, 
NULL
, 0, NULL, 0, 0 },

259 { "Qu™", 
NULL
, 0, 
£‹mumode
, 
EM_PLEASEQUIT
, 0 },

260 { 
NULL
, } };

262 
osdm’u™em
 
	ghwÝ™ems
[] = { { " Oric-1", "1", 
SDLK_1
, 
sw­mach
, (0xffff<<16)|
MACH_ORIC1
, 0 },

263 { " Oric-1 16K", "2", 
SDLK_2
, 
sw­mach
, (0xffff<<16)|
MACH_ORIC1_16K
, 0 },

264 { " Atmos", "3", 
SDLK_3
, 
sw­mach
, (0xffff<<16)|
MACH_ATMOS
, 0 },

265 { " T–e¡¿t", "4", 
SDLK_4
, 
sw­mach
, (
DRV_NONE
<<16)|
MACH_TELESTRAT
, 0 },

266 { " P¿v‘z 8D", "5", 
SDLK_5
, 
sw­mach
, (0xffff<<16)|
MACH_PRAVETZ
, 0 },

267 { 
OSDMENUBAR
, 
NULL
, 0, NULL, 0, 0 },

268 { " NØdisk", "X", 'x', 
£tdriv‘y³
, 
DRV_NONE
, 0 },

269 { " Miüodisc", "M", 'm', 
£tdriv‘y³
, 
DRV_MICRODISC
, 0 },

270 { " Jasmš", "J", 'j', 
£tdriv‘y³
, 
DRV_JASMIN
, 0 },

272 { " P¿v‘z 8D disk", "P", 'p', 
£tdriv‘y³
, 
DRV_PRAVETZ
, 0 },

273 { 
OSDMENUBAR
, 
NULL
, 0, NULL, 0, 0 },

274 { " TurbØ³", 
NULL
, 0, 
toggË³turbo
, 0, 0 },

275 { " Autoš£¹­e", 
NULL
, 0, 
toggËautoš¤t
, 0, 0 },

276 { " AutÜewšd­e", 
NULL
, 0, 
toggËautowšd
, 0, 0 },

277 { 
OSDMENUBAR
, 
NULL
, 0, NULL, 0, 0 },

278 { " VSynøhack", 
NULL
, 0, 
toggËvsynchack
, 0, 0 },

279 { " Ligh’", 
NULL
, 0, 
toggËligh’
, 0, 0 },

280 { " S”ŸÈnÚ ", 
NULL
, 0, 
toggËacŸback’d
, 0, 0 },

281 { " CH376 (T–e¡¿tè ", 
NULL
, 0, 
toggËch376
, 0, 0 },

283 { 
OSDMENUBAR
, 
NULL
, 0, NULL, 0, 0 },

284 { "Back", "\x17", 
SDLK_BACKSPACE
,
gÙom’u
, 0, 0 },

285 { 
NULL
, } };

287 
osdm’u™em
 
	gauÝ™ems
[] = { { " SoundƒÇbËd", 
NULL
, 0, 
toggËsound
, 0, 0 },

288 { " T­noi£", 
NULL
, 0, 
toggË³noi£
, 0, 0 },

289 { 
OSDMENUBAR
, 
NULL
, 0, NULL, 0, 0 },

290 { "Back", "\x17", 
SDLK_BACKSPACE
,
gÙom’u
, 0, 0 },

291 { 
NULL
, } };

293 
osdm’u™em
 
	gkeÝ™ems
[] = { { " Show keybßrd", 
NULL
, 0, 
toggËkeybßrd
, 0, 0 },

294 { " Sticky mod keys", 
NULL
, 0, 
toggË¡ickykeys
,0, 0 },

295 { " Defšm­pšg", 
NULL
, 0, 
defšem­pšg
, 0, 0 },

296 { "Savm­pšg...", 
NULL
, 0, 
§vem­pšg
, 0, 0 },

297 { "Lßd m­pšg...", 
NULL
, 0, 
lßdm­pšg
, 0, 0 },

298 { "Re£ˆm­pšg", 
NULL
, 0, 
»£tm­pšg
, 0, 0 },

299 { 
OSDMENUBAR
, 
NULL
, 0, NULL, 0, 0 },

300 { "Back", "\x17", 
SDLK_BACKSPACE
,
gÙom’u
, 0, 0 },

301 { 
NULL
, } };

305 
osdm’u™em
 
	gdbÝ™ems
[] = { { " AutÞßd symbÞ fže", 
NULL
, 0, 
toggËsymbÞ§uto
, 0, 0 },

306 { " Ca£-£ns™ivsymbÞs",
NULL
, 0, 
toggËÿ£syms
, 0, 0 },

307 { 
OSDMENUBAR
, 
NULL
, 0, NULL, 0, 0 },

308 { "Back", "\x17", 
SDLK_BACKSPACE
,
gÙom’u
, 0, 0 },

309 { 
NULL
, } };

311 #ifdeà
__OPENGL_AVAILABLE__


312 
osdm’u™em
 
	gvdÝ™ems
[] = { { " O³nGL„’d”šg", "O", 'o', 
sw­_»nd”_mode
, 
RENDERMODE_GL
, 0 },

313 { " Soáw¬»nd”šg", "S", 's', 
sw­_»nd”_mode
, 
RENDERMODE_SW
, 0 },

314 { 
OSDMENUBAR
, 
NULL
, 0, NULL, 0, 0 },

315 { " FuÎsü“n", "[F8]", 
SDLK_F8
, 
toggËfuÎsü“n
, 0, 0 },

316 { " SÿÆšes", "C", 'c', 
toggËsÿÆšes
, 0, 0 },

317 { 
OSDMENUBAR
, 
NULL
, 0, NULL, 0, 0 },

318 { "Back", "\x17", 
SDLK_BACKSPACE
,
gÙom’u
, 0, 0 },

319 { 
NULL
, } };

321 
osdm’u™em
 
	gvdÝ™ems
[] = { { " FuÎsü“n", "F", 'f', 
toggËfuÎsü“n
, 0, 0 },

322 { " SÿÆšes", "C", 'c', 
toggËsÿÆšes
, 0, 0 },

323 { 
OSDMENUBAR
, 
NULL
, 0, NULL, 0, 0 },

324 { "Back", "\x17", 
SDLK_BACKSPACE
,
gÙom’u
, 0, 0 },

325 { 
NULL
, } };

328 
osdm’u™em
 
	gglÝ™ems
[] = { { " O³nGL„’d”šg", "O", 'o', 
sw­_»nd”_mode
, 
RENDERMODE_GL
, 0 },

329 { " Soáw¬»nd”šg", "S", 's', 
sw­_»nd”_mode
, 
RENDERMODE_SW
, 0 },

330 { 
OSDMENUBAR
, 
NULL
, 0, NULL, 0, 0 },

331 { " FuÎsü“n", "F", 'f', 
toggËfuÎsü“n
, 0, 0 },

332 { " 50Hz/60Hz‡¥eù„©io", "R", 'r', 
toggË¬©io
, 0, 0 },

333 { " HÜizÚÈ¡»tch", "H", 'h', 
toggËh¡»tch
, 0, 0 },

334 { " SÿÆšes", "C", 'c', 
toggËsÿÆšes
, 0, 0 },

335 { " PAL gho¡šg", "P", 'p', 
toggË·lgho¡
, 0, 0 },

336 { 
OSDMENUBAR
, 
NULL
, 0, NULL, 0, 0 },

337 { "Back", "\x17", 
SDLK_BACKSPACE
,
gÙom’u
, 0, 0 },

338 { 
NULL
, } };

340 
osdm’u™em
 
	gabout™ems
[] = { { "", 
NULL
, 0, NULL, 0, 0 },

341 { 
APP_NAME_FULL
, 
NULL
, 0, NULL, 0, 
OMIF_BRIGHT
|
OMIF_CENTRED
 },

342 { "h‰ps://g™hub.com/³‹-gÜdÚ/ÜicuŒÚ",
NULL
, 0, 
gÙos™e
, 0, 
OMIF_CENTRED
 },

343 { "", 
NULL
, 0, NULL, 0, 0 },

344 { "(C)" 
APP_YEAR
 " P‘” GÜdÚ", 
NULL
, 0, NULL, 0, 
OMIF_BRIGHT
|
OMIF_CENTRED
 },

345 { "h‰p://www.³‹rgÜdÚ.Üg.uk", 
NULL
, 0, 
gÙos™e
, 0, 
OMIF_CENTRED
 },

346 { "", 
NULL
, 0, NULL, 0, 0 },

347 { "Add™iÚ®…rog¿mmšg", 
NULL
, 0, NULL, 0, 
OMIF_BRIGHT
|
OMIF_CENTRED
 },

348 { "F¿ncoi RevÞ", 
NULL
, 0, NULL, 0, 
OMIF_CENTRED
 },

349 { "S‹çÀHaub’th®", 
NULL
, 0, NULL, 0, 
OMIF_CENTRED
 },

350 { "AËxªd» Dev”t", 
NULL
, 0, NULL, 0, 
OMIF_CENTRED
 },

351 { "Ibisum", 
NULL
, 0, NULL, 0, 
OMIF_CENTRED
 },

352 { "Kam– Biskri", 
NULL
, 0, NULL, 0, 
OMIF_CENTRED
 },

353 { "Iss", 
NULL
, 0, NULL, 0, 
OMIF_CENTRED
 },

354 { "P©riû TÜgu‘", 
NULL
, 0, NULL, 0, 
OMIF_CENTRED
 },

355 { "", 
NULL
, 0, NULL, 0, 0 },

356 { 
OSDMENUBAR
, 
NULL
, 0, NULL, 0, 0 },

357 { "Back", "\x17", 
SDLK_BACKSPACE
, 
gÙom’u
, 0, 0 },

358 { 
NULL
, } };

360 
osdm’u™em
 
	govÝ™ems
[] = { { " 1mhz (NÚe)", "1", '1', 
£tov”þock
, 0, 0 },

361 { " 2mhz", "2", '2', 
£tov”þock
, 1, 0 },

362 { " 4mhz", "3", '3', 
£tov”þock
, 2, 0 },

363 { " 8mhz", "4", '4', 
£tov”þock
, 3, 0 },

364 { " 16mhz", "5", '5', 
£tov”þock
, 4, 0 },

365 { " 32mhz", "6", '6', 
£tov”þock
, 5, 0 },

366 { " 64mhz", "7", '7', 
£tov”þock
, 6, 0 },

367 { 
OSDMENUBAR
, 
NULL
, 0, NULL, 0, 0 },

368 { "Back", "\x17", 
SDLK_BACKSPACE
,
gÙom’u
,0, 0 },

369 { 
NULL
, } };

371 
	#LAST_ITEM
(
x
è(((x)/(
osdm’u™em
))-2)

	)

373 
osdm’u
 
	gm’us
[] = { { "Maš M’u", 
LAST_ITEM
(
maš™ems
)-4, mainitems },

374 { "H¬dw¬ÝtiÚs", 
LAST_ITEM
(
hwÝ™ems
), hwopitems },

375 { "AudiØÝtiÚs", 
LAST_ITEM
(
auÝ™ems
),‡uopitems },

376 { "Debug o±iÚs", 
LAST_ITEM
(
dbÝ™ems
), dbopitems },

377 { "VideØÝtiÚs", 
LAST_ITEM
(
vdÝ™ems
), vdopitems },

378 { "AbouˆOricuŒÚ", 
LAST_ITEM
(
about™ems
),‡boutitems },

379 { "Ov”þock", 
LAST_ITEM
(
ovÝ™ems
), ovopitems },

380 { "Keybßrd o±iÚs", 
LAST_ITEM
(
keÝ™ems
), keopitems }};

383 
SDL_boÞ
 
	$gimg_lßd
Ð
guiimg
 *
gi
 )

385 
SDL_RWÝs
 *
f
;

386 
Ušt8
 
hdrbuf
[640*3];

387 
Sšt32
 
x
, 
y
;

388 
SDL_boÞ
 
fžeok
;

391 
f
 = 
	`SDL_RWFromFže
Ð
gi
->
fž’ame
, "rb" );

392 ifÐ!
f
 )

394 
	`”rÜ_´štf
Ð"gu˜UÇbËØÝ’ '%s'\n", 
gi
->
fž’ame
 );

395 
	`”rÜ_´štf
("SDL”rÜ : %s\n", 
	`SDL_G‘E¼Ü
());

396  
SDL_FALSE
;

400 ifÐ
	`SDL_RW»ad
Ð
f
, 
hdrbuf
, 54, 1 ) != 1 )

402 
	`”rÜ_´štf
Ð"E¼Ü„—dšg '%s'\n", 
gi
->
fž’ame
 );

403 
	`SDL_RWþo£
Ð
f
 );

404  
SDL_FALSE
;

407 
fžeok
 = 
SDL_TRUE
;

408 ifÐ
	`¡ºcmp
Ð(*)
hdrbuf
, "BM", 2 ) !ð0 ) 
fžeok
 = 
SDL_FALSE
;

409 ifÐ((
hdrbuf
[21]<<24)|(hdrbuf[20]<<16)|(hdrbuf[19]<<8)|hdrbuf[18]è!ð
gi
->
w
 ) 
fžeok
 = 
SDL_FALSE
;

410 ifÐ((
hdrbuf
[25]<<24)|(hdrbuf[24]<<16)|(hdrbuf[23]<<8)|hdrbuf[22]è!ð
gi
->
h
 ) 
fžeok
 = 
SDL_FALSE
;

411 ifÐ((
hdrbuf
[27]<<8)|hdrbuf[26]è!ð1 ) 
fžeok
 = 
SDL_FALSE
;

412 ifÐ((
hdrbuf
[29]<<8)|hdrbuf[28]è!ð24 ) 
fžeok
 = 
SDL_FALSE
;

413 ifÐ((
hdrbuf
[33]<<24)|(hdrbuf[32]<<16)|(hdrbuf[31]<<8)|hdrbuf[30]è!ð0 ) 
fžeok
 = 
SDL_FALSE
;

415 ifÐ!
fžeok
 )

417 
	`”rÜ_´štf
Ð"'%s'‚“d tØb¨%dx%d, uncom´es£d, 24-b™ BMP image\n", 
gi
->
fž’ame
, gi->
w
, gi->
h
 );

418 
	`SDL_RWþo£
Ð
f
 );

419  
SDL_FALSE
;

423 ifÐ!
gi
->
buf
 )

424 
gi
->
buf
 = 
	`m®loc
Ðgi->
w
 * gi->
h
 * 3 );

426 ifÐ!
gi
->
buf
 )

428 
	`”rÜ_´štf
( "Out of memory\n" );

429 
	`SDL_RWþo£
Ð
f
 );

430  
SDL_FALSE
;

434  
y
=
gi
->
h
-1; y>=0; y-- )

436 
	`SDL_RW»ad
Ð
f
, 
hdrbuf
, ((
gi
->
w
*3)+3)&0xfffffffc, 1 );

437  
x
=0; x<
gi
->
w
; x++ )

439 
gi
->
buf
[(
y
*gi->
w
+
x
)*3+0] = 
hdrbuf
[x*3+2];

440 
gi
->
buf
[(
y
*gi->
w
+
x
)*3+1] = 
hdrbuf
[x*3+1];

441 
gi
->
buf
[(
y
*gi->
w
+
x
)*3+2] = 
hdrbuf
[x*3];

445 
	`SDL_RWþo£
Ð
f
 );

447  
SDL_TRUE
;

448 
	}
}

451 
	$d¿w_¡©usb¬
Ð
machše
 *
Üic
 )

453 ià(
Üic
->
¡©usb¬_mode
 =ð
STATUSBARMODE_NONE
)

454 
Üic
->
	`»nd”_þ—r_¬—
Ð0, 
GIMG_POS_SBARY
, 640, 480-GIMG_POS_SBARY );

456 
Üic
->
	`»nd”_gimg
Ð
GIMG_STATUSBAR
, 0, 
GIMG_POS_SBARY
 );

457 
	}
}

459 
	$d¿w_keybßrd
Ð
machše
 *
Üic
 ) {

460 ià(
Üic
->
show_keybßrd
) {

461  
Üic
->
ty³
 )

463 
MACH_PRAVETZ
:

464 
Üic
->
	`»nd”_gimg
Ð
GIMG_PRAVETZ_KEYBOARD
, 0, 480);

466 
MACH_ORIC1
:

467 
MACH_ORIC1_16K
:

468 
Üic
->
	`»nd”_gimg
Ð
GIMG_ORIC1_KEYBOARD
, 0, 480);

471 
Üic
->
	`»nd”_gimg
Ð
GIMG_ATMOS_KEYBOARD
, 0, 480);

475 
	}
}

478 
	$d¿w_disks
Ð
machše
 *
Üic
 )

480 
Sšt32
 
i
, 
j
;

482 ifÐ
Üic
->
¡©usb¬_mode
 =ð
STATUSBARMODE_NONE
 )

485 ifÐ
Üic
->
driv‘y³
 =ð
DRV_NONE
 )

487 
Üic
->
	`»nd”_gimg·¹
Ð
GIMG_STATUSBAR
, 
GIMG_POS_DISKX
, 
GIMG_POS_SBARY
, GIMG_POS_DISKX, 0, 18*4, 16 );

491  
i
=0; i<4; i++ )

493 
j
 = 
GIMG_DISK_EJECTED
;

494 ifÐ
Üic
->
wddisk
.
disk
[
i
] )

496 
j
 = ((
Üic
->
wddisk
.
c_drive
==
i
)&&(Üic->wddisk.
cu¼’tÝ
!=
COP_NUFFINK
)è? 
GIMG_DISK_ACTIVE
 : 
GIMG_DISK_IDLE
;

497 ifÐ
Üic
->
wddisk
.
disk
[
i
]->
modif›d
 ) 
j
+=2;

499 
Üic
->
	`»nd”_gimg
Ð
j
, 
GIMG_POS_DISKX
+
i
*
GIMG_W_DISK
, 
GIMG_POS_SBARY
 );

501 
	}
}

504 
	$d¿w_avœec
Ð
machše
 *
Üic
, 
SDL_boÞ
 
»cÜdšg
 )

506 ifÐ
Üic
->
¡©usb¬_mode
 =ð
STATUSBARMODE_NONE
)

509 ifÐ
»cÜdšg
 )

511 
Üic
->
	`»nd”_gimg
Ð
GIMG_AVI_RECORD
, 
GIMG_POS_AVIRECX
, 
GIMG_POS_SBARY
 );

515 
Üic
->
	`»nd”_gimg·¹
Ð
GIMG_STATUSBAR
, 
GIMG_POS_AVIRECX
, 
GIMG_POS_SBARY
, GIMG_POS_AVIRECX, 0, 16, 16 );

516 
	}
}

519 
	$d¿w_³
Ð
machše
 *
Üic
 )

521 ifÐ
Üic
->
¡©usb¬_mode
 =ð
STATUSBARMODE_NONE
 )

524 ifÐ
Üic
->
³ÿp
 )

526 
Üic
->
	`»nd”_gimg
Ð
GIMG_TAPE_RECORD
, 
GIMG_POS_TAPEX
, 
GIMG_POS_SBARY
 );

530 ifÐ!
Üic
->
³buf
 )

532 
Üic
->
	`»nd”_gimg
Ð
GIMG_TAPE_EJECTED
, 
GIMG_POS_TAPEX
, 
GIMG_POS_SBARY
 );

536 ifÐ
Üic
->
³mÙÜ
 )

538 
Üic
->
	`»nd”_gimg
Ð
GIMG_TAPE_PLAY
, 
GIMG_POS_TAPEX
, 
GIMG_POS_SBARY
 );

542 ifÐ
Üic
->
³offs
 >ðÜic->
³Ën
 )

544 
Üic
->
	`»nd”_gimg
Ð
GIMG_TAPE_STOP
, 
GIMG_POS_TAPEX
, 
GIMG_POS_SBARY
 );

548 
Üic
->
	`»nd”_gimg
Ð
GIMG_TAPE_PAUSE
, 
GIMG_POS_TAPEX
, 
GIMG_POS_SBARY
 );

549 
	}
}

552 
	$do_pÝup
Ð
machše
 *
Üic
, *
¡r
 )

554 
	`¡ºýy
Ð
Üic
->
pÝup¡r
, 
¡r
, 40 ); oric->popupstr[39] = 0;

555 
Üic
->
ÃwpÝup¡r
 = 
SDL_TRUE
;

556 
Üic
->
pÝu±ime
 = 100;

557 
	}
}

559 
	$»nd”_¡©us
Ð
machše
 *
Üic
 )

561 ifÐ
»äesh¡©us
 )

562 
	`d¿w_¡©usb¬
Ð
Üic
 );

564 ifÐ
»äeshdisks
 || 
»äesh¡©us
 )

566 
	`d¿w_disks
Ð
Üic
 );

567 
»äeshdisks
 = 
SDL_FALSE
;

570 ifÐ
»äeshavi
 || 
»äesh¡©us
 )

572 
	`d¿w_avœec
Ð
Üic
, 
vidÿp
 !ð
NULL
 );

573 
»äeshavi
 = 
SDL_FALSE
;

576 ifÐ
»äesh³
 || 
»äesh¡©us
 )

578 
	`d¿w_³
Ð
Üic
 );

579 
»äesh³
 = 
SDL_FALSE
;

582 if(
»äeshkeybßrd
 || 
»äesh¡©us
) {

583 
	`d¿w_keybßrd
Ð
Üic
 );

584 
»äeshkeybßrd
 = 
SDL_FALSE
;

587 
»äesh¡©us
 = 
SDL_FALSE
;

588 
	}
}

591 
	$»nd”
Ð
machše
 *
Üic
 )

593 
³rc
, 
ås
;

595 ifÐ
Üic
->
emu_mode
 =ð
EM_DEBUG
 )

596 
	`mÚ_upd©e
Ð
Üic
 );

598 
Üic
->
	`»nd”_begš
( oric );

600  
Üic
->
emu_mode
 )

602 
EM_MENU
:

603 
Üic
->
	`»nd”_video
ÐÜic, 
SDL_TRUE
 );

604 
	`»nd”_¡©us
Ð
Üic
 );

605 ifÐ
tz
[
TZ_MENU
] ) 
Üic
->
	`»nd”_‹xtzÚe
( oric, TZ_MENU );

608 
EM_RUNNING
:

609 
Üic
->
	`»nd”_video
ÐÜic, 
SDL_TRUE
 );

610 
	`»nd”_¡©us
Ð
Üic
 );

611 ifÐ
Üic
->
¡©usb¬_mode
 =ð
STATUSBARMODE_FULL
 )

613 
ås
 = 100000/(
äam‘im—ve
?frametimeave:1);

614 ifÐ
Üic
->
vid_äeq
 )

615 
³rc
 = 200000/(
äam‘im—ve
?frametimeave:1);

617 
³rc
 = 166667/(
äam‘im—ve
?frametimeave:1);

619 #ifdeà
DEBUG_VSYNC


620 
	`¥rštf
Ð
Üic
->
¡©us¡r
, "%4d.%02d%% - %4dFPS VSYNC:%3d", 
³rc
/100,…”c%100, 
ås
/100, oric->
vid_off£t
 );

622 
	`¥rštf
Ð
Üic
->
¡©us¡r
, "%4d.%02d%% - %4dFPS", 
³rc
/100,…”c%100, 
ås
/100 );

625 
Üic
->
Ãw¡©us¡r
 = 
SDL_TRUE
;

627 ifÐ
Üic
->
pÝu±ime
 > 0 )

629 
Üic
->
pÝu±ime
--;

630 ifÐ
Üic
->
pÝu±ime
 == 0 )

632 
Üic
->
pÝup¡r
[0] = 0;

633 
Üic
->
ÃwpÝup¡r
 = 
SDL_TRUE
;

638 
EM_DEBUG
:

639 
	`mÚ_»nd”
Ð
Üic
 );

643 
Üic
->
	`»nd”_’d
( oric );

644 
	}
}

650 
	$makebox
Ð
‹xtzÚe
 *
±z
, 
x
, 
y
, 
w
, 
h
, 
fg
, 
bg
 )

652 
cx
, 
cy
, 
o
, 
bo
;

654 
o
 = 
y
*
±z
->
w
+
x
;

655  
cy
=0; cy<
h
; cy++ )

657  
cx
=0; cx<
w
; cx++ )

659 
±z
->
tx
[
o
 ] = ' ';

660 
±z
->
fc
[
o
 ] = 
fg
;

661 
±z
->
bc
[
o
++] = 
bg
;

663 
±z
->
tx
[
o
-
w
] = 5;

664 
±z
->
tx
[
o
-1] = 5;

665 
o
 +ð
±z
->
w
-w;

669 
o
 = 
y
*
±z
->
w
+
x
;

670 
bo
 = 
o
 + (
h
-1)*
±z
->
w
;

671  
cx
=0; cx<(
w
-1); cx++ )

673 
±z
->
tx
[
o
++] = 
cx
==0?1:2;

674 
±z
->
tx
[
bo
++] = 
cx
==0?9:2;

676 
±z
->
tx
[
o
] = 4;

677 
±z
->
tx
[
bo
] = 11;

679 
±z
->
modif›d
 = 
SDL_TRUE
;

680 
	}
}

683 
	$tz¡r
Ð
‹xtzÚe
 *
±z
, *
‹xt
 )

685 
i
, 
o
;

687 
o
 = 
±z
->
py
*±z->
w
+±z->
px
;

688  
i
=0; 
‹xt
 &&ext[i]; i++ )

690  
‹xt
[
i
] )

693 
±z
->
px
 = 1;

694 
±z
->
py
++;

695 
o
 = 
±z
->
py
*±z->
w
+1;

702 
±z
->
tx
[
o
 ] = 
‹xt
[
i
];

703 
±z
->
fc
[
o
 ] =…tz->
cfc
;

704 
±z
->
bc
[
o
++] =…tz->
cbc
;

705 
±z
->
px
++;

706 ifÐ
±z
->
px
 >ð±z->
w
 )

708 
±z
->
px
 = 1;

709 
±z
->
py
++;

710 
o
 = 
±z
->
py
*±z->
w
+1;

716 
±z
->
modif›d
 = 
SDL_TRUE
;

717 
	}
}

719 
	$tzputc
Ð
‹xtzÚe
 *
±z
, 
c
 )

721 
tmp
[2];

722 
tmp
[0] = 
c
;

723 
tmp
[1] = 0;

724 
	`tz¡r
Ð
±z
, 
tmp
 );

725 
	}
}

728 
	$tz´štf
Ð
‹xtzÚe
 *
±z
, *
fmt
, ... )

730 
va_li¡
 
­
;

731 
	`va_¡¬t
Ð
­
, 
fmt
 );

732 ifÐ
	`v¢´štf
Ð
v¥tmp
, 
VSPTMPSIZE
, 
fmt
, 
­
 ) != -1 )

734 
v¥tmp
[
VSPTMPSIZE
-1] = 0;

735 
	`tz¡r
Ð
±z
, 
v¥tmp
 );

737 
	`va_’d
Ð
­
 );

738 
	}
}

741 
	$tz¡½os
Ð
‹xtzÚe
 *
±z
, 
x
, 
y
, *
‹xt
 )

743 
±z
->
px
 = 
x
;

744 
±z
->
py
 = 
y
;

745 
	`tz¡r
Ð
±z
, 
‹xt
 );

746 
	}
}

749 
	$tz´štåos
Ð
‹xtzÚe
 *
±z
, 
x
, 
y
, *
fmt
, ... )

751 
va_li¡
 
­
;

752 
	`va_¡¬t
Ð
­
, 
fmt
 );

753 ifÐ
	`v¢´štf
Ð
v¥tmp
, 
VSPTMPSIZE
, 
fmt
, 
­
 ) != -1 )

755 
v¥tmp
[
VSPTMPSIZE
-1] = 0;

756 
	`tz¡½os
Ð
±z
, 
x
, 
y
, 
v¥tmp
 );

758 
	`va_’d
Ð
­
 );

759 
	}
}

762 
	$tz£tcÞ
Ð
‹xtzÚe
 *
±z
, 
fc
, 
bc
 )

764 
±z
->
cfc
 = 
fc
;

765 
±z
->
cbc
 = 
bc
;

766 
	}
}

769 
	$tz£‰™Ë
Ð
‹xtzÚe
 *
±z
, *
t™Ë
 )

771 
ox
, 
oy
;

772 
	`makebox
Ð
±z
, 0, 0,…tz->
w
,…tz->
h
, 
	`m’ufc
(
SDL_FALSE
), 
	`m’ubc
(SDL_FALSE));

773 ifÐ!
t™Ë
 ) ;

775 
	`tz£tcÞ
Ð
±z
, 
	`m’ufc
(
SDL_FALSE
), 
	`m’ubc
(SDL_FALSE));

776 
ox
 = 
±z
->
px
;

777 
oy
 = 
±z
->
py
;

778 
±z
->
px
 = 3;

779 
±z
->
py
 = 0;

780 
	`tz¡r
Ð
±z
, "[ " );

781 
	`tz¡r
Ð
±z
, 
t™Ë
 );

782 
	`tz¡r
Ð
±z
, " ]" );

783 
±z
->
px
 = 
ox
;

784 
±z
->
py
 = 
oy
;

785 
	}
}

787 
SDL_boÞ
 
	$š_‹xtzÚe
Ð
‹xtzÚe
 *
tz
, 
x
, 
y
 )

789 ifÐÐ
x
 >ð
tz
->x ) && ( x < (tz->x+tz->
w
*8) ) &&

790 Ð
y
 >ð
tz
->y ) && ( y < (tz->y+tz->
h
*12) ) )

792  
SDL_TRUE
;

795  
SDL_FALSE
;

796 
	}
}

799 
SDL_boÞ
 
	$®loc_‹xtzÚe
Ð
machše
 *
Üic
, 
i
, 
x
, 
y
, 
w
, 
h
, *
t™Ë
 )

801 
‹xtzÚe
 *
Áz
;

803 
Áz
 = 
	`m®loc
ÐÐ
‹xtzÚe
 ) + 
w
*
h
*3 );

804 ifÐ!
Áz
 )  
SDL_FALSE
;

806 
Áz
->
x
 = x;

807 
Áz
->
y
 = y;

808 
Áz
->
w
 = w;

809 
Áz
->
h
 = h;

811 
Áz
->
tx
 = (*)(&ntz[1]);

812 
Áz
->
fc
 = &Áz->
tx
[
w
*
h
];

813 
Áz
->
bc
 = &Áz->
fc
[
w
*
h
];

815 
	`tz£‰™Ë
Ð
Áz
, 
t™Ë
 );

817 
Áz
->
px
 = 1;

818 
Áz
->
py
 = 1;

820 
Áz
->
modif›d
 = 
SDL_TRUE
;

822 
tz
[
i
] = 
Áz
;

823 
Üic
->
	`»nd”_‹xtzÚe_®loc
ÐÜic, 
i
 );

825  
SDL_TRUE
;

826 
	}
}

828 
	$þ—r_‹xtzÚe
Ð
machše
 *
Üic
, 
i
 )

830 
x
, 
y
;

831 
‹xtzÚe
 *
±z
 = 
tz
[
i
];

833 ià(!
±z
) ;

835  
y
=1; y<(
±z
->
h
-1); y++ )

837  
x
=1; x<(
±z
->
w
-1); x++ )

839 
±z
->
tx
[
y
*±z->
w
+
x
] = ' ';

840 
±z
->
fc
[
y
*±z->
w
+
x
] = 2;

841 
±z
->
bc
[
y
*±z->
w
+
x
] = 3;

845 
±z
->
modif›d
 = 
SDL_TRUE
;

846 
	}
}

849 
	$ä“_‹xtzÚe
Ð
machše
 *
Üic
, 
i
 )

851 
Üic
->
	`»nd”_‹xtzÚe_ä“
ÐÜic, 
i
 );

852 ifÐ!
tz
[
i
] ) ;

853 
	`ä“
Ð
tz
[
i
] );

854 
tz
[
i
] = 
NULL
;

855 
	}
}

858 
	$d¿w™ems
( )

860 
i
, 
j
, 
o
;

863 ifÐÐ!
cm’u
 ) || ( !
tz
[
TZ_MENU
] ) )

867  
i
=0; 
cm’u
->
™ems
[i].
Çme
; i++ )

870 ifÐ
cm’u
->
™ems
[
i
].
Çme
 =ð
OSDMENUBAR
 )

873 
o
 = 
tz
[
TZ_MENU
]->
w
 * (
i
+1) + 1;

874  
j
=1; j<
tz
[
TZ_MENU
]->
w
-1; j++, 
o
++ )

876 
tz
[
TZ_MENU
]->
tx
[
o
] = 12;

877 
tz
[
TZ_MENU
]->
fc
[
o
] = 
	`m’ufc
(
SDL_FALSE
);

878 
tz
[
TZ_MENU
]->
bc
[
o
] = 
	`m’ubc
(
SDL_FALSE
);

884 ifÐ
i
==
cm’u
->
c™em
 )

885 
	`tz£tcÞ
Ð
tz
[
TZ_MENU
], 
	`m’ufc
(
SDL_TRUE
), 
	`m’ubc
(SDL_TRUE));

887 
	`tz£tcÞ
Ð
tz
[
TZ_MENU
], (
cm’u
->
™ems
[
i
].
æags
&
OMIF_BRIGHT
è? 1 : 
	`m’ufc
(
SDL_FALSE
), 
	`m’ubc
(SDL_FALSE));

890 
o
 = 
tz
[
TZ_MENU
]->
w
 * (
i
+1) + 1;

893  
j
=1; j<
tz
[
TZ_MENU
]->
w
-1; j++, 
o
++ )

894 
tz
[
TZ_MENU
]->
bc
[
o
] =z[TZ_MENU]->
cbc
;

897 ifÐ
cm’u
->
™ems
[
i
].
æags
 & 
OMIF_CENTRED
 )

898 
	`tz¡½os
Ð
tz
[
TZ_MENU
], (tz[TZ_MENU]->
w
-()
	`¡¾’
(
cm’u
->
™ems
[
i
].
Çme
))/2, i+1, cmenu->items[i].name );

900 
	`tz¡½os
Ð
tz
[
TZ_MENU
], 1, 
i
+1, 
cm’u
->
™ems
[i].
Çme
 );

903 ifÐ
cm’u
->
™ems
[
i
].
key
 )

904 
	`tz¡½os
Ð
tz
[
TZ_MENU
],z[TZ_MENU]->
w
-(1+()
	`¡¾’
(
cm’u
->
™ems
[
i
].
key
)), i+1, cmenu->items[i].key );

906 
	}
}

910 
	$još·th
Ð*
·th
, *
fže
 )

912 #ià
	`defšed
(
__amigaos4__
)

913 
	`¡rýy
Ð
fž‘mp
, 
·th
 );

914 
IDOS
->
	`AddP¬t
Ð
fž‘mp
, 
fže
, 4096 );

915 #–ià
	`defšed
(
WIN32
)

916 
i
;

917 
	`¡ºýy
Ð
fž‘mp
, 
·th
, 4096 ); filetmp[4095] = 0;

918 
i
 = 
	`¡¾’
Ð
fž‘mp
 );

919 ifÐÐ
i
 > 0 ) && ( 
fž‘mp
[i-1] !ð
PATHSEP
 ) && ( filetmp[i-1] != ':' ) )

921 
fž‘mp
[
i
++] = 
PATHSEP
;

922 
fž‘mp
[
i
++] = 0;

924 
	`¡ºÿt
Ð
fž‘mp
, 
fže
, 4096+512 );

925 
fž‘mp
[4096+511] = 0;

927 
i
;

928 
	`¡ºýy
Ð
fž‘mp
, 
·th
, 4096 ); filetmp[4095] = 0;

929 
i
 = ()
	`¡¾’
Ð
fž‘mp
 );

930 ifÐÐ
i
 > 0 ) && ( 
fž‘mp
[i-1] !ð
PATHSEP
 ) )

932 
fž‘mp
[
i
++] = 
PATHSEP
;

933 
fž‘mp
[
i
++] = 0;

935 
	`¡ºÿt
Ð
fž‘mp
, 
fže
, 4096+512 );

936 
fž‘mp
[4096+511] = 0;

938 
	}
}

941 
	$š£¹³
Ð
machše
 *
Üic
, 
osdm’u™em
 *
m™em
, 
dummy
 )

943 ifÐ!
	`fž”eque¡”
Ð
Üic
, "In£¹­e", 
³·th
, 
³fže
, 
FR_TAPELOAD
 ) ) ;

944 
Üic
->
Ï¡³fže
[0] = 0;

945 
	`još·th
Ð
³·th
, 
³fže
 );

947 
	`d‘eù_image_ty³
(
fž‘mp
))

949 
IMG_SNAPSHOT
:

950 ià(
	`msgbox
(
Üic
, 
MSGBOX_YES_NO
,

954 
	`lßd_¢­shÙ
(
Üic
, 
fž‘mp
);

959 
IMG_ATMOS_MICRODISC
:

960 ià((
Üic
->
ty³
 !ð
MACH_ATMOS
) &&

961 (
Üic
->
ty³
 !ð
MACH_ORIC1
) &&

962 (
Üic
->
ty³
 !ð
MACH_PRAVETZ
))

964 ià(
	`msgbox
(
Üic
, 
MSGBOX_YES_NO
,

968 
	`sw­mach
Ð
Üic
, 
NULL
, (
DRV_MICRODISC
<<16)|
MACH_ATMOS
 );

969 
	`još·th
Ð
³·th
, 
³fže
 );

970 
	`diskimage_lßd
Ð
Üic
, 
fž‘mp
, 0 );

972 
	`£‹mumode
Ð
Üic
, 
NULL
, 
EM_RUNNING
 );

976 ià(
Üic
->
driv‘y³
 !ð
DRV_MICRODISC
)

978 ià(
	`msgbox
(
Üic
, 
MSGBOX_YES_NO
,

982 
	`sw­mach
Ð
Üic
, 
NULL
, (
DRV_MICRODISC
<<16)|Üic->
ty³
 );

983 
	`još·th
Ð
³·th
, 
³fže
 );

984 
	`diskimage_lßd
Ð
Üic
, 
fž‘mp
, 0 );

986 
	`£‹mumode
Ð
Üic
, 
NULL
, 
EM_RUNNING
 );

990 ià(
	`msgbox
(
Üic
, 
MSGBOX_YES_NO
,

994 
	`još·th
Ð
³·th
, 
³fže
 );

995 
	`diskimage_lßd
Ð
Üic
, 
fž‘mp
, 0 );

997 
	`£‹mumode
Ð
Üic
, 
NULL
, 
EM_RUNNING
 );

1000 
IMG_ATMOS_JASMIN
:

1001 ià((
Üic
->
ty³
 !ð
MACH_ATMOS
) &&

1002 (
Üic
->
ty³
 !ð
MACH_ORIC1
) &&

1003 (
Üic
->
ty³
 !ð
MACH_PRAVETZ
))

1005 ià(
	`msgbox
(
Üic
, 
MSGBOX_YES_NO
,

1009 
	`sw­mach
Ð
Üic
, 
NULL
, (
DRV_JASMIN
<<16)|
MACH_ATMOS
 );

1010 
	`još·th
Ð
³·th
, 
³fže
 );

1011 
	`diskimage_lßd
Ð
Üic
, 
fž‘mp
, 0 );

1012 
Üic
->
auto_jasmš_»£t
 = 
SDL_TRUE
;

1014 
	`£‹mumode
Ð
Üic
, 
NULL
, 
EM_RUNNING
 );

1018 ià(
Üic
->
driv‘y³
 !ð
DRV_JASMIN
)

1020 ià(
	`msgbox
(
Üic
, 
MSGBOX_YES_NO
,

1024 
	`sw­mach
Ð
Üic
, 
NULL
, (
DRV_JASMIN
<<16)|Üic->
ty³
 );

1025 
	`još·th
Ð
³·th
, 
³fže
 );

1026 
	`diskimage_lßd
Ð
Üic
, 
fž‘mp
, 0 );

1027 
Üic
->
auto_jasmš_»£t
 = 
SDL_TRUE
;

1029 
	`£‹mumode
Ð
Üic
, 
NULL
, 
EM_RUNNING
 );

1033 ià(
	`msgbox
(
Üic
, 
MSGBOX_YES_NO
,

1037 
	`još·th
Ð
³·th
, 
³fže
 );

1038 
	`diskimage_lßd
Ð
Üic
, 
fž‘mp
, 0 );

1040 
	`£‹mumode
Ð
Üic
, 
NULL
, 
EM_RUNNING
 );

1043 
IMG_TELESTRAT_DISK
:

1044 ià(
Üic
->
ty³
 !ð
MACH_TELESTRAT
)

1046 ià(
	`msgbox
(
Üic
, 
MSGBOX_YES_NO
,

1050 
	`sw­mach
Ð
Üic
, 
NULL
, 
MACH_TELESTRAT
 );

1051 
	`još·th
Ð
³·th
, 
³fže
 );

1052 
	`diskimage_lßd
Ð
Üic
, 
fž‘mp
, 0 );

1054 
	`£‹mumode
Ð
Üic
, 
NULL
, 
EM_RUNNING
 );

1058 ià(
	`msgbox
(
Üic
, 
MSGBOX_YES_NO
,

1062 
	`još·th
Ð
³·th
, 
³fže
 );

1063 
	`diskimage_lßd
Ð
Üic
, 
fž‘mp
, 0 );

1065 
	`£‹mumode
Ð
Üic
, 
NULL
, 
EM_RUNNING
 );

1068 
IMG_PRAVETZ_DISK
:

1069 ià(
Üic
->
ty³
 !ð
MACH_PRAVETZ
)

1071 ià(
	`msgbox
(
Üic
, 
MSGBOX_YES_NO
,

1075 
	`sw­mach
Ð
Üic
, 
NULL
, (
DRV_PRAVETZ
<<16)|
MACH_PRAVETZ
 );

1076 
	`još·th
Ð
³·th
, 
³fže
 );

1077 
	`diskimage_lßd
Ð
Üic
, 
fž‘mp
, 0 );

1078 
	`´avdiskboÙ
Ð
Üic
 );

1080 
	`£‹mumode
Ð
Üic
, 
NULL
, 
EM_RUNNING
 );

1084 ià(
Üic
->
driv‘y³
 !ð
DRV_PRAVETZ
)

1086 ià(
	`msgbox
(
Üic
, 
MSGBOX_YES_NO
,

1090 
	`sw­mach
Ð
Üic
, 
NULL
, (
DRV_PRAVETZ
<<16)|
MACH_PRAVETZ
 );

1091 
	`još·th
Ð
³·th
, 
³fže
 );

1092 
	`diskimage_lßd
Ð
Üic
, 
fž‘mp
, 0 );

1093 
	`´avdiskboÙ
Ð
Üic
 );

1095 
	`£‹mumode
Ð
Üic
, 
NULL
, 
EM_RUNNING
 );

1099 ià(
	`msgbox
(
Üic
, 
MSGBOX_YES_NO
,

1103 
	`još·th
Ð
³·th
, 
³fže
 );

1104 
	`diskimage_lßd
Ð
Üic
, 
fž‘mp
, 0 );

1106 
	`£‹mumode
Ð
Üic
, 
NULL
, 
EM_RUNNING
 );

1109 
IMG_GUESS_MICRODISC
:

1110 ià((
Üic
->
driv‘y³
 =ð
DRV_PRAVETZ
) ||

1111 (
Üic
->
driv‘y³
 =ð
DRV_NONE
))

1113 ià(
	`msgbox
(
Üic
, 
MSGBOX_YES_NO
,

1117 
	`sw­mach
Ð
Üic
, 
NULL
, (
DRV_MICRODISC
<<16)|Üic->
ty³
 );

1118 
	`još·th
Ð
³·th
, 
³fže
 );

1119 
	`diskimage_lßd
Ð
Üic
, 
fž‘mp
, 0 );

1121 
	`£‹mumode
Ð
Üic
, 
NULL
, 
EM_RUNNING
 );

1125 ià(
	`msgbox
(
Üic
, 
MSGBOX_YES_NO
,

1129 
	`još·th
Ð
³·th
, 
³fže
 );

1130 
	`diskimage_lßd
Ð
Üic
, 
fž‘mp
, 0 );

1132 
	`£‹mumode
Ð
Üic
, 
NULL
, 
EM_RUNNING
 );

1136 
	`³_lßd_p
Ð
Üic
, 
fž‘mp
 );

1137 ifÐ
Üic
->
symbÞ§utÞßd
 ) 
	`mÚ_Ãw_symbÞs
Ð&Üic->
u£rsyms
, oric, "symbÞs", 
SYM_BESTGUESS
, 
SDL_TRUE
, SDL_TRUE );

1138 
	`£‹mumode
Ð
Üic
, 
NULL
, 
EM_RUNNING
 );

1139 
	}
}

1142 
	$š£¹disk
Ð
machše
 *
Üic
, 
osdm’u™em
 *
m™em
, 
drive
 )

1144 *
d·th
, *
dfže
;

1146 ifÐ
Üic
->
ty³
 !ð
MACH_TELESTRAT
 )

1148 
Üic
->
driv‘y³
)

1150 
DRV_PRAVETZ
:

1151 
d·th
 = 
´avdisk·th
;

1152 
dfže
 = 
´avdiskfže
;

1156 
d·th
 = 
disk·th
;

1157 
dfže
 = 
diskfže
;

1161 
d·th
 = 
‹Ëdisk·th
;

1162 
dfže
 = 
‹Ëdiskfže
;

1165 ifÐ!
	`fž”eque¡”
Ð
Üic
, "In£¹ disk", 
d·th
, 
dfže
, 
FR_DISKLOAD
 ) ) ;

1166 
	`još·th
Ð
d·th
, 
dfže
 );

1168 
	`d‘eù_image_ty³
(
fž‘mp
))

1170 
IMG_SNAPSHOT
:

1171 ià(
	`msgbox
(
Üic
, 
MSGBOX_YES_NO
,

1175 
	`lßd_¢­shÙ
(
Üic
, 
fž‘mp
);

1180 
IMG_ATMOS_MICRODISC
:

1181 ià((
Üic
->
ty³
 !ð
MACH_ATMOS
) &&

1182 (
Üic
->
ty³
 !ð
MACH_ORIC1
) &&

1183 (
Üic
->
ty³
 !ð
MACH_PRAVETZ
))

1185 ià(
	`msgbox
(
Üic
, 
MSGBOX_YES_NO
,

1189 
	`sw­mach
Ð
Üic
, 
NULL
, (
DRV_MICRODISC
<<16)|
MACH_ATMOS
 );

1194 ià((
Üic
->
driv‘y³
 !ð
DRV_MICRODISC
) &&

1195 (
Üic
->
driv‘y³
 !ð
DRV_NONE
))

1197 ià(
	`msgbox
(
Üic
, 
MSGBOX_YES_NO
,

1201 
	`sw­mach
Ð
Üic
, 
NULL
, (
DRV_MICRODISC
<<16)|Üic->
ty³
 );

1207 
IMG_ATMOS_JASMIN
:

1208 ià((
Üic
->
ty³
 !ð
MACH_ATMOS
) &&

1209 (
Üic
->
ty³
 !ð
MACH_ORIC1
) &&

1210 (
Üic
->
ty³
 !ð
MACH_PRAVETZ
))

1212 ià(
	`msgbox
(
Üic
, 
MSGBOX_YES_NO
,

1216 
	`sw­mach
Ð
Üic
, 
NULL
, (
DRV_JASMIN
<<16)|
MACH_ATMOS
 );

1217 
Üic
->
auto_jasmš_»£t
 = 
SDL_TRUE
;

1222 ià(
Üic
->
driv‘y³
 =ð
DRV_NONE
)

1224 
	`sw­mach
Ð
Üic
, 
NULL
, (
DRV_JASMIN
<<16)|Üic->
ty³
);

1225 
Üic
->
auto_jasmš_»£t
 = 
SDL_TRUE
;

1229 ià(
Üic
->
driv‘y³
 !ð
DRV_JASMIN
)

1231 ià(
	`msgbox
(
Üic
, 
MSGBOX_YES_NO
,

1235 
	`sw­mach
Ð
Üic
, 
NULL
, (
DRV_JASMIN
<<16)|Üic->
ty³
 );

1236 
Üic
->
auto_jasmš_»£t
 = 
SDL_TRUE
;

1242 
IMG_TELESTRAT_DISK
:

1243 ià(
Üic
->
ty³
 !ð
MACH_TELESTRAT
)

1245 ià(
	`msgbox
(
Üic
, 
MSGBOX_YES_NO
,

1249 
	`sw­mach
Ð
Üic
, 
NULL
, 
MACH_TELESTRAT
 );

1255 
IMG_PRAVETZ_DISK
:

1256 ià(
Üic
->
ty³
 !ð
MACH_PRAVETZ
)

1258 ià(
	`msgbox
(
Üic
, 
MSGBOX_YES_NO
,

1262 
	`sw­mach
Ð
Üic
, 
NULL
, (
DRV_PRAVETZ
<<16)|
MACH_PRAVETZ
 );

1263 
	`´avdiskboÙ
Ð
Üic
 );

1268 ià(
Üic
->
driv‘y³
 =ð
DRV_NONE
)

1270 
	`sw­mach
Ð
Üic
, 
NULL
, (
DRV_PRAVETZ
<<16)|
MACH_PRAVETZ
 );

1271 
	`´avdiskboÙ
Ð
Üic
 );

1275 ià(
Üic
->
driv‘y³
 !ð
DRV_PRAVETZ
)

1277 ià(
	`msgbox
(
Üic
, 
MSGBOX_YES_NO
,

1281 
	`sw­mach
Ð
Üic
, 
NULL
, (
DRV_PRAVETZ
<<16)|
MACH_PRAVETZ
 );

1282 
	`´avdiskboÙ
Ð
Üic
 );

1288 
IMG_GUESS_MICRODISC
:

1289 ià(
Üic
->
driv‘y³
 =ð
DRV_PRAVETZ
)

1291 ià(
	`msgbox
(
Üic
, 
MSGBOX_YES_NO
,

1295 
	`sw­mach
Ð
Üic
, 
NULL
, (
DRV_MICRODISC
<<16)|Üic->
ty³
 );

1301 
IMG_TAPE
:

1302 ià(
	`msgbox
(
Üic
, 
MSGBOX_YES_NO
,

1306 
Üic
->
Ï¡³fže
[0] = 0;

1307 
	`³_lßd_p
Ð
Üic
, 
fž‘mp
 );

1308 ifÐ
Üic
->
symbÞ§utÞßd
 ) 
	`mÚ_Ãw_symbÞs
Ð&Üic->
u£rsyms
, oric, "symbÞs", 
SYM_BESTGUESS
, 
SDL_TRUE
, SDL_TRUE );

1310 
	`£‹mumode
Ð
Üic
, 
NULL
, 
EM_RUNNING
 );

1314 
	`još·th
Ð
d·th
, 
dfže
 );

1315 
	`diskimage_lßd
Ð
Üic
, 
fž‘mp
, 
drive
 );

1317 ifÐ
Üic
->
driv‘y³
 =ð
DRV_NONE
 )

1319 
	`sw­mach
Ð
Üic
, 
NULL
, (
DRV_MICRODISC
<<16)|Üic->
ty³
 );

1323 
	`£‹mumode
Ð
Üic
, 
NULL
, 
EM_RUNNING
 );

1324 
	}
}

1326 
	$§ve¢­
Ð
machše
 *
Üic
, 
osdm’u™em
 *
m™em
, 
dummy
 )

1328 ifÐ!
	`fž”eque¡”
Ð
Üic
, "SavSÇpshÙ", 
¢­·th
, 
¢­fže
, 
FR_SNAPSHOTSAVE
 ) ) ;

1329 
	`još·th
Ð
¢­·th
, 
¢­fže
 );

1330 
	`§ve_¢­shÙ
Ð
Üic
, 
fž‘mp
 );

1331 
	}
}

1333 
	$lßd¢­
Ð
machše
 *
Üic
, 
osdm’u™em
 *
m™em
, 
dummy
 )

1335 ifÐ!
	`fž”eque¡”
Ð
Üic
, "Lßd SÇpshÙ", 
¢­·th
, 
¢­fže
, 
FR_SNAPSHOTLOAD
 ) ) ;

1336 
	`još·th
Ð
¢­·th
, 
¢­fže
 );

1337 
	`lßd_¢­shÙ
Ð
Üic
, 
fž‘mp
 );

1338 
	}
}

1340 
	$soá»£tÜic
(
machše
 *
Üic
, 
osdm’u™em
 *
m™em
, 
dummy
)

1342 
Üic
->
ýu
.
nmi
 = 
SDL_TRUE
;

1343 
Üic
->
ýu
.
nmicouÁ
 = 2;

1344 
	`£‹mumode
(
Üic
, 
NULL
, 
EM_RUNNING
);

1345 
	}
}

1348 
	$»£tÜic
Ð
machše
 *
Üic
, 
osdm’u™em
 *
m™em
, 
dummy
 )

1350  
Üic
->
driv‘y³
 )

1352 
DRV_MICRODISC
:

1353 
Üic
->
romdis
 = 
SDL_TRUE
;

1354 
	`miüodisc_š™
Ð&
Üic
->
md
, &Üic->
wddisk
, oric );

1357 
DRV_JASMIN
:

1358 
Üic
->
romdis
 = 
SDL_TRUE
;

1362 
Üic
->
romdis
 = 
SDL_FALSE
;

1365 
	`£ŒomÚ
Ð
Üic
 );

1366 
	`m6502_»£t
Ð&
Üic
->
ýu
 );

1367 
	`vŸ_š™
Ð&
Üic
->
vŸ
, oric, 
VIA_MAIN
 );

1368 
	`vŸ_š™
Ð&
Üic
->
‹Ë_vŸ
, oric, 
VIA_TELESTRAT
 );

1369 
	`ay_š™
Ð&
Üic
->
ay
, oric );

1370 
Üic
->
ýu
.
¿¡”cyþes
 = oric->
cyþe¥”¿¡”
;

1371 
Üic
->
äames
 = 0;

1372 ifÐ
Üic
->
autÜewšd
 ) 
	`³_»wšd
( oric );

1373 
	`£‹mumode
Ð
Üic
, 
NULL
, 
EM_RUNNING
 );

1374 
	}
}

1376 
osdm’u™em
 *
	$fšd_™em_by_funùiÚ
(
osdm’u™em
 *
m’u
, *
funùiÚ
)

1378 
i
;

1379 
osdm’u™em
 
dummy™em
;

1381 
i
=0; 
m’u
[i].
Çme
; i++)

1382 ià(
m’u
[
i
].
func
 =ð
funùiÚ
)

1383  &
m’u
[
i
];

1385  &
dummy™em
;

1386 
	}
}

1388 
osdm’u™em
 *
	$fšd_™em_by_funùiÚ_ªd_¬g
(
osdm’u™em
 *
m’u
, *
funùiÚ
, 
¬g
)

1390 
i
;

1391 
osdm’u™em
 
dummy™em
;

1393 
i
=0; 
m’u
[i].
Çme
; i++)

1394 ià((
m’u
[
i
].
func
 =ð
funùiÚ
è&& (m’u[i].
¬g
 ==‡rg))

1395  &
m’u
[
i
];

1397  &
dummy™em
;

1398 
	}
}

1400 
osdm’u™em
 *
	$fšd_™em_by_key
(
osdm’u™em
 *
m’u
, 
sdlkey
)

1402 
i
;

1403 
osdm’u™em
 
dummy™em
;

1405 
i
=0; 
m’u
[i].
Çme
; i++)

1406 ià(
m’u
[
i
].
sdlkey
 == sdlkey)

1407  &
m’u
[
i
];

1409  &
dummy™em
;

1410 
	}
}

1413 
	$toggË³noi£
Ð
machše
 *
Üic
, 
osdm’u™em
 *
m™em
, 
dummy
 )

1415 ifÐ
Üic
->
³noi£
 )

1417 
Üic
->
ay
.
³out
 = 0;

1418 
Üic
->
³noi£
 = 
SDL_FALSE
;

1419 
m™em
->
Çme
 = " Tape‚oise";

1423 
Üic
->
³noi£
 = 
SDL_TRUE
;

1424 
m™em
->
Çme
 = "\x0e""Tape‚oise";

1425 
	}
}

1428 
	$toggËsound
Ð
machše
 *
Üic
, 
osdm’u™em
 *
m™em
, 
dummy
 )

1430 ifÐÐ
soundÚ
 ) || (!
soundavažabË
) )

1432 
soundÚ
 = 
SDL_FALSE
;

1433 
Üic
->
ay
.
soundÚ
 = 
SDL_FALSE
;

1434 
m™em
->
Çme
 = " Soundƒnabled";

1435 ifÐ
soundavažabË
 ) 
	`SDL_Pau£Audio
( 1 );

1439 
soundÚ
 = 
SDL_TRUE
;

1440 
Üic
->
ay
.
soundÚ
 = !
w¬p¥“d
;

1441 
m™em
->
Çme
 = "\x0e""Soundƒnabled";

1442 ifÐ
Üic
->
emu_mode
 =ð
EM_RUNNING
 ) 
	`SDL_Pau£Audio
Ð!
w¬p¥“d
 );

1443 
	}
}

1446 
	$toggË³turbo
Ð
machše
 *
Üic
, 
osdm’u™em
 *
m™em
, 
dummy
 )

1448 
Üic
->
³turbo_fÜûoff
 = 
SDL_FALSE
;

1450 ifÐ
Üic
->
³turbo
 )

1452 
Üic
->
³turbo
 = 
SDL_FALSE
;

1453 
m™em
->
Çme
 = " Turboape";

1457 
Üic
->
³turbo
 = 
SDL_TRUE
;

1458 
m™em
->
Çme
 = "\x0e""Turboape";

1459 
	}
}

1462 
	$toggËvsynchack
Ð
machše
 *
Üic
, 
osdm’u™em
 *
m™em
, 
dummy
 )

1464 ifÐ
Üic
->
vsynchack
 )

1466 
Üic
->
vsynchack
 = 
SDL_FALSE
;

1467 
m™em
->
Çme
 = " VSync hack";

1471 
Üic
->
vsynchack
 = 
SDL_TRUE
;

1472 
m™em
->
Çme
 = "\x0e""VSync hack";

1473 
	}
}

1476 
	$toggËligh’
Ð
machše
 *
Üic
, 
osdm’u™em
 *
m™em
, 
dummy
 )

1478 ifÐ
Üic
->
ligh’
 )

1480 
Üic
->
ligh’
 = 
SDL_FALSE
;

1481 
Üic
->
ýu
.
»ad
 = oric->
»ad_nÙ_ligh’
;

1482 
m™em
->
Çme
 = " Lightpen";

1486 
Üic
->
ligh’
 = 
SDL_TRUE
;

1487 
Üic
->
ýu
.
»ad
 = 
ligh’_»ad
;

1488 
m™em
->
Çme
 = "\x0e""Lightpen";

1489 
	}
}

1492 
	$toggËacŸback’d
Ð
machše
 *
Üic
, 
osdm’u™em
 *
m™em
, 
dummy
 )

1494 ifÐ
Üic
->
acŸback’d
 )

1496 
Üic
->
acŸback’d
 = 
ACIA_TYPE_NONE
;

1497 
m™em
->
Çme
 = 
acŸback’ds
[
Üic
->
acŸback’d
];

1501 
Üic
->
acŸback’d
 = oric->
acŸback’dcfg
;

1502 
m™em
->
Çme
 = 
acŸback’dÏb–
;

1505 
	`acŸ_š™
Ð&
Üic
->
‹Ë_acŸ
, oric );

1506 
	}
}

1509 
	$toggËch376
(
machše
 *
Üic
, 
osdm’u™em
 *
m™em
, 
dummy
)

1512 ià(
Üic
->
ch376_aùiv©ed
)

1514 
Üic
->
ch376_aùiv©ed
 = 
SDL_FALSE
;

1515 
m™em
->
Çme
 = " CH376 (Telestrat)";

1519 
Üic
->
ch376_aùiv©ed
 = 
SDL_TRUE
;

1520 
m™em
->
Çme
 = "\x0e""CH376 (Telestrat)";

1521 
Üic
->
ch376
 = 
	`ch376_Üic_š™
();

1522 ià(
Üic
->
ch376
 !ð
NULL
)

1523 
	`ch376_Üic_cÚfig
(
Üic
->
ch376
);

1524 
	}
}

1527 
	$toggËsymbÞ§uto
Ð
machše
 *
Üic
, 
osdm’u™em
 *
m™em
, 
dummy
 )

1529 ifÐ
Üic
->
symbÞ§utÞßd
 )

1531 
Üic
->
symbÞ§utÞßd
 = 
SDL_FALSE
;

1532 
m™em
->
Çme
 = " Autoload symbols file";

1536 
Üic
->
symbÞ§utÞßd
 = 
SDL_TRUE
;

1537 
m™em
->
Çme
 = "\x0e""Autoload symbols file";

1538 
	}
}

1541 
	$toggËÿ£syms
Ð
machše
 *
Üic
, 
osdm’u™em
 *
m™em
, 
dummy
 )

1543 ifÐ
Üic
->
symbÞsÿ£
 )

1545 
Üic
->
symbÞsÿ£
 = 
SDL_FALSE
;

1546 
m™em
->
Çme
 = " Case-sensitive symbols";

1550 
Üic
->
symbÞsÿ£
 = 
SDL_TRUE
;

1551 
m™em
->
Çme
 = "\x0e""Case-sensitive symbols";

1552 
	}
}

1555 
	$toggËautowšd
Ð
machše
 *
Üic
, 
osdm’u™em
 *
m™em
, 
dummy
 )

1557 ifÐ
Üic
->
autÜewšd
 )

1559 
Üic
->
autÜewšd
 = 
SDL_FALSE
;

1560 
m™em
->
Çme
 = " Autorewindape";

1564 
Üic
->
autÜewšd
 = 
SDL_TRUE
;

1565 
m™em
->
Çme
 = "\x0e""Autorewindape";

1566 
	}
}

1569 
	$toggËautoš¤t
Ð
machše
 *
Üic
, 
osdm’u™em
 *
m™em
, 
dummy
 )

1571 ifÐ
Üic
->
autoš£¹
 )

1573 
Üic
->
autoš£¹
 = 
SDL_FALSE
;

1574 
m™em
->
Çme
 = " Autoinsertape";

1578 
Üic
->
autoš£¹
 = 
SDL_TRUE
;

1579 
m™em
->
Çme
 = "\x0e""Autoinsertape";

1580 
	}
}

1583 
	$toggËfuÎsü“n
Ð
machše
 *
Üic
, 
osdm’u™em
 *
m™em
, 
dummy
 )

1585 ifÐ!
Üic
->
	`»nd”_toggËfuÎsü“n
( oric ) ) ;

1587 ifÐ
fuÎsü“n
 )

1589 
	`fšd_™em_by_funùiÚ
(
vdÝ™ems
, 
toggËfuÎsü“n
)->
Çme
 = "\x0e""Fullscreen";

1590 
	`fšd_™em_by_funùiÚ
(
glÝ™ems
, 
toggËfuÎsü“n
)->
Çme
 = "\x0e""Fullscreen";

1594 
	`fšd_™em_by_funùiÚ
(
vdÝ™ems
, 
toggËfuÎsü“n
)->
Çme
 = " Fullscreen";

1595 
	`fšd_™em_by_funùiÚ
(
glÝ™ems
, 
toggËfuÎsü“n
)->
Çme
 = " Fullscreen";

1596 
	}
}

1599 
	$toggË¬©io
Ð
machše
 *
Üic
, 
osdm’u™em
 *
m™em
, 
dummy
 )

1601 ifÐ
Üic
->
¬©io
 )

1603 
Üic
->
¬©io
 = 
SDL_FALSE
;

1604 
m™em
->
Çme
 = " 50Hz/60Hz‡spect„atio";

1608 
Üic
->
¬©io
 = 
SDL_TRUE
;

1609 
m™em
->
Çme
 = "\x0e""50Hz/60Hz‡spect„atio";

1610 
	}
}

1613 
	$toggËh¡»tch
Ð
machše
 *
Üic
, 
osdm’u™em
 *
m™em
, 
dummy
 )

1615 ifÐ
Üic
->
h¡»tch
 )

1617 
Üic
->
h¡»tch
 = 
SDL_FALSE
;

1618 
m™em
->
Çme
 = " Horizontal stretch";

1622 
Üic
->
h¡»tch
 = 
SDL_TRUE
;

1623 
m™em
->
Çme
 = "\x0e""Horizontal stretch";

1624 
	}
}

1627 
	$toggË·lgho¡
Ð
machše
 *
Üic
, 
osdm’u™em
 *
m™em
, 
dummy
 )

1629 ifÐ
Üic
->
·lgho¡
 )

1631 
Üic
->
·lgho¡
 = 
SDL_FALSE
;

1632 
m™em
->
Çme
 = " PAL ghosting";

1636 
Üic
->
·lgho¡
 = 
SDL_TRUE
;

1637 
m™em
->
Çme
 = "\x0e""PAL ghosting";

1638 
	}
}

1641 
	$toggËsÿÆšes
Ð
machše
 *
Üic
, 
osdm’u™em
 *
m™em
, 
dummy
 )

1643 ifÐ
Üic
->
sÿÆšes
 )

1645 
Üic
->
sÿÆšes
 = 
SDL_FALSE
;

1646 
	`fšd_™em_by_funùiÚ
(
vdÝ™ems
, 
toggËsÿÆšes
)->
Çme
 = " Scanlines";

1647 
	`fšd_™em_by_funùiÚ
(
glÝ™ems
, 
toggËsÿÆšes
)->
Çme
 = " Scanlines";

1651 
Üic
->
sÿÆšes
 = 
SDL_TRUE
;

1652 
	`fšd_™em_by_funùiÚ
(
vdÝ™ems
, 
toggËsÿÆšes
)->
Çme
 = "\x0e""Scanlines";

1653 
	`fšd_™em_by_funùiÚ
(
glÝ™ems
, 
toggËsÿÆšes
)->
Çme
 = "\x0e""Scanlines";

1654 
	}
}

1656 
	$£tov”þock
Ð
machše
 *
Üic
, 
osdm’u™em
 *
m™em
, 
v®ue
 )

1658 
i
;

1662 *
£Šames
[] = { "\x0e"" 1MHz (None)", "\x0e"" 2MHz", "\x0e"" 4MHz", "\x0e"" 8MHz",

1664 *
un£Šames
[] = { " 1MHz (None)", " 2MHz", " 4MHz", " 8MHz",

1667 
Üic
->
ov”þockmuÉ
 = 1<<
v®ue
;

1668 
Üic
->
ov”þockshiá
 = 
v®ue
;

1670  
i
=0; i<7; i++ )

1672 if(
i
 =ð
v®ue
)

1673 
ovÝ™ems
[
i
].
Çme
 = 
£Šames
[i];

1675 
ovÝ™ems
[
i
].
Çme
 = 
un£Šames
[i];

1677 
	}
}

1680 
	$gÙos™e
Ð
machše
 *
Üic
, 
osdm’u™em
 *
m™em
, 
dummy
 )

1683 #ià
	`defšed
(
__MORPHOS__
è|| defšed(
__AROS__
)

1684 
Lib¿ry
 *
O³nURLBa£
 = 
	`O³nLib¿ry
( "openurl.library", 0 );

1685 cÚ¡ 
TagI‹m
 
URLTags
[] = {{
TAG_DONE
, (
ULONG
è
NULL
}};

1687 ifÐ
O³nURLBa£
 )

1689 
	`URL_O³nA
(
m™em
->
Çme
, (
TagI‹m
*è
URLTags
);

1690 
	`Clo£Lib¿ry
Ð
O³nURLBa£
 );

1693 #–ià
	`defšed
(
__amigaos4__
)

1694 
tmp
[256];

1695 
BPTR
 
h
;

1696 
	`¥rštf
Ð
tmp
, "URL:%s", 
m™em
->
Çme
 );

1697 ifÐÐ
h
 = 
IDOS
->
	`O³n
Ð
tmp
, 
MODE_OLDFILE
 ) ) ) IDOS->
	`Clo£
( h );

1699 #–ià
	`defšed
(
WIN32
è|| defšed(
__APPLE__
è|| defšed(
__BEOS__
è|| defšed(
__HAIKU__
)

1700 
	`gui_Ý’_u¾
Ð
m™em
->
Çme
 );

1704 
tmp
[256];

1705 
	`¥rštf
Ð
tmp
, "xdg-Ý’ '%s'", 
m™em
->
Çme
 );

1706 
	`sy¡em
Ð
tmp
 );

1709 
	}
}

1712 
	$gÙom’u
Ð
machše
 *
Üic
, 
osdm’u™em
 *
m™em
, 
m’unum
 )

1714 
i
, 
w
, 
keyw
;

1716 ifÐ
tz
[
TZ_MENU
] ) 
	`ä“_‹xtzÚe
Ð
Üic
, TZ_MENU );

1718 
cm’u
 = &
m’us
[
m’unum
];

1719 
w
 = ()
	`¡¾’
Ð
cm’u
->
t™Ë
 )+8;

1720 
keyw
 = 0;

1721  
i
=0; 
cm’u
->
™ems
[i].
Çme
; i++ )

1723 ifÐ
cm’u
->
™ems
[
i
].
Çme
 =ð
OSDMENUBAR
 )

1725 ifÐ
	`¡¾’
Ð
cm’u
->
™ems
[
i
].
Çme
 ) > 
w
 )

1726 
w
 = ()
	`¡¾’
Ð
cm’u
->
™ems
[
i
].
Çme
 );

1727 ifÐ
cm’u
->
™ems
[
i
].
key
 )

1729 ifÐ(
	`¡¾’
Ð
cm’u
->
™ems
[
i
].
key
 )+1è> 
keyw
 )

1730 
keyw
 = ()
	`¡¾’
Ð
cm’u
->
™ems
[
i
].
key
 )+1;

1734 
w
+=
keyw
+2; 
i
+=2;

1736 ifÐ!
	`®loc_‹xtzÚe
Ð
Üic
, 
TZ_MENU
, 320-
w
*4, 240-
i
*6, w, i, 
cm’u
->
t™Ë
 ) )

1738 
cm’u
 = 
NULL
;

1739 
Üic
->
emu_mode
 = 
EM_RUNNING
;

1743 
	`d¿w™ems
();

1744 
	}
}

1746 
	$toggËkeybßrd
Ð
machše
 *
Üic
, 
osdm’u™em
 *
m™em
, 
dummy
 )

1748 ifÐ
Üic
->
show_keybßrd
 )

1750 
Üic
->
show_keybßrd
 = 
SDL_FALSE
;

1751 
m™em
->
Çme
 = " Show keyboard";

1752 
Üic
->
	`shut_»nd”
(oric);

1753 
Üic
->
	`š™_»nd”
(oric);

1757 
Üic
->
show_keybßrd
 = 
SDL_TRUE
;

1758 
m™em
->
Çme
 = "\x0e""Show keyboard";

1759 
Üic
->
	`shut_»nd”
(oric);

1760 
Üic
->
	`š™_»nd”
(oric);

1761 
	`£‹mumode
Ð
Üic
, 
NULL
, 
EM_RUNNING
 );

1762 
	}
}

1764 
	$defšem­pšg
Ð
machše
 *
Üic
, 
osdm’u™em
 *
m™em
, 
dummy
 )

1766 ifÐ
Üic
->
defše_m­pšg
 )

1768 
Üic
->
defše_m­pšg
 = 
SDL_FALSE
;

1769 
m™em
->
Çme
 = " Define mapping";

1773 
Üic
->
defše_m­pšg
 = 
SDL_TRUE
;

1774 
m™em
->
Çme
 = "\x0e""Define mapping";

1775 if(!
Üic
->
show_keybßrd
) {

1776 
	`fšd_™em_by_funùiÚ
(
keÝ™ems
, 
toggËkeybßrd
)->
Çme
 = "\x0e""Show keyboard";

1777 
Üic
->
show_keybßrd
 = 
SDL_TRUE
;

1778 
Üic
->
	`shut_»nd”
(oric);

1779 
Üic
->
	`š™_»nd”
(oric);

1781 
cm’u
 = 
NULL
;

1782 
Üic
->
emu_mode
 = 
EM_RUNNING
;

1783 
	`do_pÝup
Ð
Üic
, "Click on‡n Oric key." );

1784 
	`£‹mumode
Ð
Üic
, 
NULL
, 
EM_RUNNING
 );

1785 
	}
}

1787 
	$toggË¡ickykeys
Ð
machše
 *
Üic
, 
osdm’u™em
 *
m™em
, 
dummy
 )

1789 ifÐ
Üic
->
¡icky_mod_keys
 )

1791 
Üic
->
¡icky_mod_keys
 = 
SDL_FALSE
;

1792 
m™em
->
Çme
 = " Sticky mod keys";

1793 
	`»Ëa£_¡icky_keys
();

1797 
Üic
->
¡icky_mod_keys
 = 
SDL_TRUE
;

1798 
m™em
->
Çme
 = "\x0e""Sticky mod keys";

1799 
	`£‹mumode
Ð
Üic
, 
NULL
, 
EM_RUNNING
 );

1800 
	}
}

1803 
	$§vem­pšg
Ð
machše
 *
Üic
, 
osdm’u™em
 *
m™em
, 
dummy
 )

1805 ifÐ!
	`fž”eque¡”
Ð
Üic
, "SavKeybßrd M­pšg", 
m­pšg·th
, 
m­pšgfže
, 
FR_KEYMAPPINGSAVE
 ) ) ;

1806 
	`još·th
Ð
m­pšg·th
, 
m­pšgfže
 );

1807 
	`§ve_keybßrd_m­pšg
(
Üic
, 
fž‘mp
);

1808 
	`£‹mumode
Ð
Üic
, 
NULL
, 
EM_RUNNING
 );

1809 
	}
}

1811 
	$lßdm­pšg
Ð
machše
 *
Üic
, 
osdm’u™em
 *
m™em
, 
dummy
 )

1813 ifÐ!
	`fž”eque¡”
Ð
Üic
, "Lßd Keybßrd M­pšg", 
m­pšg·th
, 
m­pšgfže
, 
FR_KEYMAPPINGLOAD
 ) ) ;

1814 
	`još·th
Ð
m­pšg·th
, 
m­pšgfže
 );

1815 
	`lßd_keybßrd_m­pšg
(
Üic
, 
fž‘mp
);

1816 
	`£‹mumode
Ð
Üic
, 
NULL
, 
EM_RUNNING
 );

1817 
	}
}

1819 
	$»£tm­pšg
Ð
machše
 *
Üic
, 
osdm’u™em
 *
m™em
, 
dummy
 )

1821 
	`»£t_keybßrd_m­pšg
(&(
Üic
->
keybßrd_m­pšg
));

1822 
	`£‹mumode
Ð
Üic
, 
NULL
, 
EM_RUNNING
 );

1823 
	}
}

1825 #ifdeà
__CBCOPY__


1826 
	$þbd_cÝy_gui
Ð
machše
 *
Üic
, 
osdm’u™em
 *
m™em
, 
dummy
 )

1828 
	`þbßrd_cÝy
(
Üic
);

1829 
	`£‹mumode
Ð
Üic
, 
NULL
, 
EM_RUNNING
 );

1830 
	}
}

1832 #ifdeà
__CBPASTE__


1833 
	$þbd_·¡e_gui
Ð
machše
 *
Üic
, 
osdm’u™em
 *
m™em
, 
dummy
 )

1835 
	`þbßrd_·¡e
(
Üic
);

1836 
	`£‹mumode
Ð
Üic
, 
NULL
, 
EM_RUNNING
 );

1837 
	}
}

1844 
SDL_boÞ
 
	$m’u_ev’t
Ð
SDL_Ev’t
 *
ev
, 
machše
 *
Üic
, 
SDL_boÞ
 *
Ãed»nd”
 )

1846 
SDL_boÞ
 
dÚe
 = 
SDL_FALSE
;

1847 
i
, 
x
, 
y
;

1850 ifÐÐ!
cm’u
 ) || ( !
tz
[
TZ_MENU
] ) )

1851  
dÚe
;

1853 
x
 = -1;

1854 
y
 = -1;

1855  
ev
->
ty³
 )

1857 
SDL_MOUSEMOTION
:

1858 
x
 = (
ev
->
mÙiÚ
.x - 
tz
[
TZ_MENU
]->x)/8;

1859 
y
 = (
ev
->
mÙiÚ
.y - 
tz
[
TZ_MENU
]->y)/12-1;

1862 
SDL_MOUSEBUTTONDOWN
:

1863 ifÐ
ev
->
bu‰Ú
.bu‰Ú =ð
SDL_BUTTON_LEFT
 )

1865 
x
 = (
ev
->
bu‰Ú
.x - 
tz
[
TZ_MENU
]->x)/8;

1866 
y
 = (
ev
->
bu‰Ú
.y - 
tz
[
TZ_MENU
]->y)/12-1;

1871  
ev
->
ty³
 )

1873 
SDL_COMPAT_ACTIVEEVENT
:

1874 if(
	`SDL_COMPAT_IsAµFocu£d
(
ev
)) {

1875 *
Ãed»nd”
 = 
SDL_TRUE
;

1879 
SDL_MOUSEMOTION
:

1880 
SDL_MOUSEBUTTONDOWN
:

1881 
x
 = (
ev
->
mÙiÚ
.x - 
tz
[
TZ_MENU
]->x)/8;

1882 
y
 = (
ev
->
mÙiÚ
.y - 
tz
[
TZ_MENU
]->y)/12-1;

1884 ifÐÐ
x
 < 0 ) || ( 
y
 < 0 ) ||

1885 Ð
x
 >ð
tz
[
TZ_MENU
]->
w
 ) )

1888  
i
=0; i<
y
; i++ )

1889 ifÐ
cm’u
->
™ems
[
i
].
Çme
 =ð
NULL
 )

1892 ifÐÐ
i
 !ð
y
 ) || ( 
cm’u
->
™ems
[y].
Çme
 =ð
OSDMENUBAR
 ) || ( cm’u->™ems[y].
func
 =ð
NULL
 ) )

1895 
cm’u
->
c™em
 = 
y
;

1897 ifÐÐ
ev
->
ty³
 =ð
SDL_MOUSEBUTTONDOWN
 ) &&

1898 Ð(
ev
->
bu‰Ú
.bu‰Ú==
SDL_BUTTON_LEFT
) ||

1899 (
ev
->
bu‰Ú
.bu‰Ú==
SDL_BUTTON_RIGHT
) ) )

1900 
cm’u
->
™ems
[cm’u->
c™em
].
	`func
Ð
Üic
, &cm’u->™ems[cm’u->c™em], cm’u->™ems[cm’u->c™em].
¬g
 );

1902 
	`d¿w™ems
();

1903 *
Ãed»nd”
 = 
SDL_TRUE
;

1906 
SDL_KEYDOWN
:

1907  
ev
->
key
.
keysym
.
sym
 )

1909 
SDLK_UP
:

1911 
i
 = 
cm’u
->
c™em
-1;

1912  ( 
cm’u
->
™ems
[
i
].
Çme
 =ð
OSDMENUBAR
 ) ||

1913 Ð
cm’u
->
™ems
[
i
].
func
 =ð
NULL
 ) )

1915 ifÐ
i
 < 0 ) ;

1916 
i
--;

1920 ifÐÐ
i
 < 0 ) || ( 
cm’u
->
™ems
[i].
Çme
 =ð
OSDMENUBAR
 ) )

1923  
i
=0; 
cm’u
->
™ems
[i].
Çme
; i++ ) ;

1924 
i
--;

1927  ( 
cm’u
->
™ems
[
i
].
Çme
 =ð
OSDMENUBAR
 ) ||

1928 Ð
cm’u
->
™ems
[
i
].
func
 =ð
NULL
 ) )

1930 ifÐ
i
 < 0 ) ;

1931 
i
--;

1933 ifÐÐ
i
 < 0 ) || ( 
cm’u
->
™ems
[i].
Çme
 =ð
OSDMENUBAR
 ) ) ;

1935 
cm’u
->
c™em
 = 
i
;

1936 
	`d¿w™ems
();

1937 *
Ãed»nd”
 = 
SDL_TRUE
;

1940 
SDLK_DOWN
:

1941 
i
 = 
cm’u
->
c™em
+1;

1942  ( 
cm’u
->
™ems
[
i
].
Çme
 =ð
OSDMENUBAR
 ) ||

1943 Ð
cm’u
->
™ems
[
i
].
func
 =ð
NULL
 ) )

1945 ifÐ
cm’u
->
™ems
[
i
].
Çme
 =ð
NULL
 ) ;

1946 
i
++;

1949 ifÐÐ
cm’u
->
™ems
[
i
].
Çme
 =ð
NULL
 ) || ( cm’u->™ems[i].Çm=ð
OSDMENUBAR
 ) )

1951 
i
=0;

1953  ( 
cm’u
->
™ems
[
i
].
Çme
 =ð
OSDMENUBAR
 ) ||

1954 Ð
cm’u
->
™ems
[
i
].
func
 =ð
NULL
 ) )

1956 ifÐ
cm’u
->
™ems
[
i
].
Çme
 =ð
NULL
 ) ;

1957 
i
++;

1960 ifÐÐ
cm’u
->
™ems
[
i
].
Çme
 =ð
NULL
 ) || ( cm’u->™ems[i].Çm=ð
OSDMENUBAR
 ) )

1964 
cm’u
->
c™em
 = 
i
;

1965 
	`d¿w™ems
();

1966 *
Ãed»nd”
 = 
SDL_TRUE
;

1974 
SDL_KEYUP
:

1975  
ev
->
key
.
keysym
.
sym
 )

1977 
SDLK_RETURN
:

1978 
SDLK_KP_ENTER
:

1979 ifÐ!
cm’u
->
™ems
[cm’u->
c™em
].
func
 ) ;

1980 
cm’u
->
™ems
[cm’u->
c™em
].
	`func
Ð
Üic
, &cm’u->™ems[cm’u->c™em], cm’u->™ems[cm’u->c™em].
¬g
 );

1981 
	`d¿w™ems
();

1982 *
Ãed»nd”
 = 
SDL_TRUE
;

1985 
SDLK_ESCAPE
:

1986 
	`£‹mumode
Ð
Üic
, 
NULL
, 
EM_RUNNING
 );

1987 *
Ãed»nd”
 = 
SDL_TRUE
;

1991  
i
=0; 
cm’u
->
™ems
[i].
Çme
; i++ )

1993 ifÐÐ
cm’u
->
™ems
[
i
].
sdlkey
 ) &&

1994 Ð
cm’u
->
™ems
[
i
].
sdlkey
 =ð
ev
->
key
.
keysym
.
sym
 ) &&

1995 Ð
cm’u
->
™ems
[
i
].
func
 ) )

1999 ifÐ!
cm’u
->
™ems
[
i
].
Çme
 ) ;

2001 
cm’u
->
™ems
[
i
].
	`func
Ð
Üic
, &cm’u->™ems[i], cm’u->™ems[i].
¬g
 );

2002 
	`d¿w™ems
();

2003 *
Ãed»nd”
 = 
SDL_TRUE
;

2009 ià(*
Ãed»nd”
è
	`uÏ_£t_dœty
(
Üic
);

2010  
dÚe
;

2011 
	}
}

2013 
	$£t_»nd”_mode
Ð
machše
 *
Üic
, 
which»nd”mode
 )

2015 
Üic
->
»nd”mode
 = 
which»nd”mode
;

2016  
which»nd”mode
 )

2018 
RENDERMODE_SW
:

2019 ià(
Üic
->
sw_d•th
 == 8)

2021 
Üic
->
»nd”_begš
 = 
»nd”_begš_sw8
;

2022 
Üic
->
»nd”_’d
 = 
»nd”_’d_sw8
;

2023 
Üic
->
»nd”_‹xtzÚe_®loc
 = 
»nd”_‹xtzÚe_®loc_sw8
;

2024 
Üic
->
»nd”_‹xtzÚe_ä“
 = 
»nd”_‹xtzÚe_ä“_sw8
;

2025 
Üic
->
»nd”_‹xtzÚe
 = 
»nd”_‹xtzÚe_sw8
;

2026 
Üic
->
»nd”_þ—r_¬—
 = 
»nd”_þ—r_¬—_sw8
;

2027 
Üic
->
»nd”_gimg
 = 
»nd”_gimg_sw8
;

2028 
Üic
->
»nd”_gimg·¹
 = 
»nd”_gimg·¹_sw8
;

2029 
Üic
->
»nd”_video
 = 
»nd”_video_sw8
;

2030 
Üic
->
»nd”_toggËfuÎsü“n
 = 
»nd”_toggËfuÎsü“n_sw8
;

2031 
Üic
->
š™_»nd”
 = 
š™_»nd”_sw8
;

2032 
Üic
->
shut_»nd”
 = 
shut_»nd”_sw8
;

2033 
	`fšd_™em_by_funùiÚ_ªd_¬g
(
vdÝ™ems
, 
sw­_»nd”_mode
, 
RENDERMODE_GL
)->
Çme
 = " OpenGL„endering";

2034 
	`fšd_™em_by_funùiÚ_ªd_¬g
(
glÝ™ems
, 
sw­_»nd”_mode
, 
RENDERMODE_GL
)->
Çme
 = " OpenGL„endering";

2035 
	`fšd_™em_by_funùiÚ_ªd_¬g
(
vdÝ™ems
, 
sw­_»nd”_mode
, 
RENDERMODE_SW
)->
Çme
 = "\x0e""Software„endering";

2036 
	`fšd_™em_by_funùiÚ_ªd_¬g
(
glÝ™ems
, 
sw­_»nd”_mode
, 
RENDERMODE_SW
)->
Çme
 = "\x0e""Software„endering";

2037 
m’us
[4].
™ems
 = 
vdÝ™ems
;

2040 
Üic
->
»nd”_begš
 = 
»nd”_begš_sw
;

2041 
Üic
->
»nd”_’d
 = 
»nd”_’d_sw
;

2042 
Üic
->
»nd”_‹xtzÚe_®loc
 = 
»nd”_‹xtzÚe_®loc_sw
;

2043 
Üic
->
»nd”_‹xtzÚe_ä“
 = 
»nd”_‹xtzÚe_ä“_sw
;

2044 
Üic
->
»nd”_‹xtzÚe
 = 
»nd”_‹xtzÚe_sw
;

2045 
Üic
->
»nd”_þ—r_¬—
 = 
»nd”_þ—r_¬—_sw
;

2046 
Üic
->
»nd”_gimg
 = 
»nd”_gimg_sw
;

2047 
Üic
->
»nd”_gimg·¹
 = 
»nd”_gimg·¹_sw
;

2048 
Üic
->
sw_d•th
)

2051 
Üic
->
»nd”_video
 = 
»nd”_video_sw_16bµ
;

2054 
Üic
->
»nd”_video
 = 
»nd”_video_sw_32bµ
;

2058 
Üic
->
»nd”_video
 = 
»nd”_video_sw_16bµ
;

2061 
Üic
->
»nd”_toggËfuÎsü“n
 = 
»nd”_toggËfuÎsü“n_sw
;

2062 
Üic
->
š™_»nd”
 = 
š™_»nd”_sw
;

2063 
Üic
->
shut_»nd”
 = 
shut_»nd”_sw
;

2064 
	`fšd_™em_by_funùiÚ_ªd_¬g
(
vdÝ™ems
, 
sw­_»nd”_mode
, 
RENDERMODE_GL
)->
Çme
 = " OpenGL„endering";

2065 
	`fšd_™em_by_funùiÚ_ªd_¬g
(
glÝ™ems
, 
sw­_»nd”_mode
, 
RENDERMODE_GL
)->
Çme
 = " OpenGL„endering";

2066 
	`fšd_™em_by_funùiÚ_ªd_¬g
(
vdÝ™ems
, 
sw­_»nd”_mode
, 
RENDERMODE_SW
)->
Çme
 = "\x0e""Software„endering";

2067 
	`fšd_™em_by_funùiÚ_ªd_¬g
(
glÝ™ems
, 
sw­_»nd”_mode
, 
RENDERMODE_SW
)->
Çme
 = "\x0e""Software„endering";

2068 
m’us
[4].
™ems
 = 
vdÝ™ems
;

2071 #ifdeà
__OPENGL_AVAILABLE__


2072 
RENDERMODE_GL
:

2073 
Üic
->
»nd”_begš
 = 
»nd”_begš_gl
;

2074 
Üic
->
»nd”_’d
 = 
»nd”_’d_gl
;

2075 
Üic
->
»nd”_‹xtzÚe_®loc
 = 
»nd”_‹xtzÚe_®loc_gl
;

2076 
Üic
->
»nd”_‹xtzÚe_ä“
 = 
»nd”_‹xtzÚe_ä“_gl
;

2077 
Üic
->
»nd”_‹xtzÚe
 = 
»nd”_‹xtzÚe_gl
;

2078 
Üic
->
»nd”_þ—r_¬—
 = 
»nd”_þ—r_¬—_gl
;

2079 
Üic
->
»nd”_gimg
 = 
»nd”_gimg_gl
;

2080 
Üic
->
»nd”_gimg·¹
 = 
»nd”_gimg·¹_gl
;

2081 
Üic
->
»nd”_video
 = 
»nd”_video_gl
;

2082 
Üic
->
»nd”_toggËfuÎsü“n
 = 
»nd”_toggËfuÎsü“n_gl
;

2083 
Üic
->
š™_»nd”
 = 
š™_»nd”_gl
;

2084 
Üic
->
shut_»nd”
 = 
shut_»nd”_gl
;

2085 
	`fšd_™em_by_funùiÚ_ªd_¬g
(
vdÝ™ems
, 
sw­_»nd”_mode
, 
RENDERMODE_GL
)->
Çme
 = "\x0e""OpenGL„endering";

2086 
	`fšd_™em_by_funùiÚ_ªd_¬g
(
glÝ™ems
, 
sw­_»nd”_mode
, 
RENDERMODE_GL
)->
Çme
 = "\x0e""OpenGL„endering";

2087 
	`fšd_™em_by_funùiÚ_ªd_¬g
(
vdÝ™ems
, 
sw­_»nd”_mode
, 
RENDERMODE_SW
)->
Çme
 = " Software„endering";

2088 
	`fšd_™em_by_funùiÚ_ªd_¬g
(
glÝ™ems
, 
sw­_»nd”_mode
, 
RENDERMODE_SW
)->
Çme
 = " Software„endering";

2089 
m’us
[4].
™ems
 = 
glÝ™ems
;

2094 
Üic
->
»nd”_begš
 = 
»nd”_begš_nuÎ
;

2095 
Üic
->
»nd”_’d
 = 
»nd”_’d_nuÎ
;

2096 
Üic
->
»nd”_‹xtzÚe_®loc
 = 
»nd”_‹xtzÚe_®loc_nuÎ
;

2097 
Üic
->
»nd”_‹xtzÚe_ä“
 = 
»nd”_‹xtzÚe_ä“_nuÎ
;

2098 
Üic
->
»nd”_‹xtzÚe
 = 
»nd”_‹xtzÚe_nuÎ
;

2099 
Üic
->
»nd”_þ—r_¬—
 = 
»nd”_þ—r_¬—_nuÎ
;

2100 
Üic
->
»nd”_gimg
 = 
»nd”_gimg_nuÎ
;

2101 
Üic
->
»nd”_gimg·¹
 = 
»nd”_gimg·¹_nuÎ
;

2102 
Üic
->
»nd”_video
 = 
»nd”_video_nuÎ
;

2103 
Üic
->
»nd”_toggËfuÎsü“n
 = 
»nd”_toggËfuÎsü“n_nuÎ
;

2104 
Üic
->
š™_»nd”
 = 
š™_»nd”_nuÎ
;

2105 
Üic
->
shut_»nd”
 = 
shut_»nd”_nuÎ
;

2106 
	`fšd_™em_by_funùiÚ_ªd_¬g
(
vdÝ™ems
, 
sw­_»nd”_mode
, 
RENDERMODE_GL
)->
Çme
 = " OpenGL„endering";

2107 
	`fšd_™em_by_funùiÚ_ªd_¬g
(
glÝ™ems
, 
sw­_»nd”_mode
, 
RENDERMODE_GL
)->
Çme
 = " OpenGL„endering";

2108 
	`fšd_™em_by_funùiÚ_ªd_¬g
(
vdÝ™ems
, 
sw­_»nd”_mode
, 
RENDERMODE_SW
)->
Çme
 = " Software„endering";

2109 
	`fšd_™em_by_funùiÚ_ªd_¬g
(
glÝ™ems
, 
sw­_»nd”_mode
, 
RENDERMODE_SW
)->
Çme
 = " Software„endering";

2110 
m’us
[4].
™ems
 = 
vdÝ™ems
;

2113 
	}
}

2115 
	$sw­_»nd”_mode
Ð
machše
 *
Üic
, 
osdm’u™em
 *
m™em
, 
Ãw»nd”mode
 )

2117 ifÐ
Üic
->
»nd”mode
 =ð
Ãw»nd”mode
 ) ;

2119 
	`shut_gui
Ð
Üic
 );

2120 
	`shut_joy
Ð
Üic
 );

2121 
	`SDL_COMPAT_Qu™
();

2122 
Ãed_sdl_qu™
 = 
SDL_FALSE
;

2125 ifÐ
	`SDL_In™
Ð
SDL_INIT_VIDEO
 | 
SDL_INIT_AUDIO
 ) < 0 )

2127 
	`”rÜ_´štf
( "SDL init failed\n" );

2128 
Üic
->
emu_mode
 = 
EM_PLEASEQUIT
;

2131 
Ãed_sdl_qu™
 = 
SDL_TRUE
;

2133 #iâdeà
__APPLE__


2134 
	`SDL_COMPAT_WM_S‘IcÚ
Ð
	`SDL_LßdBMP
Ð
IMAGEPREFIX
"wšicÚ.bmp" ), 
NULL
 );

2137 ifÐ!
	`š™_joy
Ð
Üic
 ) )

2139 
Üic
->
emu_mode
 = 
EM_PLEASEQUIT
;

2143 ifÐ!
	`š™_gui
Ð
Üic
, 
Ãw»nd”mode
 ) )

2145 
Üic
->
emu_mode
 = 
EM_PLEASEQUIT
;

2149 ifÐ!
	`ay_š™
Ð&
Üic
->
ay
, oric ) )

2151 
Üic
->
emu_mode
 = 
EM_PLEASEQUIT
;

2155 ifÐ!
	`š™_fž”eque¡”
Ð
Üic
 ) )

2157 
Üic
->
emu_mode
 = 
EM_PLEASEQUIT
;

2161 ifÐ!
	`š™_msgbox
Ð
Üic
 ) )

2163 
Üic
->
emu_mode
 = 
EM_PLEASEQUIT
;

2167 
	`joy_£tup
Ð
Üic
 );

2168 
	`mÚ_w¬mš™
Ð
Üic
 );

2170 
	`£‹mumode
Ð
Üic
, 
NULL
, 
EM_RUNNING
 );

2171 
	}
}

2175 
	$´eš™_gui
Ð
machše
 *
Üic
 )

2177 
i
;

2178  
i
=0; i<
NUM_TZ
; i++ ) 
tz
[i] = 
NULL
;

2179  
i
=0; i<
NUM_GIMG
; i++ ) 
gimgs
[i].
buf
 = 
NULL
;

2180 
	`¡rýy
Ð
³·th
, 
FILEPREFIX
"tapes" );

2181 
	`¡rýy
Ð
³fže
, "" );

2182 
	`¡rýy
Ð
disk·th
, 
FILEPREFIX
"disks" );

2183 
	`¡rýy
Ð
diskfže
, "" );

2184 
	`¡rýy
Ð
‹Ëdisk·th
, 
FILEPREFIX
"teledisks" );

2185 
	`¡rýy
Ð
‹Ëdiskfže
, "" );

2186 
	`¡rýy
Ð
´avdisk·th
, 
FILEPREFIX
"pravdisks" );

2187 
	`¡rýy
Ð
´avdiskfže
, "" );

2188 
	`¡rýy
Ð
©mo¤omfže
, 
ROMPREFIX
"basic11b" );

2189 
	`¡rýy
Ð
Üic1romfže
, 
ROMPREFIX
"basic10" );

2190 
	`¡rýy
Ð
mdisüomfže
, 
ROMPREFIX
"microdis" );

2191 
	`¡rýy
Ð
jasmÄomfže
, 
ROMPREFIX
"jasmin" );

2192 
	`¡rýy
Ð
´av‘zromfže
[0], 
ROMPREFIX
"pravetzt" );

2193 
	`¡rýy
Ð
´av‘zromfže
[1], 
ROMPREFIX
"8dos2" );

2194 
‹Ëbªkfžes
[0][0] = 0;

2195 
‹Ëbªkfžes
[1][0] = 0;

2196 
‹Ëbªkfžes
[2][0] = 0;

2197 
‹Ëbªkfžes
[3][0] = 0;

2198 
‹Ëbªkfžes
[4][0] = 0;

2199 
	`¡rýy
Ð
‹Ëbªkfžes
[5], 
ROMPREFIX
"teleass" );

2200 
	`¡rýy
Ð
‹Ëbªkfžes
[6], 
ROMPREFIX
"hyperbas" );

2201 
	`¡rýy
Ð
‹Ëbªkfžes
[7], 
ROMPREFIX
"telmon24" );

2202 
	`£t_»nd”_mode
Ð
Üic
, 
RENDERMODE_NULL
 );

2203 
	`¡rýy
Ð
¢­·th
, 
FILEPREFIX
"snapshots" );

2204 
	`¡rýy
Ð
¢­fže
, "" );

2205 
	`¡rýy
Ð
m­pšg·th
, 
FILEPREFIX
"keymap" );

2206 
	`¡rýy
Ð
m­pšgfže
, "" );

2207 
	}
}

2210 
	$£tm’utoggËs
Ð
machše
 *
Üic
 )

2212 
Üic
->
driv‘y³
)

2214 
DRV_JASMIN
:

2215 
DRV_MICRODISC
:

2216 
	`fšd_™em_by_key
(
maš™ems
, 
SDLK_0
)->
func
 = 
š£¹disk
;

2217 
	`fšd_™em_by_key
(
maš™ems
, 
SDLK_1
)->
func
 = 
š£¹disk
;

2218 
	`fšd_™em_by_key
(
maš™ems
, 
SDLK_2
)->
func
 = 
š£¹disk
;

2219 
	`fšd_™em_by_key
(
maš™ems
, 
SDLK_3
)->
func
 = 
š£¹disk
;

2222 
DRV_PRAVETZ
:

2224 
	`fšd_™em_by_key
(
maš™ems
, 
SDLK_0
)->
func
 = 
š£¹disk
;

2225 
	`fšd_™em_by_key
(
maš™ems
, 
SDLK_1
)->
func
 = 
š£¹disk
;

2226 
	`fšd_™em_by_key
(
maš™ems
, 
SDLK_2
)->
func
 = 
NULL
;

2227 
	`fšd_™em_by_key
(
maš™ems
, 
SDLK_3
)->
func
 = 
NULL
;

2231 ifÐ
soundavažabË
 && 
soundÚ
 )

2232 
	`fšd_™em_by_funùiÚ
(
auÝ™ems
, 
toggËsound
)->
Çme
 = "\x0e""Soundƒnabled";

2234 
	`fšd_™em_by_funùiÚ
(
auÝ™ems
, 
toggËsound
)->
Çme
 = " Soundƒnabled";

2236 ifÐ
Üic
->
³noi£
 )

2237 
	`fšd_™em_by_funùiÚ
(
auÝ™ems
, 
toggË³noi£
)->
Çme
 = "\x0e""Tape‚oise";

2239 
	`fšd_™em_by_funùiÚ
(
auÝ™ems
, 
toggË³noi£
)->
Çme
 = " Tape‚oise";

2241 ifÐ
Üic
->
³turbo
 )

2242 
	`fšd_™em_by_funùiÚ
(
hwÝ™ems
, 
toggË³turbo
)->
Çme
 = "\x0e""Turboape";

2244 
	`fšd_™em_by_funùiÚ
(
hwÝ™ems
, 
toggË³turbo
)->
Çme
 = " Turboape";

2246 ifÐ
Üic
->
autoš£¹
 )

2247 
	`fšd_™em_by_funùiÚ
(
hwÝ™ems
, 
toggËautoš¤t
)->
Çme
 = "\x0e""Autoinsertape";

2249 
	`fšd_™em_by_funùiÚ
(
hwÝ™ems
, 
toggËautoš¤t
)->
Çme
 = " Autoinsertape";

2251 ifÐ
Üic
->
autÜewšd
 )

2252 
	`fšd_™em_by_funùiÚ
(
hwÝ™ems
, 
toggËautowšd
)->
Çme
 = "\x0e""Autorewindape";

2254 
	`fšd_™em_by_funùiÚ
(
hwÝ™ems
, 
toggËautowšd
)->
Çme
 = " Autorewindape";

2256 ifÐ
Üic
->
vsynchack
 )

2257 
	`fšd_™em_by_funùiÚ
(
hwÝ™ems
, 
toggËvsynchack
)->
Çme
 = "\x0e""VSync hack";

2259 
	`fšd_™em_by_funùiÚ
(
hwÝ™ems
, 
toggËvsynchack
)->
Çme
 = " VSync hack";

2261 ifÐ
Üic
->
ligh’
 )

2262 
	`fšd_™em_by_funùiÚ
(
hwÝ™ems
, 
toggËligh’
)->
Çme
 = "\x0e""Lightpen";

2264 
	`fšd_™em_by_funùiÚ
(
hwÝ™ems
, 
toggËligh’
)->
Çme
 = " Lightpen";

2266 ifÐ
Üic
->
acŸback’d
 )

2268 
	`¡rýy
(
acŸback’dÏb–
, 
acŸback’ds
[
Üic
->
acŸback’d
]);

2269 
	`¥rštf
(
acŸback’dÏb–
+18, "%.4X", 
Üic
->
acŸoff£t
);

2270 
	`fšd_™em_by_funùiÚ
(
hwÝ™ems
, 
toggËacŸback’d
)->
Çme
 = 
acŸback’dÏb–
;

2273 
	`fšd_™em_by_funùiÚ
(
hwÝ™ems
, 
toggËacŸback’d
)->
Çme
 = 
acŸback’ds
[
Üic
->
acŸback’d
];

2275 ifÐ
Üic
->
symbÞ§utÞßd
 )

2276 
	`fšd_™em_by_funùiÚ
(
dbÝ™ems
, 
toggËsymbÞ§uto
)->
Çme
 = "\x0e""Autoload symbols file";

2278 
	`fšd_™em_by_funùiÚ
(
dbÝ™ems
, 
toggËsymbÞ§uto
)->
Çme
 = " Autoload symbols file";

2280 ifÐ
Üic
->
symbÞsÿ£
 )

2281 
	`fšd_™em_by_funùiÚ
(
dbÝ™ems
, 
toggËÿ£syms
)->
Çme
 = "\x0e""Case-sensitive symbols";

2283 
	`fšd_™em_by_funùiÚ
(
dbÝ™ems
, 
toggËÿ£syms
)->
Çme
 = " Case-sensitive symbols";

2285 ifÐ
fuÎsü“n
 )

2287 
	`fšd_™em_by_funùiÚ
(
vdÝ™ems
, 
toggËfuÎsü“n
)->
Çme
 = "\x0e""Fullscreen";

2288 
	`fšd_™em_by_funùiÚ
(
glÝ™ems
, 
toggËfuÎsü“n
)->
Çme
 = "\x0e""Fullscreen";

2290 
	`fšd_™em_by_funùiÚ
(
vdÝ™ems
, 
toggËfuÎsü“n
)->
Çme
 = " Fullscreen";

2291 
	`fšd_™em_by_funùiÚ
(
glÝ™ems
, 
toggËfuÎsü“n
)->
Çme
 = " Fullscreen";

2294 ifÐ
Üic
->
¬©io
 )

2295 
	`fšd_™em_by_funùiÚ
(
glÝ™ems
, 
toggË¬©io
)->
Çme
 = "\x0e""50Hz/60Hz‡spect„atio";

2297 
	`fšd_™em_by_funùiÚ
(
glÝ™ems
, 
toggË¬©io
)->
Çme
 = " 50Hz/60Hz‡spect„atio";

2299 ifÐ
Üic
->
h¡»tch
 )

2300 
	`fšd_™em_by_funùiÚ
(
glÝ™ems
, 
toggËh¡»tch
)->
Çme
 = "\x0e""Horizontal stretch";

2302 
	`fšd_™em_by_funùiÚ
(
glÝ™ems
, 
toggËh¡»tch
)->
Çme
 = " Horizontal stretch";

2304 ifÐ
Üic
->
sÿÆšes
 )

2306 
	`fšd_™em_by_funùiÚ
(
vdÝ™ems
, 
toggËsÿÆšes
)->
Çme
 = "\x0e""Scanlines";

2307 
	`fšd_™em_by_funùiÚ
(
glÝ™ems
, 
toggËsÿÆšes
)->
Çme
 = "\x0e""Scanlines";

2309 
	`fšd_™em_by_funùiÚ
(
vdÝ™ems
, 
toggËsÿÆšes
)->
Çme
 = " Scanlines";

2310 
	`fšd_™em_by_funùiÚ
(
glÝ™ems
, 
toggËsÿÆšes
)->
Çme
 = " Scanlines";

2313 ifÐ
Üic
->
·lgho¡
 )

2314 
	`fšd_™em_by_funùiÚ
(
glÝ™ems
, 
toggË·lgho¡
)->
Çme
 = "\x0e""PAL ghosting";

2316 
	`fšd_™em_by_funùiÚ
(
glÝ™ems
, 
toggË·lgho¡
)->
Çme
 = " PAL ghosting";

2319 
	`fšd_™em_by_funùiÚ_ªd_¬g
(
hwÝ™ems
, 
sw­mach
, (0xffff<<16)|
MACH_ORIC1
 )->
Çme
 = 
Üic
->
ty³
==MACH_ORIC1 ? "\x0e""Oric-1" : " Oric-1";

2320 
	`fšd_™em_by_funùiÚ_ªd_¬g
(
hwÝ™ems
, 
sw­mach
, (0xffff<<16)|
MACH_ORIC1_16K
 )->
Çme
 = 
Üic
->
ty³
==MACH_ORIC1_16K ? "\x0e""Oric-1 16K" : " Oric-1 16K";

2321 
	`fšd_™em_by_funùiÚ_ªd_¬g
(
hwÝ™ems
, 
sw­mach
, (0xffff<<16)|
MACH_ATMOS
 )->
Çme
 = 
Üic
->
ty³
==MACH_ATMOS ? "\x0e""Atmos" : " Atmos";

2322 
	`fšd_™em_by_funùiÚ_ªd_¬g
(
hwÝ™ems
, 
sw­mach
, (
DRV_NONE
<<16)|
MACH_TELESTRAT
)->
Çme
 = 
Üic
->
ty³
==MACH_TELESTRAT ? "\x0e""Telestrat" : " Telestrat";

2323 
	`fšd_™em_by_funùiÚ_ªd_¬g
(
hwÝ™ems
, 
sw­mach
, (0xffff<<16)|
MACH_PRAVETZ
 )->
Çme
 = 
Üic
->
ty³
==MACH_PRAVETZ ? "\x0e""Pravetz 8D" : " Pravetz 8D";

2325 
	`fšd_™em_by_key
(
hwÝ™ems
, 'm')->
func
 = 
miüodisüom_v®id
 ? 
£tdriv‘y³
 : 
NULL
;

2326 
	`fšd_™em_by_key
(
hwÝ™ems
, 'j')->
func
 = 
jasmšrom_v®id
 ? 
£tdriv‘y³
 : 
NULL
;

2327 
	`fšd_™em_by_key
(
hwÝ™ems
, 'p')->
func
 = 
´av‘zrom_v®id
 ? 
£tdriv‘y³
 : 
NULL
;

2329 
	`fšd_™em_by_key
(
hwÝ™ems
, 'x')->
Çme
 = 
Üic
->
driv‘y³
==
DRV_NONE
 ? "\x0e""No disk" : " No disk";

2330 
	`fšd_™em_by_key
(
hwÝ™ems
, 'm')->
Çme
 = 
Üic
->
driv‘y³
==
DRV_MICRODISC
 ? "\x0e""Microdisc" : " Microdisc";

2331 
	`fšd_™em_by_key
(
hwÝ™ems
, 'j')->
Çme
 = 
Üic
->
driv‘y³
==
DRV_JASMIN
 ? "\x0e""Jasmin" : " Jasmin";

2332 
	`fšd_™em_by_key
(
hwÝ™ems
, 'p')->
Çme
 = 
Üic
->
driv‘y³
==
DRV_PRAVETZ
 ? "\x0e""Pravetz 8D disk": " Pravetz 8D disk";

2334 if(
Üic
->
show_keybßrd
)

2335 
	`fšd_™em_by_funùiÚ
(
keÝ™ems
, 
toggËkeybßrd
)->
Çme
 = "\x0e""Show keyboard";

2337 
	`fšd_™em_by_funùiÚ
(
keÝ™ems
, 
toggËkeybßrd
)->
Çme
 = " Show keyboard";

2339 if(
Üic
->
show_keybßrd
)

2340 
	`fšd_™em_by_funùiÚ
(
keÝ™ems
, 
toggË¡ickykeys
)->
Çme
 = "\x0e""Sticky mod keys";

2342 
	`fšd_™em_by_funùiÚ
(
keÝ™ems
, 
toggË¡ickykeys
)->
Çme
 = " Sticky mod keys";

2344 
	`fšd_™em_by_funùiÚ
(
hwÝ™ems
, 
toggËch376
)->
Çme
 = 
Üic
->
ch376_aùiv©ed
 ? "\x0e""CH376 (Telestrat)" : " CH376 (Telestrat) ";

2345 
	}
}

2348 
SDL_boÞ
 
	$š™_gui
Ð
machše
 *
Üic
, 
Sšt32
 
»nd”mode
 )

2350 
i
;

2351 
SDL_AudioS³c
 
wª‹d
;

2353  
i
=0; i<
NUM_GIMG
; i++ )

2355 ifÐ!
	`gimg_lßd
Ð&
gimgs
[
i
] ) )  
SDL_FALSE
;

2358 
	`£t_»nd”_mode
Ð
Üic
, 
»nd”mode
 );

2359 ifÐ!
Üic
->
	`š™_»nd”
ÐÜiøèè 
SDL_FALSE
;

2362 ifÐ!
	`®loc_‹xtzÚe
Ð
Üic
, 
TZ_MONITOR
, 0, 228, 50, 21, "MÚ™Ü" ) )  
SDL_FALSE
;

2363 ifÐ!
	`®loc_‹xtzÚe
Ð
Üic
, 
TZ_DEBUG
, 0, 228, 50, 21, "Debug cÚsÞe" ) )  
SDL_FALSE
;

2364 ifÐ!
	`®loc_‹xtzÚe
Ð
Üic
, 
TZ_MEMWATCH
, 0, 228, 50, 21, "MemÜy w©ch" ) )  
SDL_FALSE
;

2365 ifÐ!
	`®loc_‹xtzÚe
Ð
Üic
, 
TZ_REGS
, 240, 0, 50, 19, "6502 Stus" ) )  
SDL_FALSE
;

2366 ifÐ!
	`®loc_‹xtzÚe
Ð
Üic
, 
TZ_VIA
, 400, 228, 30, 21, "VIA Stus" ) )  
SDL_FALSE
;

2367 ifÐ!
	`®loc_‹xtzÚe
Ð
Üic
, 
TZ_VIA2
, 400, 228, 30, 21, "T–e¡¿ˆVIA Stus" ) )  
SDL_FALSE
;

2368 ifÐ!
	`®loc_‹xtzÚe
Ð
Üic
, 
TZ_AY
, 400, 228, 30, 21, "AY Stus" ) )  
SDL_FALSE
;

2369 ifÐ!
	`®loc_‹xtzÚe
Ð
Üic
, 
TZ_DISK
, 400, 228, 30, 21, "Disk Stus" ) )  
SDL_FALSE
;

2372 
wª‹d
.
äeq
 = 
AUDIO_FREQ
;

2373 
wª‹d
.
fÜm©
 = 
AUDIO_S16SYS
;

2374 
wª‹d
.
chªÃls
 = 2;

2375 
wª‹d
.
§m¶es
 = 
AUDIO_BUFLEN
;

2377 
wª‹d
.
ÿÎback
 = (*)
ay_ÿÎback
;

2378 
wª‹d
.
u£rd©a
 = &
Üic
->
ay
;

2380 
soundavažabË
 = 
SDL_FALSE
;

2381 
soundÚ
 = 
SDL_FALSE
;

2382 ifÐ
	`SDL_O³nAudio
Ð&
wª‹d
, &
obšed
 ) >= 0 )

2384 
soundÚ
 = 
SDL_TRUE
;

2385 
soundavažabË
 = 
SDL_TRUE
;

2386 
soundsž’û
 = 
obšed
.
sž’û
 * 8192;

2387 
cyþe¥”§m¶e
 = ((
CYCLESPERSECOND
<<
FPBITS
)/
obšed
.
äeq
);

2390 
	`£tm’utoggËs
Ð
Üic
 );

2391 #ià
	`defšed
(
__APPLE__
è|| defšed(
__BEOS__
è|| defšed(
__HAIKU__
)

2392 
	`š™_gui_Çtive
Ð
Üic
 );

2393 #–ià
	`defšed
(
__WIN32__
è|| defšed(
__CYGWIN__
)

2394 
	`š™_gui_Çtive
Ð
Üic
 );

2395 #–ià
	`defšed
(
__lšux__
)

2396 
	`š™_gui_Çtive
Ð
Üic
 );

2398  
SDL_TRUE
;

2399 
	}
}

2402 
	$shut_gui
Ð
machše
 *
Üic
 )

2404 
i
;

2405 
i
 = 0; i<
NUM_GIMG
; i++)

2407 
	`ä“
(
gimgs
[
i
].
buf
);

2408 
gimgs
[
i
].
buf
 = 0;

2411 
Üic
->
	`shut_»nd”
( oric );

2413  
i
=0; i<
NUM_TZ
; i++ )

2414 
	`ä“_‹xtzÚe
Ð
Üic
, 
i
 );

2416 #ià
	`defšed
(
__APPLE__
è|| defšed(
__BEOS__
è|| defšed(
__HAIKU__
)

2417 
	`shut_gui_Çtive
Ð
Üic
 );

2418 #–ià
	`defšed
(
__WIN32__
è|| defšed(
__CYGWIN__
)

2419 
	`shut_gui_Çtive
Ð
Üic
 );

2420 #–ià
	`defšed
(
__lšux__
)

2421 
	`shut_gui_Çtive
Ð
Üic
 );

2423 
	}
}

2425 
	$´avdiskboÙ
Ð
machše
 *
Üic
 )

2427 ifÐ
Üic
->
´avdiskautoboÙ
 )

2429 
	`queuekeys
( "CALL800\x0d" );

2431 
	}
}

	@gui.h

25 
	mRENDERMODE_NULL
 = 0,

26 
	mRENDERMODE_SW
,

27 
	mRENDERMODE_GL


33 
	mTZ_MONITOR
 = 0,

34 
	mTZ_DEBUG
,

35 
	mTZ_MEMWATCH
,

36 
	mTZ_REGS
,

37 
	mTZ_VIA
,

38 
	mTZ_VIA2
,

39 
	mTZ_AY
,

40 
	mTZ_DISK
,

41 
	mTZ_MENU
,

42 
	mTZ_MSGBOX
,

43 
	mTZ_FILEREQ
,

44 
	mNUM_TZ


49 
	mSTATUSBARMODE_FULL
 = 0,

50 
	mSTATUSBARMODE_NOFPS
,

51 
	mSTATUSBARMODE_NONE
,

52 
	mSTATUSBARMODE_LAST


55 
	s‹xtzÚe


57 
	mx
, 
	my
, 
	mw
, 
	mh
;

58 
	mpx
, 
	mpy
, 
	mcfc
, 
	mcbc
;

59 *
	mtx
;

60 *
	mfc
, *
	mbc
;

61 
SDL_boÞ
 
	mmodif›d
;

65 
	#OSDMENUBAR
 ((*)-1)

	)

68 
	#OMIB_CENTRED
 0

	)

69 
	#OMIF_CENTRED
 (1<<
OMIB_CENTRED
)

	)

70 
	#OMIB_BRIGHT
 1

	)

71 
	#OMIF_BRIGHT
 (1<<
OMIB_BRIGHT
)

	)

73 
	sosdm’u™em


75 *
	mÇme
;

76 *
	mkey
;

77 
	msdlkey
;

78 (*
	mfunc
)(
	mmachše
 *,
	mosdm’u™em
 *,);

79 
	m¬g
;

80 
Ušt16
 
	mæags
;

83 
	sosdm’u


85 *
	mt™Ë
;

86 
	mc™em
;

87 
osdm’u™em
 *
	m™ems
;

90 
	#VSPTMPSIZE
 1024

	)

92 
	sguiimg


94 *
	mfž’ame
;

95 
Ušt16
 
	mw
, 
	mh
;

96 
Ušt8
 *
	mbuf
;

101 
	mGIMG_STATUSBAR
,

102 
	mGIMG_DISK_EJECTED
,

103 
	mGIMG_DISK_IDLE
,

104 
	mGIMG_DISK_ACTIVE
,

105 
	mGIMG_DISK_IDLE_MOD
,

106 
	mGIMG_DISK_ACTIVE_MOD
,

107 
	mGIMG_TAPE_EJECTED
,

108 
	mGIMG_TAPE_PAUSE
,

109 
	mGIMG_TAPE_PLAY
,

110 
	mGIMG_TAPE_STOP
,

111 
	mGIMG_TAPE_RECORD
,

112 
	mGIMG_AVI_RECORD
,

113 
	mGIMG_ORIC1_KEYBOARD
,

114 
	mGIMG_ATMOS_KEYBOARD
,

115 
	mGIMG_PRAVETZ_KEYBOARD
,

116 
	mNUM_GIMG


119 
	#NUM_GUI_COLS
 16

	)

121 
SDL_boÞ
 
®loc_‹xtzÚe
Ð
machše
 *
Üic
, 
i
, 
x
, 
y
, 
w
, 
h
, *
t™Ë
 );

122 
ä“_‹xtzÚe
Ð
machše
 *
Üic
, 
i
 );

123 
SDL_boÞ
 
š_‹xtzÚe
Ð
‹xtzÚe
 *
tz
, 
x
, 
y
 );

125 
do_pÝup
Ð
machše
 *
Üic
, *
¡r
 );

126 
makebox
Ð
‹xtzÚe
 *
±z
, 
x
, 
y
, 
w
, 
h
, 
fg
, 
bg
 );

127 
tz£‰™Ë
Ð
‹xtzÚe
 *
±z
, *
t™Ë
 );

128 
tz¡r
Ð
‹xtzÚe
 *
±z
, *
‹xt
 );

129 
tzputc
Ð
‹xtzÚe
 *
±z
, 
c
 );

130 
tz¡½os
Ð
‹xtzÚe
 *
±z
, 
x
, 
y
, *
‹xt
 );

131 
tz£tcÞ
Ð
‹xtzÚe
 *
±z
, 
fc
, 
bc
 );

132 
tz´štf
Ð
‹xtzÚe
 *
±z
, *
fmt
, ... );

133 
tz´štåos
Ð
‹xtzÚe
 *
±z
, 
x
, 
y
, *
fmt
, ... );

134 
d¿w_‹xtzÚe
Ð
‹xtzÚe
 *
±z
 );

135 
´št¡r
Ð
x
, 
y
, 
Ušt32
 
fc
, Ušt32 
bc
, *
¡r
 );

136 
gÙos™e
Ð
machše
 *
Üic
, 
osdm’u™em
 *
m™em
, 
dummy
 );

137 
gÙom’u
Ð
machše
 *
Üic
, 
osdm’u™em
 *
m™em
, 
m’unum
 );

138 
SDL_boÞ
 
m’u_ev’t
Ð
SDL_Ev’t
 *
ev
, 
machše
 *
Üic
, SDL_boÞ *
Ãed»nd”
 );

139 
£tm’utoggËs
Ð
machše
 *
Üic
 );

140 
£t_»nd”_mode
Ð
machše
 *
Üic
, 
which»nd”mode
 );

142 
»nd”
Ð
machše
 *
Üic
 );

143 
´eš™_gui
Ð
machše
 *
Üic
 );

144 
SDL_boÞ
 
š™_gui
Ð
machše
 *
Üic
, 
Sšt32
 
»nd”mode
 );

145 
shut_gui
Ð
machše
 *
Üic
 );

147 
d¿w_¡©usb¬
Ð
machše
 *
Üic
 );

148 
d¿w_disks
Ð
machše
 *
Üic
 );

149 
d¿w_avœec
Ð
machše
 *
Üic
, 
SDL_boÞ
 
»cÜdšg
 );

150 
d¿w_³
Ð
machše
 *
Üic
 );

152 
d¿w_keybßrd
Ð
machše
 *
Üic
 );

155 
¡©u¥ršt¡r
Ð
x
, 
Ušt32
 
fc
, *
¡r
 );

156 
još·th
Ð*
·th
, *
fže
 );

160 
SDL_boÞ
 
š™_gui_Çtive
Ð
machše
 *
Üic
 );

161 
shut_gui_Çtive
Ð
machše
 *
Üic
 );

162 
gui_Ý’_u¾
ÐcÚ¡ *
u¾
 );

163 
SDL_boÞ
 
þbßrd_cÝy
Ð
machše
 *
Üic
 );

164 
SDL_boÞ
 
þbßrd_·¡e
Ð
machše
 *
Üic
 );

166 
£tov”þock
Ð
machše
 *
Üic
, 
osdm’u™em
 *
m™em
, 
v®ue
 );

167 
þ—r_‹xtzÚe
Ð
machše
 *
Üic
, 
i
 );

169 
osdm’u™em
 *
fšd_™em_by_funùiÚ
(osdm’u™em *
m’u
, *
funùiÚ
);

171 
toggËfuÎsü“n
Ð
machše
 *
Üic
, 
osdm’u™em
 *
m™em
, 
dummy
 );

173 
soá»£tÜic
Ð
machše
 *
Üic
, 
osdm’u™em
 *
m™em
, 
dummy
 );

175 
´avdiskboÙ
Ð
machše
 *
Üic
 );

	@gui_beos.cpp

22 
	~<¡dlib.h
>

23 
	~<¡dio.h
>

24 
	~<¡ršg.h
>

25 
	~<uni¡d.h
>

26 
	~<dœ’t.h
>

27 
	~<sys/¡©.h
>

28 
	~<AË¹.h
>

29 
	~<Clbßrd.h
>

30 
	~<FÚt.h
>

31 
	~<IÁ”çûDefs.h
>

32 
	~<Li¡.h
>

33 
	~<M’uI‹m.h
>

34 
	~<Mime.h
>

35 
	~<PÝUpM’u.h
>

36 
	~<SŒšg.h
>

37 
	~<TextV›w.h
>

40 
	~"sy¡em.h
"

41 
	~"6502.h
"

42 
	~"vŸ.h
"

43 
	~"8912.h
"

44 
	~"gui.h
"

45 
	~"disk.h
"

46 
	~"mÚ™Ü.h
"

47 
	~"6551.h
"

48 
	~"machše.h
"

51 
rgb_cÞÜ
 
Üic_cÞÜs
[] = {

62 
osdm’u
 
m’us
[];

63 
osdm’u™em
 
about™ems
[];

66 þas 
	cOSDM’uI‹m
 : 
public
 
BM’uI‹m
 {

67 
public
:

68 
	$OSDM’uI‹m
(
osdm’u™em
 *
desc
, cÚ¡ *
Çme
, 
BMes§ge
 *
mes§ge
)

69 : 
	`BM’uI‹m
(
Çme
, 
mes§ge
), 
	$fI‹m
(
desc
)

71 ià(
desc
->
Çme
[0] == '\x0e')

72 
	`S‘M¬ked
(
Œue
);

73 ià(
desc
->
key
)

74 
	`S‘Trigg”
(
desc
->
key
[0]);

76 
vœtu®
 ~
	$OSDM’uI‹m
(è{
	}
};

77 
osdm’u™em
 *
	gfI‹m
;

80 
	$bužd_Çtive_m’us
Ð
osdm’u
 *
m’u
, 
BM’u
 *
m
 )

82 
osdm’u™em
 *
™em
 = 
m’u
->
™ems
;

84 
	`´štf
("m’u '%s': {\n", 
m’u
->
t™Ë
);

85 ; 
™em
->
Çme
; item++) {

86 
BM’uI‹m
 *
mi
;

87 cÚ¡ *
Çme
 = 
™em
->name;

88 ià(
Çme
 =ð
OSDMENUBAR
) {

89 
Çme
 = "------------";

91 ià(
™em
[1].
sdlkey
 =ð
SDLK_BACKSPACE
)

93 
mi
 = 
Ãw
 
	`BS•¬©ÜI‹m
();

94 } ià(
™em
->
func
 =ð
gÙom’u
) {

95 ià(
™em
->
¬g
 == 0)

98 ià(
m’us
[
™em
->
¬g
].
™ems
 =ð
about™ems
) {

99 
mi
 = 
Ãw
 
	`BM’uI‹m
(
Çme
,‚ew 
	`BMes§ge
(
B_ABOUT_REQUESTED
));

101 
BM’u
 *
subM’u
 = 
Ãw
 
	`BM’u
(
Çme
);

102 
mi
 = 
Ãw
 
	`BM’uI‹m
(
subM’u
);

103 
	`bužd_Çtive_m’us
Ð&
m’us
[
™em
->
¬g
], 
subM’u
 );

106 ià(
Çme
[0] == ' ' ||‚ame[0] == '\x0e')

107 
Çme
 = &name[1];

108 
mi
 = 
Ãw
 
	`OSDM’uI‹m
(
™em
, 
Çme
, 
NULL
);

113 
m
->
	`AddI‹m
(
mi
);

115 
	`´štf
("}\n");

116 
	}
}

119 
	$run_Çtive_about
( )

121 
osdm’u™em
 *
™em
 = 
about™ems
;

122 
BSŒšg
 
‹xt
;

123 ; 
™em
->
Çme
; item++) {

124 ià(
™em
->
Çme
 =ð
OSDMENUBAR
)

126 
‹xt
 << 
™em
->
Çme
;

127 
‹xt
 << "\n";

129 
BAË¹
 *
®”t
 = 
Ãw
 
	`BAË¹
("About", 
‹xt
.
	`SŒšg
(), "Ok");

130 
®”t
->
	`Go
();

131 
	}
}

134 
SDL_boÞ
 
	$š™_gui_Çtive
Ð
machše
 *
Üic
 )

136 
BMimeTy³
 
	`³Ty³
("application/x-oric-tape");

137 ià(!
³Ty³
.
	`IsIn¡®Ëd
())

138 
³Ty³
.
	`In¡®l
();

139 
BMes§ge
 
exts
;

140 ià(
³Ty³
.
	`G‘FžeEx‹nsiÚs
(&
exts
è!ð
B_OK
) {

141 
exts
.
	`AddSŒšg
("extensions", "tap");

142 
³Ty³
.
	`S‘ShÜtDesütiÚ
("ORIC Tape");

143 
³Ty³
.
	`S‘LÚgDesütiÚ
("ORIC Tape Image forƒmulators");

144 
³Ty³
.
	`S‘P»ã¼edAµ
("application/x-vnd.oricutron");

145 
³Ty³
.
	`S‘FžeEx‹nsiÚs
(&
exts
);

146 
³Ty³
.
	`S‘SnifãrRuË
("0.40 [0:8](\"\\026\\026\\026\\044\")");

148 
exts
.
	`MakeEm±y
();

149 
BMimeTy³
 
	`diskTy³
("application/x-oric-disk");

150 ià(!
diskTy³
.
	`IsIn¡®Ëd
())

151 
diskTy³
.
	`In¡®l
();

152 ià(
diskTy³
.
	`G‘FžeEx‹nsiÚs
(&
exts
è!ð
B_OK
) {

153 
exts
.
	`AddSŒšg
("extensions", "dsk");

154 
diskTy³
.
	`In¡®l
();

155 
diskTy³
.
	`S‘ShÜtDesütiÚ
("ORIC Disk");

156 
diskTy³
.
	`S‘LÚgDesütiÚ
("ORIC Disk Image forƒmulators");

157 
diskTy³
.
	`S‘P»ã¼edAµ
("application/x-vnd.oricutron");

158 
diskTy³
.
	`S‘FžeEx‹nsiÚs
(&
exts
);

159 
diskTy³
.
	`S‘SnifãrRuË
("0.80 (\"MFM_DISK\")");

170  
SDL_TRUE
;

171 
	}
}

173 
	$shut_gui_Çtive
Ð
machše
 *
Üic
 )

175 
	}
}

177 "C" 
SDL_boÞ
 
þbßrd_cÝy
Ð
machše
 *
Üic
 );

178 "C" 
SDL_boÞ
 
þbßrd_·¡e
Ð
machše
 *
Üic
 );

180 
‹xt_run
 *
	$Ãw_run
(
št32
 
off£t
, 
cÞÜ
)

182 
BFÚt
 
	`fÚt
(
be_fixed_fÚt
);

183 
‹xt_run
 *
run
 = 
Ãw
ext_run;

184 
run
->
off£t
 = offset;

185 
run
->
fÚt
 = font;

186 
run
->
cÞÜ
 = 
Üic_cÞÜs
[color];

187  
run
;

188 
	}
}

191 
SDL_boÞ
 
	$þbßrd_cÝy_‹xt
Ð
machše
 *
Üic
 )

193 *
vidmem
 = (&
Üic
->
mem
[Üic->
vid_addr
]);

194 
lše
, 
cÞ
;

196 
BSŒšg
 
‹xt
;

197 
BLi¡
 
‹xŒuns
;

199 
‹xŒuns
.
	`AddI‹m
(
	`Ãw_run
(0, 0));

201 
lše
 = 0;†ine < 28;†ine++) {

202 
cÞ
 = 0; col < 40; col++) {

203 
c
 = 
vidmem
[
lše
 * 40 + 
cÞ
];

205 ià(
c
 > 127) {

206 
c
 -= 128;

209 ià(
c
 < 8) {

210 
‹xŒuns
.
	`AddI‹m
(
	`Ãw_run
(
‹xt
.
	`L’gth
(), 
c
));

211 
‹xt
 << ' ';

212 } ià(
c
 < ' ' || c == 127) {

213 
‹xt
 << ' ';

214 } ià(
c
 == 0x60) {

215 
‹xt
 << 
B_UTF8_COPYRIGHT
;

217 
‹xt
 << ()
c
;

219 
‹xt
 << '\n';

224 
BMes§ge
 *
þ
 = 
NULL
;

225 ià(
be_þbßrd
->
	`Lock
()) {

226 
be_þbßrd
->
	`CË¬
();

227 
þ
 = 
be_þbßrd
->
	`D©a
();

228 ià(
þ
) {

229 
þ
->
	`AddD©a
("‹xt/¶aš", 
B_MIME_TYPE
, 
‹xt
.
	`SŒšg
(),ext.
	`L’gth
());

231 
¬¿ySize
 = (
‹xt_run_¬¿y
)

232 + 
‹xŒuns
.
	`CouÁI‹ms
(è* (
‹xt_run
);

233 
‹xt_run_¬¿y
 *
¬¿y
 = (‹xt_run_¬¿y *)
	`m®loc
(
¬¿ySize
);

234 
¬¿y
->
couÁ
 = 
‹xŒuns
.
	`CouÁI‹ms
();

235 
i
 = 0; i < 
¬¿y
->
couÁ
; i++) {

236 
	`memýy
(&
¬¿y
->
runs
[
i
], 
‹xŒuns
.
	`I‹mAt
(i), (
‹xt_run
));

238 
þ
->
	`AddD©a
("­¶iÿtiÚ/x-vnd.Be-‹xt_run_¬¿y", 
B_MIME_TYPE
,

239 
¬¿y
, 
¬¿ySize
);

240 
	`ä“
(
¬¿y
);

242 
be_þbßrd
->
	`Comm™
();

244 
be_þbßrd
->
	`UÆock
();

247 
i
 = 0; i < 
‹xŒuns
.
	`CouÁI‹ms
(); i++) {

248 
	`d–‘e
 (
‹xt_run
 *)(
‹xŒuns
.
	`I‹mAt
(
i
));

250 
‹xŒuns
.
	`MakeEm±y
();

252  
SDL_TRUE
;

253 
	}
}

256 
SDL_boÞ
 
	$þbßrd_cÝy
Ð
machše
 *
Üic
 )

259 ià(
Üic
->
vid_addr
 =ðÜic->
vidba£s
[0]) {

261 } ià(
Üic
->
vid_addr
 =ðÜic->
vidba£s
[2]) {

263  
	`þbßrd_cÝy_‹xt
Ð
Üic
 );

266  
SDL_TRUE
;

267 
	}
}

269 
SDL_boÞ
 
	$þbßrd_·¡e
Ð
machše
 *
Üic
 )

271 cÚ¡ *
‹xt
;

272 
št32
 
‹xtL’
;

273 
BMes§ge
 *
þ
 = 
NULL
;

275 ià(
be_þbßrd
->
	`Lock
()) {

276 
þ
 = 
be_þbßrd
->
	`D©a
();

277 ià(
þ
 && cl->
	`FšdD©a
("‹xt/¶aš", 
B_MIME_TYPE
, (cÚ¡ **)&
‹xt
, &
‹xtL’
è=ð
B_OK
) {

278 
	`´štf
("þ:ËÀ%ld\n", 
‹xtL’
);

279 
BSŒšg
 
	`t
(
‹xt
, 
‹xtL’
);

280 
t
.
	`R•ÏûAÎ
('\n', '\r');

281 
t
.
	`R•ÏûAÎ
('\t', ' ');

282 
	`queuekeys
Ð(*)
t
.
	`SŒšg
() );

284 
be_þbßrd
->
	`UÆock
();

286  
SDL_TRUE
;

287 
	}
}

291 
SDL_boÞ
 
	$þbßrd_·¡e_sdl
Ð
machše
 *
Üic
 )

293 cÚ¡ *
‹xt
;

294 
št32
 
‹xtL’
;

295 
BMes§ge
 *
þ
 = 
NULL
;

296 
SDL_Ev’t
 
ev
;

297 
ev
.
key
.
keysym
.
sÿncode
 = 0;

298 
ev
.
key
.
keysym
.
mod
 = (
SDLMod
)0;

299 
ev
.
key
.
keysym
.
sym
 = (
SDLKey
)0;

301 ià(
be_þbßrd
->
	`Lock
()) {

302 
þ
 = 
be_þbßrd
->
	`D©a
();

303 ià(
þ
 && cl->
	`FšdD©a
("‹xt/¶aš", 
B_MIME_TYPE
, (cÚ¡ **)&
‹xt
, &
‹xtL’
è=ð
B_OK
) {

304 
i
 = 0; i < 
‹xtL’
; i++) {

305 
	`årštf
(
¡d”r
, "pushšg key '%c'\n", 
‹xt
[
i
]);

306 
ev
.
key
.
keysym
.
sym
 = (
SDLKey
)
‹xt
[
i
];

307 
ev
.
key
.
keysym
.
unicode
 = 
‹xt
[
i
];

308 
ev
.
ty³
 = 
SDL_KEYDOWN
;

309 
ev
.
key
.
¡©e
 = 
SDL_PRESSED
;

310 
	`SDL_PushEv’t
(&
ev
);

311 
ev
.
ty³
 = 
SDL_KEYUP
;

312 
ev
.
key
.
¡©e
 = 
SDL_RELEASED
;

313 
	`SDL_PushEv’t
(&
ev
);

316 
be_þbßrd
->
	`UÆock
();

318  
SDL_TRUE
;

319 
	}
}

321 
	$gui_Ý’_u¾
ÐcÚ¡ *
u¾
 )

325 
BSŒšg
 
	`commªd
("/bin/open '");

326 
commªd
 << 
u¾
 << "'";

327 
	`sy¡em
(
commªd
.
	`SŒšg
());

328 
	}
}

	@gui_win.c

27 #ifdeà
WIN32


28 
	~<wšdows.h
>

29 
	#WANT_WMINFO


	)

32 
	~"sy¡em.h
"

33 
	~"6502.h
"

34 
	~"vŸ.h
"

35 
	~"8912.h
"

36 
	~"disk.h
"

37 
	~"gui.h
"

38 
	~"mÚ™Ü.h
"

39 
	~"6551.h
"

40 
	~"machše.h
"

42 
HWND
 
	gg_SDL_Wšdow
;

44 
SDL_boÞ
 
	gš™Ÿlized
 = 
SDL_FALSE
;

46 * 
	g‹xt
 = 
NULL
;

48 
	$š™_þbßrd
()

50 if(
š™Ÿlized
)

54 
SDL_SysWMšfo
 
šfo
;

55 
	`SDL_VERSION
(&
šfo
.
v”siÚ
);

56 ià(
	`SDL_COMPAT_G‘WMInfo
(&
šfo
))

59 #ià
SDL_MAJOR_VERSION
 == 1

60 
g_SDL_Wšdow
 = 
šfo
.
wšdow
;

62 
g_SDL_Wšdow
 = 
šfo
.šfo.
wš
.
wšdow
;

64 
š™Ÿlized
 = 
SDL_TRUE
;

66 
	}
}

68 * 
	$g‘_þbßrd_‹xt_wš
()

70 ià(!
š™Ÿlized
)

71  
NULL
;

73 ià(
	`IsClbßrdFÜm©AvažabË
(
CF_TEXT
è&& 
	`O³nClbßrd
(
g_SDL_Wšdow
))

75 cÚ¡ 
HANDLE
 
hMem
 = 
	`G‘ClbßrdD©a
(
CF_TEXT
);

76 ià(
hMem
)

78 *
¤c
 = (*)
	`Glob®Lock
(
hMem
);

79 ià(
¤c
)

81 
	`ä“
(
‹xt
);

82 
‹xt
 = 
	`¡rdup
(
¤c
);

83 
	`Glob®UÆock
(
hMem
);

86 
	`Clo£Clbßrd
();

89  
‹xt
;

90 
	}
}

92 
	$£t_þbßrd_‹xt_wš
(cÚ¡ * 
‹xt
)

94 ià(!
š™Ÿlized
)

97 iàÐ
‹xt
 !ð
NULL
 )

99 iàÐ
	`O³nClbßrd
(
g_SDL_Wšdow
) )

101 
HANDLE
 
hMem
 = 
	`Glob®AÎoc
((
GMEM_MOVEABLE
|
GMEM_DDESHARE
), 
	`¡¾’
(
‹xt
)+1);

102 iàÐ
hMem
 !ð
NULL
 )

104 * 
d¡
 = (*)
	`Glob®Lock
(
hMem
);

105 
	`memýy
(
d¡
, 
‹xt
, 
	`¡¾’
(text)+1);

106 
	`Glob®UÆock
(
hMem
);

107 
	`Em±yClbßrd
();

108 
	`S‘ClbßrdD©a
(
CF_TEXT
, 
hMem
);

110 
	`Clo£Clbßrd
();

113 
	}
}

115 
SDL_boÞ
 
	$š™_gui_Çtive
Ð
machše
 *
Üic
 )

117 
	`š™_þbßrd
();

118  
š™Ÿlized
;

119 
	}
}

121 
	$shut_gui_Çtive
Ð
machše
 *
Üic
 )

123 if(
‹xt
)

125 
	`ä“
(
‹xt
);

126 
‹xt
 = 0;

128 
	}
}

130 
	$gui_Ý’_u¾
ÐcÚ¡ *
u¾
 )

132 
	`Sh–lExecu‹
(
NULL
, "Ý’", 
u¾
,

133 
NULL
, NULL, 
SW_SHOWNORMAL
);

135 
	}
}

137 
SDL_boÞ
 
	$þbßrd_cÝy
Ð
machše
 *
Üic
 )

140 ià(
Üic
->
vid_addr
 !ðÜic->
vidba£s
[2])

141  
SDL_FALSE
;

143 
lše
, 
cÞ
, 
i
;

144 
‹xt
[40 * 28 + 28 + 1];

145 *
vidmem
 = (&
Üic
->
mem
[Üic->
vid_addr
]);

147 
i
 = 0, 
lše
 = 0;†ine < 28;†ine++) {

148 
cÞ
 = 0; col < 40; col++) {

149 
c
 = 
vidmem
[
lše
 * 40 + 
cÞ
];

151 ià(
c
 > 127) {

152 
c
 -= 128;

155 ià(
c
 < ' ' || c == 127) {

156 
‹xt
[
i
++] = ' ';

158 
‹xt
[
i
++] = ()
c
;

160 
‹xt
[
i
++] = '\n';

162 
‹xt
[
i
++] = '\0';

165 
	`£t_þbßrd_‹xt_wš
(
‹xt
);

166  
SDL_TRUE
;

167 
	}
}

169 
SDL_boÞ
 
	$þbßrd_·¡e
Ð
machše
 *
Üic
 )

171 if(
	`g‘_þbßrd_‹xt_wš
())

173 * 
p
 = 
‹xt
;

174 
p
 && *p)

176 *
p
)

178 '\t': *
p
 = ' '; ;

179 '\n': *
p
 = '\r'; ;

181 *
p
 = (*p < 0x20 || 127 < *p)? ' ' : *p;

184 
p
++;

186 
	`queuekeys
(
‹xt
);

188  
SDL_TRUE
;

189 
	}
}

	@gui_x11.c

27 
	#WANT_WMINFO


	)

29 
	~"sy¡em.h
"

30 
	~"6502.h
"

31 
	~"vŸ.h
"

32 
	~"8912.h
"

33 
	~"gui.h
"

34 
	~"disk.h
"

35 
	~"mÚ™Ü.h
"

36 
	~"6551.h
"

37 
	~"machše.h
"

39 
	~<lim™s.h
>

41 
Di¥Ïy
 *
	gdi¥Ïy
;

42 
Wšdow
 
	gwšdow
;

44 
SDL_boÞ
 
	gš™Ÿlized
 = 
SDL_FALSE
;

46 #ià
SDL_MAJOR_VERSION
 == 1

48 (*
	glock_di¥Ïy
)(èð
NULL
;

49 (*
	guÆock_di¥Ïy
)(èð
NULL
;

51 
	$Lock_Di¥Ïy
()

53 if(
lock_di¥Ïy
)

54 
	`lock_di¥Ïy
();

55 
	}
}

57 
	$UÆock_Di¥Ïy
()

59 if(
uÆock_di¥Ïy
)

60 
	`uÆock_di¥Ïy
();

61 
	}
}

63 
	$þbßrd_fž‹r
(cÚ¡ 
SDL_Ev’t
 *
ev’t
)

66 iàÐ
ev’t
->
ty³
 =ð
SDL_SYSWMEVENT
 &&ƒv’t->
syswm
.
msg
 !ð
NULL
)

68 
XEv’t
 
xev’t
 = 
ev’t
->
syswm
.
msg
->event.xevent;

71 
xev’t
.
ty³
)

74 
S–eùiÚReque¡
:

76 
XEv’t
 
£v’t
;

77 
XS–eùiÚReque¡Ev’t
 *
»q
;

78 
£Ê_fÜm©
;

79 
nby‹s
;

80 
ov”æow
;

81 *
£Ê_d©a
;

83 
»q
 = &
xev’t
.
x£ËùiÚ»que¡
;

84 
£v’t
.
x£ËùiÚ
.
ty³
 = 
S–eùiÚNÙify
;

85 
£v’t
.
x£ËùiÚ
.
di¥Ïy
 = 
»q
->display;

86 
£v’t
.
x£ËùiÚ
.
£ËùiÚ
 = 
»q
->selection;

87 
£v’t
.
x£ËùiÚ
.
rg‘
 = 
NÚe
;

88 
£v’t
.
x£ËùiÚ
.
´Ý”ty
 = 
NÚe
;

89 
£v’t
.
x£ËùiÚ
.
»que¡Ü
 = 
»q
->requestor;

90 
£v’t
.
x£ËùiÚ
.
time
 = 
»q
->time;

91 iàÐ
	`XG‘WšdowPrÝ”ty
(
di¥Ïy
, 
	`DeçuÉRoÙWšdow
(display),

92 
XA_CUT_BUFFER0
, 0, 
INT_MAX
/4, 
F®£
, 
»q
->
rg‘
,

93 &
£v’t
.
x£ËùiÚ
.
rg‘
, &
£Ê_fÜm©
,

94 &
nby‹s
, &
ov”æow
, &
£Ê_d©a
è=ð
Sucûss
 )

96 iàÐ
£v’t
.
x£ËùiÚ
.
rg‘
 =ð
»q
->target )

98 iàÐ
£v’t
.
x£ËùiÚ
.
rg‘
 =ð
XA_STRING
 )

100 iàÐ
£Ê_d©a
[
nby‹s
-1] == '\0' )

101 --
nby‹s
;

103 
	`XChªgePrÝ”ty
(
di¥Ïy
, 
»q
->
»que¡Ü
,„eq->
´Ý”ty
,

104 
£v’t
.
x£ËùiÚ
.
rg‘
, 
£Ê_fÜm©
, 
PrÝModeR•Ïû
,

105 
£Ê_d©a
, 
nby‹s
);

106 
£v’t
.
x£ËùiÚ
.
´Ý”ty
 = 
»q
->property;

108 
	`XF»e
(
£Ê_d©a
);

110 
	`XS’dEv’t
(
di¥Ïy
,
»q
->
»que¡Ü
,
F®£
,0,&
£v’t
);

111 
	`XSync
(
di¥Ïy
, 
F®£
);

119 
	}
}

121 * 
	$g‘_þbßrd_‹xt_x11
()

123 
Atom
 
£ËùiÚ
;

124 
Wšdow
 
owÃr
;

125 
Atom
 
£Ê_ty³
;

126 
£Ê_fÜm©
;

127 
nby‹s
;

128 
ov”æow
;

129 *
¤c
;

130 *
‹xt
 = 
NULL
;

132 ià(!
š™Ÿlized
)

133  
NULL
;

135 
	`Lock_Di¥Ïy
();

136 
owÃr
 = 
	`XG‘S–eùiÚOwÃr
(
di¥Ïy
, 
XA_PRIMARY
);

137 
	`UÆock_Di¥Ïy
();

139 ià(
owÃr
 =ð
NÚe
 || owÃ¸=ð
wšdow
)

141 
owÃr
 = 
	`DeçuÉRoÙWšdow
(
di¥Ïy
);

142 
£ËùiÚ
 = 
XA_CUT_BUFFER0
;

146 
£ËùiÚ_»¥Ú£
 = 0;

147 
SDL_Ev’t
 
ev’t
;

149 
owÃr
 = 
wšdow
;

151 
	`Lock_Di¥Ïy
();

152 
£ËùiÚ
 = 
	`XIÁ”nAtom
(
di¥Ïy
, "OricuŒÚ", 
F®£
);

153 
	`XCÚv”tS–eùiÚ
(
di¥Ïy
, 
XA_PRIMARY
, 
XA_STRING
, 
£ËùiÚ
, 
owÃr
, 
Cu¼’tTime
);

154 
	`UÆock_Di¥Ïy
();

156 !
£ËùiÚ_»¥Ú£
)

158 
	`SDL_Wa™Ev’t
(&
ev’t
);

159 ià(
ev’t
.
ty³
 =ð
SDL_SYSWMEVENT
 &&ƒv’t.
syswm
.
msg
 !ð
NULL
)

161 
XEv’t
 
xev’t
 = 
ev’t
.
syswm
.
msg
->event.xevent;

162 iàÐ(
xev’t
.
ty³
 =ð
S–eùiÚNÙify
) &&

163 (
xev’t
.
x£ËùiÚ
.
»que¡Ü
 =ð
owÃr
) )

164 
£ËùiÚ_»¥Ú£
 = 1;

169 
	`Lock_Di¥Ïy
();

170 ià(
	`XG‘WšdowPrÝ”ty
(
di¥Ïy
, 
owÃr
, 
£ËùiÚ
, 0,

171 
INT_MAX
/4, 
F®£
, 
XA_STRING
, &
£Ê_ty³
, &
£Ê_fÜm©
,

172 &
nby‹s
, &
ov”æow
, (**)&
¤c
è=ð
Sucûss
)

174 ià(
£Ê_ty³
 =ð
XA_STRING
)

176 
‹xt
 = 
	`¡rdup
(
¤c
);

178 
	`XF»e
(
¤c
);

180 
	`UÆock_Di¥Ïy
();

182  
‹xt
;

183 
	}
}

185 
	$£t_þbßrd_‹xt_x11
(cÚ¡ * 
‹xt
)

187 ià(!
š™Ÿlized
)

190 iàÐ
‹xt
 !ð
NULL
 )

192 
	`Lock_Di¥Ïy
();

193 
	`XChªgePrÝ”ty
(
di¥Ïy
, 
	`DeçuÉRoÙWšdow
(display),

194 (
Atom
)
XA_CUT_BUFFER0
, 
XA_STRING
, 8, 
PrÝModeR•Ïû
, (*)
‹xt
, 
	`¡¾’
(text)+1);

195 iàÐ
	`XG‘S–eùiÚOwÃr
(
di¥Ïy
, 
XA_PRIMARY
è!ð
wšdow
 )

196 
	`XS‘S–eùiÚOwÃr
(
di¥Ïy
, 
XA_PRIMARY
, 
wšdow
, 
Cu¼’tTime
);

197 
	`UÆock_Di¥Ïy
();

199 
	}
}

201 
	$š™_þbßrd
()

203 if(
š™Ÿlized
)

207 
SDL_SysWMšfo
 
šfo
;

208 
	`SDL_VERSION
(&
šfo
.
v”siÚ
);

209 ià(
	`SDL_COMPAT_G‘WMInfo
(&
šfo
))

212 ià(
šfo
.
subsy¡em
 =ð
SDL_SYSWM_X11
)

214 
di¥Ïy
 = 
šfo
.šfo.
x11
.display;

215 
wšdow
 = 
šfo
.šfo.
x11
.window;

216 
lock_di¥Ïy
 = 
šfo
.šfo.
x11
.
lock_func
;

217 
uÆock_di¥Ïy
 = 
šfo
.šfo.
x11
.
uÆock_func
;

220 
	`SDL_Ev’tS‹
(
SDL_SYSWMEVENT
, 
SDL_ENABLE
);

221 
	`SDL_COMPAT_S‘Ev’tFž‹r
(
þbßrd_fž‹r
);

223 
š™Ÿlized
 = 
SDL_TRUE
;

226 
	}
}

230 
	$š™_þbßrd
()

232 if(
š™Ÿlized
)

236 
SDL_SysWMšfo
 
šfo
;

237 
	`SDL_VERSION
(&
šfo
.
v”siÚ
);

238 ià(
	`SDL_COMPAT_G‘WMInfo
(&
šfo
))

241 ià(
šfo
.
subsy¡em
 =ð
SDL_SYSWM_X11
)

243 
di¥Ïy
 = 
šfo
.šfo.
x11
.display;

244 
wšdow
 = 
šfo
.šfo.
x11
.window;

246 
š™Ÿlized
 = 
SDL_TRUE
;

249 
	}
}

253 
SDL_boÞ
 
	$š™_gui_Çtive
Ð
machše
 *
Üic
 )

255 
	`š™_þbßrd
();

256  
š™Ÿlized
;

257 
	}
}

259 
	$shut_gui_Çtive
Ð
machše
 *
Üic
 )

262 
	}
}

264 
	$gui_Ý’_u¾
ÐcÚ¡ *
u¾
 )

267 
	}
}

269 
SDL_boÞ
 
	$þbßrd_cÝy
Ð
machše
 *
Üic
 )

272 ià(
Üic
->
vid_addr
 !ðÜic->
vidba£s
[2])

273  
SDL_FALSE
;

275 
lše
, 
cÞ
, 
i
;

276 
‹xt
[40 * 28 + 28 + 1];

277 *
vidmem
 = (&
Üic
->
mem
[Üic->
vid_addr
]);

279 
i
 = 0, 
lše
 = 0;†ine < 28;†ine++) {

280 
cÞ
 = 0; col < 40; col++) {

281 
c
 = 
vidmem
[
lše
 * 40 + 
cÞ
];

283 ià(
c
 > 127) {

284 
c
 -= 128;

287 ià(
c
 < ' ' || c == 127) {

288 
‹xt
[
i
++] = ' ';

290 
‹xt
[
i
++] = ()
c
;

292 
‹xt
[
i
++] = '\n';

294 
‹xt
[
i
++] = '\0';

297 #ià
SDL_MAJOR_VERSION
 == 1

298 
	`£t_þbßrd_‹xt_x11
(
‹xt
);

300 
	`SDL_S‘ClbßrdText
(
‹xt
);

302  
SDL_TRUE
;

303 
	}
}

305 
SDL_boÞ
 
	$þbßrd_·¡e
Ð
machše
 *
Üic
 )

307 *
‹xt
 = 
NULL
;

309 #ià
SDL_MAJOR_VERSION
 == 1

310 
‹xt
 = 
	`g‘_þbßrd_‹xt_x11
();

312 if(
	`SDL_HasClbßrdText
())

313 
‹xt
 = 
	`SDL_G‘ClbßrdText
();

316 if(
‹xt
 !ð
NULL
)

318 * 
p
 = 
‹xt
;

319 
p
 && *p)

321 *
p
)

323 '\t': *
p
 = ' '; ;

324 '\n': *
p
 = '\r'; ;

326 *
p
 = (*p < 0x20 || 128 <= *p)? ' ' : *p;

329 
p
++;

331 
	`queuekeys
(
‹xt
);

332 
	`ä“
(
‹xt
);

334  
SDL_TRUE
;

335 
	}
}

	@joystick.c

22 
	~<¡dlib.h
>

23 
	~<¡dio.h
>

24 
	~<¡ršg.h
>

25 
	~<ùy³.h
>

27 
	~"sy¡em.h
"

28 
	~"6502.h
"

29 
	~"vŸ.h
"

30 
	~"8912.h
"

31 
	~"gui.h
"

32 
	~"disk.h
"

33 
	~"mÚ™Ü.h
"

34 
	~"6551.h
"

35 
	~"machše.h
"

36 
	~"joy¡ick.h
"

38 
	skeyjoydef


40 *
	mid
;

41 
SDL_COMPAT_KEY
 
	msym
;

44 
keyjoydef
 
	gkeyjoyb
[] = { { "BACKSPACE", 
SDLK_BACKSPACE
 },

45 { "TAB", 
SDLK_TAB
 },

46 { "CLEAR", 
SDLK_CLEAR
 },

47 { "RETURN", 
SDLK_RETURN
 },

48 { "ENTER", 
SDLK_RETURN
 },

49 { "PAUSE", 
SDLK_PAUSE
 },

50 { "ESCAPE", 
SDLK_ESCAPE
 },

51 { "SPACE", 
SDLK_SPACE
 },

52 { "HELP", 
SDLK_HELP
 },

53 { "DELETE", 
SDLK_DELETE
 },

54 { "DEL", 
SDLK_DELETE
 },

55 { "LSHIFT", 
SDLK_LSHIFT
 },

56 { "RSHIFT", 
SDLK_RSHIFT
 },

57 { "RCTRL", 
SDLK_RCTRL
 },

58 { "LCTRL", 
SDLK_LCTRL
 },

59 { "RALT", 
SDLK_RALT
 },

60 { "LALT", 
SDLK_LALT
 },

61 { "KP0", 
SDLK_KP0
 },

62 { "KP1", 
SDLK_KP1
 },

63 { "KP2", 
SDLK_KP2
 },

64 { "KP3", 
SDLK_KP3
 },

65 { "KP4", 
SDLK_KP4
 },

66 { "KP5", 
SDLK_KP5
 },

67 { "KP6", 
SDLK_KP6
 },

68 { "KP7", 
SDLK_KP7
 },

69 { "KP8", 
SDLK_KP8
 },

70 { "KP9", 
SDLK_KP9
 },

71 { "KP_PERIOD", 
SDLK_KP_PERIOD
 },

72 { "KP_FULLSTOP", 
SDLK_KP_PERIOD
 },

73 { "KP_DIVIDE", 
SDLK_KP_DIVIDE
 },

74 { "KP_MULTIPLY", 
SDLK_KP_MULTIPLY
 },

75 { "KP_MINUS", 
SDLK_KP_MINUS
 },

76 { "KP_PLUS", 
SDLK_KP_PLUS
 },

77 { "KP_ENTER", 
SDLK_KP_ENTER
 },

78 { "KP_EQUALS", 
SDLK_KP_EQUALS
 },

79 { "UP", 
SDLK_UP
 },

80 { "DOWN", 
SDLK_DOWN
 },

81 { "LEFT", 
SDLK_LEFT
 },

82 { "RIGHT", 
SDLK_RIGHT
 },

83 { "INSERT", 
SDLK_INSERT
 },

84 { "HOME", 
SDLK_HOME
 },

85 { "END", 
SDLK_END
 },

86 { "PAGEUP", 
SDLK_PAGEUP
 },

87 { "PAGEDOWN", 
SDLK_PAGEDOWN
 },

88 { 
NULL
, 0 } };

90 
SDL_boÞ
 
	gjoysubš™ed
 = 
SDL_FALSE
;

91 
Ušt8
 
	gjoy¡©e_a
[6], 
	gjoy¡©e_b
[6];

93 
SDL_boÞ
 
	$is_»®_joy¡ick
Ð
Sšt16
 
joymode
 )

95 ifÐÐ
joymode
 >ð
JOYMODE_SDL0
 ) && ( joymod<ð
JOYMODE_SDL9
 ) )

96  
SDL_TRUE
;

97  
SDL_FALSE
;

98 
	}
}

100 
	$þo£_joy¡icks
Ð
machše
 *
Üic
 )

102 ifÐ
joysubš™ed
 )

104 ifÐ
Üic
->
sdljoy_a
 )

106 
	`SDL_Joy¡ickClo£
Ð
Üic
->
sdljoy_a
 );

107 ifÐ
Üic
->
sdljoy_b
 =ðÜic->
sdljoy_a
 )

108 
Üic
->
sdljoy_b
 = 
NULL
;

109 
Üic
->
sdljoy_a
 = 
NULL
;

111 ifÐ
Üic
->
sdljoy_b
 )

113 
	`SDL_Joy¡ickClo£
Ð
Üic
->
sdljoy_b
 );

114 
Üic
->
sdljoy_b
 = 
NULL
;

117 
	`SDL_Joy¡ickEv’tS‹
Ð
SDL_FALSE
 );

119 
	}
}

122 
Sšt16
 
	$joy_keyÇme_to_sym
Ð*
Çme
 )

124 
Sšt32
 
i
;

125 
c
;

128 ifÐ
Çme
[1] == 0 )

130 
c
 = 
	`tÞow”
Ð
Çme
[0] );

131 ifÐÐ
c
 >= 32 ) && ( c < 127 ) )  c;

136  
i
=0; 
keyjoyb
[i].
id
; i++ )

138 ifÐ
	`¡rÿ£cmp
Ð
keyjoyb
[
i
].
id
, 
Çme
 ) == 0 )

139  
keyjoyb
[
i
].
sym
;

143 
	}
}

145 
SDL_boÞ
 
	$dojoyev’t
Ð
SDL_Ev’t
 *
ev
, 
machše
 *
Üic
, 
Sšt16
 
mode
, 
Ušt8
 *
joy¡©e
, 
SDL_Joy¡ick
 *
sjoy
 )

147 
Sšt32
 
i
;

148 
SDL_COMPAT_KEY
 *
kbb
;

149 
SDL_boÞ
 
sw®low™
 = 
SDL_FALSE
;

151 
kbb
 = 
Üic
->
kbjoy2
;

152  
mode
 )

154 
JOYMODE_NONE
:

155 
JOYMODE_MOUSE
:

156  
SDL_FALSE
;

158 
JOYMODE_KB1
:

159 
kbb
 = 
Üic
->
kbjoy1
;

160 
JOYMODE_KB2
:

161  
ev
->
ty³
 )

163 
SDL_KEYDOWN
:

164  
i
=0; i<6; i++ )

166 ifÐ
ev
->
key
.
keysym
.
sym
 =ð
kbb
[
i
] )

168 
joy¡©e
[
i
] = 1;

169 
sw®low™
 = 
SDL_TRUE
;

174 
SDL_KEYUP
:

175  
i
=0; i<6; i++ )

177 ifÐ
ev
->
key
.
keysym
.
sym
 =ð
kbb
[
i
] )

179 
joy¡©e
[
i
] = 0;

180 
sw®low™
 = 
SDL_TRUE
;

187 
JOYMODE_SDL0
:

188 
JOYMODE_SDL1
:

189 
JOYMODE_SDL2
:

190 
JOYMODE_SDL3
:

191 
JOYMODE_SDL4
:

192 
JOYMODE_SDL5
:

193 
JOYMODE_SDL6
:

194 
JOYMODE_SDL7
:

195 
JOYMODE_SDL8
:

196 
JOYMODE_SDL9
:

197 ifÐ!
sjoy
 )  
SDL_FALSE
;

199  
ev
->
ty³
 )

201 
SDL_JOYAXISMOTION
:

202 ifÐ
ev
->
jaxis
.
which
 !ð(
mode
-
JOYMODE_SDL0
èè 
SDL_FALSE
;

203 
sw®low™
 = 
SDL_TRUE
;

204  
ev
->
jaxis
.
axis
 )

207 ifÐ
ev
->
jaxis
.
v®ue
 < -3200 )

209 
joy¡©e
[2] = 1;

210 
joy¡©e
[3] = 0;

211 } ifÐ
ev
->
jaxis
.
v®ue
 > 3200 ) {

212 
joy¡©e
[2] = 0;

213 
joy¡©e
[3] = 1;

215 
joy¡©e
[2] = 0;

216 
joy¡©e
[3] = 0;

221 ifÐ
ev
->
jaxis
.
v®ue
 < -3200 )

223 
joy¡©e
[0] = 1;

224 
joy¡©e
[1] = 0;

225 } ifÐ
ev
->
jaxis
.
v®ue
 > 3200 ) {

226 
joy¡©e
[0] = 0;

227 
joy¡©e
[1] = 1;

229 
joy¡©e
[0] = 0;

230 
joy¡©e
[1] = 0;

236 
SDL_JOYBUTTONDOWN
:

237 ifÐ
ev
->
jbu‰Ú
.
which
 !ð(
mode
-
JOYMODE_SDL0
èè 
SDL_FALSE
;

238 
joy¡©e
[4+(
ev
->
jbu‰Ú
.
bu‰Ú
&1)] = 1;

239 
sw®low™
 = 
SDL_TRUE
;

242 
SDL_JOYBUTTONUP
:

243 ifÐ
ev
->
jbu‰Ú
.
which
 !ð(
mode
-
JOYMODE_SDL0
èè 
SDL_FALSE
;

244 
joy¡©e
[4+(
ev
->
jbu‰Ú
.
bu‰Ú
&1)] = 0;

245 
sw®low™
 = 
SDL_TRUE
;

251  
sw®low™
;

252 
	}
}

254 
	$joy_buždmask
Ð
machše
 *
Üic
 )

256 
Ušt8
 
mkmask
 = 0xff;

257 
Ušt8
 
joy£l
 = 
Üic
->
vŸ
.
	`»ad_pÜt_a
( &oric->via );

258 
SDL_boÞ
 
gimme_pÜt_a
 = 
SDL_FALSE
;

260  
Üic
->
joy_içû
 )

262 
JOYIFACE_ALTAI
:

263 ifÐ
joy£l
 & 0x80 )

265 ifÐ
joy¡©e_a
[0] ) 
mkmask
 &= 0xef;

266 ifÐ
joy¡©e_a
[1] ) 
mkmask
 &= 0xf7;

267 ifÐ
joy¡©e_a
[2] ) 
mkmask
 &= 0xfe;

268 ifÐ
joy¡©e_a
[3] ) 
mkmask
 &= 0xfd;

269 ifÐ
joy¡©e_a
[4] ) 
mkmask
 &= 0xdf;

270 
gimme_pÜt_a
 = 
SDL_TRUE
;

273 ifÐ
joy£l
 & 0x40 )

275 ifÐ
joy¡©e_b
[0] ) 
mkmask
 &= 0xef;

276 ifÐ
joy¡©e_b
[1] ) 
mkmask
 &= 0xf7;

277 ifÐ
joy¡©e_b
[2] ) 
mkmask
 &= 0xfe;

278 ifÐ
joy¡©e_b
[3] ) 
mkmask
 &= 0xfd;

279 ifÐ
joy¡©e_b
[4] ) 
mkmask
 &= 0xdf;

280 
gimme_pÜt_a
 = 
SDL_TRUE
;

284 
JOYIFACE_IJK
:

285 
mkmask
 &= 0xdf;

287 ifÐ((
Üic
->
vŸ
.
ddrb
 & 0x10)==0) ||

288 ((
Üic
->
vŸ
.
	`»ad_pÜt_b
( &oric->via )&0x10)!=0) )

291 
gimme_pÜt_a
 = 
SDL_TRUE
;

293 ifÐÐ
joy£l
 & 0xc0 ) == 0xc0 ) ;

295 ifÐ
joy£l
 & 0x40 )

297 ifÐ
joy¡©e_a
[0] ) 
mkmask
 &= 0xef;

298 ifÐ
joy¡©e_a
[1] ) 
mkmask
 &= 0xf7;

299 ifÐ
joy¡©e_a
[2] ) 
mkmask
 &= 0xfd;

300 ifÐ
joy¡©e_a
[3] ) 
mkmask
 &= 0xfe;

301 ifÐ
joy¡©e_a
[4] ) 
mkmask
 &= 0xfb;

304 ifÐ
joy£l
 & 0x80 )

306 ifÐ
joy¡©e_b
[0] ) 
mkmask
 &= 0xef;

307 ifÐ
joy¡©e_b
[1] ) 
mkmask
 &= 0xf7;

308 ifÐ
joy¡©e_b
[2] ) 
mkmask
 &= 0xfd;

309 ifÐ
joy¡©e_b
[3] ) 
mkmask
 &= 0xfe;

310 ifÐ
joy¡©e_b
[4] ) 
mkmask
 &= 0xfb;

315 
Üic
->
pÜ_joy
 = 
mkmask
;

316 ifÐ
gimme_pÜt_a
 )

318 
Üic
->
vŸ
.
	`wr™e_pÜt_a
Ð&Üic->vŸ, 0xff, 
mkmask
 );

319 
Üic
->
pÜ_is_ay
 = 
SDL_FALSE
;

321 ifÐ!
Üic
->
pÜ_is_ay
 )

323 
Üic
->
vŸ
.
	`wr™e_pÜt_a
Ð&Üic->vŸ, 0xff, oric->
pÜ_ay
 );

324 
Üic
->
pÜ_is_ay
 = 
SDL_TRUE
;

327 
	}
}

329 
SDL_boÞ
 
	$joy_fž‹r_ev’t
Ð
SDL_Ev’t
 *
ev
, 
machše
 *
Üic
 )

331 
SDL_boÞ
 
sw®low_ev’t
;

333 
sw®low_ev’t
 = 
	`dojoyev’t
Ð
ev
, 
Üic
, (Üic->
ty³
==
MACH_TELESTRAT
è? oric->
‹Ëjoymode_a
 : oric->
joymode_a
, 
joy¡©e_a
, oric->
sdljoy_a
 );

334 
sw®low_ev’t
 |ð
	`dojoyev’t
Ð
ev
, 
Üic
, (Üic->
ty³
==
MACH_TELESTRAT
è? oric->
‹Ëjoymode_b
 : oric->
joymode_b
, 
joy¡©e_b
, oric->
sdljoy_b
 );

336 ifÐ
sw®low_ev’t
 )

340 
	`joy_buždmask
Ð
Üic
 );

351  
sw®low_ev’t
;

352 
	}
}

354 
	$dojoy£tup
Ð
machše
 *
Üic
, 
Sšt16
 
mode_a
, Sšt16 
mode_b
 )

356 
Sšt32
 
i
;

358 
	`þo£_joy¡icks
Ð
Üic
 );

360  
i
=0; i<6; i++ )

362 
joy¡©e_a
[
i
] = 0;

363 
joy¡©e_b
[
i
] = 0;

366 ifÐ(!
	`is_»®_joy¡ick
Ð
mode_a
 )è&& (!is_»®_joy¡ickÐ
mode_b
 )) )

369 ifÐ!
joysubš™ed
 )

372 ifÐ
	`SDL_In™SubSy¡em
Ð
SDL_INIT_JOYSTICK
 ) != 0 )

376 
joysubš™ed
 = 
SDL_TRUE
;

379 ifÐ
	`is_»®_joy¡ick
Ð
mode_a
 ) )

381 
Üic
->
sdljoy_a
 = 
	`SDL_Joy¡ickO³n
Ð
mode_a
 - 
JOYMODE_SDL0
 );

383 
	`SDL_Joy¡ickEv’tS‹
Ð
SDL_TRUE
 );

386 ifÐ
	`is_»®_joy¡ick
Ð
mode_b
 ) )

388 ifÐ
mode_b
 =ð
mode_a
 )

390 
Üic
->
sdljoy_b
 = oric->
sdljoy_a
;

392 
Üic
->
sdljoy_b
 = 
	`SDL_Joy¡ickO³n
Ð
mode_b
 - 
JOYMODE_SDL0
 );

393 
	`SDL_Joy¡ickEv’tS‹
Ð
SDL_TRUE
 );

396 
	}
}

398 
	$joy_£tup
Ð
machše
 *
Üic
 )

400 ifÐ
Üic
->
ty³
 =ð
MACH_TELESTRAT
 )

401 
	`dojoy£tup
Ð
Üic
, oric->
‹Ëjoymode_a
, oric->
‹Ëjoymode_b
 );

403 
	`dojoy£tup
Ð
Üic
, oric->
joymode_a
, oric->
joymode_b
 );

404 
	}
}

408 
SDL_boÞ
 
	$š™_joy
Ð
machše
 *
Üic
 )

410  
SDL_TRUE
;

411 
	}
}

413 
	$shut_joy
Ð
machše
 *
Üic
 )

415 
	`þo£_joy¡icks
Ð
Üic
 );

416 
	}
}

	@joystick.h

25 
	mJOYIFACE_NONE
 = 0,

26 
	mJOYIFACE_ALTAI
,

27 
	mJOYIFACE_IJK


33 
	mJOYMODE_NONE
 = 0,

34 
	mJOYMODE_KB1
,

35 
	mJOYMODE_KB2
,

36 
	mJOYMODE_SDL0
,

37 
	mJOYMODE_SDL1
,

38 
	mJOYMODE_SDL2
,

39 
	mJOYMODE_SDL3
,

40 
	mJOYMODE_SDL4
,

41 
	mJOYMODE_SDL5
,

42 
	mJOYMODE_SDL6
,

43 
	mJOYMODE_SDL7
,

44 
	mJOYMODE_SDL8
,

45 
	mJOYMODE_SDL9
,

46 
	mJOYMODE_MOUSE


49 
SDL_boÞ
 
š™_joy
Ð
machše
 *
Üic
 );

50 
shut_joy
Ð
machše
 *
Üic
 );

52 
Sšt16
 
joy_keyÇme_to_sym
Ð*
Çme
 );

53 
joy_£tup
Ð
machše
 *
Üic
 );

54 
SDL_boÞ
 
joy_fž‹r_ev’t
Ð
SDL_Ev’t
 *
ev
, 
machše
 *
Üic
 );

55 
joy_buždmask
Ð
machše
 *
Üic
 );

	@keyboard.c

22 #ifdeà
_MSC_VER


23 
	~<¡dlib.h
>

26 
	~<¡ršg.h
>

28 
	~"sy¡em.h
"

29 
	~"6502.h
"

30 
	~"vŸ.h
"

31 
	~"8912.h
"

32 
	~"gui.h
"

33 
	~"disk.h
"

34 
	~"mÚ™Ü.h
"

35 
	~"6551.h
"

36 
	~"machše.h
"

37 
	~"fž”eq.h
"

38 
	~"»nd”_sw.h
"

39 
	~"»nd”_sw8.h
"

40 
	~"»nd”_gl.h
"

41 
	~"»nd”_nuÎ.h
"

42 
	~"uÏ.h
"

43 
	~"³.h
"

44 
	~"joy¡ick.h
"

45 
	~"msgbox.h
"

46 
	~"keybßrd.h
"

49 
kbdkey
 
	gkbd_©mos
[65], 
	gkbd_Üic1
[65], 
	gkbd_´av‘z
[65];

51 
SDL_Surçû
* 
	$C»©eSurçû
Ð
width
 , 
height
 )

53 
ušt32_t
 
rmask
 , 
gmask
 , 
bmask
 , 
amask
;

54 
SDL_Surçû
* 
surçû
;

58 #ià
SDL_BYTEORDER
 =ð
SDL_BIG_ENDIAN


59 
rmask
 = 0xff000000;

60 
gmask
 = 0x00ff0000;

61 
bmask
 = 0x0000ff00;

62 
amask
 = 0x000000ff;

64 
rmask
 = 0x000000ff;

65 
gmask
 = 0x0000ff00;

66 
bmask
 = 0x00ff0000;

67 
amask
 = 0xff000000;

70 
surçû
 = 
	`SDL_C»©eRGBSurçû
Ð0 , 
width
 , 
height
 , 32 , 
rmask
 , 
gmask
 , 
bmask
 , 
amask
 );

71 ifÐ
surçû
 =ð
NULL
 )

73 
	`”rÜ_´štf
("C»©eRGBSurçû fažed: %s", 
	`SDL_G‘E¼Ü
() );

74 
	`ex™
(
EXIT_FAILURE
);

77  
surçû
;

78 
	}
}

80 
	#KEYSIM_FLAG
 ((
SDL_COMPAT_KEY
)0x8000)

	)

81 
	#KEYSIM_MASK
 ((
SDL_COMPAT_KEY
)0x7FFF)

	)

83 
SDL_COMPAT_KEY
 
	gkeyM­
[] = {

85 
SDLK_ESCAPE
, 'q', 'w', 'e', 'r', 't', 'y', 'u', 'i', 'o', 'p', '[', ']', 
SDLK_BACKSPACE
,

86 
SDLK_LCTRL
, 'a', 's', 'd', 'f', 'g', 'h', 'j', 'k', 'l', ';', '\'', 
SDLK_RETURN
,

87 
SDLK_LSHIFT
, 'z', 'x', 'c', 'v', 'b', 'n', 'm', ',', '.', '/', 
SDLK_RSHIFT
,

88 
SDLK_LEFT
, 
SDLK_DOWN
, ' ', 
SDLK_UP
, 
SDLK_RIGHT
, 
SDLK_RALT
, ' ', ' ', ' ', ' ', ' ', ' ' };

90 
SDL_COMPAT_KEY
 
	gkeyM­P¿v‘z
[] = {

91 '1', '2', '3', '4', '5', '6', '7', '8', '9', '0', 
KEYSIM_FLAG
|';', '-', ';',

92 
SDLK_ESCAPE
, 'q', 'w', 'e', 'r', 't', 'y', 'u', 'i', 'o', 'p', 
KEYSIM_FLAG
|'2', '\\', 
SDLK_BACKSPACE
,

93 
SDLK_LCTRL
, 'a', 's', 'd', 'f', 'g', 'h', 'j', 'k', 'l', '[', ']', 
SDLK_RETURN
,

94 
SDLK_LSHIFT
, 'z', 'x', 'c', 'v', 'b', 'n', 'm', ',', '.', '/', 
SDLK_RSHIFT
,

95 
SDLK_LEFT
, 
SDLK_DOWN
, ' ', 
SDLK_UP
, 
SDLK_RIGHT
, 
SDLK_RALT
, 
KEYSIM_FLAG
|'6', ' ', ' ', ' ', ' ', ' ' };

97 
SDL_COMPAT_KEY
 
	gkeyM­ShiáedP¿v‘z
[] = {

98 '1', '\'', '3', '4', '5', '7', 
KEYSIM_FLAG
|'\'', '9', '0', '-', '8', KEYSIM_FLAG|'=', '=',

99 
SDLK_ESCAPE
, 'q', 'w', 'e', 'r', 't', 'y', 'u', 'i', 'o', 'p', '~', '\\', 
SDLK_BACKSPACE
,

100 
SDLK_LCTRL
, 'a', 's', 'd', 'f', 'g', 'h', 'j', 'k', 'l', '[', ']', 
SDLK_RETURN
,

101 
SDLK_LSHIFT
, 'z', 'x', 'c', 'v', 'b', 'n', 'm', ',', '.', '/', 
SDLK_RSHIFT
,

102 
SDLK_LEFT
, 
SDLK_DOWN
, ' ', 
SDLK_UP
, 
SDLK_RIGHT
, 
SDLK_RALT
, '`', ' ', ' ', ' ', ' ', ' ' };

105 
	mMOD_CTRL
 = 0,

106 
	mMOD_LSHIFT
,

107 
	mMOD_RSHIFT
,

108 
	mMOD_FUNCT
,

109 
	mMODKEY_MAX


112 
SDL_COMPAT_KEY
 
	gmodKeys
[
MODKEY_MAX
] = { 
SDLK_LCTRL
, 
SDLK_LSHIFT
, 
SDLK_RSHIFT
, 
SDLK_LALT
 };

113 *
	gmodKeyNames
[
MODKEY_MAX
] = { "Ctrl", "Left shift", "Right shift", "Funct" };

114 cÚ¡ 
	gmodKeyMax
 = 
MODKEY_MAX
;

115 
SDL_boÞ
 
	gmodKeyP»s£d
[
MODKEY_MAX
];

116 
SDL_boÞ
 
	gmodKeyFakeP»s£d
[
MODKEY_MAX
];

118 
	$kbd_š™
Ð
machše
 *
Üic
 )

120 
i
, 
j
;

122 
	`mem£t
(&
modKeyP»s£d
[0], 0, (modKeyPressed));

123 
	`mem£t
(&
modKeyFakeP»s£d
[0], 0, (modKeyFakePressed));

125 
Üic
->
keybßrd_m­pšg
.
nb_m­
 = 0;

127  
i
=0; i<62; i++ )

129 
kbd_©mos
[
i
].
w
 = 43;

130 
kbd_©mos
[
i
].
h
 = 43;

131 
kbd_©mos
[
i
].
highlight
 = 0;

132 
kbd_©mos
[
i
].
highlightçde
 = 0;

133 
kbd_©mos
[
i
].
is_mod_key
 = 0;

134 
kbd_©mos
[
i
].
keysim
 = 
keyM­
[i];

136 
kbd_Üic1
[
i
].
w
 = 43;

137 
kbd_Üic1
[
i
].
h
 = 43;

138 
kbd_Üic1
[
i
].
highlight
 = 0;

139 
kbd_Üic1
[
i
].
highlightçde
 = 0;

140 
kbd_Üic1
[
i
].
is_mod_key
 = 0;

141 
kbd_Üic1
[
i
].
keysim
 = 
keyM­
[i];

143 
kbd_´av‘z
[
i
].
w
 = 41;

144 
kbd_´av‘z
[
i
].
h
 = 41;

145 
kbd_´av‘z
[
i
].
highlight
 = 0;

146 
kbd_´av‘z
[
i
].
highlightçde
 = 0;

147 
kbd_´av‘z
[
i
].
is_mod_key
 = 0;

148 
kbd_´av‘z
[
i
].
keysim
 = 
keyM­P¿v‘z
[i];

149 
kbd_´av‘z
[
i
].
keysimshiáed
 = 
keyM­ShiáedP¿v‘z
[i];

153 
j
 = 0; j < 
modKeyMax
; j++) {

154 ià(
kbd_©mos
[
i
].
keysim
 =ð
modKeys
[
j
]) {

155 
kbd_©mos
[
i
].
is_mod_key
 = 1;

156 
kbd_Üic1
[
i
].
is_mod_key
 = 1;

157 
kbd_´av‘z
[
i
].
is_mod_key
 = 1;

164  
i
=0; i<13; i++ )

166 
kbd_©mos
[
i
].
x
 = i*43+47;

167 
kbd_©mos
[
i
].
y
 = 10;

169 
kbd_Üic1
[
i
].
x
 = i*43+40;

170 
kbd_Üic1
[
i
].
y
 = 15;

172 
kbd_´av‘z
[
i
].
x
 = i*42+47;

173 
kbd_´av‘z
[
i
].
y
 = 10;

175  
i
=13; i<27; i++ )

177 
kbd_©mos
[
i
].
x
 = (i-13)*43+23;

178 
kbd_©mos
[
i
].
y
 = 53;

180 
kbd_Üic1
[
i
].
x
 = (i-13)*43+16;

181 
kbd_Üic1
[
i
].
y
 = 58;

183 
kbd_´av‘z
[
i
].
x
 = (i-13)*42+25;

184 
kbd_´av‘z
[
i
].
y
 = 51;

186  
i
=27; i<40; i++ )

188 
kbd_©mos
[
i
].
x
 = (i-27)*43+38;

189 
kbd_©mos
[
i
].
y
 = 96;

191 
kbd_Üic1
[
i
].
x
 = (i-27)*43+27;

192 
kbd_Üic1
[
i
].
y
 = 101;

194 
kbd_´av‘z
[
i
].
x
 = (i-27)*43+40;

195 
kbd_´av‘z
[
i
].
y
 = 93;

197 
kbd_©mos
[39].
w
 = 65;

198 
kbd_Üic1
[39].
w
 = 87;

200 
kbd_©mos
[40].
x
 = 38;

201 
kbd_©mos
[40].
y
 = 139;

202 
kbd_©mos
[40].
w
 = 65;

204  
i
=41; i<52; i++ )

206 
kbd_©mos
[
i
].
x
 = (i-41)*43+103;

207 
kbd_©mos
[
i
].
y
 = 139;

209 
kbd_©mos
[51].
w
 = 65;

211 
kbd_©mos
[52].
x
 = 60;

212 
kbd_©mos
[52].
y
 = 182;

213 
kbd_©mos
[53].
x
 = 103;

214 
kbd_©mos
[53].
y
 = 182;

215 
kbd_©mos
[54].
x
 = 146;

216 
kbd_©mos
[54].
y
 = 182;

217 
kbd_©mos
[54].
w
 = 344;

218 
kbd_©mos
[55].
x
 = 490;

219 
kbd_©mos
[55].
y
 = 182;

220 
kbd_©mos
[56].
x
 = 533;

221 
kbd_©mos
[56].
y
 = 182;

222 
kbd_©mos
[57].
x
 = 576;

223 
kbd_©mos
[57].
y
 = 182;

224 
kbd_©mos
[58].
x
 = -1;

226  
i
=40; i<52; i++ )

228 
kbd_Üic1
[
i
].
x
 = (i-40)*43+49;

229 
kbd_Üic1
[
i
].
y
 = 144;

232 
kbd_Üic1
[52].
x
 = 135;

233 
kbd_Üic1
[52].
y
 = 187;

234 
kbd_Üic1
[53].
x
 = 178;

235 
kbd_Üic1
[53].
y
 = 187;

236 
kbd_Üic1
[54].
x
 = 221;

237 
kbd_Üic1
[54].
y
 = 187;

238 
kbd_Üic1
[54].
w
 = 215;

239 
kbd_Üic1
[55].
x
 = 436;

240 
kbd_Üic1
[55].
y
 = 187;

241 
kbd_Üic1
[56].
x
 = 479;

242 
kbd_Üic1
[56].
y
 = 187;

243 
kbd_Üic1
[57].
x
 = -1;

245  
i
=41; i<52; i++ )

247 
kbd_´av‘z
[
i
].
x
 = (i-41)*43+103;

248 
kbd_´av‘z
[
i
].
y
 = 137;

251 
kbd_´av‘z
[26].
x
 = 38;

252 
kbd_´av‘z
[26].
y
 = 180;

254 
kbd_´av‘z
[39].
w
 = 65;

255 
kbd_´av‘z
[40].
x
 = 38;

256 
kbd_´av‘z
[40].
y
 = 137;

257 
kbd_´av‘z
[40].
w
 = 65;

258 
kbd_´av‘z
[51].
w
 = 65;

260 
kbd_´av‘z
[52].
x
 = 82;

261 
kbd_´av‘z
[52].
y
 = 180;

262 
kbd_´av‘z
[53].
x
 = 125;

263 
kbd_´av‘z
[53].
y
 = 180;

264 
kbd_´av‘z
[54].
x
 = 168;

265 
kbd_´av‘z
[54].
y
 = 180;

266 
kbd_´av‘z
[54].
w
 = 215+88;

267 
kbd_´av‘z
[55].
x
 = 436+40;

268 
kbd_´av‘z
[55].
y
 = 180;

269 
kbd_´av‘z
[56].
x
 = 479+40;

270 
kbd_´av‘z
[56].
y
 = 180;

271 
kbd_´av‘z
[58].
x
 = (13)*42+25;

272 
kbd_´av‘z
[58].
y
 = 51;

273 
kbd_´av‘z
[59].
x
 = 479+40 +42;

274 
kbd_´av‘z
[59].
y
 = 180;

275 
kbd_´av‘z
[60].
x
 = -1;

278 
	}
}

280 
SDL_boÞ
 
	gdefššg_key_m­
 = 
SDL_FALSE
;

281 
kbdkey
 * 
	gcu¼’t_key
 = 
NULL
;

282 
SDL_boÞ
 
	g»Ëa£_keys
 = 
SDL_FALSE
;

286 
SDL_boÞ
 
	$keybßrd_ev’t
Ð
SDL_Ev’t
 *
ev
, 
machše
 *
Üic
, 
SDL_boÞ
 *
Ãed»nd”
 )

288 
SDL_boÞ
 
dÚe
 = 
SDL_FALSE
;

289 
SDL_boÞ
 
lshiáed
 = 
modKeyP»s£d
[
MOD_LSHIFT
];

290 
SDL_boÞ
 
rshiáed
 = 
modKeyP»s£d
[
MOD_RSHIFT
];

292 
i
, 
x
, 
y
, 
cu¼’t_key_num
 = -1;

293 
tmp
[64];

294 
kbdkey
 * 
kbd
;

296 ià(
»Ëa£_keys
)

298 
x
 = 0;

299 
i
=0; i<
modKeyMax
; i++)

301 ià(
modKeyP»s£d
[
i
])

303 
modKeyP»s£d
[
i
] = 
SDL_FALSE
;

304 
	`ay_key´ess
Ð&
Üic
->
ay
, 
modKeys
[
i
], 
SDL_FALSE
 );

305 
	`¢´štf
(
tmp
, Ñmp), "% »Ëa£d.", 
modKeyNames
[
i
]);

306 
	`do_pÝup
(
Üic
, 
tmp
);

307 
x
++;

308 } ià(
modKeyFakeP»s£d
[
i
]) {

309 
modKeyFakeP»s£d
[
i
] = 
SDL_FALSE
;

310 
	`ay_key´ess
Ð&
Üic
->
ay
, 
modKeys
[
i
], 
SDL_FALSE
 );

314 ià(
x
 > 1)

315 
	`do_pÝup
(
Üic
, "All keys„eleased");

317 
»Ëa£_keys
 = 
SDL_FALSE
;

320 
x
 = -1;

321 
y
 = -1;

322  
ev
->
ty³
 )

324 
SDL_MOUSEBUTTONDOWN
:

325 
x
 = 
ev
->
bu‰Ú
.x;

326 
y
 = 
ev
->
bu‰Ú
.y - 480;

328  
Üic
->
ty³
 )

330 
MACH_PRAVETZ
:

331 
kbd
 = 
kbd_´av‘z
;

333 
MACH_ORIC1
:

334 
MACH_ORIC1_16K
:

335 
kbd
 = 
kbd_Üic1
;

338 
kbd
 = 
kbd_©mos
;

343 
cu¼’t_key
 = 
NULL
;

344 
i
=0; i<62; i++) {

345 ià((
x
 > 
kbd
[
i
].xè&& (x < kbd[i].x + kbd[i].
w
) &&

346 (
y
 > 
kbd
[
i
].yè&& (y < kbd[i].y + kbd[i].
h
)) {

347 
cu¼’t_key
 = &(
kbd
[
i
]);

348 
cu¼’t_key_num
 = 
i
;

356 ià(
cu¼’t_key
 !ð
NULL
) {

358 ifÐ
ev
->
bu‰Ú
.bu‰Ú =ð
SDL_BUTTON_LEFT
 )

360 if(
Üic
->
defše_m­pšg
) {

361 
	`do_pÝup
Ð
Üic
, "Presshe key you wanto use." );

362 
defššg_key_m­
 = 
SDL_TRUE
;

365 ià(
cu¼’t_key
->
is_mod_key
 && 
Üic
->
¡icky_mod_keys
) {

366 
i
=0; i<
modKeyMax
; i++) {

367 ià(
cu¼’t_key
->
keysim
 =ð
modKeys
[
i
])

371 ià(
i
 < 
modKeyMax
) {

372 ià(
modKeyP»s£d
[
i
]) {

373 
modKeyP»s£d
[
i
] = 
SDL_FALSE
;

374 
	`¢´štf
(
tmp
, Ñmp), "% »Ëa£d.", 
modKeyNames
[
i
]);

376 
modKeyP»s£d
[
i
] = 
SDL_TRUE
;

377 
	`¢´štf
(
tmp
, Ñmp), "% ´es£d.", 
modKeyNames
[
i
]);

379 
	`do_pÝup
(
Üic
, 
tmp
);

380 
	`ay_key´ess
Ð&
Üic
->
ay
, 
cu¼’t_key
->
keysim
, 
modKeyP»s£d
[
i
] );

381 
cu¼’t_key
 = 
NULL
;

382  
dÚe
;

387  
Üic
->
ty³
 )

389 
MACH_PRAVETZ
:

390 ià(
lshiáed
) {

391 ià(
cu¼’t_key_num
 == 24)

392 
	`queuekeys
("\x60");

393 ià(
KEYSIM_FLAG
 & 
cu¼’t_key
->
keysimshiáed
)

394 
	`ay_key´ess
Ð&
Üic
->
ay
, 
modKeys
[
MOD_LSHIFT
], 
SDL_FALSE
 );

395 
	`ay_key´ess
Ð&
Üic
->
ay
, 
KEYSIM_MASK
 & 
cu¼’t_key
->
keysimshiáed
, 
SDL_TRUE
 );

396 } ià(
rshiáed
) {

397 ià(
cu¼’t_key_num
 == 24)

398 
	`queuekeys
("\x60");

399 ià(
KEYSIM_FLAG
 & 
cu¼’t_key
->
keysimshiáed
)

400 
	`ay_key´ess
Ð&
Üic
->
ay
, 
modKeys
[
MOD_RSHIFT
], 
SDL_FALSE
 );

401 
	`ay_key´ess
Ð&
Üic
->
ay
, 
KEYSIM_MASK
 & 
cu¼’t_key
->
keysimshiáed
, 
SDL_TRUE
 );

403 ià(
cu¼’t_key_num
 == 59) {

404 
	`queuekeys
("\x14");

405 } ià(
KEYSIM_FLAG
 & 
cu¼’t_key
->
keysim
) {

406 
	`ay_key´ess
Ð&
Üic
->
ay
, 
modKeys
[
MOD_LSHIFT
], 
SDL_TRUE
 );

407 
	`ay_key´ess
Ð&
Üic
->
ay
, 
KEYSIM_MASK
 & 
cu¼’t_key
->
keysim
, 
SDL_TRUE
 );

408 
modKeyFakeP»s£d
[
MOD_LSHIFT
] = 
SDL_TRUE
;

410 
	`ay_key´ess
Ð&
Üic
->
ay
, 
KEYSIM_MASK
 & 
cu¼’t_key
->
keysim
, 
SDL_TRUE
 );

414 
MACH_ORIC1
:

415 
MACH_ORIC1_16K
:

416 
MACH_ATMOS
:

418 
	`ay_key´ess
Ð&
Üic
->
ay
, 
cu¼’t_key
->
keysim
, 
SDL_TRUE
 );

423 
»Ëa£_keys
 = 
SDL_TRUE
;

429 
SDL_MOUSEBUTTONUP
:

430 ià((
cu¼’t_key
 =ð
NULL
è|| (
defššg_key_m­
))

434  
Üic
->
ty³
 )

436 
MACH_PRAVETZ
:

437 ià(
lshiáed
 || 
rshiáed
) {

438 
	`ay_key´ess
Ð&
Üic
->
ay
, 
KEYSIM_MASK
 & 
cu¼’t_key
->
keysimshiáed
, 
SDL_FALSE
 );

440 
	`ay_key´ess
Ð&
Üic
->
ay
, 
KEYSIM_MASK
 & 
cu¼’t_key
->
keysim
, 
SDL_FALSE
 );

443 
MACH_ORIC1
:

444 
MACH_ORIC1_16K
:

445 
MACH_ATMOS
:

447 
	`ay_key´ess
Ð&
Üic
->
ay
, 
cu¼’t_key
->
keysim
, 
SDL_FALSE
 );

451 
cu¼’t_key
 = 
NULL
;

454 
SDL_KEYUP
:

455 ià(
defššg_key_m­
) {

456 
SDL_KeybßrdEv’t
 *
kbd_evt
 = (SDL_KeybßrdEv’ˆ*è
ev
;

457 
	`add_to_keybßrd_m­pšg
Ð&(
Üic
->
keybßrd_m­pšg
), 
kbd_evt
->
keysym
.
sym
, 
cu¼’t_key
->
keysim
 );

458 
	`do_pÝup
Ð
Üic
, "Key mapping done.");

459 
defššg_key_m­
 = 
SDL_FALSE
;

460 
cu¼’t_key
 = 
NULL
;

465  
dÚe
;

466 
	}
}

468 
	$»Ëa£_¡icky_keys
()

470 
»Ëa£_keys
 = 
SDL_TRUE
;

471 
	}
}

473 
	$add_to_keybßrd_m­pšg
Ð
keybßrd_m­pšg
 *
m­
, 
SDL_COMPAT_KEY
 
ho¡_key
, SDL_COMPAT_KEY 
Üic_key
 )

476 
šdex
 = 0;

477 
šdex
 < 
m­
->
nb_m­
) {

478 ià(
m­
->
ho¡_keys
[
šdex
] =ð
ho¡_key
) {

480 
m­
->
Üic_keys
[
šdex
] = 
Üic_key
;

484 
šdex
++;

488 
m­
->
ho¡_keys
[m­->
nb_m­
] = 
ho¡_key
;

489 
m­
->
Üic_keys
[m­->
nb_m­
] = 
Üic_key
;

490 
m­
->
nb_m­
++;

491 
	}
}

493 
	$»£t_keybßrd_m­pšg
Ð
keybßrd_m­pšg
 *
m­
 )

495 
m­
->
nb_m­
 = 0;

496 
	}
}

498 
SDL_boÞ
 
	$§ve_keybßrd_m­pšg
Ð
machše
 *
Üic
, *
fž’ame
 )

500 
SDL_boÞ
 
ok
 = 
SDL_TRUE
;

501 
FILE
 *
f
 = 
NULL
;

503 
f
 = 
	`fÝ’
(
fž’ame
, "wt");

504 ià(!
f
)

506 
	`msgbox
(
Üic
, 
MSGBOX_OK
, "Unableo create keyboard mapping file (1)");

507  
SDL_FALSE
;

510 ià(
	`åuts
("# SDL_key_symbÞ_fÜ_ho¡ : SDL_key_symbÞ_fÜ_Üic\n", 
f
) < 0)

512 
	`msgbox
(
Üic
, 
MSGBOX_OK
, "Unableo writeo keyboard mapping file (2)");

513 
ok
 = 
SDL_FALSE
;

515 ià(
ok
 =ð
SDL_TRUE
 && 
	`åuts
("# s“ h‰p://www.libsdl.Üg/»Ëa£/SDL-1.2.15/docs/html/sdlkey.htmÈ\n", 
f
) < 0)

517 
	`msgbox
(
Üic
, 
MSGBOX_OK
, "Unableo writeo keyboard mapping file (2)");

518 
ok
 = 
SDL_FALSE
;

522 ià(
ok
 =ð
SDL_TRUE
 && 
Üic
->
keybßrd_m­pšg
.
nb_m­
 != 0) {

523 
i
;

525 
i
=0; i < 
Üic
->
keybßrd_m­pšg
.
nb_m­
 && 
ok
 =ð
SDL_TRUE
; i++) {

527 ià(
	`årštf
(
f
, "%d : %d\n", 
Üic
->
keybßrd_m­pšg
.
ho¡_keys
[
i
], oric->keybßrd_m­pšg.
Üic_keys
[i]) < 0)

529 
	`msgbox
(
Üic
, 
MSGBOX_OK
, "Unableo writeo keyboard mapping file (3)");

530 
ok
 = 
SDL_FALSE
;

535 if(
	`fþo£
(
f
è=ð
EOF
) {

536 
	`msgbox
(
Üic
, 
MSGBOX_OK
, "Unableo close keyboard mapping file (4)");

537 
ok
 = 
SDL_FALSE
;

540  
ok
;

541 
	}
}

543 
SDL_boÞ
 
	$lßd_keybßrd_m­pšg
Ð
machše
 *
Üic
, *
fž’ame
 )

545 
SDL_boÞ
 
ok
 = 
SDL_TRUE
;

546 
FILE
 *
f
 = 
NULL
;

547 
buf
[4096];

548 
ho¡_key
, 
Üic_key
;

550 
f
 = 
	`fÝ’
(
fž’ame
, "rt");

551 ià(!
f
)

553 
	`msgbox
(
Üic
, 
MSGBOX_OK
, "Unableo„ead keyboard mapping file (1)");

554  
SDL_FALSE
;

558 
	`»£t_keybßrd_m­pšg
(&(
Üic
->
keybßrd_m­pšg
));

561 !
	`ãof
(
f
è&& !
	`ã¼Ü
(f)) {

563 ià(
	`fg‘s
(
buf
, 4096, 
f
)>0) {

565 ià(
buf
[0] != '#') {

567 ià(
	`ssÿnf
(
buf
, "%d : %d", &
ho¡_key
, &
Üic_key
)==2) {

569 
	`add_to_keybßrd_m­pšg
Ð&(
Üic
->
keybßrd_m­pšg
), 
ho¡_key
, 
Üic_key
);

575 if(
	`ã¼Ü
(
f
)) {

576 
	`msgbox
(
Üic
, 
MSGBOX_OK
, "Problem while„eading from keyboard mapping file (2)");

577 
ok
 = 
SDL_FALSE
;

580 ià(
ok
 =ð
SDL_TRUE
 && 
	`¥rštf
(
buf
, "R—d %d key m­pšgs", 
Üic
->
keybßrd_m­pšg
.
nb_m­
) > 0)

581 
	`do_pÝup
(
Üic
, 
buf
);

583 if(
	`fþo£
(
f
è=ð
EOF
) {

584 
	`msgbox
(
Üic
, 
MSGBOX_OK
, "Unableo close keyboard mapping file (3)");

585 
ok
 = 
SDL_FALSE
;

588  
ok
;

589 
	}
}

	@keyboard.h

21 #iâdeà
KEYBOARD_H


22 
	#KEYBOARD_H


	)

24 
	skbdkey


26 
	mx
, 
	my
, 
	mw
, 
	mh
;

27 
	mhighlight
;

28 
	mhighlightçde
;

29 
SDL_COMPAT_KEY
 
	mkeysim
;

30 
SDL_COMPAT_KEY
 
	mkeysimshiáed
;

31 
	mis_mod_key
;

34 
	skeybßrd_m­pšg


36 
SDL_COMPAT_KEY
 
	mho¡_keys
[65];

37 
SDL_COMPAT_KEY
 
	mÜic_keys
[65];

38 
SDL_COMPAT_KEY
 
	mnb_m­
;

42 
kbd_š™
Ð
machše
 *
Üic
 );

44 
SDL_boÞ
 
keybßrd_ev’t
Ð
SDL_Ev’t
 *
ev
, 
machše
 *
Üic
, SDL_boÞ *
Ãed»nd”
 );

46 
»Ëa£_¡icky_keys
();

48 
add_to_keybßrd_m­pšg
Ð
keybßrd_m­pšg
 *
m­
, 
SDL_COMPAT_KEY
 
ho¡_key
, SDL_COMPAT_KEY 
Üic_key
 );

50 
»£t_keybßrd_m­pšg
Ð
keybßrd_m­pšg
 *
m­
 );

52 
SDL_boÞ
 
§ve_keybßrd_m­pšg
Ð
machše
 *
Üic
, *
fž’ame
 );

54 
SDL_boÞ
 
lßd_keybßrd_m­pšg
Ð
machše
 *
Üic
, *
fž’ame
 );

	@machine.c

22 
	~<¡dlib.h
>

23 
	~<¡dio.h
>

24 
	~<¡ršg.h
>

25 
	~<ùy³.h
>

27 #ià
defšed
(
__amigaos4__
è|| defšed(
__MORPHOS__
)

28 
	~<´Ùo/dos.h
>

29 
	~<dos/do¡ags.h
>

30 
	~<´Ùo/amigaguide.h
>

33 
	~"sy¡em.h
"

34 
	~"6502.h
"

35 
	~"vŸ.h
"

36 
	~"8912.h
"

37 
	~"gui.h
"

38 
	~"disk.h
"

39 
	~"mÚ™Ü.h
"

40 
	~"6551.h
"

46 
	~"¶ugšs/ch376/ch376.h
"

47 
	~"¶ugšs/ch376/Üic_ch376_¶ugš.h
"

49 
	~"machše.h
"

50 
	~"avi.h
"

51 
	~"fž”eq.h
"

52 
	~"maš.h
"

53 
	~"uÏ.h
"

54 
	~"joy¡ick.h
"

55 
	~"³.h
"

56 
	~"keybßrd.h
"

58 
SDL_boÞ
 
w¬p¥“d
, 
soundavažabË
, 
soundÚ
;

59 
disk·th
[], 
diskfže
[], 
fž‘mp
[];

60 
‹Ëdisk·th
[], 
‹Ëdiskfže
[];

61 
´avdisk·th
[], 
´avdiskfže
[];

62 
SDL_boÞ
 
»äesh¡©us
, 
»äeshavi
;

63 
g_m’u_scheme
;

65 
	g©mo¤omfže
[1024];

66 
	gÜic1romfže
[1024];

67 
	gmdisüomfže
[1024];

68 
	gjasmÄomfže
[1024];

69 
	g´av‘zromfže
[2][1024];

70 
	g‹Ëbªkfžes
[8][1024];

72 
avi_hªdË
 *
	gvidÿp
 = 
NULL
;

73 
	gvidÿ²ame
[128];

74 
	gvidÿpcouÁ
 = 0;

76 
	gsü“nÿ²ame
[128];

77 
	gsü“nÿpcouÁ
 = 0;

79 
	grom_miüodisc
[8912], 
	grom_jasmš
[2048], 
	grom_´av‘z
[512];

80 
symbÞbË
 
	gsym_miüodisc
, 
	gsym_jasmš
, 
	gsym_´av‘z
;

81 
SDL_boÞ
 
	gmiüodisüom_v®id
, 
	gjasmšrom_v®id
, 
	g´av‘zrom_v®id
;

82 
osdm’u™em
 
maš™ems
[];

84 
Ušt8
 
	gÜiý®‘‹
[] = { 0x00, 0x00, 0x00,

93 
Ušt8
 
	g£dÜic_d‘eù
[] =

100 
Ušt8
 
	g¡¿t£d_d‘eù
[] =

107 
Ušt8
 
	gádos_d‘eù
[] =

114 
	$d‘eù_image_ty³
(*
fž’ame
)

116 
FILE
 *
f
;

117 
size_t
 
size
;

118 
tmp
[6400];

120 
f
 = 
	`fÝ’
(
fž’ame
, "rb");

121 ià(!
f
)

122  
IMG_I_DUNNO
;

124 
	`f£ek
(
f
, 0, 
SEEK_END
);

125 
size
 = 
	`á–l
(
f
);

126 
	`f£ek
(
f
, 0, 
SEEK_SET
);

128 ià(1 !ð
	`ä—d
(
tmp
, 8, 1, 
f
))

130 
	`fþo£
(
f
);

131  
IMG_I_DUNNO
;

135 ià((
	`memcmp
(
tmp
, "\x16\x16\x16\x16", 4) == 0) ||

136 (
	`memcmp
(
tmp
, "\x16\x16\x16\x24", 4) == 0) ||

137 (
	`memcmp
(
tmp
, "\x16\x16\x24", 3) == 0) ||

138 (
	`memcmp
(
tmp
, "RIFF", 4) == 0) ||

139 (
	`memcmp
(
tmp
, "ORT\x00", 4) == 0))

141 
	`fþo£
(
f
);

142  
IMG_TAPE
;

146 ià(
	`memcmp
(
tmp
, "OSN\x00", 4)==0)

148 
	`fþo£
(
f
);

149  
IMG_SNAPSHOT
;

153 ià((
size
 > 20è&& (
	`memcmp
(
tmp
, "MFM_DISK", 8)==0))

155 
Ušt8
 *
±r
, *
eÙ
;

156 
£ùÜËn
;

157 
SDL_boÞ
 
gÙ£ùÜ
 = 
SDL_FALSE
;

160 
	`f£ek
(
f
, 256, 
SEEK_SET
);

161 
	`ä—d
(
tmp
, 6400, 1, 
f
);

162 
	`fþo£
(
f
);

165 
±r
 = 
tmp
;

166 
eÙ
 = &
tmp
[6400];

170  (
±r
<
eÙ
) && (ptr[0]!=0xfe) )…tr++;

173 ià(
±r
 >ð
eÙ
)

175 
	`´štf
("%s: couldn'ˆfšd¿ck 0 seùÜ 1 iÀ%s\n", 
__func__
, 
fž’ame
);

176  
IMG_I_DUNNO
;

180 
£ùÜËn
 = (1<<(
±r
[4]+7));

181 
gÙ£ùÜ
 = (
±r
[3] == 1);

184 
±r
+=7;

187  (
±r
<
eÙ
) && (ptr[0]!=0xfb) && (ptr[0]!=0xf8) )…tr++;

188 ià(
±r
 >ð
eÙ
)

190 
	`´štf
("%s: couldn'ˆfšd¿ck 0 seùÜ 1 iÀ% (2)\n", 
__func__
, 
fž’ame
);

191  
IMG_I_DUNNO
;

195 ià(
gÙ£ùÜ
)

199 
±r
 +ð
£ùÜËn
+3;

200 ià(
±r
 >ð
eÙ
)

202 
	`´štf
("%s: couldn'ˆfšd¿ck 0 seùÜ 1 iÀ% (3)\n", 
__func__
, 
fž’ame
);

203  
IMG_I_DUNNO
;

209 ià(
£ùÜËn
 == 256)

211 ià(
	`memcmp
(
±r
, 
£dÜic_d‘eù
, (sedoric_detect))==0)

212  
IMG_ATMOS_MICRODISC
;

214 ià(
	`memcmp
(
±r
, 
¡¿t£d_d‘eù
, (stratsed_detect))==0)

215  
IMG_TELESTRAT_DISK
;

217 ià(
	`memcmp
(
±r
, 
ádos_d‘eù
, (ftdos_detect))==0)

218  
IMG_ATMOS_JASMIN
;

222  
IMG_GUESS_MICRODISC
;

225 
	`fþo£
(
f
);

228 ià(
size
 == 143360)

229  
IMG_PRAVETZ_DISK
;

231  
IMG_I_DUNNO
;

232 
	}
}

235 
	$£‹mumode
Ð
machše
 *
Üic
, 
osdm’u™em
 *
m™em
, 
mode
 )

237 
Üic
->
emu_mode
 = 
mode
;

239  
mode
 )

241 
EM_RUNNING
:

242 
	`SDL_COMPAT_EÇbËKeyR•—t
( 0, 0 );

243 
	`SDL_COMPAT_EÇbËUNICODE
Ð
SDL_FALSE
 );

244 
Üic
->
ay
.
soundÚ
 = 
soundavažabË
 && soundÚ && (!
w¬p¥“d
);

245 ifÐ
Üic
->
ay
.
soundÚ
 )

247 
	`ay_æushlog
Ð&
Üic
->
ay
 );

248 
	`SDL_Pau£Audio
( 0 );

250 
	`uÏ_£t_dœty
Ð
Üic
 );

253 
EM_MENU
:

254 ifÐ
vidÿp
 ) 
	`avi_þo£
( &vidcap );

255 
	`gÙom’u
Ð
Üic
, 
NULL
, 0 );

256 
	`SDL_COMPAT_EÇbËKeyR•—t
Ð
SDL_DEFAULT_REPEAT_DELAY
, 
SDL_DEFAULT_REPEAT_INTERVAL
 );

257 
	`SDL_COMPAT_EÇbËUNICODE
Ð
SDL_TRUE
 );

258 
Üic
->
ay
.
soundÚ
 = 
SDL_FALSE
;

259 ifÐ
soundavažabË
 )

260 
	`SDL_Pau£Audio
( 1 );

263 
EM_DEBUG
:

264 ifÐ
vidÿp
 ) 
	`avi_þo£
( &vidcap );

265 
	`mÚ_’‹r
Ð
Üic
 );

266 
	`SDL_COMPAT_EÇbËKeyR•—t
Ð
SDL_DEFAULT_REPEAT_DELAY
, 
SDL_DEFAULT_REPEAT_INTERVAL
 );

267 
	`SDL_COMPAT_EÇbËUNICODE
Ð
SDL_TRUE
 );

268 
Üic
->
ay
.
soundÚ
 = 
SDL_FALSE
;

269 ifÐ
soundavažabË
 )

270 
	`SDL_Pau£Audio
( 1 );

273 
	}
}

275 
	$£ŒomÚ
Ð
machše
 *
Üic
 )

278 
Üic
->
romÚ
 = 
SDL_TRUE
;

279 ifÐ
Üic
->
driv‘y³
 =ð
DRV_JASMIN
 )

281 ifÐ
Üic
->
jasmš
.
Þay
 == 0 )

283 
Üic
->
romÚ
 = !Üic->
romdis
;

285 
Üic
->
romÚ
 = 
SDL_FALSE
;

288 ifÐ
Üic
->
driv‘y³
 =ð
DRV_PRAVETZ
 )

290 
Üic
->
romÚ
 = !Üic->
´av‘z
.
Þay
;

292 
Üic
->
romÚ
 = !Üic->
romdis
;

294 
	}
}

297 
	$©moswr™e
Ð
m6502
 *
ýu
, 
addr
, 
d©a
 )

299 
machše
 *
Üic
 = (machš*)
ýu
->
u£rd©a
;

300 ifÐÐ!
Üic
->
romdis
 ) && ( 
addr
 >= 0xc000 ) ) ;

301 ifÐÐ
addr
 & 0xff00 ) == 0x0300 )

303 ifÐ
Üic
->
acŸback’d
 && ( oric->
acŸoff£t
 <ð
addr
 &&‡ddr < oric->aciaoffset+4 ) )

304 
	`acŸ_wr™e
Ð&
Üic
->
‹Ë_acŸ
, 
addr
, 
d©a
 );

306 ifÐ
Üic
->
ch376_aùiv©ed
 && ( 0x340 <ð
addr
 ) && (‡ddr < 0x342 ) )

307 
	`ch376_Üic_wr™e
(
Üic
->
ch376
, 
addr
, 
d©a
);

310 
	`vŸ_wr™e
Ð&
Üic
->
vŸ
, 
addr
, 
d©a
 );

314 
Üic
->
mem
[
addr
] = 
d©a
;

315 
	}
}

318 
	$o16kwr™e
Ð
m6502
 *
ýu
, 
addr
, 
d©a
 )

320 
machše
 *
Üic
 = (machš*)
ýu
->
u£rd©a
;

321 ifÐÐ!
Üic
->
romdis
 ) && ( 
addr
 >= 0xc000 ) ) ;

322 ifÐÐ
addr
 & 0xff00 ) == 0x0300 )

324 ifÐ
Üic
->
acŸback’d
 && ( oric->
acŸoff£t
 <ð
addr
 &&‡ddr < oric->aciaoffset+4 ) )

325 
	`acŸ_wr™e
Ð&
Üic
->
‹Ë_acŸ
, 
addr
, 
d©a
 );

327 ifÐ
Üic
->
ch376_aùiv©ed
 && ( 0x340 <ð
addr
 ) && (‡ddr < 0x342 ) )

328 
	`ch376_Üic_wr™e
(
Üic
->
ch376
, 
addr
, 
d©a
);

331 
	`vŸ_wr™e
Ð&
Üic
->
vŸ
, 
addr
, 
d©a
 );

336 
Üic
->
mem
[
addr
&0x3fff] = 
d©a
;

337 
	}
}

340 
	$‹Ë¡¿twr™e
Ð
m6502
 *
ýu
, 
addr
, 
d©a
 )

342 
machše
 *
Üic
 = (machš*)
ýu
->
u£rd©a
;

344 ifÐ
addr
 >= 0xc000 )

350  
Üic
->
‹Ë_bªkty³
 )

352 
TELEBANK_HALFNHALF
:

353 ifÐ
addr
 >= 0xe000 ) ;

354 
TELEBANK_RAM
:

355 
Üic
->
rom
[
addr
-0xc000] = 
d©a
;

362 ifÐÐ
addr
 & 0xff00 ) == 0x0300 )

364  
addr
 & 0x0f0 )

368 
	`vŸ_wr™e
Ð&
Üic
->
‹Ë_vŸ
, 
addr
, 
d©a
 );

372 ifÐ
addr
 >= 0x31c )

373 
	`acŸ_wr™e
Ð&
Üic
->
‹Ë_acŸ
, 
addr
, 
d©a
 );

375 
	`miüodisc_wr™e
Ð&
Üic
->
md
, 
addr
, 
d©a
 );

379 ià(
Üic
->
ch376_aùiv©ed
)

381 ià(
addr
 == 0x340 ||‡ddr == 0x341)

382 
	`ch376_Üic_wr™e
(
Üic
->
ch376
, 
addr
, 
d©a
);

387 
	`vŸ_wr™e
Ð&
Üic
->
vŸ
, 
addr
, 
d©a
 );

393 
Üic
->
mem
[
addr
] = 
d©a
;

394 
	}
}

397 
	$jasmš_©moswr™e
Ð
m6502
 *
ýu
, 
addr
, 
d©a
 )

399 
machše
 *
Üic
 = (machš*)
ýu
->
u£rd©a
;

401 ifÐ
Üic
->
jasmš
.
Þay
 == 0 )

403 ifÐ
Üic
->
romdis
 )

405 ifÐ
addr
 >= 0xf800 ) ;

407 ifÐ
addr
 >= 0xc000 ) ;

411 ifÐÐ
addr
 & 0xff00 ) == 0x0300 )

413 ifÐÐ
addr
 >= 0x3f4 ) && (‡ddr < 0x400 ) )

414 
	`jasmš_wr™e
Ð&
Üic
->
jasmš
, 
addr
, 
d©a
 );

416 ifÐ
Üic
->
acŸback’d
 && ( oric->
acŸoff£t
 <ð
addr
 &&‡ddr < oric->aciaoffset+4 ) )

417 
	`acŸ_wr™e
Ð&
Üic
->
‹Ë_acŸ
, 
addr
, 
d©a
 );

419 ifÐ
Üic
->
ch376_aùiv©ed
 && ( 0x340 <ð
addr
 ) && (‡ddr < 0x342 ) )

420 
	`ch376_Üic_wr™e
(
Üic
->
ch376
, 
addr
, 
d©a
);

423 
	`vŸ_wr™e
Ð&
Üic
->
vŸ
, 
addr
, 
d©a
 );

427 
Üic
->
mem
[
addr
] = 
d©a
;

428 
	}
}

431 
	$jasmš_o16kwr™e
Ð
m6502
 *
ýu
, 
addr
, 
d©a
 )

433 
machše
 *
Üic
 = (machš*)
ýu
->
u£rd©a
;

435 ifÐ
Üic
->
jasmš
.
Þay
 == 0 )

437 ifÐ
Üic
->
romdis
 )

439 ifÐ
addr
 >= 0xf800 ) ;

441 ifÐ
addr
 >= 0xc000 ) ;

445 ifÐÐ
addr
 & 0xff00 ) == 0x0300 )

447 ifÐÐ
addr
 >= 0x3f4 ) && (‡ddr < 0x400 ) )

448 
	`jasmš_wr™e
Ð&
Üic
->
jasmš
, 
addr
, 
d©a
 );

450 ifÐ
Üic
->
acŸback’d
 && ( oric->
acŸoff£t
 <ð
addr
 &&‡ddr < oric->aciaoffset+4 ) )

451 
	`acŸ_wr™e
Ð&
Üic
->
‹Ë_acŸ
, 
addr
, 
d©a
 );

453 ifÐ
Üic
->
ch376_aùiv©ed
 && ( 0x340 <ð
addr
 ) && (‡ddr < 0x342 ) )

454 
	`ch376_Üic_wr™e
(
Üic
->
ch376
, 
addr
, 
d©a
);

457 
	`vŸ_wr™e
Ð&
Üic
->
vŸ
, 
addr
, 
d©a
 );

462 
Üic
->
mem
[
addr
&0x3fff] = 
d©a
;

463 
	}
}

466 
	$miüodisc_©moswr™e
Ð
m6502
 *
ýu
, 
addr
, 
d©a
 )

468 
machše
 *
Üic
 = (machš*)
ýu
->
u£rd©a
;

469 ifÐ
Üic
->
romdis
 )

471 ifÐÐ
Üic
->
md
.
diskrom
 ) && ( 
addr
 >= 0xe000 ) ) ;

473 ifÐ
addr
 >= 0xc000 ) ;

476 ifÐÐ
addr
 & 0xff00 ) == 0x0300 )

478 ifÐÐ
addr
 >= 0x310 ) && (‡ddr < 0x31c ) )

479 
	`miüodisc_wr™e
Ð&
Üic
->
md
, 
addr
, 
d©a
 );

481 ifÐ
Üic
->
acŸback’d
 && ( oric->
acŸoff£t
 <ð
addr
 &&‡ddr < oric->aciaoffset+4 ) )

482 
	`acŸ_wr™e
Ð&
Üic
->
‹Ë_acŸ
, 
addr
, 
d©a
 );

484 ifÐ
Üic
->
ch376_aùiv©ed
 && ( 0x340 <ð
addr
 ) && (‡ddr < 0x342 ) )

485 
	`ch376_Üic_wr™e
(
Üic
->
ch376
, 
addr
, 
d©a
);

488 
	`vŸ_wr™e
Ð&
Üic
->
vŸ
, 
addr
, 
d©a
 );

492 
Üic
->
mem
[
addr
] = 
d©a
;

493 
	}
}

496 
	$miüodisc_o16kwr™e
Ð
m6502
 *
ýu
, 
addr
, 
d©a
 )

498 
machše
 *
Üic
 = (machš*)
ýu
->
u£rd©a
;

499 ifÐ
Üic
->
romdis
 )

501 ifÐÐ
Üic
->
md
.
diskrom
 ) && ( 
addr
 >= 0xe000 ) ) ;

503 ifÐ
addr
 >= 0xc000 ) ;

506 ifÐÐ
addr
 & 0xff00 ) == 0x0300 )

508 ifÐÐ
addr
 >= 0x310 ) && (‡ddr < 0x31c ) )

509 
	`miüodisc_wr™e
Ð&
Üic
->
md
, 
addr
, 
d©a
 );

511 ifÐ
Üic
->
acŸback’d
 && ( oric->
acŸoff£t
 <ð
addr
 &&‡ddr < oric->aciaoffset+4 ) )

512 
	`acŸ_wr™e
Ð&
Üic
->
‹Ë_acŸ
, 
addr
, 
d©a
 );

514 ifÐ
Üic
->
ch376_aùiv©ed
 && ( 0x340 <ð
addr
 ) && (‡ddr < 0x342 ) )

515 
	`ch376_Üic_wr™e
(
Üic
->
ch376
, 
addr
, 
d©a
);

518 
	`vŸ_wr™e
Ð&
Üic
->
vŸ
, 
addr
, 
d©a
 );

522 
Üic
->
mem
[
addr
&0x3fff] = 
d©a
;

523 
	}
}

526 
	$´av‘z_©moswr™e
Ð
m6502
 *
ýu
, 
addr
, 
d©a
 )

528 
machše
 *
Üic
 = (machš*)
ýu
->
u£rd©a
;

530 
Üic
->
mem
[
addr
] = 
d©a
;

532 ifÐ0x300 <ð
addr
 &&‡ddr <= 0x30f )

534 
	`vŸ_wr™e
Ð&
Üic
->
vŸ
, 
addr
, 
d©a
 );

536 ifÐ0x310 <ð
addr
 &&‡ddr <= 0x31f )

538 ifÐ
Üic
->
acŸback’d
 && oric->
´av‘z
.
ex‹nsiÚ
 == 0x100 )

539 
	`acŸ_wr™e
Ð&
Üic
->
‹Ë_acŸ
, 
addr
, 
d©a
 );

541 
	`´av‘z_wr™e
Ð&
Üic
->
´av‘z
, 
addr
, 
d©a
 );

543 ifÐ0x320 <ð
addr
 &&‡ddr <= 0x3ff )

545  
addr
 )

548 
Üic
->
´av‘z
.
Þay
 = 0;

549 
Üic
->
´av‘z
.
romdis
 = 1;

550 
Üic
->
´av‘z
.
ex‹nsiÚ
 = 0;

551 
Üic
->
romdis
 = !Üic->
´av‘z
.romdis;

552 
Üic
->
romÚ
 = !Üic->
romdis
;

555 
Üic
->
´av‘z
.
Þay
 = 1;

556 
Üic
->
´av‘z
.
romdis
 = 0;

557 
Üic
->
´av‘z
.
ex‹nsiÚ
 = 0;

558 
Üic
->
romdis
 = !Üic->
´av‘z
.romdis;

559 
Üic
->
romÚ
 = !Üic->
romdis
;

562 
Üic
->
´av‘z
.
Þay
 = 0;

563 
Üic
->
´av‘z
.
romdis
 = 1;

564 
Üic
->
´av‘z
.
ex‹nsiÚ
 = 0x100;

565 
Üic
->
romdis
 = !Üic->
´av‘z
.romdis;

566 
Üic
->
romÚ
 = !Üic->
romdis
;

569 
Üic
->
´av‘z
.
Þay
 = 1;

570 
Üic
->
´av‘z
.
romdis
 = 0;

571 
Üic
->
´av‘z
.
ex‹nsiÚ
 = 0x100;

572 
Üic
->
romdis
 = !Üic->
´av‘z
.romdis;

573 
Üic
->
romÚ
 = !Üic->
romdis
;

579 
	}
}

582 
SDL_boÞ
 
	$i¤am
Ð
machše
 *
Üic
, 
addr
 )

584 ifÐ
addr
 < 0xc000 )  
SDL_TRUE
;

586 ifÐ
Üic
->
ty³
 =ð
MACH_TELESTRAT
 )

588  
Üic
->
‹Ë_bªkty³
 =ð
TELEBANK_RAM
;

591 ifÐ!
Üic
->
romdis
 )  
SDL_FALSE
;

593  
Üic
->
driv‘y³
 )

595 
DRV_MICRODISC
:

596 ifÐ!
Üic
->
md
.
diskrom
 )  
SDL_TRUE
;

597 ifÐ
addr
 >ð0xe000 )  
SDL_FALSE
;

600 
DRV_JASMIN
:

601 ifÐ
Üic
->
jasmš
.
Þay
 )  
SDL_TRUE
;

602 ifÐ
addr
 >ð0xf800 )  
SDL_FALSE
;

605 
DRV_PRAVETZ
:

606 ifÐ
Üic
->
´av‘z
.
Þay
 )  
SDL_TRUE
;

607 ifÐ
addr
 >ð0xc000 )  
SDL_FALSE
;

611  
SDL_TRUE
;

612 
	}
}

615 
	$©mo¤—d
Ð
m6502
 *
ýu
, 
addr
 )

617 
machše
 *
Üic
 = (machš*)
ýu
->
u£rd©a
;

619 ifÐÐ
addr
 & 0xff00 ) == 0x0300 )

621 ifÐ
Üic
->
acŸback’d
 && ( oric->
acŸoff£t
 <ð
addr
 &&‡ddr < oric->aciaoffset+4 ) )

622  
	`acŸ_»ad
Ð&
Üic
->
‹Ë_acŸ
, 
addr
 );

624 ifÐ
Üic
->
ch376_aùiv©ed
 && ( 0x340 <ð
addr
 ) && (‡ddr < 0x342 ) )

625  
	`ch376_Üic_»ad
(
Üic
->
ch376
, 
addr
);

627  
	`vŸ_»ad
Ð&
Üic
->
vŸ
, 
addr
 );

630 ifÐÐ!
Üic
->
romdis
 ) && ( 
addr
 >= 0xc000 ) )

631  
Üic
->
rom
[
addr
-0xc000];

633  
Üic
->
mem
[
addr
];

634 
	}
}

637 
	$o16k»ad
Ð
m6502
 *
ýu
, 
addr
 )

639 
machše
 *
Üic
 = (machš*)
ýu
->
u£rd©a
;

641 ifÐÐ
addr
 & 0xff00 ) == 0x0300 )

643 ifÐ
Üic
->
acŸback’d
 && ( oric->
acŸoff£t
 <ð
addr
 &&‡ddr < oric->aciaoffset+4 ) )

644  
	`acŸ_»ad
Ð&
Üic
->
‹Ë_acŸ
, 
addr
 );

646 ifÐ
Üic
->
ch376_aùiv©ed
 && ( 0x340 <ð
addr
 ) && (‡ddr < 0x342 ) )

647  
	`ch376_Üic_»ad
(
Üic
->
ch376
, 
addr
);

649  
	`vŸ_»ad
Ð&
Üic
->
vŸ
, 
addr
 );

652 ifÐÐ!
Üic
->
romdis
 ) && ( 
addr
 >= 0xc000 ) )

653  
Üic
->
rom
[
addr
-0xc000];

655  
Üic
->
mem
[
addr
&0x3fff];

656 
	}
}

659 
	$‹Ë¡¿Œ—d
Ð
m6502
 *
ýu
, 
addr
 )

661 
machše
 *
Üic
 = (machš*)
ýu
->
u£rd©a
;

663 ifÐÐ
addr
 & 0xff00 ) == 0x0300 )

665  
addr
 & 0x0f0 )

669 ifÐ
addr
 >= 0x31c )

671  
	`acŸ_»ad
Ð&
Üic
->
‹Ë_acŸ
, 
addr
 );

674  
	`miüodisc_»ad
Ð&
Üic
->
md
, 
addr
 );

677  
	`vŸ_»ad
Ð&
Üic
->
‹Ë_vŸ
, 
addr
 );

680 ià(
Üic
->
ch376_aùiv©ed
)

682 ià(
addr
 == 0x340 ||‡ddr == 0x341)

683  
	`ch376_Üic_»ad
(
Üic
->
ch376
, 
addr
);

687  
	`vŸ_»ad
Ð&
Üic
->
vŸ
, 
addr
 );

690 ifÐ
addr
 >= 0xc000 )

697  
Üic
->
rom
[
addr
-0xc000];

701  
Üic
->
mem
[
addr
];

702 
	}
}

705 
	$jasmš_©mo¤—d
Ð
m6502
 *
ýu
, 
addr
 )

707 
machše
 *
Üic
 = (machš*)
ýu
->
u£rd©a
;

709 ifÐ
Üic
->
jasmš
.
Þay
 == 0 )

711 ifÐ
Üic
->
romdis
 )

713 ifÐ
addr
 >ð0xf800 )  
rom_jasmš
[addr-0xf800];

715 ifÐ
addr
 >ð0xc000 )  
Üic
->
rom
[addr-0xc000];

719 ifÐÐ
addr
 & 0xff00 ) == 0x0300 )

721 ifÐÐ
addr
 >= 0x3f4 ) && (‡ddr < 0x400 ) )

722  
	`jasmš_»ad
Ð&
Üic
->
jasmš
, 
addr
 );

724 ifÐ
Üic
->
acŸback’d
 && ( oric->
acŸoff£t
 <ð
addr
 &&‡ddr < oric->aciaoffset+4 ) )

725  
	`acŸ_»ad
Ð&
Üic
->
‹Ë_acŸ
, 
addr
 );

727 ifÐ
Üic
->
ch376_aùiv©ed
 && ( 0x340 <ð
addr
 ) && (‡ddr < 0x342 ) )

728  
	`ch376_Üic_»ad
(
Üic
->
ch376
, 
addr
);

730  
	`vŸ_»ad
Ð&
Üic
->
vŸ
, 
addr
 );

733  
Üic
->
mem
[
addr
];

734 
	}
}

737 
	$jasmš_o16k»ad
Ð
m6502
 *
ýu
, 
addr
 )

739 
machše
 *
Üic
 = (machš*)
ýu
->
u£rd©a
;

741 ifÐ
Üic
->
jasmš
.
Þay
 == 0 )

743 ifÐ
Üic
->
romdis
 )

745 ifÐ
addr
 >ð0xf800 )  
rom_jasmš
[addr-0xf800];

747 ifÐ
addr
 >ð0xc000 )  
Üic
->
rom
[addr-0xc000];

751 ifÐÐ
addr
 & 0xff00 ) == 0x0300 )

753 ifÐÐ
addr
 >= 0x3f4 ) && (‡ddr < 0x400 ) )

754  
	`jasmš_»ad
Ð&
Üic
->
jasmš
, 
addr
 );

756 ifÐ
Üic
->
acŸback’d
 && ( oric->
acŸoff£t
 <ð
addr
 &&‡ddr < oric->aciaoffset+4 ) )

757  
	`acŸ_»ad
Ð&
Üic
->
‹Ë_acŸ
, 
addr
 );

759 ifÐ
Üic
->
ch376_aùiv©ed
 && ( 0x340 <ð
addr
 ) && (‡ddr < 0x342 ) )

760  
	`ch376_Üic_»ad
(
Üic
->
ch376
, 
addr
);

762  
	`vŸ_»ad
Ð&
Üic
->
vŸ
, 
addr
 );

765  
Üic
->
mem
[
addr
&0x3fff];

766 
	}
}

769 
	$miüodisc_©mo¤—d
Ð
m6502
 *
ýu
, 
addr
 )

771 
machše
 *
Üic
 = (machš*)
ýu
->
u£rd©a
;

773 ifÐ
Üic
->
romdis
 )

775 ifÐÐ
Üic
->
md
.
diskrom
 ) && ( 
addr
 >= 0xe000 ) )

776  
rom_miüodisc
[
addr
-0xe000];

778 ifÐ
addr
 >= 0xc000 )

779  
Üic
->
rom
[
addr
-0xc000];

782 ifÐÐ
addr
 & 0xff00 ) == 0x0300 )

784 ifÐÐ
addr
 >= 0x310 ) && (‡ddr < 0x31c ) )

785  
	`miüodisc_»ad
Ð&
Üic
->
md
, 
addr
 );

787 ifÐ
Üic
->
acŸback’d
 && ( oric->
acŸoff£t
 <ð
addr
 &&‡ddr < oric->aciaoffset+4 ) )

788  
	`acŸ_»ad
Ð&
Üic
->
‹Ë_acŸ
, 
addr
 );

790 ifÐ
Üic
->
ch376_aùiv©ed
 && ( 0x340 <ð
addr
 ) && (‡ddr < 0x342 ) )

791  
	`ch376_Üic_»ad
(
Üic
->
ch376
, 
addr
);

793  
	`vŸ_»ad
Ð&
Üic
->
vŸ
, 
addr
 );

796  
Üic
->
mem
[
addr
];

797 
	}
}

800 
	$miüodisc_o16k»ad
Ð
m6502
 *
ýu
, 
addr
 )

802 
machše
 *
Üic
 = (machš*)
ýu
->
u£rd©a
;

804 ifÐ
Üic
->
romdis
 )

806 ifÐÐ
Üic
->
md
.
diskrom
 ) && ( 
addr
 >= 0xe000 ) )

807  
rom_miüodisc
[
addr
-0xe000];

809 ifÐ
addr
 >= 0xc000 )

810  
Üic
->
rom
[
addr
-0xc000];

813 ifÐÐ
addr
 & 0xff00 ) == 0x0300 )

815 ifÐÐ
addr
 >= 0x310 ) && (‡ddr < 0x31c ) )

816  
	`miüodisc_»ad
Ð&
Üic
->
md
, 
addr
 );

818 ifÐ
Üic
->
acŸback’d
 && ( oric->
acŸoff£t
 <ð
addr
 &&‡ddr < oric->aciaoffset+4 ) )

819  
	`acŸ_»ad
Ð&
Üic
->
‹Ë_acŸ
, 
addr
 );

821 ifÐ
Üic
->
ch376_aùiv©ed
 && ( 0x340 <ð
addr
 ) && (‡ddr < 0x342 ) )

822  
	`ch376_Üic_»ad
(
Üic
->
ch376
, 
addr
);

824  
	`vŸ_»ad
Ð&
Üic
->
vŸ
, 
addr
 );

827  
Üic
->
mem
[
addr
&0x3fff];

828 
	}
}

831 
	$´av‘z_©mo¤—d
Ð
m6502
 *
ýu
, 
addr
 )

833 
machše
 *
Üic
 = (machš*)
ýu
->
u£rd©a
;

835 ifÐ0x300 =ðÐ
addr
 & 0xfff0 ) )

837  
	`vŸ_»ad
Ð&
Üic
->
vŸ
, 
addr
 );

840 ifÐ0x310 =ðÐ
addr
 & 0xfff0 ) )

842 ifÐ
Üic
->
acŸback’d
 && oric->
´av‘z
.
ex‹nsiÚ
 == 0x100 )

843  
	`acŸ_»ad
Ð&
Üic
->
‹Ë_acŸ
, 
addr
 );

845  
	`´av‘z_»ad
Ð&
Üic
->
´av‘z
, 
addr
 );

848 ifÐ0x320 <ð
addr
 &&‡ddr <= 0x3ff )

850 ifÐ
´av‘zrom_v®id
 )

852  
rom_´av‘z
[
addr
 - 0x300 + 
Üic
->
´av‘z
.
ex‹nsiÚ
];

856 ifÐ0xc000 <ð
addr
 )

858 ifÐ!
Üic
->
´av‘z
.
Þay
 )

860  
Üic
->
rom
[
addr
-0xc000];

864  
Üic
->
mem
[
addr
];

865 
	}
}

868 
	$ligh’_»ad
Ð
m6502
 *
ýu
, 
addr
 )

870 
machše
 *
Üic
 = (machš*)
ýu
->
u£rd©a
;

872 ifÐ
addr
 =ð0x3e0 )  
Üic
->
ligh’x
;

873 ifÐ
addr
 =ð0x3e1 )  
Üic
->
ligh’y
;

875  
Üic
->
	`»ad_nÙ_ligh’
Ð
ýu
, 
addr
 );

876 
	}
}

879 
SDL_boÞ
 
	$lßd_rom
Ð
machše
 *
Üic
, *
âame
, 
size
, *
wh”e
, 
symbÞbË
 *
¡ab
, 
symæags
 )

881 
SDL_RWÝs
 *
f
;

882 *
tm²ame
;

885 
tm²ame
 = 
	`m®loc
Ð
	`¡¾’
Ð
âame
 ) + 10 );

886 ifÐ!
tm²ame
 )  
SDL_FALSE
;

888 
	`¥rštf
Ð
tm²ame
, "%s.rom", 
âame
 );

889 
f
 = 
	`SDL_RWFromFže
Ð
tm²ame
, "rb" );

890 ifÐ!
f
 )

892 
	`”rÜ_´štf
Ð"UÇbËØÝ’ '%s'\n", 
tm²ame
 );

893 
	`ä“
Ð
tm²ame
 );

894  
SDL_FALSE
;

897 ifÐ
size
 < 0 )

899 
fžesize
;

900 
	`SDL_RW£ek
Ð
f
, 0, 
SEEK_END
 );

901 
fžesize
 = 
	`SDL_RW‹Î
Ð
f
 );

902 
	`SDL_RW£ek
Ð
f
, 0, 
SEEK_SET
 );

904 ifÐ
fžesize
 > -
size
 )

906 
	`”rÜ_´štf
Ð"ROM '%s'ƒxûed %d by‹s.\n", 
âame
, -
size
 );

907 
	`SDL_RWþo£
Ð
f
 );

908 
	`ä“
Ð
tm²ame
 );

909  
SDL_FALSE
;

912 
wh”e
 +ð(-
size
)-
fžesize
;

913 
size
 = 
fžesize
;

916 ifÐ
	`SDL_RW»ad
Ð
f
, 
wh”e
, 
size
, 1 ) != 1 )

918 
	`”rÜ_´štf
Ð"UÇbËØ»ad '%s'\n", 
tm²ame
 );

919 
	`SDL_RWþo£
Ð
f
 );

920 
	`ä“
Ð
tm²ame
 );

921  
SDL_FALSE
;

924 
	`SDL_RWþo£
Ð
f
 );

926 
	`¥rštf
Ð
tm²ame
, "%s.sym", 
âame
 );

927 
	`mÚ_Ãw_symbÞs
Ð
¡ab
, 
Üic
, 
tm²ame
, 
symæags
, 
SDL_FALSE
, SDL_FALSE );

928 
	`ä“
Ð
tm²ame
 );

930  
SDL_TRUE
;

931 
	}
}

933 
	$´eš™_machše
Ð
machše
 *
Üic
 )

935 
i
;

937 
	`mÚ_š™_symb
Ð&
sym_miüodisc
 );

938 
	`mÚ_š™_symb
Ð&
sym_jasmš
 );

939 
	`mÚ_š™_symb
Ð&
Üic
->
romsyms
 );

940 
	`mÚ_š™_symb
Ð&
Üic
->
‹Ë_bªksyms
[0] );

941 
	`mÚ_š™_symb
Ð&
Üic
->
‹Ë_bªksyms
[1] );

942 
	`mÚ_š™_symb
Ð&
Üic
->
‹Ë_bªksyms
[2] );

943 
	`mÚ_š™_symb
Ð&
Üic
->
‹Ë_bªksyms
[3] );

944 
	`mÚ_š™_symb
Ð&
Üic
->
‹Ë_bªksyms
[4] );

945 
	`mÚ_š™_symb
Ð&
Üic
->
‹Ë_bªksyms
[5] );

946 
	`mÚ_š™_symb
Ð&
Üic
->
‹Ë_bªksyms
[6] );

947 
	`mÚ_š™_symb
Ð&
Üic
->
‹Ë_bªksyms
[7] );

949 
Üic
->
mem
 = 
NULL
;

950 
Üic
->
rom
 = 
NULL
;

952 
Üic
->
³buf
 = 
NULL
;

953 
Üic
->
³Ën
 = 0;

954 
Üic
->
³mÙÜ
 = 
SDL_FALSE
;

955 
Üic
->
vsynchack
 = 
SDL_FALSE
;

956 
Üic
->
³turbo
 = 
SDL_TRUE
;

957 
Üic
->
³turbo_fÜûoff
 = 
SDL_FALSE
;

958 
Üic
->
autÜewšd
 = 
SDL_FALSE
;

959 
Üic
->
autoš£¹
 = 
SDL_TRUE
;

960 
Üic
->
symbÞ§utÞßd
 = 
SDL_TRUE
;

961 
Üic
->
symbÞsÿ£
 = 
SDL_FALSE
;

962 
Üic
->
³Çme
[0] = 0;

963 
Üic
->
´f
 = 
NULL
;

964 
Üic
->
´þock
 = 0;

965 
Üic
->
´þo£
 = 0;

966 
Üic
->
Ï¡³fže
[0] = 0;

967 
Üic
->
keym­
 = 
KMAP_QWERTY
;

968 
Üic
->
¡©usb¬_mode
 = 
STATUSBARMODE_FULL
;

969 
Üic
->
pÝup¡r
[0] = 0;

970 
Üic
->
ÃwpÝup¡r
 = 
SDL_FALSE
;

971 
Üic
->
pÝu±ime
 = 0;

972 
Üic
->
¡©us¡r
[0] = 0;

973 
Üic
->
Ãw¡©us¡r
 = 
SDL_FALSE
;

974 
Üic
->
sdljoy_a
 = 
NULL
;

975 
Üic
->
sdljoy_b
 = 
NULL
;

976 
Üic
->
¿m·‰”n
 = 0;

977 
Üic
->
³ÿp
 = 
NULL
;

978 
Üic
->
³noi£
 = 
SDL_FALSE
;

979 
Üic
->
¿w³
 = 
SDL_FALSE
;

981 
Üic
->
joy_içû
 = 
JOYIFACE_NONE
;

982 
Üic
->
joymode_a
 = 
JOYMODE_KB1
;

983 
Üic
->
joymode_b
 = 
JOYMODE_NONE
;

984 
Üic
->
‹Ëjoymode_a
 = 
JOYMODE_KB1
;

985 
Üic
->
‹Ëjoymode_b
 = 
JOYMODE_NONE
;

987 
Üic
->
pÜ_joy
 = 0xff;

988 
Üic
->
pÜ_ay
 = 0;

989 
Üic
->
pÜ_is_ay
 = 
SDL_TRUE
;

991 
Üic
->
kbjoy1
[0] = 
SDLK_KP8
;

992 
Üic
->
kbjoy1
[1] = 
SDLK_KP2
;

993 
Üic
->
kbjoy1
[2] = 
SDLK_KP4
;

994 
Üic
->
kbjoy1
[3] = 
SDLK_KP6
;

995 
Üic
->
kbjoy1
[4] = 
SDLK_KP_ENTER
;

996 
Üic
->
kbjoy1
[5] = 
SDLK_KP_PLUS
;

997 
Üic
->
kbjoy2
[0] = 'w';

998 
Üic
->
kbjoy2
[1] = 's';

999 
Üic
->
kbjoy2
[2] = 'a';

1000 
Üic
->
kbjoy2
[3] = 'd';

1001 
Üic
->
kbjoy2
[4] = 
SDLK_SPACE
;

1002 
Üic
->
kbjoy2
[5] = 'n';

1004 
Üic
->
driv‘y³
 = 
DRV_NONE
;

1005  
i
=0; i<
MAX_DRIVES
; i++ )

1007 
Üic
->
wddisk
.
disk
[
i
] = 
NULL
;

1008 
Üic
->
diskÇme
[
i
][0] = 0;

1010 
Üic
->
diskauto§ve
 = 
SDL_FALSE
;

1011 
Üic
->
auto_jasmš_»£t
 = 
SDL_TRUE
;

1013 
Üic
->
ligh’
 = 
SDL_FALSE
;

1014 
Üic
->
ligh’x
 = 0;

1015 
Üic
->
ligh’y
 = 0;

1016 
Üic
->
»ad_nÙ_ligh’
 = 
NULL
;

1018 
Üic
->
´š‹ÇbË
 = 
SDL_TRUE
;

1019 
Üic
->
´štfž‹r
 = 
SDL_TRUE
;

1021 
Üic
->
acŸback’d
 = 
ACIA_TYPE_NONE
;

1022 
Üic
->
acŸoff£t
 = 0x31c;

1024 
Üic
->
t§vf
 = 
NULL
;

1026 
Üic
->
keybßrd_m­pšg
.
nb_m­
 = 0;

1027 
Üic
->
show_keybßrd
 = 
SDL_FALSE
;

1028 
Üic
->
defše_m­pšg
 = 
SDL_FALSE
;

1029 
Üic
->
¡icky_mod_keys
 = 
SDL_FALSE
;

1031 
Üic
->
´avdiskautoboÙ
 = 
SDL_TRUE
;

1032 
	}
}

1034 
	$lßd_diskroms
Ð
machše
 *
Üic
 )

1036 
miüodisüom_v®id
 = 
	`lßd_rom
Ð
Üic
, 
mdisüomfže
, 8192, 
rom_miüodisc
, &
sym_miüodisc
, 
SYMF_ROMDIS1
|
SYMF_MICRODISC
 );

1037 
jasmšrom_v®id
 = 
	`lßd_rom
Ð
Üic
, 
jasmÄomfže
, 2048, 
rom_jasmš
, &
sym_jasmš
, 
SYMF_ROMDIS1
|
SYMF_JASMIN
 );

1038 
´av‘zrom_v®id
 = 
	`lßd_rom
Ð
Üic
, 
´av‘zromfže
[1], 512, 
rom_´av‘z
, &
sym_´av‘z
, 
SYMF_PRAVZ8D
 );

1039 
	}
}

1045 
	$m­key
Ð
machše
 *
Üic
, 
key
 )

1047  
key
 )

1049 #ià
	`defšed
(
__amigaos4__
è|| defšed(
__MORPHOS__
è|| defšed(
__AROS__
)

1066 #–ià
	`defšed
(
WIN32
)

1071 ià(
Üic
->
keybßrd_m­pšg
.
nb_m­
 != 0) {

1072 
i
;

1073 
i
=0; i < 
Üic
->
keybßrd_m­pšg
.
nb_m­
; i++) {

1074 ià(
key
 =ð
Üic
->
keybßrd_m­pšg
.
ho¡_keys
[
i
])

1075  
Üic
->
keybßrd_m­pšg
.
Üic_keys
[
i
];

1079  
key
;

1080 
	}
}

1082 
SDL_boÞ
 
	gligh’down
 = 
SDL_FALSE
;

1083 
	$move_ligh’
Ð
machše
 *
Üic
, 
x
, 
y
 )

1085 ià(!
ligh’down
) ;

1087 ià((
Üic
->
»nd”mode
 =ð
RENDERMODE_SW
è|| (!Üic->
h¡»tch
))

1089 
x
 = (x-80)/2;

1090 if(
Üic
->
»nd”mode
 =ð
RENDERMODE_GL
 && oric->
¬©io
 && oric->
vid_äeq
)

1092 
y
 = (y-48)/2;

1096 
y
 = (y-14)/2;

1101 
x
 = (()x)/(640.0f/240.0f);

1102 
y
 = (y-14)/2;

1105 ià((
x
>=0è&& (x<240è&& (
y
>=0) && (y<224))

1107 ià(
Üic
->
sü
[
y
*240+
x
] != 0)

1109 
Üic
->
ligh’x
 = (
x
+219)&0xff;

1110 
Üic
->
ligh’y
 = (
y
+54)&0xff;

1113 
	}
}

1115 
SDL_boÞ
 
	gshiáed
 = 
SDL_FALSE
;

1116 
SDL_boÞ
 
	$emu_ev’t
Ð
SDL_Ev’t
 *
ev
, 
machše
 *
Üic
, 
SDL_boÞ
 *
Ãed»nd”
 )

1118 
Sšt32
 
i
;

1120 ifÐ
	`joy_fž‹r_ev’t
Ð
ev
, 
Üic
 ) )

1121  
SDL_FALSE
;

1124  
ev
->
ty³
 )

1126 
SDL_MOUSEBUTTONDOWN
:

1127 
ev
->
bu‰Ú
.button)

1129 
SDL_BUTTON_LEFT
:

1130 
ligh’down
 = 
SDL_TRUE
;

1131 
	`move_ligh’
Ð
Üic
, 
ev
->
bu‰Ú
.
x
,ƒv->bu‰Ú.
y
 );

1134 
SDL_BUTTON_RIGHT
:

1135 
	`£‹mumode
Ð
Üic
, 
NULL
, 
EM_MENU
 );

1136 *
Ãed»nd”
 = 
SDL_TRUE
;

1141 
SDL_MOUSEBUTTONUP
:

1142 ifÐ
ev
->
bu‰Ú
.bu‰Ú =ð
SDL_BUTTON_LEFT
 )

1143 
ligh’down
 = 
SDL_FALSE
;

1146 
SDL_MOUSEMOTION
:

1147 
	`move_ligh’
Ð
Üic
, 
ev
->
mÙiÚ
.
x
,ƒv->mÙiÚ.
y
 );

1150 
SDL_KEYUP
:

1151  
ev
->
key
.
keysym
.
sym
 )

1153 
SDLK_F1
:

1154 
	`£‹mumode
Ð
Üic
, 
NULL
, 
EM_MENU
 );

1155 *
Ãed»nd”
 = 
SDL_TRUE
;

1158 
SDLK_F2
:

1159 
	`£‹mumode
Ð
Üic
, 
NULL
, 
EM_DEBUG
 );

1160 *
Ãed»nd”
 = 
SDL_TRUE
;

1163 
SDLK_F3
:

1164 
	`soá»£tÜic
(
Üic
, 
NULL
, 0);

1167 
SDLK_F4
:

1168 ifÐÐ
shiáed
 ) && ( 
Üic
->
driv‘y³
 =ð
DRV_JASMIN
 ) )

1169 
Üic
->
ýu
.
	`wr™e
( &oric->cpu, 0x3fb, 1 );

1170 ifÐ
Üic
->
driv‘y³
 =ð
DRV_MICRODISC
 )

1172 
Üic
->
romdis
 = 
SDL_TRUE
;

1173 
	`miüodisc_š™
Ð&
Üic
->
md
, &Üic->
wddisk
, oric );

1175 ifÐ
Üic
->
driv‘y³
 =ð
DRV_PRAVETZ
 )

1177 
Üic
->
´av‘z
.
Þay
 = 0;

1178 
Üic
->
´av‘z
.
romdis
 = 1;

1179 
Üic
->
´av‘z
.
ex‹nsiÚ
 = 0;

1180 
Üic
->
romdis
 = !Üic->
´av‘z
.romdis;

1182 
	`£ŒomÚ
Ð
Üic
 );

1183 
	`m6502_»£t
Ð&
Üic
->
ýu
 );

1184 
	`vŸ_š™
Ð&
Üic
->
vŸ
, oric, 
VIA_MAIN
 );

1185 
	`vŸ_š™
Ð&
Üic
->
‹Ë_vŸ
, oric, 
VIA_TELESTRAT
 );

1186 
	`acŸ_š™
Ð&
Üic
->
‹Ë_acŸ
, oric );

1188 ià(
Üic
->
ch376_aùiv©ed
)

1190 
Üic
->
ch376
 = 
	`ch376_Üic_š™
();

1191 ià(
Üic
->
ch376
 !ð
NULL
)

1192 
	`ch376_Üic_cÚfig
(
Üic
->
ch376
);

1197 
SDLK_F5
:

1198 
Üic
->
¡©usb¬_mode
 = (Üic->¡©usb¬_mode+1è% 
STATUSBARMODE_LAST
;

1199 
»äesh¡©us
 = 
SDL_TRUE
;

1200 
Üic
->
¡©us¡r
[0] = 0;

1201 
Üic
->
Ãw¡©us¡r
 = 
SDL_TRUE
;

1204 
SDLK_F6
:

1205 ifÐ
vidÿp
 )

1207 
w¬p¥“d
 = 
SDL_FALSE
;

1211 
w¬p¥“d
 = w¬p¥“d ? 
SDL_FALSE
 : 
SDL_TRUE
;

1214 ifÐ
soundavažabË
 && 
soundÚ
 )

1216 
	`ay_æushlog
Ð&
Üic
->
ay
 );

1217 
Üic
->
ay
.
soundÚ
 = !
w¬p¥“d
;

1218 
	`SDL_Pau£Audio
Ð
w¬p¥“d
 );

1222 
SDLK_F7
:

1223 ifÐ
Üic
->
driv‘y³
 =ð
DRV_NONE
 ) ;

1225  
i
=0; i<4; i++ )

1227 ifÐÐ
Üic
->
wddisk
.
disk
[
i
] ) && ( oric->wddisk.disk[i]->
modif›d
 ) )

1229 ifÐ
shiáed
 )

1231 
äÇme
[64];

1232 *
d·th
, *
dfže
;

1234 ifÐ
Üic
->
ty³
 !ð
MACH_TELESTRAT
 )

1236 
Üic
->
driv‘y³
)

1238 
DRV_PRAVETZ
:

1239 
d·th
 = 
´avdisk·th
;

1240 
dfže
 = 
´avdiskfže
;

1244 
d·th
 = 
disk·th
;

1245 
dfže
 = 
diskfže
;

1249 
d·th
 = 
‹Ëdisk·th
;

1250 
dfže
 = 
‹Ëdiskfže
;

1253 
	`¥rštf
Ð
äÇme
, "Savdisk %d", 
i
 );

1254 ifÐ
	`fž”eque¡”
Ð
Üic
, 
äÇme
, 
d·th
, 
dfže
, 
FR_DISKSAVE
 ) )

1256 
	`još·th
Ð
d·th
, 
dfže
 );

1257 
	`diskimage_§ve
Ð
Üic
, 
fž‘mp
, 
i
 );

1260 
	`diskimage_§ve
Ð
Üic
, oric->
wddisk
.
disk
[
i
]->
fž’ame
, i );

1266 
SDLK_F8
:

1267 
	`toggËfuÎsü“n
Ð
Üic
, 
NULL
, 0 );

1270 
SDLK_F9
:

1271 
	`toggË³ÿp
Ð
Üic
, 
	`fšd_™em_by_funùiÚ
(
maš™ems
, 
toggË³ÿp
), 0 );

1274 
SDLK_F10
:

1275 ifÐ
vidÿp
 )

1277 
	`ay_lockaudio
Ð&
Üic
->
ay
 );

1278 
	`avi_þo£
Ð&
vidÿp
 );

1279 
	`ay_uÆockaudio
Ð&
Üic
->
ay
 );

1280 
	`do_pÝup
Ð
Üic
, "AVI capture stopped" );

1281 
»äeshavi
 = 
SDL_TRUE
;

1285 
	`¥rštf
Ð
vidÿ²ame
, "C­turšgØvideo%02d.avi", 
vidÿpcouÁ
 );

1286 
w¬p¥“d
 = 
SDL_FALSE
;

1287 
	`ay_lockaudio
Ð&
Üic
->
ay
 );

1288 
vidÿp
 = 
	`avi_Ý’
Ð&
vidÿ²ame
[13], 
Üiý®‘‹
, 
soundavažabË
&&
soundÚ
, 
Üic
->
vid_äeq
 );

1289 
	`ay_uÆockaudio
Ð&
Üic
->
ay
 );

1290 ifÐ
vidÿp
 )

1292 
vidÿpcouÁ
++;

1293 
	`do_pÝup
Ð
Üic
, 
vidÿ²ame
 );

1295 
»äeshavi
 = 
SDL_TRUE
;

1297 #ifdeà
__CBCOPY__


1298 
SDLK_F11
:

1299 
	`þbßrd_cÝy
Ð
Üic
 );

1302 #ifdeà
__CBPASTE__


1303 
SDLK_F12
:

1304 
	`þbßrd_·¡e
Ð
Üic
 );

1308 #ifdeà
__amigaos4__


1309 
SDLK_HELP
:

1310 
IDOS
->
	`Sy¡emTags
( "Multiview Oricutron.guide",

1311 
SYS_IÅut
, 
IDOS
->
	`O³n
Ð"NIL:", 
MODE_NEWFILE
 ),

1312 
SYS_Ouut
, 
IDOS
->
	`O³n
Ð"NIL:", 
MODE_NEWFILE
 ),

1313 
SYS_Asynch
, 
TRUE
,

1314 
TAG_DONE
 );

1318 #ifdeà
__MORPHOS__


1319 
SDLK_HELP
:

1321 
NewAmigaGuide
 
Çg
 =

1322 { (
BPTR
è
NULL
,

1324 
NULL
,

1325 
NULL
,

1326 
NULL
,

1327 
NULL
,

1328 
NULL
,

1330 
NULL
,

1333 
NULL
,

1334 
NULL


1337 
	`O³nAmigaGuide
(&
Çg
, 
TAG_DONE
);

1342 
SDLK_PRINT
:

1343 
	`¥rštf
Ð
sü“nÿ²ame
, "C­turšgØsü“nshÙ%02d.bmp", 
sü“nÿpcouÁ
 );

1344 
sü“nÿpcouÁ
++;

1345 
	`do_pÝup
Ð
Üic
, 
sü“nÿ²ame
 );

1346 
	`SDL_COMPAT_TakeSü“nshÙ
Ð&
sü“nÿ²ame
[13] );

1349 
SDLK_LSHIFT
:

1350 
SDLK_RSHIFT
:

1351 
shiáed
 = 
SDL_FALSE
;

1354 
	`ay_key´ess
Ð&
Üic
->
ay
, 
	`m­key
ÐÜic, 
ev
->
key
.
keysym
.
sym
 ), 
SDL_FALSE
 );

1359 
SDL_KEYDOWN
:

1360  
ev
->
key
.
keysym
.
sym
 )

1362 
SDLK_LSHIFT
:

1363 
SDLK_RSHIFT
:

1364 
shiáed
 = 
SDL_TRUE
;

1367 
	`ay_key´ess
Ð&
Üic
->
ay
, 
	`m­key
ÐÜic, 
ev
->
key
.
keysym
.
sym
 ), 
SDL_TRUE
 );

1373  
SDL_FALSE
;

1374 
	}
}

1376 
	$bÏnk_¿m
Ð
Sšt32
 
how
, 
Ušt8
 *
mem
, 
Ušt32
 
size
 )

1378 
Ušt32
 
i
, 
j
;

1380  
how
 )

1383  
i
=0; i<
size
; i+=256 )

1385  
j
=0; j<128; j++ )

1387 
mem
[
i
+
j
 ] = 0;

1388 
mem
[
i
+
j
+128] = 255;

1394  
i
=0; i<
size
; i+=2 )

1396 
mem
[
i
 ] = 0xff;

1397 
mem
[
i
+1] = 0x00;

1401 
	}
}

1403 
	$þ—r_·tches
Ð
machše
 *
Üic
 )

1405 
Üic
->
pch_fd_þßd_g‘Çme_pc
 = -1;

1406 
Üic
->
pch_fd_c§ve_g‘Çme_pc
 = -1;

1407 
Üic
->
pch_fd_¡Üe_g‘Çme_pc
 = -1;

1408 
Üic
->
pch_fd_»ÿÎ_g‘Çme_pc
 = -1;

1409 
Üic
->
pch_fd_g‘Çme_addr
 = -1;

1410 
Üic
->
pch_fd_avažabË
 = 
SDL_FALSE
;

1412 
Üic
->
pch_‰_g‘sync_pc
 = -1;

1413 
Üic
->
pch_‰_g‘sync_’d_pc
 = -1;

1414 
Üic
->
pch_‰_g‘sync_loÝ_pc
 = -1;

1415 
Üic
->
pch_‰_»adby‹_pc
 = -1;

1416 
Üic
->
pch_‰_»adby‹_’d_pc
 = -1;

1417 
Üic
->
pch_‰_»adby‹_¡Üeby‹_addr
 = -1;

1418 
Üic
->
pch_‰_»adby‹_¡Üez”o_addr
 = -1;

1419 
Üic
->
pch_‰_putby‹_pc
 = -1;

1420 
Üic
->
pch_‰_putby‹_’d_pc
 = -1;

1421 
Üic
->
pch_‰_c§ve_’d_pc
 = -1;

1422 
Üic
->
pch_‰_¡Üe_’d_pc
 = -1;

1423 
Üic
->
pch_‰_avažabË
 = 
SDL_FALSE
;

1424 
Üic
->
pch_‰_§ve_avažabË
 = 
SDL_FALSE
;

1426 
Üic
->
keym­
 = 
KMAP_QWERTY
;

1427 
	}
}

1429 *
	gkeym­Çmes
[] = { "qwerty",

1432 
NULL
 };

1434 
Ušt8
 
	$hex2bš
(
c
)

1436  ( ('0' <ð
c
 && c <ð'9')? (ø- '0'è: (10 + (
	`touµ”
(c) - 'A')) );

1437 
	}
}

1439 
Ušt8
 
	$hex2by‹
(* 
s
)

1441  
	`hex2bš
(
s
[0]) * 16 + hex2bin(s[1]);

1442 
	}
}

1444 
SDL_boÞ
 
	$ishexch¬
(
c
)

1446 if('0' <ð
c
 && c <= '9')

1447  
SDL_TRUE
;

1449 
c
 = 
	`touµ”
(c);

1450 if('A' <ð
c
 && c <= 'F')

1451  
SDL_TRUE
;

1453  
SDL_FALSE
;

1454 
	}
}

1456 
	$lßd_·tches
Ð
machše
 *
Üic
, *
âame
 )

1458 
FILE
 *
f
;

1459 
Sšt32
 
i
;

1460 *
tm²ame
;

1463 
tm²ame
 = 
	`m®loc
Ð
	`¡¾’
Ð
âame
 ) + 10 );

1464 ifÐ!
tm²ame
 ) ;

1466 
	`¥rštf
Ð
tm²ame
, "%s.pch", 
âame
 );

1468 
f
 = 
	`fÝ’
Ð
tm²ame
, "r" );

1469 
	`ä“
Ð
tm²ame
 );

1470 ifÐ!
f
 ) ;

1472  !
	`ãof
Ð
f
 ) )

1474 ifÐ!
	`fg‘s
Ð
fž‘mp
, 2048, 
f
 ) ) ;

1476  
i
=0; 
	`isws
Ð
fž‘mp
[i] ); i++ ) ;

1478 ifÐ
	`»ad_cÚfig_št
Ð&
fž‘mp
[
i
], "fd_þßd_g‘Çme_pc", &
Üic
->
pch_fd_þßd_g‘Çme_pc
, 0, 65535 ) ) ;

1479 ifÐ
	`»ad_cÚfig_št
Ð&
fž‘mp
[
i
], "fd_c§ve_g‘Çme_pc", &
Üic
->
pch_fd_c§ve_g‘Çme_pc
, 0, 65535 ) ) ;

1480 ifÐ
	`»ad_cÚfig_št
Ð&
fž‘mp
[
i
], "fd_¡Üe_g‘Çme_pc", &
Üic
->
pch_fd_¡Üe_g‘Çme_pc
, 0, 65535 ) ) ;

1481 ifÐ
	`»ad_cÚfig_št
Ð&
fž‘mp
[
i
], "fd_»ÿÎ_g‘Çme_pc", &
Üic
->
pch_fd_»ÿÎ_g‘Çme_pc
, 0, 65535 ) ) ;

1482 ifÐ
	`»ad_cÚfig_št
Ð&
fž‘mp
[
i
], "fd_g‘Çme_addr", &
Üic
->
pch_fd_g‘Çme_addr
, 0, 65535 ) ) ;

1483 ifÐ
	`»ad_cÚfig_št
Ð&
fž‘mp
[
i
], "‰_g‘sync_pc", &
Üic
->
pch_‰_g‘sync_pc
, 0, 65535 ) ) ;

1484 ifÐ
	`»ad_cÚfig_št
Ð&
fž‘mp
[
i
], "‰_g‘sync_’d_pc", &
Üic
->
pch_‰_g‘sync_’d_pc
, 0, 65535 ) ) ;

1485 ifÐ
	`»ad_cÚfig_št
Ð&
fž‘mp
[
i
], "‰_g‘sync_loÝ_pc", &
Üic
->
pch_‰_g‘sync_loÝ_pc
, 0, 65535 ) ) ;

1486 ifÐ
	`»ad_cÚfig_št
Ð&
fž‘mp
[
i
], "‰_»adby‹_pc", &
Üic
->
pch_‰_»adby‹_pc
, 0, 65535 ) ) ;

1487 ifÐ
	`»ad_cÚfig_št
Ð&
fž‘mp
[
i
], "‰_»adby‹_’d_pc", &
Üic
->
pch_‰_»adby‹_’d_pc
, 0, 65535 ) ) ;

1488 ifÐ
	`»ad_cÚfig_št
Ð&
fž‘mp
[
i
], "‰_»adby‹_¡Üeby‹_addr", &
Üic
->
pch_‰_»adby‹_¡Üeby‹_addr
, 0, 65535 ) ) ;

1489 ifÐ
	`»ad_cÚfig_št
Ð&
fž‘mp
[
i
], "‰_»adby‹_¡Üez”o_addr", &
Üic
->
pch_‰_»adby‹_¡Üez”o_addr
, 0, 65535 ) ) ;

1490 ifÐ
	`»ad_cÚfig_boÞ
Ð&
fž‘mp
[
i
], "‰_»adby‹_£tÿ¼y", &
Üic
->
pch_‰_»adby‹_£tÿ¼y
 ) ) ;

1491 ifÐ
	`»ad_cÚfig_št
Ð&
fž‘mp
[
i
], "‰_putby‹_pc", &
Üic
->
pch_‰_putby‹_pc
, 0, 65535 ) ) ;

1492 ifÐ
	`»ad_cÚfig_št
Ð&
fž‘mp
[
i
], "‰_putby‹_’d_pc", &
Üic
->
pch_‰_putby‹_’d_pc
, 0, 65535 ) ) ;

1493 ifÐ
	`»ad_cÚfig_št
Ð&
fž‘mp
[
i
], "‰_c§ve_’d_pc", &
Üic
->
pch_‰_c§ve_’d_pc
, 0, 65535 ) ) ;

1494 ifÐ
	`»ad_cÚfig_št
Ð&
fž‘mp
[
i
], "‰_¡Üe_’d_pc", &
Üic
->
pch_‰_¡Üe_’d_pc
, 0, 65535 ) ) ;

1495 ifÐ
	`»ad_cÚfig_št
Ð&
fž‘mp
[
i
], "‰_wr™–—d”_pc", &
Üic
->
pch_‰_wr™–—d”_pc
, 0, 65535 ) ) ;

1496 ifÐ
	`»ad_cÚfig_št
Ð&
fž‘mp
[
i
], "‰_wr™–—d”_’d_pc", &
Üic
->
pch_‰_wr™–—d”_’d_pc
, 0, 65535 ) ) ;

1497 ifÐ
	`»ad_cÚfig_ÝtiÚ
Ð&
fž‘mp
[
i
], "keym­", &
Üic
->
keym­
, 
keym­Çmes
 ) ) ;

1505 if(8 <ð
	`¡¾’
(&
fž‘mp
[
i
]) && ';' != filetmp[i])

1507 * 
±mp
 = &
fž‘mp
[
i
];

1509 if(
±mp
[0]=='$' &&…tmp[5]==':')

1512 if(
	`ishexch¬
(
±mp
[1]) && ishexchar(ptmp[2]) && ishexchar(ptmp[3]) && ishexchar(ptmp[4]))

1514 
Ušt16
 
·tchaddr
 = 
	`hex2by‹
(
±mp
+1) * 256 + hex2byte(ptmp+3);

1515 
±mp
 += 6;

1516 
	`ishexch¬
(
±mp
[0]) && ishexchar(ptmp[1]))

1518 
Ušt8
 
·tchby‹
 = 
	`hex2by‹
(
±mp
);

1520 
Üic
->
rom
[
·tchaddr
] = 
·tchby‹
 ;

1521 
·tchaddr
++;

1522 
±mp
 += 2;

1530 
	`fþo£
Ð
f
 );

1533 ifÐÐÐ
Üic
->
pch_fd_þßd_g‘Çme_pc
 != -1 ) ||

1534 Ð
Üic
->
pch_fd_c§ve_g‘Çme_pc
 != -1 ) ||

1535 Ð
Üic
->
pch_fd_¡Üe_g‘Çme_pc
 != -1 ) ||

1536 Ð
Üic
->
pch_fd_»ÿÎ_g‘Çme_pc
 != -1 ) ) &&

1537 Ð
Üic
->
pch_fd_g‘Çme_addr
 != -1 ) )

1538 
Üic
->
pch_fd_avažabË
 = 
SDL_TRUE
;

1540 ifÐÐ
Üic
->
pch_‰_g‘sync_pc
 != -1 ) &&

1541 Ð
Üic
->
pch_‰_g‘sync_’d_pc
 != -1 ) &&

1542 Ð
Üic
->
pch_‰_g‘sync_loÝ_pc
 != -1 ) &&

1543 Ð
Üic
->
pch_‰_»adby‹_pc
 != -1 ) &&

1544 Ð
Üic
->
pch_‰_»adby‹_’d_pc
 != -1 ) )

1545 
Üic
->
pch_‰_avažabË
 = 
SDL_TRUE
;

1547 ifÐÐ
Üic
->
pch_‰_putby‹_pc
 != -1 ) &&

1548 Ð
Üic
->
pch_‰_putby‹_’d_pc
 != -1 ) )

1549 
Üic
->
pch_‰_§ve_avažabË
 = 
SDL_TRUE
;

1550 
	}
}

1552 
	$£tup_fÜ_miüodisc
Ð
machše
 *
Üic
, *
»ad±r
, *
wr™•Œ
 )

1554 
Üic
->
ýu
.
»ad
 = 
»ad±r
;

1555 
Üic
->
ýu
.
wr™e
 = 
wr™•Œ
;

1556 
Üic
->
romdis
 = 
SDL_TRUE
;

1557 
	`miüodisc_š™
Ð&
Üic
->
md
, &Üic->
wddisk
, oric );

1558 
Üic
->
disksyms
 = &
sym_miüodisc
;

1559 
	}
}

1561 
	$£tup_fÜ_jasmš
Ð
machše
 *
Üic
, *
»ad±r
, *
wr™•Œ
 )

1563 
Üic
->
ýu
.
»ad
 = 
»ad±r
;

1564 
Üic
->
ýu
.
wr™e
 = 
wr™•Œ
;

1565 
Üic
->
romdis
 = 
SDL_FALSE
;

1566 
	`jasmš_š™
Ð&
Üic
->
jasmš
, &Üic->
wddisk
, oric );

1567 
Üic
->
disksyms
 = &
sym_jasmš
;

1568 
	}
}

1570 
	$£tup_fÜ_´av‘zdisk
Ð
machše
 *
Üic
, *
»ad±r
, *
wr™•Œ
 )

1572 
Üic
->
ýu
.
»ad
 = 
»ad±r
;

1573 
Üic
->
ýu
.
wr™e
 = 
wr™•Œ
;

1574 
Üic
->
romdis
 = 
SDL_FALSE
;

1575 
	`´av‘z_š™
Ð&
Üic
->
´av‘z
, oric );

1576 
Üic
->
disksyms
 = &
sym_´av‘z
;

1577 
	}
}

1579 
	$£tup_fÜ_no_disk
Ð
machše
 *
Üic
, *
»ad±r
, *
wr™•Œ
 )

1581 
Üic
->
driv‘y³
 = 
DRV_NONE
;

1582 
Üic
->
ýu
.
»ad
 = 
»ad±r
;

1583 
Üic
->
ýu
.
wr™e
 = 
wr™•Œ
;

1584 
Üic
->
romdis
 = 
SDL_FALSE
;

1585 
Üic
->
disksyms
 = 
NULL
;

1586 
	}
}

1588 
SDL_boÞ
 
	$š™_machše
Ð
machše
 *
Üic
, 
ty³
, 
SDL_boÞ
 
nukeb»akpošts
 )

1590 
i
;

1592 
Üic
->
³turbo_fÜûoff
 = 
SDL_FALSE
;

1594 
Üic
->
ty³
 =ype;

1595 
	`m6502_š™
Ð&
Üic
->
ýu
, (*)Üic, 
nukeb»akpošts
 );

1597 
Üic
->
³turbo_sync¡ack
 = -1;

1599 
Üic
->
vidba£s
[0] = 0xa000;

1600 
Üic
->
vidba£s
[1] = 0x9800;

1601 
Üic
->
vidba£s
[2] = 0xbb80;

1602 
Üic
->
vidba£s
[3] = 0xb400;

1604 
Üic
->
romsyms
.
numsyms
 = 0;

1605 
Üic
->
‹Ë_bªksyms
[0].
numsyms
 = 0;

1606 
Üic
->
‹Ë_bªksyms
[1].
numsyms
 = 0;

1607 
Üic
->
‹Ë_bªksyms
[2].
numsyms
 = 0;

1608 
Üic
->
‹Ë_bªksyms
[3].
numsyms
 = 0;

1609 
Üic
->
‹Ë_bªksyms
[4].
numsyms
 = 0;

1610 
Üic
->
‹Ë_bªksyms
[5].
numsyms
 = 0;

1611 
Üic
->
‹Ë_bªksyms
[6].
numsyms
 = 0;

1612 
Üic
->
‹Ë_bªksyms
[7].
numsyms
 = 0;

1614 
	`þ—r_·tches
Ð
Üic
 );

1616 
g_m’u_scheme
 = 
ty³
;

1618  
ty³
 )

1620 
MACH_ORIC1_16K
:

1621  
i
=0; i<4; i++ )

1622 
Üic
->
vidba£s
[
i
] &= 0x7fff;

1623 
Üic
->
memsize
 = 16384 + 16384;

1624 
Üic
->
mem
 = 
	`m®loc
ÐÜic->
memsize
 );

1625 ifÐ!
Üic
->
mem
 )

1627 
	`”rÜ_´štf
( "Out of memory\n" );

1628  
SDL_FALSE
;

1631 
	`bÏnk_¿m
Ð
Üic
->
¿m·‰”n
, oric->
mem
, 16384+16384 );

1633 
Üic
->
rom
 = &Üic->
mem
[16384];

1635  
Üic
->
driv‘y³
 )

1637 
DRV_MICRODISC
:

1638 
	`£tup_fÜ_miüodisc
Ð
Üic
, 
miüodisc_o16k»ad
, 
miüodisc_o16kwr™e
);

1641 
DRV_JASMIN
:

1642 
	`£tup_fÜ_jasmš
Ð
Üic
, 
jasmš_o16k»ad
, 
jasmš_o16kwr™e
);

1645 
DRV_PRAVETZ
:

1647 
	`£tup_fÜ_no_disk
Ð
Üic
, 
o16k»ad
, 
o16kwr™e
 );

1651 ifÐ!
	`lßd_rom
Ð
Üic
, 
Üic1romfže
, -16384, &Üic->
rom
[0], &Üic->
romsyms
, 
SYMF_ROMDIS0
 ) )  
SDL_FALSE
;

1652 
	`lßd_·tches
Ð
Üic
, 
Üic1romfže
 );

1655 
MACH_ORIC1
:

1656 
Üic
->
memsize
 = 65536 + 16384;

1657 
Üic
->
mem
 = 
	`m®loc
ÐÜic->
memsize
 );

1658 ifÐ!
Üic
->
mem
 )

1660 
	`”rÜ_´štf
( "Out of memory\n" );

1661  
SDL_FALSE
;

1664 
	`bÏnk_¿m
Ð
Üic
->
¿m·‰”n
, oric->
mem
, 65536+16384 );

1666 
Üic
->
rom
 = &Üic->
mem
[65536];

1668  
Üic
->
driv‘y³
 )

1670 
DRV_MICRODISC
:

1671 
	`£tup_fÜ_miüodisc
Ð
Üic
, 
miüodisc_©mo¤—d
, 
miüodisc_©moswr™e
);

1674 
DRV_JASMIN
:

1675 
	`£tup_fÜ_jasmš
Ð
Üic
, 
jasmš_©mo¤—d
, 
jasmš_©moswr™e
);

1678 
DRV_PRAVETZ
:

1680 
	`£tup_fÜ_no_disk
Ð
Üic
, 
©mo¤—d
, 
©moswr™e
 );

1684 ifÐ!
	`lßd_rom
Ð
Üic
, 
Üic1romfže
, -16384, &Üic->
rom
[0], &Üic->
romsyms
, 
SYMF_ROMDIS0
 ) )  
SDL_FALSE
;

1685 
	`lßd_·tches
Ð
Üic
, 
Üic1romfže
 );

1688 
MACH_ATMOS
:

1689 
Üic
->
memsize
 = 65536 + 16384;

1690 
Üic
->
mem
 = 
	`m®loc
ÐÜic->
memsize
 );

1691 ifÐ!
Üic
->
mem
 )

1693 
	`”rÜ_´štf
( "Out of memory\n" );

1694  
SDL_FALSE
;

1697 
	`bÏnk_¿m
Ð
Üic
->
¿m·‰”n
, oric->
mem
, 65536+16384 );

1699 
Üic
->
rom
 = &Üic->
mem
[65536];

1701  
Üic
->
driv‘y³
 )

1703 
DRV_MICRODISC
:

1704 
	`£tup_fÜ_miüodisc
Ð
Üic
, 
miüodisc_©mo¤—d
, 
miüodisc_©moswr™e
);

1707 
DRV_JASMIN
:

1708 
	`£tup_fÜ_jasmš
Ð
Üic
, 
jasmš_©mo¤—d
, 
jasmš_©moswr™e
);

1711 
DRV_PRAVETZ
:

1713 
	`£tup_fÜ_no_disk
Ð
Üic
, 
©mo¤—d
, 
©moswr™e
 );

1717 ifÐ!
	`lßd_rom
Ð
Üic
, 
©mo¤omfže
, -16384, &Üic->
rom
[0], &Üic->
romsyms
, 
SYMF_ROMDIS0
 ) )  
SDL_FALSE
;

1718 
	`lßd_·tches
Ð
Üic
, 
©mo¤omfže
 );

1721 
MACH_TELESTRAT
:

1722 
Üic
->
driv‘y³
 = 
DRV_MICRODISC
;

1723 
Üic
->
memsize
 = 65536 + 16384*7;

1724 
Üic
->
mem
 = 
	`m®loc
ÐÜic->
memsize
 );

1725 ifÐ!
Üic
->
mem
 )

1727 
	`”rÜ_´štf
( "Out of memory\n" );

1728  
SDL_FALSE
;

1731 
	`bÏnk_¿m
Ð
Üic
->
¿m·‰”n
, oric->
mem
, 65536+16384*7 );

1733 
	`£tup_fÜ_miüodisc
Ð
Üic
, 
‹Ë¡¿Œ—d
, 
‹Ë¡¿twr™e
 );

1734 
Üic
->
disksyms
 = 
NULL
;

1736  
i
=0; i<8; i++ )

1739 
Üic
->
rom
 = oric->
‹Ë_bªk
[
i
].
±r
 = &Üic->
mem
[0x0c000+(i*0x4000)];

1740 ifÐ
‹Ëbªkfžes
[
i
][0] )

1742 
Üic
->
‹Ë_bªk
[
i
].
ty³
 = 
TELEBANK_ROM
;

1743 ifÐ!
	`lßd_rom
Ð
Üic
, 
‹Ëbªkfžes
[
i
], -16384, oric->
‹Ë_bªk
[i].
±r
, &Üic->
‹Ë_bªksyms
[i], 
SYMF_TELEBANK0
<<˜èè 
SDL_FALSE
;

1744 
	`lßd_·tches
Ð
Üic
, 
‹Ëbªkfžes
[
i
] );

1746 
Üic
->
‹Ë_bªk
[
i
].
ty³
 = 
TELEBANK_RAM
;

1750 
Üic
->
‹Ë_cu¼bªk
 = 7;

1751 
Üic
->
‹Ë_bªkty³
 = oric->
‹Ë_bªk
[7].
ty³
;

1752 
Üic
->
rom
 = oric->
‹Ë_bªk
[7].
±r
;

1755 
MACH_PRAVETZ
:

1756 
Üic
->
memsize
 = 65536 + 16384;

1757 
Üic
->
mem
 = 
	`m®loc
ÐÜic->
memsize
 );

1758 ifÐ!
Üic
->
mem
 )

1760 
	`”rÜ_´štf
( "Out of memory\n" );

1761  
SDL_FALSE
;

1764 
	`bÏnk_¿m
Ð
Üic
->
¿m·‰”n
, oric->
mem
, 65536+16384 );

1766 
Üic
->
rom
 = &Üic->
mem
[65536];

1768  
Üic
->
driv‘y³
 )

1770 
DRV_MICRODISC
:

1771 
	`£tup_fÜ_miüodisc
Ð
Üic
, 
miüodisc_©mo¤—d
, 
miüodisc_©moswr™e
);

1774 
DRV_JASMIN
:

1775 
	`£tup_fÜ_jasmš
Ð
Üic
, 
jasmš_©mo¤—d
, 
jasmš_©moswr™e
);

1778 
DRV_PRAVETZ
:

1779 
	`£tup_fÜ_´av‘zdisk
Ð
Üic
, 
´av‘z_©mo¤—d
, 
´av‘z_©moswr™e
 );

1783 
	`£tup_fÜ_no_disk
Ð
Üic
, 
©mo¤—d
, 
©moswr™e
 );

1787 ifÐ!
	`lßd_rom
Ð
Üic
, 
´av‘zromfže
[0], -16384, &Üic->
rom
[0], &Üic->
romsyms
, 
SYMF_ROMDIS0
 ) )  
SDL_FALSE
;

1788 
	`lßd_·tches
Ð
Üic
, 
´av‘zromfže
[0] );

1793  
SDL_FALSE
;

1796 
Üic
->
cyþe¥”¿¡”
 = 64;

1797 
Üic
->
vid_¡¬t
 = 65;

1798 
Üic
->
vid_max¿¡
 = 312;

1799 
Üic
->
vid_’d
 = oric->
vid_¡¬t
 + 224;

1800 
Üic
->
vid_¿¡”
 = 0;

1801 
	`uÏ_pow”up_deçuÉ
Ð
Üic
 );

1803 
Üic
->
»ad_nÙ_ligh’
 = oric->
ýu
.
»ad
;

1805 ià(
Üic
->
ligh’
)

1806 
Üic
->
ýu
.
»ad
 = 
ligh’_»ad
;

1808 
	`£ŒomÚ
Ð
Üic
 );

1809 
Üic
->
³Çme
[0] = 0;

1810 
	`³_»wšd
Ð
Üic
 );

1811 
	`m6502_»£t
Ð&
Üic
->
ýu
 );

1812 
	`vŸ_š™
Ð&
Üic
->
vŸ
, oric, 
VIA_MAIN
 );

1813 
	`vŸ_š™
Ð&
Üic
->
‹Ë_vŸ
, oric, 
VIA_TELESTRAT
 );

1814 
	`acŸ_š™
Ð&
Üic
->
‹Ë_acŸ
, oric );

1816 ià(
Üic
->
ch376_aùiv©ed
)

1818 
Üic
->
ch376
 = 
	`ch376_Üic_š™
();

1819 
	`ch376_Üic_cÚfig
(
Üic
->
ch376
);

1822 
	`ay_š™
Ð&
Üic
->
ay
, oric );

1823 
	`joy_£tup
Ð
Üic
 );

1824 
Üic
->
ýu
.
¿¡”cyþes
 = oric->
cyþe¥”¿¡”
;

1825 
Üic
->
äames
 = 0;

1826 
Üic
->
vid_doubË
 = 
SDL_TRUE
;

1827 
	`£‹mumode
Ð
Üic
, 
NULL
, 
EM_RUNNING
 );

1829 ifÐ
Üic
->
autÜewšd
 ) 
	`³_»wšd
( oric );

1831 
	`£tm’utoggËs
Ð
Üic
 );

1832 
»äesh¡©us
 = 
SDL_TRUE
;

1834  
SDL_TRUE
;

1835 
	}
}

1837 
	$shut_machše
Ð
machše
 *
Üic
 )

1839 ifÐ
Üic
->
driv‘y³
 =ð
DRV_MICRODISC
 ) { 
	`miüodisc_ä“
Ð&Üic->
md
 ); oric->driv‘y³ = 
DRV_NONE
; }

1840 ifÐ
Üic
->
driv‘y³
 =ð
DRV_JASMIN
 ) { 
	`jasmš_ä“
Ð&Üic->
jasmš
 ); oric->driv‘y³ = 
DRV_NONE
; }

1841 ifÐ
Üic
->
driv‘y³
 =ð
DRV_PRAVETZ
 ) { 
	`´av‘z_ä“
Ð&Üic->
´av‘z
 ); oric->driv‘y³ = 
DRV_NONE
; }

1842 ifÐ
Üic
->
mem
 ) { 
	`ä“
ÐÜic->mem ); oric->mem = 
NULL
; oric->
rom
 = NULL; }

1843 ifÐ
Üic
->
´f
 ) { 
	`fþo£
ÐÜic->´à); oric->´àð
NULL
; }

1844 ifÐ
Üic
->
t§vf
 ) 
	`³_¡Ý_§v•©ch
( oric );

1845 ifÐ
Üic
->
³ÿp
 ) 
	`toggË³ÿp
ÐÜic, 
	`fšd_™em_by_funùiÚ
(
maš™ems
, 
toggË³ÿp
), 0 );

1846 ià(
Üic
->
³buf
è{ 
	`ä“
(Üic->³buf); oric->³buàð
NULL
; }

1847 
	`mÚ_ä“syms
Ð&
sym_miüodisc
 );

1848 
	`mÚ_ä“syms
Ð&
sym_jasmš
 );

1849 
	`mÚ_ä“syms
Ð&
sym_´av‘z
 );

1850 
	`mÚ_ä“syms
Ð&
Üic
->
romsyms
 );

1851 
	`mÚ_ä“syms
Ð&
Üic
->
‹Ë_bªksyms
[0] );

1852 
	`mÚ_ä“syms
Ð&
Üic
->
‹Ë_bªksyms
[1] );

1853 
	`mÚ_ä“syms
Ð&
Üic
->
‹Ë_bªksyms
[2] );

1854 
	`mÚ_ä“syms
Ð&
Üic
->
‹Ë_bªksyms
[3] );

1855 
	`mÚ_ä“syms
Ð&
Üic
->
‹Ë_bªksyms
[4] );

1856 
	`mÚ_ä“syms
Ð&
Üic
->
‹Ë_bªksyms
[5] );

1857 
	`mÚ_ä“syms
Ð&
Üic
->
‹Ë_bªksyms
[6] );

1858 
	`mÚ_ä“syms
Ð&
Üic
->
‹Ë_bªksyms
[7] );

1859 
	}
}

1861 
shut
( );

1862 
	$£tdriv‘y³
Ð
machše
 *
Üic
, 
osdm’u™em
 *
m™em
, 
ty³
 )

1864 ifÐ
Üic
->
driv‘y³
 =ð
ty³
 )

1867 ifÐÐ
ty³
 =ð
DRV_PRAVETZ
 ) &&

1868 Ð
Üic
->
ty³
 !ð
MACH_PRAVETZ
 ) )

1870 
	`sw­mach
Ð
Üic
, 
m™em
, (
DRV_PRAVETZ
<<16)|
MACH_PRAVETZ
 );

1874 
	`shut_machše
Ð
Üic
 );

1876  
ty³
 )

1878 
DRV_MICRODISC
:

1879 
DRV_JASMIN
:

1880 
DRV_PRAVETZ
:

1881 
Üic
->
driv‘y³
 = 
ty³
;

1885 
Üic
->
driv‘y³
 = 
DRV_NONE
;

1889 
	`mÚ_¡©e_»£t
Ð
Üic
 );

1890 ifÐ!
	`š™_machše
Ð
Üic
, oric->
ty³
, 
SDL_FALSE
 ) )

1892 
	`shut
();

1893 
	`ex™
Ð
EXIT_FAILURE
 );

1896 
	`£tm’utoggËs
Ð
Üic
 );

1897 
	}
}

1899 
	$sw­mach
Ð
machše
 *
Üic
, 
osdm’u™em
 *
m™em
, 
which
 )

1901 
cu¼_driv‘y³
;

1903 
cu¼_driv‘y³
 = 
Üic
->
driv‘y³
;

1905 
	`shut_machše
Ð
Üic
 );

1907 ifÐ((
which
>>16)&0xffff) != 0xffff )

1908 
cu¼_driv‘y³
 = (
which
>>16)&0xffff;

1910 
which
 &= 0xffff;

1912 
Üic
->
driv‘y³
 = 
cu¼_driv‘y³
;

1916 
	`þ—r_‹xtzÚe
Ð
Üic
, 
TZ_DISK
 );

1918 
	`mÚ_¡©e_»£t
Ð
Üic
 );

1919 ifÐ!
	`š™_machše
Ð
Üic
, 
which
, which!=Üic->
ty³
 ) )

1921 
	`shut
();

1922 
	`ex™
Ð
EXIT_FAILURE
 );

1924 
	}
}

	@machine.h

21 #ifdeà
_MSC_VER


22 
	~<¡dio.h
>

25 
	~"keybßrd.h
"

29 
	mDRV_NONE
 = 0,

30 
	mDRV_JASMIN
,

31 
	mDRV_MICRODISC
,

32 
	mDRV_PRAVETZ


37 
	mMACH_ORIC1
 = 0,

38 
	mMACH_ORIC1_16K
,

39 
	mMACH_ATMOS
,

40 
	mMACH_TELESTRAT
,

41 
	mMACH_PRAVETZ
,

42 
	mMACH_LAST


47 
	mEM_PAUSED
 = 0,

48 
	mEM_RUNNING
,

49 
	mEM_DEBUG
,

50 
	mEM_MENU
,

51 
	mEM_PLEASEQUIT


56 
	mTELEBANK_RAM
,

57 
	mTELEBANK_ROM
,

58 
	mTELEBANK_HALFNHALF


63 
	mKMAP_QWERTY
 = 0,

64 
	mKMAP_AZERTY
,

65 
	mKMAP_QWERTZ


71 
	mIMG_I_DUNNO
 = 0,

72 
	mIMG_ATMOS_MICRODISC
,

73 
	mIMG_ATMOS_JASMIN
,

74 
	mIMG_TELESTRAT_DISK
,

75 
	mIMG_PRAVETZ_DISK
,

76 
	mIMG_GUESS_MICRODISC
,

77 
	mIMG_SNAPSHOT
,

78 
	mIMG_TAPE


81 
	s‹Ëbªkšfo


83 
	mty³
;

84 *
	m±r
;

87 
	smachše


89 
Ušt8
 
	mty³
;

90 
m6502
 
	mýu
;

91 
vŸ
 
	mvŸ
;

92 
ay8912
 
	may
;

93 
	mmemsize
;

94 *
	mmem
;

95 *
	mrom
;

96 
	memu_mode
;

98 
symbÞbË
 
	mromsyms
;

99 
symbÞbË
 
	mu£rsyms
;

100 
symbÞbË
 *
	mdisksyms
;

102 
‹Ëbªkšfo
 
	m‹Ë_bªk
[8];

103 
symbÞbË
 
	m‹Ë_bªksyms
[8];

104 
vŸ
 
	m‹Ë_vŸ
;

105 
acŸ
 
	m‹Ë_acŸ
;

106 
ch376
 *
	mch376
;

107 
SDL_boÞ
 
	mch376_aùiv©ed
;

108 
	m‹Ë_cu¼bªk
;

109 
	m‹Ë_bªkty³
;

112 
	mvid_¡¬t
;

113 
	mvid_’d
;

114 
	mvid_max¿¡
;

115 
	mvid_¿¡”
;

116 
	mvid_off£t
;

118 
	mvid_fg_cÞ
;

119 
	mvid_bg_cÞ
;

120 
Ušt16
 *
	mvid_b™±r
;

121 
Ušt16
 *
	mvid_šv_b™±r
;

122 
	mvid_mode
;

123 
	mvid_äeq
;

124 
	mvid_‹x‰rs
;

125 
	mvid_blškmask
;

126 
	mvid_chlše
;

127 
	mäames
;

128 
SDL_boÞ
 
	mvid_dœty
[224];

129 (*
	mvid_block_func
)Ð
	mmachše
 *, 
	mSDL_boÞ
, , );

131 
	mov”þockmuÉ
, 
	mov”þockshiá
;

133 
	mcyþe¥”¿¡”
;

134 
	mvsync
;

136 
SDL_boÞ
 
	mvid_doubË
;

137 
SDL_boÞ
 
	mromdis
, 
	mromÚ
;

138 
SDL_boÞ
 
	mvsynchack
;

140 
	mvid_addr
;

141 *
	mvid_ch_d©a
;

142 *
	mvid_ch_ba£
;

144 
Ušt8
 *
	msü±
;

145 
Ušt8
 *
	msü
;

147 
Ušt16
 
	mvidba£s
[4];

149 
	mdriv‘y³
;

150 
wd17xx
 
	mwddisk
;

151 
miüodisc
 
	mmd
;

152 
jasmš
 
	mjasmš
;

153 
´av‘z
 
	m´av‘z
;

154 
	mdiskÇme
[
MAX_DRIVES
][32];

155 
SDL_boÞ
 
	mdiskauto§ve
;

156 
SDL_boÞ
 
	mauto_jasmš_»£t
;

158 
FILE
 *
	m´f
;

159 
	m´þo£
, 
	m´þock
;

161 
	m³b™
, 
	m³out
, 
	m³·r™y
;

162 
	m³Ën
, 
	m³offs
, 
	m³couÁ
, 
	m³time
, 
	m³dupby‹s
, 
	m³hd»nd
, 
	m³d–ay
;

163 *
	m³buf
;

164 
SDL_boÞ
 
	m³mÙÜ
, 
	m³noi£
, 
	m³turbo
, 
	mautÜewšd
, 
	mautoš£¹
;

165 
SDL_boÞ
 
	m³turbo_fÜûoff
;

166 
SDL_boÞ
 
	msymbÞ§utÞßd
, 
	msymbÞsÿ£
;

167 
SDL_boÞ
 
	m¿w³
;

168 
	mnÚ¿w’d
, 
	m³h™’d
;

169 
	mÏ¡³fže
[20];

170 
	m³Çme
[32];

171 
	m³turbo_sync¡ack
;

172 
FILE
 *
	m³ÿp
;

173 
	m³ÿpcouÁ
;

174 
	m³ÿ¶a¡b™
;

175 
	m³ÿp§vby‹s
;

176 
	m³ÿp§voffs
;

179 
	mpch_fd_þßd_g‘Çme_pc
;

180 
	mpch_fd_c§ve_g‘Çme_pc
;

181 
	mpch_fd_¡Üe_g‘Çme_pc
;

182 
	mpch_fd_»ÿÎ_g‘Çme_pc
;

183 
	mpch_fd_g‘Çme_addr
;

184 
SDL_boÞ
 
	mpch_fd_avažabË
;

187 
	mpch_‰_g‘sync_pc
;

188 
	mpch_‰_g‘sync_’d_pc
;

189 
	mpch_‰_g‘sync_loÝ_pc
;

190 
	mpch_‰_»adby‹_pc
;

191 
	mpch_‰_»adby‹_’d_pc
;

192 
	mpch_‰_»adby‹_¡Üeby‹_addr
;

193 
	mpch_‰_»adby‹_¡Üez”o_addr
;

194 
	mpch_‰_putby‹_pc
;

195 
	mpch_‰_putby‹_’d_pc
;

196 
	mpch_‰_c§ve_’d_pc
;

197 
	mpch_‰_¡Üe_’d_pc
;

198 
	mpch_‰_wr™–—d”_pc
;

199 
	mpch_‰_wr™–—d”_’d_pc
;

200 
SDL_boÞ
 
	mpch_‰_»adby‹_£tÿ¼y
;

201 
SDL_boÞ
 
	mpch_‰_avažabË
;

202 
SDL_boÞ
 
	mpch_‰_§ve_avažabË
;

203 
FILE
 *
	mt§vf
;

205 
Sšt32
 
	mkeym­
;

207 
SDL_boÞ
 
	m¬©io
, 
	mh¡»tch
, 
	msÿÆšes
, 
	m·lgho¡
, 
	m´avdiskautoboÙ
;

208 
Sšt32
 
	msw_d•th
;

210 
	m»nd”mode
;

211 (*
	m»nd”_begš
)(
	mmachše
 *);

212 (*
	m»nd”_’d
)(
	mmachše
 *);

213 (*
	m»nd”_‹xtzÚe_®loc
)(
	mmachše
 *, );

214 (*
	m»nd”_‹xtzÚe_ä“
)(
	mmachše
 *, );

215 (*
	m»nd”_‹xtzÚe
)(
	mmachše
 *, );

216 (*
	m»nd”_þ—r_¬—
)( , , , );

217 (*
	m»nd”_gimg
)(, 
	mSšt32
, Sint32);

218 (*
	m»nd”_gimg·¹
)(, 
	mSšt32
, Sint32, Sint32, Sint32, Sint32, Sint32);

219 (*
	m»nd”_®loc_‹xtzÚe
)(
	mmachše
 *, 
	m‹xtzÚe
 *);

220 (*
	m»nd”_ä“_‹xtzÚe
)(
	mmachše
 *, 
	m‹xtzÚe
 *);

221 (*
	m»nd”_video
)(
	mmachše
 *, 
	mSDL_boÞ
);

222 
SDL_boÞ
 (*
»nd”_toggËfuÎsü“n
)(
machše
 *
	mÜic
);

223 
SDL_boÞ
 (*
š™_»nd”
)(
	mmachše
 *);

224 (*
	mshut_»nd”
)(
	mmachše
 *);

226 
	mpÝup¡r
[40];

227 
	mpÝu±ime
;

228 
SDL_boÞ
 
	mÃwpÝup¡r
;

230 
	m¡©us¡r
[40];

231 
SDL_boÞ
 
	mÃw¡©us¡r
;

233 
	m¡©usb¬_mode
;

235 
	m¿m·‰”n
;

237 
Sšt32
 
	mjoy_içû
;

238 
Sšt32
 
	mjoymode_a
, 
	mjoymode_b
;

239 
Sšt32
 
	m‹Ëjoymode_a
, 
	m‹Ëjoymode_b
;

240 
SDL_COMPAT_KEY
 
	mkbjoy1
[6], 
	mkbjoy2
[6];

242 
SDL_boÞ
 
	m´š‹ÇbË
;

243 
SDL_boÞ
 
	m´štfž‹r
;

245 
SDL_boÞ
 
	mligh’
;

246 
Ušt8
 
	mligh’x
, 
	mligh’y
;

247 (*
	m»ad_nÙ_ligh’
)(
	mm6502
 *,
	mUšt16
);

249 
Ušt8
 
	mpÜ_joy
, 
	mpÜ_ay
;

250 
SDL_boÞ
 
	mpÜ_is_ay
;

252 
SDL_Joy¡ick
 *
	msdljoy_a
, *
	msdljoy_b
;

254 
keybßrd_m­pšg
 
	mkeybßrd_m­pšg
;

255 
SDL_boÞ
 
	mshow_keybßrd
;

256 
SDL_boÞ
 
	mdefše_m­pšg
;

257 
SDL_boÞ
 
	m¡icky_mod_keys
;

259 
	macŸoff£t
;

260 
	macŸback’d
;

261 
	macŸback’dcfg
;

262 
	macŸback’dcfgpÜt
;

263 
	macŸback’dcfgdomaš
;

264 
	macŸback’dÇme
[
ACIA_BACKEND_NAME_LEN
];

267 
£ŒomÚ
Ð
machše
 *
Üic
 );

268 
£‹mumode
Ð
machše
 *
Üic
, 
osdm’u™em
 *
m™em
, 
mode
 );

269 
video_show
Ð
machše
 *
Üic
 );

270 
SDL_boÞ
 
emu_ev’t
Ð
SDL_Ev’t
 *
ev
, 
machše
 *
Üic
, SDL_boÞ *
Ãed»nd”
 );

272 
´eš™_machše
Ð
machše
 *
Üic
 );

273 
lßd_diskroms
Ð
machše
 *
Üic
 );

274 
SDL_boÞ
 
š™_machše
Ð
machše
 *
Üic
, 
ty³
, SDL_boÞ 
nukeb»akpošts
 );

275 
shut_machše
Ð
machše
 *
Üic
 );

276 
£tdriv‘y³
Ð
machše
 *
Üic
, 
osdm’u™em
 *
m™em
, 
ty³
 );

277 
sw­mach
Ð
machše
 *
Üic
, 
osdm’u™em
 *
m™em
, 
which
 );

278 
SDL_boÞ
 
i¤am
Ð
machše
 *
Üic
, 
addr
 );

280 
þ—r_·tches
Ð
machše
 *
Üic
 );

282 
ligh’_»ad
Ð
m6502
 *
ýu
, 
addr
 );

284 
d‘eù_image_ty³
(*
fž’ame
);

	@main.c

21 #ifdeà
__APPLE__


22 
	~"CÜeFound©iÚ/CÜeFound©iÚ.h
"

25 #ifdeà
_MSC_VER


26 
	#_CRTDBG_MAP_ALLOC


	)

27 
	~<¡dlib.h
>

28 
	~<ütdbg.h
>

31 
	~<¡dlib.h
>

32 
	~<¡dio.h
>

33 
	~<¡ršg.h
>

35 #ifdeà
__amigaos4__


36 
	~<´Ùo/exec.h
>

37 
	~<´Ùo/dos.h
>

40 #ifdeà
WIN32


41 
	~<wšdows.h
>

44 
	~"sy¡em.h
"

45 
	~"6502.h
"

46 
	~"vŸ.h
"

47 
	~"8912.h
"

48 
	~"gui.h
"

49 
	~"disk.h
"

50 
	~"mÚ™Ü.h
"

51 
	~"6551.h
"

52 
	~"machše.h
"

53 
	~"fž”eq.h
"

54 
	~"msgbox.h
"

55 
	~"avi.h
"

56 
	~"maš.h
"

57 
	~"uÏ.h
"

58 
	~"»nd”_sw.h
"

59 
	~"»nd”_sw8.h
"

60 
	~"»nd”_gl.h
"

61 
	~"joy¡ick.h
"

62 
	~"³.h
"

63 
	~"¢­shÙ.h
"

64 
	~"keybßrd.h
"

66 
	#FRAMES_TO_AVERAGE
 8

	)

68 
SDL_boÞ
 
	gÃed_sdl_qu™
 = 
SDL_FALSE
;

69 
SDL_boÞ
 
	gfuÎsü“n
, 
	ghwsurçû
;

70 
SDL_boÞ
 
w¬p¥“d
, 
soundÚ
;

71 
Ušt32
 
	gÏ¡äam‘imes
[
FRAMES_TO_AVERAGE
], 
	gäam‘im—ve
;

72 
mÚ_bpmsg
[];

73 
avi_hªdË
 *
vidÿp
;

74 
³·th
[], 
disk·th
[], 
‹Ëdisk·th
[], 
´avdisk·th
[];

75 
©mo¤omfže
[];

76 
Üic1romfže
[];

77 
mdisüomfže
[];

78 
jasmÄomfže
[];

79 
´av‘zromfže
[2][1024];

80 
‹Ëbªkfžes
[8][1024];

82 
	gkeym­_·th
[4096+32];

83 
	glßd_keym­
 = 
SDL_FALSE
;

85 #ifdeà
__amigaos4__


86 
__©Œibu‹__
((
u£d
)è
	g¡ackcook›
[] = "$STACK: 1000000";

89 #ià
defšed
(
__amigaos4__
è|| defšed(
__MORPHOS__
è|| defšed(
__AROS__
)

90 #ià
EXIT_FAILURE
 == 1

91 #undeà
EXIT_FAILURE


92 
	#EXIT_FAILURE
 
RETURN_FAIL


	)

94 #iâdeà
__AMIGADATE__


95 
	#__AMIGADATE__
 "("
__DATE__
")"

	)

97 
__©Œibu‹__
((
u£d
)è
	gv”siÚg
[] = "$VER: " 
APP_NAME_FULL
 " " 
__AMIGADATE__
;

100 
	s¡¬t_Ýts


102 
	mlùmp
[2048];

103 
SDL_boÞ
 
	m¡¬t_machše_£t
;

104 
Sšt32
 
	m¡¬t_machše
;

105 
SDL_boÞ
 
	m¡¬t_diskty³_£t
;

106 
Sšt32
 
	m¡¬t_diskty³
;

107 
Sšt32
 
	m¡¬t_»nd”mode
;

108 
SDL_boÞ
 
	m¡¬t_debug
;

109 
	m¡¬t_disk
[1024];

110 
	m¡¬t_³
[1024];

111 
	m¡¬t_syms
[1024];

112 * 
	m¡¬t_syms_fžes
[32];

113 
Sšt32
 
	m¡¬t_syms_couÁ
;

114 
	m¡¬t_¢­shÙ
[1024];

115 *
	m¡¬t_b»akpošt
;

118 *
	gmachty³s
[] = { "oric1",

123 
NULL
 };

125 *
	gdiskty³s
[] = { "none",

129 
NULL
 };

131 *
	gjoyiçûty³s
[] = { "none",

134 
NULL
 };

136 *
	gjoymodes
[] = { "none",

150 
NULL
 };

152 *
	g»nd”modes
[] = { "{{INVALID}}",

155 
NULL
 };

157 *
	gswd•ths
[] = { "8", "16", "32", 
NULL
 };

159 
SDL_boÞ
 
	$i¡ok’d
Ð
c
 )

161 ifÐ
	`isws
Ð
c
 ) )  
SDL_TRUE
;

162 ifÐÐ
c
 =ð0 ) || ( c =ð10 ) || ( c =ð13 ) )  
SDL_TRUE
;

163  
SDL_FALSE
;

164 
	}
}

166 
SDL_boÞ
 
	$»ad_cÚfig_¡ršg
Ð*
buf
, *
tok’
, *
de¡
, 
Sšt32
 
maxËn
 )

168 
Sšt32
 
i
, 
tokËn
, 
d
;

171 
tokËn
 = ()
	`¡¾’
Ð
tok’
 );

174 ifÐ
	`¡ºÿ£cmp
Ð
buf
, 
tok’
, 
tokËn
 ) !ð0 )  
SDL_FALSE
;

175 
i
 = 
tokËn
;

178  
	`isws
Ð
buf
[
i
] ) ) i++;

179 ifÐ
buf
[
i
] !ð'=' )  
SDL_TRUE
;

180 
i
++;

181  
	`isws
Ð
buf
[
i
] ) ) i++;

182 ifÐ
buf
[
i
] !ð'\'' )  
SDL_TRUE
;

183 
i
++;

186 
d
=0;

187  
buf
[
i
] != '\'' )

189 ifÐ
d
 >ð(
maxËn
-1) ) ;

190 ifÐ!
buf
[
i
] ) ;

192 ifÐÐ
buf
[
i
] == '\\' ) && ( buf[i+1] == '\'' ) )

194 
de¡
[
d
++] = '\'';

195 
i
+=2;

199 ifÐÐ
buf
[
i
] == '\\' ) && ( buf[i+1] == '\\' ) )

201 
de¡
[
d
++] = '\\';

202 
i
+=2;

206 
de¡
[
d
++] = 
buf
[
i
++];

209 
de¡
[
d
] = 0;

210  
SDL_TRUE
;

211 
	}
}

213 
SDL_boÞ
 
	$»ad_cÚfig_boÞ
Ð*
buf
, *
tok’
, 
SDL_boÞ
 *
de¡
 )

215 
Sšt32
 
i
, 
tokËn
;

218 
tokËn
 = ()
	`¡¾’
Ð
tok’
 );

221 ifÐ
	`¡ºÿ£cmp
Ð
buf
, 
tok’
, 
tokËn
 ) !ð0 )  
SDL_FALSE
;

222 
i
 = 
tokËn
;

225  
	`isws
Ð
buf
[
i
] ) ) i++;

226 ifÐ
buf
[
i
] !ð'=' )  
SDL_TRUE
;

227 
i
++;

228  
	`isws
Ð
buf
[
i
] ) ) i++;

230 (*
de¡
èð
SDL_FALSE
;

231 ifÐ
	`¡ºÿ£cmp
Ð&
buf
[
i
], "Œue", 4 ) =ð0 ) (*
de¡
èð
SDL_TRUE
;

232 ifÐ
	`¡ºÿ£cmp
Ð&
buf
[
i
], "yes", 3 ) =ð0 ) (*
de¡
èð
SDL_TRUE
;

233  
SDL_TRUE
;

234 
	}
}

236 
SDL_boÞ
 
	$»ad_cÚfig_ÝtiÚ
Ð*
buf
, *
tok’
, 
Sšt32
 *
de¡
, **
ÝtiÚs
 )

238 
Sšt32
 
i
, 
j
, 
Ën
;

239 *
thisÝt
;

242 
Ën
 = ()
	`¡¾’
Ð
tok’
 );

245 ifÐ
	`¡ºÿ£cmp
Ð
buf
, 
tok’
, 
Ën
 ) !ð0 )  
SDL_FALSE
;

246 
i
 = 
Ën
;

249  
	`isws
Ð
buf
[
i
] ) ) i++;

250 ifÐ
buf
[
i
] !ð'=' )  
SDL_TRUE
;

251 
i
++;

252  
	`isws
Ð
buf
[
i
] ) ) i++;

255 ifÐ
	`¡ºcmp
Ð&
buf
[
i
], "{{INVALID}}", 11 ) == 0 )

256  
SDL_FALSE
;

258  
j
=0; 
ÝtiÚs
[j]; j++ )

260 
thisÝt
 = 
ÝtiÚs
[
j
];

261  
thisÝt
[0] )

263 
Ën
 = 0;

264  (
thisÝt
[
Ën
]!=0) && (thisopt[len]!='|') )†en++;

266 ifÐ
	`¡ºÿ£cmp
Ð&
buf
[
i
], 
thisÝt
, 
Ën
 ) == 0 )

268 ifÐ
	`i¡ok’d
Ð
buf
[
i
+
Ën
] ) )

270 *
de¡
 = 
j
;

271  
SDL_TRUE
;

274 
thisÝt
 +ð
Ën
;

275 ifÐ
thisÝt
[0] == '|' )hisopt++;

279  
SDL_TRUE
;

280 
	}
}

282 
SDL_boÞ
 
	$»ad_cÚfig_št
Ð*
buf
, *
tok’
, *
de¡
, 
mš
, 
max
 )

284 
Sšt32
 
i
, 
tokËn
;

285 
v®
, 
hv
;

288 
tokËn
 = ()
	`¡¾’
Ð
tok’
 );

291 ifÐ
	`¡ºÿ£cmp
Ð
buf
, 
tok’
, 
tokËn
 ) !ð0 )  
SDL_FALSE
;

292 
i
 = 
tokËn
;

295  
	`isws
Ð
buf
[
i
] ) ) i++;

296 ifÐ
buf
[
i
] !ð'=' )  
SDL_TRUE
;

297 
i
++;

298  
	`isws
Ð
buf
[
i
] ) ) i++;

300 
v®
 = 0;

301 ifÐ
buf
[
i
] == '$' )

303 
i
++;

304  (
hv
=
	`hex™
(
buf
[
i
])) != -1 )

306 
v®
 = (v®<<4è+ 
hv
;

307 
i
++;

310 
v®
 = 
	`©oi
Ð&
buf
[
i
] );

313 ifÐ
v®
 < 
mš
 ) val = min;

314 ifÐ
v®
 > 
max
 ) val = max;

316 (*
de¡
èð
v®
;

317  
SDL_TRUE
;

318 
	}
}

320 
SDL_boÞ
 
	$»ad_cÚfig_joykey
Ð*
buf
, *
tok’
, 
SDL_COMPAT_KEY
 *
de¡
 )

322 
Sšt32
 
i
, 
tokËn
, 
d
;

323 
SDL_COMPAT_KEY
 
thekey
;

324 
keyÇme
[32];

327 
tokËn
 = ()
	`¡¾’
Ð
tok’
 );

330 ifÐ
	`¡ºÿ£cmp
Ð
buf
, 
tok’
, 
tokËn
 ) !ð0 )  
SDL_FALSE
;

331 
i
 = 
tokËn
;

334  
	`isws
Ð
buf
[
i
] ) ) i++;

335 ifÐ
buf
[
i
] !ð'=' )  
SDL_TRUE
;

336 
i
++;

337  
	`isws
Ð
buf
[
i
] ) ) i++;

338 ifÐ
buf
[
i
] !ð'\'' )  
SDL_TRUE
;

339 
i
++;

342 
d
=0;

343  
buf
[
i
] != '\'' )

345 ifÐ
d
 >= 31 ) ;

346 ifÐ!
buf
[
i
] ) ;

348 ifÐÐ
buf
[
i
] == '\\' ) && ( buf[i+1] == '\'' ) )

350 
keyÇme
[
d
++] = '\'';

351 
i
+=2;

355 ifÐÐ
buf
[
i
] == '\\' ) && ( buf[i+1] == '\\' ) )

357 
keyÇme
[
d
++] = '\\';

358 
i
+=2;

362 
keyÇme
[
d
++] = 
buf
[
i
++];

365 
keyÇme
[
d
] = 0;

367 
thekey
 = 
	`joy_keyÇme_to_sym
Ð
keyÇme
 );

369 ifÐ
thekey
 )

371 *
de¡
 = 
thekey
;

372  
SDL_TRUE
;

375  
SDL_FALSE
;

376 
	}
}

378 
	$lßd_cÚfig
Ð
¡¬t_Ýts
 *
¡o
, 
machše
 *
Üic
 )

380 
FILE
 *
f
;

381 
Sšt32
 
i
, 
j
;

382 
tbtmp
[32];

383 
keym­_fže
[4096];

385 
f
 = 
	`fÝ’
Ð
FILEPREFIX
"oricutron.cfg", "r" );

386 ifÐ!
f
 ) ;

388  !
	`ãof
Ð
f
 ) )

390 ifÐ!
	`fg‘s
Ð
¡o
->
lùmp
, 2048, 
f
 ) ) ;

392  
i
=0; 
	`isws
Ð
¡o
->
lùmp
[i] ); i++ ) ;

394 ifÐ
	`»ad_cÚfig_ÝtiÚ
Ð&
¡o
->
lùmp
[
i
], "machše", &¡o->
¡¬t_machše
, 
machty³s
 ) ) ;

395 ifÐ
	`»ad_cÚfig_ÝtiÚ
Ð&
¡o
->
lùmp
[
i
], "diskty³", &¡o->
¡¬t_diskty³
, 
diskty³s
 ) ) ;

396 ifÐ
	`»ad_cÚfig_boÞ
Ð&
¡o
->
lùmp
[
i
], "debug", &¡o->
¡¬t_debug
 ) ) ;

397 ifÐ
	`»ad_cÚfig_boÞ
Ð&
¡o
->
lùmp
[
i
], "fuÎsü“n", &
fuÎsü“n
 ) ) ;

398 ifÐ
	`»ad_cÚfig_boÞ
Ð&
¡o
->
lùmp
[
i
], "hwsurçû", &
hwsurçû
 ) ) ;

399 ifÐ
	`»ad_cÚfig_boÞ
Ð&
¡o
->
lùmp
[
i
], "sÿÆšes", &
Üic
->
sÿÆšes
 ) ) ;

400 ifÐ
	`»ad_cÚfig_boÞ
Ð&
¡o
->
lùmp
[
i
], "¬©io", &
Üic
->
¬©io
 ) ) ;

401 ifÐ
	`»ad_cÚfig_boÞ
Ð&
¡o
->
lùmp
[
i
], "h¡»tch", &
Üic
->
h¡»tch
 ) ) ;

402 ifÐ
	`»ad_cÚfig_boÞ
Ð&
¡o
->
lùmp
[
i
], "·lgho¡šg", &
Üic
->
·lgho¡
 ) ) ;

403 ifÐ
	`»ad_cÚfig_¡ršg
Ð&
¡o
->
lùmp
[
i
], "diskimage", sto->
¡¬t_disk
, 1024 ) ) ;

404 ifÐ
	`»ad_cÚfig_¡ršg
Ð&
¡o
->
lùmp
[
i
], "³image", sto->
¡¬t_³
, 1024 ) ) ;

405 ifÐ
	`»ad_cÚfig_¡ršg
Ð&
¡o
->
lùmp
[
i
], "symbÞs", sto->
¡¬t_syms
, 1024 ) ) ;

406 ifÐ
	`»ad_cÚfig_¡ršg
Ð&
¡o
->
lùmp
[
i
], "³·th", 
³·th
, 1024 ) ) ;

407 ifÐ
	`»ad_cÚfig_¡ršg
Ð&
¡o
->
lùmp
[
i
], "disk·th", 
disk·th
, 1024 ) ) ;

408 ifÐ
	`»ad_cÚfig_¡ršg
Ð&
¡o
->
lùmp
[
i
], "‹Ëdisk·th", 
‹Ëdisk·th
, 1024 ) ) ;

409 ifÐ
	`»ad_cÚfig_¡ršg
Ð&
¡o
->
lùmp
[
i
], "´avdisk·th", 
´avdisk·th
, 1024 ) ) ;

410 ifÐ
	`»ad_cÚfig_¡ršg
Ð&
¡o
->
lùmp
[
i
], "©mo¤om", 
©mo¤omfže
, 1024 ) ) ;

411 ifÐ
	`»ad_cÚfig_¡ršg
Ð&
¡o
->
lùmp
[
i
], "Üic1rom", 
Üic1romfže
, 1024 ) ) ;

412 ifÐ
	`»ad_cÚfig_¡ršg
Ð&
¡o
->
lùmp
[
i
], "mdisüom", 
mdisüomfže
, 1024 ) ) ;

413 ifÐ
	`»ad_cÚfig_¡ršg
Ð&
¡o
->
lùmp
[
i
], "jasmšrom", 
jasmÄomfže
, 1024 ) ) ;

414 ifÐ
	`»ad_cÚfig_¡ršg
Ð&
¡o
->
lùmp
[
i
], "´av‘zrom", 
´av‘zromfže
[0], 1024 ) ) ;

415 ifÐ
	`»ad_cÚfig_¡ršg
Ð&
¡o
->
lùmp
[
i
], "´av‘z8drom", 
´av‘zromfže
[1], 1024 ) ) ;

416 ifÐ
	`»ad_cÚfig_št
Ð&
¡o
->
lùmp
[
i
], "¿m·‰”n", &
Üic
->
¿m·‰”n
, 0, 1 ) ) ;

417 ifÐ
	`»ad_cÚfig_ÝtiÚ
Ð&
¡o
->
lùmp
[
i
], "swd•th", &
Üic
->
sw_d•th
, 
swd•ths
 ) )

420 
Üic
->
sw_d•th
)

422 0: 
Üic
->
sw_d•th
 = 8; ;

423 2: 
Üic
->
sw_d•th
 = 32; ;

424 : 
Üic
->
sw_d•th
 = 16; ;

428 ifÐ
	`»ad_cÚfig_ÝtiÚ
Ð&
¡o
->
lùmp
[
i
], "»nd”mode", &¡o->
¡¬t_»nd”mode
, 
»nd”modes
 ) )

430 #iâdeà
__OPENGL_AVAILABLE__


431 ifÐ
¡o
->
¡¬t_»nd”mode
 =ð
RENDERMODE_GL
 )

432 
¡o
->
¡¬t_»nd”mode
 = 
RENDERMODE_SW
;

436  
j
=0; j<8; j++ )

438 
	`¥rštf
Ð
tbtmp
, "‹Ëbªk%c", 
j
+'0' );

439 ifÐ
	`»ad_cÚfig_¡ršg
Ð&
¡o
->
lùmp
[
i
], 
tbtmp
, 
‹Ëbªkfžes
[
j
], 1024 ) ) ;

441 ifÐ
	`»ad_cÚfig_boÞ
Ð&
¡o
->
lùmp
[
i
], "ligh’", &
Üic
->
ligh’
 ) ) ;

442 ifÐ
	`»ad_cÚfig_boÞ
Ð&
¡o
->
lùmp
[
i
], "´š‹ÇbË", &
Üic
->
´š‹ÇbË
 ) ) ;

443 ifÐ
	`»ad_cÚfig_boÞ
Ð&
¡o
->
lùmp
[
i
], "´štfž‹r", &
Üic
->
´štfž‹r
 ) ) ;

444 ifÐ
	`»ad_cÚfig_št
Ð&
¡o
->
lùmp
[
i
], "£rŸl_add»ss", &
Üic
->
acŸoff£t
, 0x310, 0x3fc ) ) ;

445 ifÐ
	`»ad_cÚfig_¡ršg
Ð&
¡o
->
lùmp
[
i
], "£rŸl", 
Üic
->
acŸback’dÇme
, 
ACIA_BACKEND_NAME_LEN
 ) )

447 if(!
	`¡rÿ£cmp
("nÚe", 
Üic
->
acŸback’dÇme
))

448 
Üic
->
acŸback’dcfg
 = oric->
acŸback’d
 = 
ACIA_TYPE_NONE
;

449 if(!
	`¡rÿ£cmp
("loÝback", 
Üic
->
acŸback’dÇme
))

450 
Üic
->
acŸback’dcfg
 = oric->
acŸback’d
 = 
ACIA_TYPE_LOOPBACK
;

451 if(!
	`¡ºÿ£cmp
("modem", 
Üic
->
acŸback’dÇme
, 5))

453 #ifdeà
BACKEND_MODEM


454 * 
p
 = 
	`¡rchr
(
Üic
->
acŸback’dÇme
, ':');

455 
Üic
->
acŸback’dcfg
 = oric->
acŸback’d
 = 
ACIA_TYPE_MODEM
;

456 
Üic
->
acŸback’dcfgpÜt
 = 0;

457 
Üic
->
acŸback’dcfgdomaš
 = 4;

458 if(
p
) {

459 * 
p2
 = 
	`¡rchr
(
p
+1, ':');

460 ià(
p2
) {

462 ià(
	`¡rÿ£cmp
(
p2
+1, "ipv6")==0)

463 
Üic
->
acŸback’dcfgdomaš
 = 6;

464 *
p2
 = '\0';

465 
Üic
->
acŸback’dcfgpÜt
 = 
	`©oi
(
p
+1);

466 *
p2
 = ':';

468 
Üic
->
acŸback’dcfgpÜt
 = 
	`©oi
(
p
+1);

471 if(
Üic
->
acŸback’dcfgpÜt
 <= 0)

472 
Üic
->
acŸback’dcfgpÜt
 = 
ACIA_TYPE_MODEM_DEFAULT_PORT
;

477 #ifdeà
BACKEND_COM


478 
Üic
->
acŸback’dcfg
 = oric->
acŸback’d
 = 
ACIA_TYPE_COM
;

483 ifÐ
	`»ad_cÚfig_ÝtiÚ
Ð&
¡o
->
lùmp
[
i
], "joyš‹rçû", &
Üic
->
joy_içû
, 
joyiçûty³s
 ) ) ;

484 ifÐ
	`»ad_cÚfig_ÝtiÚ
Ð&
¡o
->
lùmp
[
i
], "joy¡ick_a", &
Üic
->
joymode_a
, 
joymodes
 ) ) ;

485 ifÐ
	`»ad_cÚfig_ÝtiÚ
Ð&
¡o
->
lùmp
[
i
], "joy¡ick_b", &
Üic
->
joymode_b
, 
joymodes
 ) ) ;

486 ifÐ
	`»ad_cÚfig_ÝtiÚ
Ð&
¡o
->
lùmp
[
i
], "‹Ëjoy_a", &
Üic
->
‹Ëjoymode_a
, 
joymodes
 ) ) ;

487 ifÐ
	`»ad_cÚfig_ÝtiÚ
Ð&
¡o
->
lùmp
[
i
], "‹Ëjoy_b", &
Üic
->
‹Ëjoymode_b
, 
joymodes
 ) ) ;

488 ifÐ
	`»ad_cÚfig_joykey
Ð&
¡o
->
lùmp
[
i
], "kbjoy1_up", &
Üic
->
kbjoy1
[0] ) ) ;

489 ifÐ
	`»ad_cÚfig_joykey
Ð&
¡o
->
lùmp
[
i
], "kbjoy1_down", &
Üic
->
kbjoy1
[1] ) ) ;

490 ifÐ
	`»ad_cÚfig_joykey
Ð&
¡o
->
lùmp
[
i
], "kbjoy1_Ëá", &
Üic
->
kbjoy1
[2] ) ) ;

491 ifÐ
	`»ad_cÚfig_joykey
Ð&
¡o
->
lùmp
[
i
], "kbjoy1_right", &
Üic
->
kbjoy1
[3] ) ) ;

492 ifÐ
	`»ad_cÚfig_joykey
Ð&
¡o
->
lùmp
[
i
], "kbjoy1_fœe1", &
Üic
->
kbjoy1
[4] ) ) ;

493 ifÐ
	`»ad_cÚfig_joykey
Ð&
¡o
->
lùmp
[
i
], "kbjoy1_fœe2", &
Üic
->
kbjoy1
[5] ) ) ;

494 ifÐ
	`»ad_cÚfig_joykey
Ð&
¡o
->
lùmp
[
i
], "kbjoy2_up", &
Üic
->
kbjoy2
[0] ) ) ;

495 ifÐ
	`»ad_cÚfig_joykey
Ð&
¡o
->
lùmp
[
i
], "kbjoy2_down", &
Üic
->
kbjoy2
[1] ) ) ;

496 ifÐ
	`»ad_cÚfig_joykey
Ð&
¡o
->
lùmp
[
i
], "kbjoy2_Ëá", &
Üic
->
kbjoy2
[2] ) ) ;

497 ifÐ
	`»ad_cÚfig_joykey
Ð&
¡o
->
lùmp
[
i
], "kbjoy2_right", &
Üic
->
kbjoy2
[3] ) ) ;

498 ifÐ
	`»ad_cÚfig_joykey
Ð&
¡o
->
lùmp
[
i
], "kbjoy2_fœe1", &
Üic
->
kbjoy2
[4] ) ) ;

499 ifÐ
	`»ad_cÚfig_joykey
Ð&
¡o
->
lùmp
[
i
], "kbjoy2_fœe2", &
Üic
->
kbjoy2
[5] ) ) ;

500 ifÐ
	`»ad_cÚfig_boÞ
Ð&
¡o
->
lùmp
[
i
], "diskauto§ve", &
Üic
->
diskauto§ve
 ) ) ;

501 ifÐ
	`»ad_cÚfig_boÞ
Ð&
¡o
->
lùmp
[
i
], "ch376", &
Üic
->
ch376_aùiv©ed
) ) ;

502 ifÐ
	`»ad_cÚfig_boÞ
Ð&
¡o
->
lùmp
[
i
], "´avdiskautoboÙ", &
Üic
->
´avdiskautoboÙ
 ) ) ;

503 ifÐ
	`»ad_cÚfig_boÞ
Ð&
¡o
->
lùmp
[
i
], "show_keybßrd", &
Üic
->
show_keybßrd
 ) ) ;

504 ifÐ
	`»ad_cÚfig_boÞ
Ð&
¡o
->
lùmp
[
i
], "¡icky_mod_keys", &
Üic
->
¡icky_mod_keys
 ) );

505 ifÐ
	`»ad_cÚfig_¡ršg
Ð&
¡o
->
lùmp
[
i
], "autÞßd_keybßrd_m­pšg", 
keym­_fže
, 4096 ) )

507 
	`¡rýy
(
keym­_·th
, 
FILEPREFIX
"");

508 
	`¡rÿt
(
keym­_·th
, 
keym­_fže
);

509 
lßd_keym­
 = 
SDL_TRUE
;

514 
	`fþo£
Ð
f
 );

515 
	}
}

517 
	$u§ge
Ð
»t
 )

519 
	`´štf
Ð
VERSION_COPYRIGHTS
 "\n\n"

541 #ifdeà
__OPENGL_AVAILABLE__


564 #ifdeà
BACKEND_MODEM


569 #ifdeà
BACKEND_COM


577 
	`ex™
(
»t
);

578 
	}
}

581 
	$”rÜ_´štf
Ð*
fmt
, ... )

583 
¡r
[256];

585 
va_li¡
 
­
;

586 
	`va_¡¬t
Ð
­
, 
fmt
 );

587 ifÐ
	`v¢´štf
Ð
¡r
, 256, 
fmt
, 
­
 ) != -1 )

589 
¡r
[255] = 0;

590 #ifdeà
WIN32


591 
	`Mes§geBoxA
Ð
NULL
, 
¡r
, "OricuŒÚ", 
MB_OK
 );

593 
	`årštf
Ð
¡d”r
, "%s\n", 
¡r
 );

596 
	`va_’d
Ð
­
 );

597 
	}
}

599 
SDL_boÞ
 
	$Ú_Ü_off
Ð*
¬g
, *
ÝtiÚ
, 
SDL_boÞ
 *
¡Üage
 )

601 ifÐ
ÝtiÚ
 )

603 ifÐ
	`¡rÿ£cmp
Ð
ÝtiÚ
, "on" ) == 0 )

605 *
¡Üage
 = 
SDL_TRUE
;

606  
SDL_TRUE
;

609 ifÐ
	`¡rÿ£cmp
Ð
ÝtiÚ
, "off" ) == 0 )

611 *
¡Üage
 = 
SDL_FALSE
;

612  
SDL_TRUE
;

616 
	`”rÜ_´štf
("P¬am‘” '%s' should bfÞlowed by 'Ú' o¸'off'", 
¬g
);

617  
SDL_FALSE
;

618 
	}
}

620 
SDL_boÞ
 
	$š™
Ð
machše
 *
Üic
, 
¬gc
, *
¬gv
[] )

622 
Sšt32
 
i
;

623 
¡¬t_Ýts
 *
¡o
;

624 
Ýt_ty³
, *
Ýt_¬g
, *
tmp
;

626 
¡o
 = 
	`m®loc
ÐÐ
¡¬t_Ýts
 ) );

627 ifÐ!
¡o
 )  
SDL_FALSE
;

630 
¡o
->
¡¬t_machše
 = 
MACH_ATMOS
;

631 
¡o
->
¡¬t_machše_£t
 = 
SDL_FALSE
;

632 
¡o
->
¡¬t_diskty³
 = 
DRV_NONE
;

633 
¡o
->
¡¬t_diskty³_£t
 = 
SDL_FALSE
;

634 
¡o
->
¡¬t_debug
 = 
SDL_FALSE
;

635 
¡o
->
¡¬t_»nd”mode
 = 
RENDERMODE_SW
;

636 
¡o
->
¡¬t_disk
[0] = 0;

637 
¡o
->
¡¬t_³
[0] = 0;

638 
¡o
->
¡¬t_syms
[0] = 0;

639 
¡o
->
¡¬t_syms_couÁ
 = 0;

640 
¡o
->
¡¬t_¢­shÙ
[0] = 0;

641 
¡o
->
¡¬t_b»akpošt
 = 
NULL
;

642 
Üic
->
ch376_aùiv©ed
 = 
SDL_FALSE
;

643 
fuÎsü“n
 = 
SDL_FALSE
;

644 #ifdeà
WIN32


645 
hwsurçû
 = 
SDL_TRUE
;

647 
hwsurçû
 = 
SDL_FALSE
;

650 
	`´eš™_uÏ
Ð
Üic
 );

651 
	`´eš™_machše
Ð
Üic
 );

652 
	`´eš™_»nd”_sw
Ð
Üic
 );

653 
	`´eš™_»nd”_sw8
Ð
Üic
 );

654 #ifdeà
__OPENGL_AVAILABLE__


655 
	`´eš™_»nd”_gl
Ð
Üic
 );

657 
	`´eš™_gui
Ð
Üic
 );

659 
	`kbd_š™
(
Üic
);

662 ifÐ
	`SDL_In™
Ð
SDL_INIT_VIDEO
 | 
SDL_INIT_AUDIO
 ) < 0 )

664 
	`”rÜ_´štf
( "SDL init failed" );

665 
	`ä“
Ð
¡o
 );

666  
SDL_FALSE
;

668 
Ãed_sdl_qu™
 = 
SDL_TRUE
;

670 #iâdeà
__APPLE__


671 
	`SDL_COMPAT_WM_S‘IcÚ
Ð
	`SDL_LßdBMP
Ð
IMAGEPREFIX
"wšicÚ.bmp" ), 
NULL
 );

674 
	`»nd”_sw_d‘eùvideo
Ð
Üic
 );

676 
	`lßd_cÚfig
Ð
¡o
, 
Üic
 );

678  
i
=1; i<
¬gc
; i++ )

680 
Ýt_ty³
 = 0;

681 ifÐ
¬gv
[
i
][0] == '-' )

683  
¬gv
[
i
][1] )

686 
Ýt_¬g
 = 
NULL
;

687 
tmp
 = &
¬gv
[
i
][2];

689 ifÐ
	`¡rÿ£cmp
Ð
tmp
, "fuÎsü“n" ) =ð0 ) { 
Ýt_ty³
 = 'f'; ; }

690 ifÐ
	`¡rÿ£cmp
Ð
tmp
, "wšdow" ) =ð0 ) { 
Ýt_ty³
 = 'w'; ; }

691 ifÐ
	`¡rÿ£cmp
Ð
tmp
, "debug" ) =ð0 ) { 
Ýt_ty³
 = 'b'; ; }

692 ifÐ
	`¡rÿ£cmp
Ð
tmp
, "hwsurçû" ) =ð0 ) { 
hwsurçû
 = 
SDL_TRUE
; ; }

693 ifÐ
	`¡rÿ£cmp
Ð
tmp
, "swsurçû" ) =ð0 ) { 
hwsurçû
 = 
SDL_FALSE
; ; }

694 ifÐ
	`¡rÿ£cmp
Ð
tmp
, "h–p" ) =ð0 ) { 
Ýt_ty³
 = 'h'; ; }

696 ifÐ
i
<(
¬gc
-1) )

697 
Ýt_¬g
 = 
¬gv
[
i
+1];

698 
i
++;

700 ifÐ
	`¡rÿ£cmp
Ð
tmp
, "machše" ) =ð0 ) { 
Ýt_ty³
 = 'm'; ; }

701 ifÐ
	`¡rÿ£cmp
Ð
tmp
, "disk" ) =ð0 ) { 
Ýt_ty³
 = 'd'; ; }

702 ifÐ
	`¡rÿ£cmp
Ð
tmp
, "³" ) =ð0 ) { 
Ýt_ty³
 = 't'; ; }

703 ifÐ
	`¡rÿ£cmp
Ð
tmp
, "drive" ) =ð0 ) { 
Ýt_ty³
 = 'k'; ; }

704 ifÐ
	`¡rÿ£cmp
Ð
tmp
, "symbÞs" ) =ð0 ) { 
Ýt_ty³
 = 's'; ; }

705 ifÐ
	`¡rÿ£cmp
Ð
tmp
, "b»akpošt" ) =ð0 ) { 
Ýt_ty³
 = 'r'; ; }

706 #ifdeà
__OPENGL_AVAILABLE__


707 ifÐ
	`¡rÿ£cmp
Ð
tmp
, "»nd”mode" ) =ð0 ) { 
Ýt_ty³
 = 'R'; ; }

711 ifÐ
	`¡rÿ£cmp
Ð
tmp
, "turbotape" ) == 0 )

713 ifÐ!
	`Ú_Ü_off
Ð
¬gv
[
i
-1], 
Ýt_¬g
, &
Üic
->
³turbo
 ) ) 
	`ex™
Ð
EXIT_FAILURE
 );

717 ifÐ
	`¡rÿ£cmp
Ð
tmp
, "lightpen" ) == 0 )

719 ifÐ!
	`Ú_Ü_off
Ð
¬gv
[
i
-1], 
Ýt_¬g
, &
Üic
->
ligh’
 ) ) 
	`ex™
Ð
EXIT_FAILURE
 );

723 ifÐ
	`¡rÿ£cmp
Ð
tmp
, "serial_address" ) == 0 )

725 ifÐ!
Ýt_¬g
 )

726 
	`ex™
Ð
EXIT_FAILURE
 );

727 ifÐ'$' =ð
Ýt_¬g
[0] && 1 =ð
	`ssÿnf
(Ýt_¬g, "$%x", &
Üic
->
acŸoff£t
) )

729 ifÐ'0' =ð
Ýt_¬g
[0] && 1 =ð
	`ssÿnf
(Ýt_¬g, "0x%x", &
Üic
->
acŸoff£t
) )

731 ifÐ'0' =ð
Ýt_¬g
[0] && 1 =ð
	`ssÿnf
(Ýt_¬g, "0X%x", &
Üic
->
acŸoff£t
) )

733 ifÐ1 =ð
	`ssÿnf
(
Ýt_¬g
, "%d", &
Üic
->
acŸoff£t
) )

735 
	`ex™
Ð
EXIT_FAILURE
 );

738 ifÐ
	`¡rÿ£cmp
Ð
tmp
, "serial" ) == 0 )

740 
Üic
->
acŸback’dcfg
 = oric->
acŸback’d
 = 
ACIA_TYPE_NONE
;

741 if(!
	`¡rÿ£cmp
("nÚe", 
Ýt_¬g
))

743 if(!
	`¡rÿ£cmp
("loÝback", 
Ýt_¬g
))

744 
Üic
->
acŸback’dcfg
 = oric->
acŸback’d
 = 
ACIA_TYPE_LOOPBACK
;

745 if(!
	`¡ºÿ£cmp
("modem", 
Ýt_¬g
, 5))

747 #ifdeà
BACKEND_MODEM


748 * 
p
 = 
	`¡rchr
(
Ýt_¬g
, ':');

749 
Üic
->
acŸback’dcfg
 = oric->
acŸback’d
 = 
ACIA_TYPE_MODEM
;

750 
Üic
->
acŸback’dcfgpÜt
 = 0;

751 
Üic
->
acŸback’dcfgdomaš
 = 4;

752 if(
p
) {

753 * 
p2
 = 
	`¡rchr
(
p
+1, ':');

754 ià(
p2
) {

756 ià(
	`¡rÿ£cmp
(
p2
+1, "ipv6")==0)

757 
Üic
->
acŸback’dcfgdomaš
 = 6;

758 *
p2
 = '\0';

759 
Üic
->
acŸback’dcfgpÜt
 = 
	`©oi
(
p
+1);

760 *
p2
 = ':';

762 
Üic
->
acŸback’dcfgpÜt
 = 
	`©oi
(
p
+1);

765 if(
Üic
->
acŸback’dcfgpÜt
 <= 0)

766 
Üic
->
acŸback’dcfgpÜt
 = 
ACIA_TYPE_MODEM_DEFAULT_PORT
;

771 #ifdeà
BACKEND_COM


772 
	`¡ºýy
(
Üic
->
acŸback’dÇme
, 
Ýt_¬g
, 
ACIA_BACKEND_NAME_LEN
);

773 
Üic
->
acŸback’dcfg
 = oric->
acŸback’d
 = 
ACIA_TYPE_COM
;

779 ifÐ
	`¡rÿ£cmp
Ð
tmp
, "vsynchack" ) == 0 )

781 ifÐ!
	`Ú_Ü_off
Ð
¬gv
[
i
-1], 
Ýt_¬g
, &
Üic
->
vsynchack
 ) ) 
	`ex™
Ð
EXIT_FAILURE
 );

785 ifÐ
	`¡rÿ£cmp
Ð
tmp
, "scanlines" ) == 0 )

787 ifÐ!
	`Ú_Ü_off
Ð
¬gv
[
i
-1], 
Ýt_¬g
, &
Üic
->
sÿÆšes
 ) ) 
	`ex™
Ð
EXIT_FAILURE
 );

793 
Ýt_ty³
 = 
¬gv
[
i
][1];

794 
Ýt_¬g
 = 
NULL
;

795 ià(
¬gv
[
i
][2])

796 
Ýt_¬g
 = &
¬gv
[
i
][2];

797 iàÐ
i
<(
¬gc
-1))

799 
Ýt_ty³
)

807 #ifdeà
__OPENGL_AVAILABLE__


810 
Ýt_¬g
 = 
¬gv
[
i
+1];

811 
i
++;

817  
Ýt_ty³
 )

820 ifÐ
Ýt_¬g
 )

822 if(Ð
	`¡rÿ£cmp
Ð
Ýt_¬g
, "atmos" ) == 0 ) ||

823 Ð
	`¡rÿ£cmp
Ð
Ýt_¬g
, "a" ) == 0 ))

825 
¡o
->
¡¬t_machše
 = 
MACH_ATMOS
;

826 
¡o
->
¡¬t_machše_£t
 = 
SDL_TRUE
;

829 if(Ð
	`¡rÿ£cmp
Ð
Ýt_¬g
, "oric1" ) == 0 ) ||

830 Ð
	`¡rÿ£cmp
Ð
Ýt_¬g
, "1" ) == 0 ))

832 
¡o
->
¡¬t_machše
 = 
MACH_ORIC1
;

833 
¡o
->
¡¬t_machše_£t
 = 
SDL_TRUE
;

836 ifÐ
	`¡rÿ£cmp
Ð
Ýt_¬g
, "o16k" ) == 0 )

838 
¡o
->
¡¬t_machše
 = 
MACH_ORIC1_16K
;

839 
¡o
->
¡¬t_machše_£t
 = 
SDL_TRUE
;

842 if(Ð
	`¡rÿ£cmp
Ð
Ýt_¬g
, "telestrat" ) == 0 ) ||

843 Ð
	`¡rÿ£cmp
Ð
Ýt_¬g
, "t" ) == 0 ))

845 
¡o
->
¡¬t_machše
 = 
MACH_TELESTRAT
;

846 
¡o
->
¡¬t_machše_£t
 = 
SDL_TRUE
;

849 if(Ð
	`¡rÿ£cmp
Ð
Ýt_¬g
, "pravetz" ) == 0 ) ||

850 Ð
	`¡rÿ£cmp
Ð
Ýt_¬g
, "pravetz8d" ) == 0 ) ||

851 Ð
	`¡rÿ£cmp
Ð
Ýt_¬g
, "p" ) == 0 ))

853 
¡o
->
¡¬t_machše
 = 
MACH_PRAVETZ
;

854 
¡o
->
¡¬t_machše_£t
 = 
SDL_TRUE
;

859 
	`”rÜ_´štf
( "Invalid machineype" );

860 
	`ä“
Ð
¡o
 );

861 
	`ex™
Ð
EXIT_FAILURE
 );

866 
SDL_boÞ
 
drÝ_through
 = 
SDL_FALSE
;

867 ifÐ
Ýt_¬g
 )

869 
	`d‘eù_image_ty³
(
Ýt_¬g
))

871 
IMG_ATMOS_MICRODISC
:

872 
IMG_ATMOS_JASMIN
:

873 
IMG_TELESTRAT_DISK
:

874 
IMG_PRAVETZ_DISK
:

875 
IMG_GUESS_MICRODISC
:

876 
	`´štf
("'%s' s“m tØb¨disk image.\n", 
Ýt_¬g
);

877 
drÝ_through
 = 
SDL_TRUE
;

880 
IMG_SNAPSHOT
:

881 
	`´štf
("'%s' s“m tØb¨¢­shÙ fže.\n", 
Ýt_¬g
);

882 
	`¡ºýy
Ð
¡o
->
¡¬t_¢­shÙ
, 
Ýt_¬g
, 1024);

883 
¡o
->
¡¬t_¢­shÙ
[1023] = 0;

886 
IMG_TAPE
:

888 
	`¡ºýy
Ð
¡o
->
¡¬t_³
, 
Ýt_¬g
, 1024 );

889 
¡o
->
¡¬t_³
[1023] = 0;

893 
	`”rÜ_´štf
( "Noape image specified" );

894 
	`ä“
Ð
¡o
 );

895 
	`ex™
Ð
EXIT_FAILURE
 );

898 ià(!
drÝ_through
)

903 ifÐ
Ýt_¬g
 )

905 
	`¡ºýy
Ð
¡o
->
¡¬t_disk
, 
Ýt_¬g
, 1024 );

906 
¡o
->
¡¬t_disk
[1023] = 0;

907 
	`d‘eù_image_ty³
(
¡o
->
¡¬t_disk
))

909 
IMG_ATMOS_MICRODISC
:

910 ià(!
¡o
->
¡¬t_machše_£t
è¡o->
¡¬t_machše
 = 
MACH_ATMOS
;

911 ià(!
¡o
->
¡¬t_diskty³_£t
è¡o->
¡¬t_diskty³
 = 
DRV_MICRODISC
;

914 
IMG_ATMOS_JASMIN
:

915 ià(!
¡o
->
¡¬t_machše_£t
è¡o->
¡¬t_machše
 = 
MACH_ATMOS
;

916 ià(!
¡o
->
¡¬t_diskty³_£t
è¡o->
¡¬t_diskty³
 = 
DRV_JASMIN
;

919 
IMG_TELESTRAT_DISK
:

920 ià(!
¡o
->
¡¬t_machše_£t
è¡o->
¡¬t_machše
 = 
MACH_TELESTRAT
;

921 ià(!
¡o
->
¡¬t_diskty³_£t
è¡o->
¡¬t_diskty³
 = 
DRV_MICRODISC
;

924 
IMG_PRAVETZ_DISK
:

925 ià(!
¡o
->
¡¬t_machše_£t
è¡o->
¡¬t_machše
 = 
MACH_PRAVETZ
;

926 ià(!
¡o
->
¡¬t_diskty³_£t
è¡o->
¡¬t_diskty³
 = 
DRV_PRAVETZ
;

929 
IMG_GUESS_MICRODISC
:

930 ià(!
¡o
->
¡¬t_diskty³_£t
è¡o->
¡¬t_diskty³
 = 
DRV_MICRODISC
;

933 
IMG_TAPE
:

934 
	`´štf
("'%s' s“m tØb¨³ image.\n", 
¡o
->
¡¬t_disk
);

935 
	`¡rýy
(
¡o
->
¡¬t_³
, sto->
¡¬t_disk
);

936 
¡o
->
¡¬t_disk
[0] = 0;

939 
IMG_SNAPSHOT
:

940 
	`´štf
("'%s' s“m tØb¨¢­shÙ fže.\n", 
Ýt_¬g
);

941 
	`¡ºýy
Ð
¡o
->
¡¬t_¢­shÙ
, 
Ýt_¬g
, 1024);

942 
¡o
->
¡¬t_¢­shÙ
[1023] = 0;

946 
	`”rÜ_´štf
( "No disk image specified" );

947 
	`ä“
Ð
¡o
 );

948 
	`ex™
Ð
EXIT_FAILURE
 );

953 ifÐ
Ýt_¬g
 )

955 if(Ð
	`¡rÿ£cmp
Ð
Ýt_¬g
, "microdisc" ) == 0 ) ||

956 Ð
	`¡rÿ£cmp
Ð
Ýt_¬g
, "m" ) == 0 ))

958 
¡o
->
¡¬t_diskty³
 = 
DRV_MICRODISC
;

959 
¡o
->
¡¬t_diskty³_£t
 = 
SDL_TRUE
;

962 if(Ð
	`¡rÿ£cmp
Ð
Ýt_¬g
, "jasmin" ) == 0 ) ||

963 Ð
	`¡rÿ£cmp
Ð
Ýt_¬g
, "j" ) == 0 ))

965 
¡o
->
¡¬t_diskty³
 = 
DRV_JASMIN
;

966 
¡o
->
¡¬t_diskty³_£t
 = 
SDL_TRUE
;

969 if(Ð
	`¡rÿ£cmp
Ð
Ýt_¬g
, "pravetz" ) == 0 ) ||

970 Ð
	`¡rÿ£cmp
Ð
Ýt_¬g
, "p" ) == 0 ))

972 
¡o
->
¡¬t_diskty³
 = 
DRV_PRAVETZ
;

973 
¡o
->
¡¬t_diskty³_£t
 = 
SDL_TRUE
;

976 if(Ð
	`¡rÿ£cmp
Ð
Ýt_¬g
, "none" ) == 0 ) ||

977 Ð
	`¡rÿ£cmp
Ð
Ýt_¬g
, "n" ) == 0 ))

979 
¡o
->
¡¬t_diskty³
 = 
DRV_NONE
;

980 
¡o
->
¡¬t_diskty³_£t
 = 
SDL_FALSE
;

985 
	`”rÜ_´štf
( "Invalid driveype" );

986 
	`ä“
Ð
¡o
 );

987 
	`ex™
Ð
EXIT_FAILURE
 );

991 ifÐ
Ýt_¬g
 )

993 ifÐ
¡o
->
¡¬t_syms_couÁ
 < 32 )

995 * 
Ãw_syms
 = 
	`¡rdup
Ð
Ýt_¬g
 );

996 ifÐ
NULL
 !ð
Ãw_syms
 )

997 
¡o
->
¡¬t_syms_fžes
[¡o->
¡¬t_syms_couÁ
++] = 
Ãw_syms
;

1000 
	`”rÜ_´štf
( "No symbols file specified" );

1001 
	`ä“
Ð
¡o
 );

1002 
	`ex™
Ð
EXIT_FAILURE
 );

1007 
fuÎsü“n
 = 
SDL_TRUE
;

1011 
fuÎsü“n
 = 
SDL_FALSE
;

1015 
¡o
->
¡¬t_debug
 = 
SDL_TRUE
;

1019 ifÐ
Ýt_¬g
 )

1021 
¡o
->
¡¬t_b»akpošt
 = 
Ýt_¬g
;

1025 
	`”rÜ_´štf
( "Breakpoint‡ddress or symbolƒxpected" );

1026 
	`ä“
Ð
¡o
 );

1027 
	`ex™
Ð
EXIT_FAILURE
 );

1031 #ifdeà
__OPENGL_AVAILABLE__


1033 ifÐ
Ýt_¬g
 )

1035 ifÐ
	`¡rÿ£cmp
Ð
Ýt_¬g
, "soá" ) =ð0 ) { 
¡o
->
¡¬t_»nd”mode
 = 
RENDERMODE_SW
; ; }

1036 ifÐ
	`¡rÿ£cmp
Ð
Ýt_¬g
, "Ý’gl" ) =ð0 ) { 
¡o
->
¡¬t_»nd”mode
 = 
RENDERMODE_GL
; ; }

1039 
	`”rÜ_´štf
( "Invalid„ender mode" );

1040 
	`ä“
Ð
¡o
 );

1041 
	`ex™
Ð
EXIT_FAILURE
 );

1046 
	`ä“
Ð
¡o
 );

1047 
	`u§ge
Ð
EXIT_SUCCESS
 );

1053 
	`d‘eù_image_ty³
(
¬gv
[
i
]))

1055 
IMG_SNAPSHOT
:

1056 
	`¡ºýy
Ð
¡o
->
¡¬t_¢­shÙ
, 
¬gv
[
i
], 1024);

1057 
¡o
->
¡¬t_¢­shÙ
[1023] = 0;

1060 
IMG_ATMOS_MICRODISC
:

1061 ià(!
¡o
->
¡¬t_machše_£t
è¡o->
¡¬t_machše
 = 
MACH_ATMOS
;

1062 ià(!
¡o
->
¡¬t_diskty³_£t
è¡o->
¡¬t_diskty³
 = 
DRV_MICRODISC
;

1063 
	`¡ºýy
Ð
¡o
->
¡¬t_disk
, 
¬gv
[
i
], 1024 );

1064 
¡o
->
¡¬t_disk
[1023] = 0;

1067 
IMG_ATMOS_JASMIN
:

1068 ià(!
¡o
->
¡¬t_machše_£t
è¡o->
¡¬t_machše
 = 
MACH_ATMOS
;

1069 ià(!
¡o
->
¡¬t_diskty³_£t
è¡o->
¡¬t_diskty³
 = 
DRV_JASMIN
;

1070 
	`¡ºýy
Ð
¡o
->
¡¬t_disk
, 
¬gv
[
i
], 1024 );

1071 
¡o
->
¡¬t_disk
[1023] = 0;

1074 
IMG_TELESTRAT_DISK
:

1075 ià(!
¡o
->
¡¬t_machše_£t
è¡o->
¡¬t_machše
 = 
MACH_TELESTRAT
;

1076 ià(!
¡o
->
¡¬t_diskty³_£t
è¡o->
¡¬t_diskty³
 = 
DRV_MICRODISC
;

1077 
	`¡ºýy
Ð
¡o
->
¡¬t_disk
, 
¬gv
[
i
], 1024 );

1078 
¡o
->
¡¬t_disk
[1023] = 0;

1081 
IMG_PRAVETZ_DISK
:

1082 ià(!
¡o
->
¡¬t_machše_£t
è¡o->
¡¬t_machše
 = 
MACH_PRAVETZ
;

1083 ià(!
¡o
->
¡¬t_diskty³_£t
è¡o->
¡¬t_diskty³
 = 
DRV_PRAVETZ
;

1084 
	`¡ºýy
Ð
¡o
->
¡¬t_disk
, 
¬gv
[
i
], 1024 );

1085 
¡o
->
¡¬t_disk
[1023] = 0;

1088 
IMG_GUESS_MICRODISC
:

1089 ià(!
¡o
->
¡¬t_diskty³_£t
è¡o->
¡¬t_diskty³
 = 
DRV_MICRODISC
;

1090 
	`¡ºýy
Ð
¡o
->
¡¬t_disk
, 
¬gv
[
i
], 1024 );

1091 
¡o
->
¡¬t_disk
[1023] = 0;

1094 
IMG_TAPE
:

1095 
	`¡ºýy
(
¡o
->
¡¬t_³
, 
¬gv
[
i
], 1024);

1096 
¡o
->
¡¬t_³
[1023] = 0;

1100 
	`ä“
Ð
¡o
 );

1101 
	`u§ge
Ð
EXIT_FAILURE
 );

1106 
	`lßd_diskroms
Ð
Üic
 );

1108 ifÐÐ
¡o
->
¡¬t_disk
[0] ) && ( sto->
¡¬t_diskty³
 =ð
DRV_NONE
 ) )

1109 
¡o
->
¡¬t_diskty³
 = 
DRV_MICRODISC
;

1111  
i
=0; i<8; i++ ) 
Ï¡äam‘imes
[i] = 0;

1112 
äam‘im—ve
 = 0;

1114 
	`£tov”þock
Ð
Üic
, 
NULL
, 0 );

1115 ifÐ!
	`š™_gui
Ð
Üic
, 
¡o
->
¡¬t_»nd”mode
 ) ) { 
	`ä“
Ð¡Ø);  
SDL_FALSE
; }

1116 ifÐ!
	`š™_fž”eque¡”
Ð
Üic
 ) ) { 
	`ä“
Ð
¡o
 );  
SDL_FALSE
; }

1117 ifÐ!
	`š™_msgbox
Ð
Üic
 ) ) { 
	`ä“
Ð
¡o
 );  
SDL_FALSE
; }

1118 
Üic
->
driv‘y³
 = 
¡o
->
¡¬t_diskty³
;

1119 ifÐ!
	`š™_uÏ
Ð
Üic
 ) ) { 
	`ä“
Ð
¡o
 );  
SDL_FALSE
; }

1120 ifÐ!
	`š™_joy
Ð
Üic
 ) ) { 
	`ä“
Ð
¡o
 );  
SDL_FALSE
; }

1121 ifÐ!
	`š™_machše
Ð
Üic
, 
¡o
->
¡¬t_machše
, 
SDL_TRUE
 ) ) { 
	`ä“
Ð¡Ø);  
SDL_FALSE
; }

1123 ifÐ
¡o
->
¡¬t_disk
[0] )

1125 
	`diskimage_lßd
Ð
Üic
, 
¡o
->
¡¬t_disk
, 0 );

1126 
Üic
->
driv‘y³
)

1128 
DRV_PRAVETZ
:

1129 
	`´avdiskboÙ
Ð
Üic
 );

1132 
DRV_JASMIN
:

1133 
Üic
->
auto_jasmš_»£t
 = 
SDL_TRUE
;

1137 ifÐ
¡o
->
¡¬t_³
[0] )

1139 ifÐ
	`³_lßd_p
Ð
Üic
, 
¡o
->
¡¬t_³
 ) )

1140 
	`queuekeys
( "CLOAD\"\"\x0d" );

1143 
	`mÚ_š™
Ð
Üic
 );

1144 ifÐ
¡o
->
¡¬t_syms
[0] )

1145 
	`mÚ_Ãw_symbÞs
Ð&
Üic
->
u£rsyms
, oric, 
¡o
->
¡¬t_syms
, 
SYM_BESTGUESS
, 
SDL_TRUE
, SDL_TRUE );

1147  
i
=0; i<
¡o
->
¡¬t_syms_couÁ
; i++ )

1149 ifÐ
NULL
!=
¡o
->
¡¬t_syms_fžes
[
i
] )

1151 
	`mÚ_Ãw_symbÞs
Ð&
Üic
->
u£rsyms
, oric, 
¡o
->
¡¬t_syms_fžes
[
i
], 
SYM_BESTGUESS
, 
SDL_TRUE
, SDL_TRUE );

1152 
	`ä“
(
¡o
->
¡¬t_syms_fžes
[
i
]);

1153 
¡o
->
¡¬t_syms_fžes
[
i
] = 
NULL
;

1156 
¡o
->
¡¬t_syms_couÁ
 = 0;

1158 ifÐ
¡o
->
¡¬t_b»akpošt
 )

1160 ifÐ
¡o
->
¡¬t_b»akpošt
[0] == ':' )

1162 
SDL_boÞ
 
Ãed»nd”
 = 
SDL_FALSE
;

1163 
bsbuf
[32];

1164 * 
â
 = 
¡o
->
¡¬t_b»akpošt
 + 1;

1165 
FILE
* 
f
 = 
	`fÝ’
Ð
â
, "rt" );

1166 ifÐ!
f
 )

1168 
	`”rÜ_´štf
( "Invalid breakpoint file" );

1169 
	`ä“
Ð
¡o
 );

1170  
SDL_FALSE
;

1172  !
	`ãof
Ð
f
 ) )

1174 * 
p
;

1175 ifÐ!
	`fg‘s
Ð
bsbuf
, 32, 
f
 ) ) ;

1176 
bsbuf
[31] = 0;

1177  
NULL
 !ð(
p
 = 
	`¡rchr
Ð
bsbuf
, '\r' )) ) *p = 0;

1178  
NULL
 !ð(
p
 = 
	`¡rchr
Ð
bsbuf
, '\n' )) ) *p = 0;

1179  
NULL
 !ð(
p
 = 
	`¡rchr
Ð
bsbuf
, '\t' )) ) *p = ' ';

1180 
p
 = 
bsbuf
;

1181  *
p
 && 
	`isws
( *p ) )…++;

1182 ifÐ*
p
 ) 
	`mÚ_cmd
Ð
bsbuf
, 
Üic
, &
Ãed»nd”
 );

1184 
	`fþo£
Ð
f
 );

1188 
i
 = 0;

1189 
addr
;

1190 ifÐ!
	`mÚ_g‘num
Ð
Üic
, &
addr
, 
¡o
->
¡¬t_b»akpošt
, &
i
, 
SDL_FALSE
, SDL_FALSE, SDL_FALSE, 
SDL_TRUE
 ) )

1192 
	`”rÜ_´štf
( "Invalid breakpoint" );

1193 
	`ä“
Ð
¡o
 );

1194  
SDL_FALSE
;

1197 
Üic
->
ýu
.
b»akpošts
[0] = 
addr
;

1198 
Üic
->
ýu
.
ªybp
 = 
SDL_TRUE
;

1202 ifÐ
¡o
->
¡¬t_¢­shÙ
[0] )

1203 
	`lßd_¢­shÙ
Ð
Üic
, 
¡o
->
¡¬t_¢­shÙ
 );

1205 ifÐ
¡o
->
¡¬t_debug
 )

1206 
	`£‹mumode
Ð
Üic
, 
NULL
, 
EM_DEBUG
 );

1208 
	`ä“
Ð
¡o
 );

1209  
SDL_TRUE
;

1210 
	}
}

1212 
	$shut
Ð
machše
 *
Üic
 )

1214 ifÐ
vidÿp
 ) 
	`avi_þo£
( &vidcap );

1215 #ià
	`defšed
(
DEBUG_CPU_TRACE
) && DEBUG_CPU_TRACE > 0

1216 
	`dump_ýuŒaû
(
Üic
);

1218 ifÐ
Üic
 )

1220 
	`shut_machše
Ð
Üic
 );

1221 
	`shut_joy
Ð
Üic
 );

1222 
	`shut_uÏ
Ð
Üic
 );

1223 
	`mÚ_shut
Ð
Üic
 );

1224 
	`shut_fž”eque¡”
Ð
Üic
 );

1225 
	`shut_msgbox
Ð
Üic
 );

1226 
	`shut_gui
Ð
Üic
 );

1228 ifÐ
Ãed_sdl_qu™
 ) 
	`SDL_COMPAT_Qu™
();

1229 
	}
}

1231 
	$äam–oÝ_ov”þock
Ð
machše
 *
Üic
, 
SDL_boÞ
 *
äamedÚe
, SDL_boÞ *
Ãed»nd”
 )

1233 
š¡loÝ
, 
š¡cyþes
;

1235  ( !(*
äamedÚe
èè&& ( !(*
Ãed»nd”
) ) )

1237  
Üic
->
ýu
.
¿¡”cyþes
 > 0 )

1240  
š¡loÝ
=0, 
š¡cyþes
=0; in¡loÝ < 
Üic
->
ov”þockmuÉ
; instloop++ )

1242 ifÐ
	`m6502_£t_icyþes
Ð&
Üic
->
ýu
, 
SDL_TRUE
, 
mÚ_bpmsg
 ) )

1245 
	`£‹mumode
Ð
Üic
, 
NULL
, 
EM_DEBUG
 );

1246 *
Ãed»nd”
 = 
SDL_TRUE
;

1250 
š¡cyþes
 +ð
Üic
->
ýu
.
icyþes
;

1251 
	`³_·tches
Ð
Üic
 );

1253 ifÐ
š¡loÝ
 < (
Üic
->
ov”þockmuÉ
-1) )

1255 ià(
	`m6502_š¡
Ð&
Üic
->
ýu
 ))

1261 
š¡cyþes
 >>ð
Üic
->
ov”þockshiá
;

1264 
	`vŸ_þock
Ð&
Üic
->
vŸ
, 
š¡cyþes
 );

1265 
	`ay_ticktock
Ð&
Üic
->
ay
, 
š¡cyþes
 );

1266 if((
Üic
->
driv‘y³
 =ð
DRV_MICRODISC
è|| (Üic->driv‘y³ =ð
DRV_JASMIN
)è
	`wd17xx_ticktock
Ð&Üic->
wddisk
, 
š¡cyþes
 );

1267 ifÐ
Üic
->
ty³
 =ð
MACH_TELESTRAT
 )

1269 
	`vŸ_þock
Ð&
Üic
->
‹Ë_vŸ
, 
š¡cyþes
 );

1271 ifÐ
Üic
->
acŸback’d
 )

1272 
	`acŸ_þock
Ð&
Üic
->
‹Ë_acŸ
, 
š¡cyþes
 );

1274 
Üic
->
ýu
.
¿¡”cyþes
 -ð
š¡cyþes
;

1278 ifÐ
Üic
->
emu_mode
 !ð
EM_RUNNING
 ) ;

1279 ifÐ
	`m6502_š¡
Ð&
Üic
->
ýu
 ) )

1282 
	`mÚ_´štf_above
Ð"Opcod%02Xƒxecu‹d‡ˆ%04X", 
Üic
->
ýu
.
ÿlcÝ
, oric->ýu.
Ï¡pc
 );

1283 
	`£‹mumode
Ð
Üic
, 
NULL
, 
EM_DEBUG
 );

1284 *
Ãed»nd”
 = 
SDL_TRUE
;

1289 ifÐ
Üic
->
ýu
.
¿¡”cyþes
 <= 0 )

1291 *
äamedÚe
 = 
	`uÏ_dÜa¡”
Ð
Üic
 );

1292 
Üic
->
ýu
.
¿¡”cyþes
 +ðÜic->
cyþe¥”¿¡”
;

1295 
	}
}

1297 
	$äam–oÝ_nÜm®
Ð
machše
 *
Üic
, 
SDL_boÞ
 *
äamedÚe
, SDL_boÞ *
Ãed»nd”
 )

1299  ( !(*
äamedÚe
èè&& ( !(*
Ãed»nd”
) ) )

1301  
Üic
->
ýu
.
¿¡”cyþes
 > 0 )

1303 ifÐ
	`m6502_£t_icyþes
Ð&
Üic
->
ýu
, 
SDL_TRUE
, 
mÚ_bpmsg
 ) )

1306 
	`£‹mumode
Ð
Üic
, 
NULL
, 
EM_DEBUG
 );

1307 *
Ãed»nd”
 = 
SDL_TRUE
;

1311 
	`³_·tches
Ð
Üic
 );

1312 
	`vŸ_þock
Ð&
Üic
->
vŸ
, oric->
ýu
.
icyþes
 );

1313 
	`ay_ticktock
Ð&
Üic
->
ay
, oric->
ýu
.
icyþes
 );

1314 if((
Üic
->
driv‘y³
 =ð
DRV_MICRODISC
è|| (Üic->driv‘y³ =ð
DRV_JASMIN
)è
	`wd17xx_ticktock
Ð&Üic->
wddisk
, oric->
ýu
.
icyþes
 );

1315 ifÐ
Üic
->
ty³
 =ð
MACH_TELESTRAT
 )

1317 
	`vŸ_þock
Ð&
Üic
->
‹Ë_vŸ
, oric->
ýu
.
icyþes
 );

1319 ifÐ
Üic
->
acŸback’d
 )

1320 
	`acŸ_þock
Ð&
Üic
->
‹Ë_acŸ
, oric->
ýu
.
icyþes
 );

1322 
Üic
->
ýu
.
¿¡”cyþes
 -ðÜic->ýu.
icyþes
;

1323 ifÐ
	`m6502_š¡
Ð&
Üic
->
ýu
 ) )

1326 
	`mÚ_´štf_above
Ð"Opcod%02Xƒxecu‹d‡ˆ%04X", 
Üic
->
ýu
.
ÿlcÝ
, oric->ýu.
Ï¡pc
 );

1327 
	`£‹mumode
Ð
Üic
, 
NULL
, 
EM_DEBUG
 );

1328 *
Ãed»nd”
 = 
SDL_TRUE
;

1333 ifÐ
Üic
->
ýu
.
¿¡”cyþes
 <= 0 )

1335 *
äamedÚe
 = 
	`uÏ_dÜa¡”
Ð
Üic
 );

1336 
Üic
->
ýu
.
¿¡”cyþes
 +ðÜic->
cyþe¥”¿¡”
;

1339 
	}
}

1342 
	$Úû_³r_äame
Ð
machše
 *
Üic
 )

1344 
i
;

1346 ifÐ
Üic
->
diskauto§ve
 )

1348  
i
=0; i<4; i++ )

1350 ifÐÐ
Üic
->
wddisk
.
disk
[
i
] ) && ( oric->wddisk.disk[i]->
modif›d
 ) )

1352 
Üic
->
wddisk
.
disk
[
i
]->
modif›d_time
++;

1353 ifÐ
Üic
->
wddisk
.
disk
[
i
]->
modif›d_time
 >= 20 )

1355 
	`diskimage_§ve
Ð
Üic
, oric->
wddisk
.
disk
[
i
]->
fž’ame
, i );

1360 
	}
}

1362 
	$maš
Ð
¬gc
, *
¬gv
[] )

1364 
machše
 
Üic
;

1365 
SDL_boÞ
 
isš™
;

1367 #ifdeà
_MSC_VER


1368 
	`_C¹S‘DbgFÏg
(
_CRTDBG_ALLOC_MEM_DF
 | 
_CRTDBG_LEAK_CHECK_DF
);

1372 #iâdeà
__MORPHOS__


1373 
	`pu‹nv
("SDL_VIDEO_CENTERED=center");

1376 
	`mem£t
(&
Üic
, 0, (oric));

1380 #ifdeà
__APPLE__


1381 
CFBundËRef
 
mašBundË
 = 
	`CFBundËG‘MašBundË
();

1382 
CFURLRef
 
»sourûsURL
 = 
	`CFBundËCÝyResourûsDœeùÜyURL
(
mašBundË
);

1383 
·th
[
PATH_MAX
];

1384 ià(!
	`CFURLG‘FžeSy¡emR•»£Á©iÚ
(
»sourûsURL
, 
TRUE
, (
UIÁ8
 *)
·th
, 
PATH_MAX
))

1388 
	`CFR–—£
(
»sourûsURL
);

1391 
	`¡rÿt
(
·th
, "/../../..");

1392 
	`chdœ
(
·th
);

1396 ifÐÐ
isš™
 = 
	`š™
Ð&
Üic
, 
¬gc
, 
¬gv
 ) ) )

1398 
Ušt64
 
Ãxtäame_us
;

1399 
Ušt32
 
Ãxtäame_ms
, 
now
=0, 
th’
;

1400 
SDL_boÞ
 
dÚe
, 
Ãed»nd”
, 
äamedÚe
;

1401 
Sšt32
 
i
;

1403 
now
 = 
	`SDL_G‘Ticks
();

1404 
Ãxtäame_ms
 = 
now
;

1405 
Ãxtäame_us
 = ((
Ušt64
)
Ãxtäame_ms
)*1000;

1407 
dÚe
 = 
SDL_FALSE
;

1408 
Ãed»nd”
 = 
SDL_TRUE
;

1409 
äamedÚe
 = 
SDL_FALSE
;

1411 if(
lßd_keym­
)

1413 
	`lßd_keybßrd_m­pšg
Ð&
Üic
, 
keym­_·th
 );

1414 
lßd_keym­
 = 
SDL_FALSE
;

1417  !
dÚe
 )

1419 
SDL_Ev’t
 
ev’t
;

1421 ifÐ
Üic
.
emu_mode
 =ð
EM_PLEASEQUIT
 )

1424 ifÐ
Üic
.
emu_mode
 =ð
EM_RUNNING
 )

1426 ifÐ
Üic
.
ov”þockmuÉ
==1 )

1427 
	`äam–oÝ_nÜm®
Ð&
Üic
, &
äamedÚe
, &
Ãed»nd”
 );

1429 
	`äam–oÝ_ov”þock
Ð&
Üic
, &
äamedÚe
, &
Ãed»nd”
 );

1431 
	`ay_uÆockaudio
Ð&
Üic
.
ay
 );

1433 ifÐ
äamedÚe
 )

1435 
Ãxtäame_us
 +ð
Üic
.
vid_äeq
 ? 20000LL : 16667LL;

1436 
Ãxtäame_ms
 = (
Ušt32
)(
Ãxtäame_us
/1000LL);

1438 ià(
w¬p¥“d
)

1440 ià((
Üic
.
äames
&3)==0)

1441 
Ãed»nd”
 = 
SDL_TRUE
;

1445 
Ãed»nd”
 = 
SDL_TRUE
;

1449 ifÐ
Ãed»nd”
 )

1451 
	`»nd”
Ð&
Üic
 );

1452 
Ãed»nd”
 = 
SDL_FALSE
;

1455 ifÐ
äamedÚe
 )

1457 
	`Úû_³r_äame
Ð&
Üic
 );

1459 
th’
 = 
now
;

1460 
now
 = 
	`SDL_G‘Ticks
();

1462 
äam‘im—ve
 = 0;

1463  
i
=(
FRAMES_TO_AVERAGE
-1); i>0; i-- )

1465 
Ï¡äam‘imes
[
i
] =†astframetimes[i-1];

1466 
äam‘im—ve
 +ð
Ï¡äam‘imes
[
i
];

1468 
Ï¡äam‘imes
[0] = 
now
-
th’
;

1469 
äam‘im—ve
 = (äam‘im—ve+
Ï¡äam‘imes
[0])/
FRAMES_TO_AVERAGE
;

1471 ià(
w¬p¥“d
)

1473 
Ãxtäame_ms
 = 
now
;

1474 
Ãxtäame_us
 = ((
Ušt64
)
Ãxtäame_ms
)*1000;

1478 ià(
now
 > 
Ãxtäame_ms
)

1480 
Ãxtäame_ms
 = 
now
;

1481 
Ãxtäame_us
 = ((
Ušt64
)
Ãxtäame_ms
)*1000;

1485 
	`SDL_D–ay
(
Ãxtäame_ms
-
now
);

1488 
äamedÚe
 = 
SDL_FALSE
;

1491 ifÐ!
	`SDL_PÞlEv’t
Ð&
ev’t
 ) ) ;

1495 
	`ay_uÆockaudio
Ð&
Üic
.
ay
 );

1496 ifÐ
Ãed»nd”
 )

1498 
	`»nd”
Ð&
Üic
 );

1499 
Ãed»nd”
 = 
SDL_FALSE
;

1501 ifÐ!
	`SDL_Wa™Ev’t
Ð&
ev’t
 ) ) ;

1505  
ev’t
.
ty³
 )

1507 
SDL_COMPAT_ACTIVEEVENT
:

1509 if(
	`SDL_COMPAT_IsAµAùive
(&
ev’t
))

1511 
Üic
.
	`shut_»nd”
(&oric);

1512 
Üic
.
	`š™_»nd”
(&oric);

1513 
Ãed»nd”
 = 
SDL_TRUE
;

1517 
SDL_QUIT
:

1518 
dÚe
 = 
SDL_TRUE
;

1522  
Üic
.
emu_mode
 )

1524 
EM_MENU
:

1525 
dÚe
 |ð
	`m’u_ev’t
Ð&
ev’t
, &
Üic
, &
Ãed»nd”
 );

1528 
EM_RUNNING
:

1529 
dÚe
 |ð
	`emu_ev’t
Ð&
ev’t
, &
Üic
, &
Ãed»nd”
 );

1532 
EM_DEBUG
:

1533 
dÚe
 |ð
	`mÚ_ev’t
Ð&
ev’t
, &
Üic
, &
Ãed»nd”
 );

1537 ià(
Üic
.
show_keybßrd
)

1538 
	`keybßrd_ev’t
Ð&
ev’t
, &
Üic
, &
Ãed»nd”
 );

1540 }  
	`SDL_PÞlEv’t
Ð&
ev’t
 ) );

1542 
	`ay_uÆockaudio
Ð&
Üic
.
ay
 );

1544 
	`shut
Ð&
Üic
 );

1546  
isš™
 ? 
EXIT_SUCCESS
 : 
EXIT_FAILURE
;

1547 
	}
}

	@main.h

21 
SDL_boÞ
 
»ad_cÚfig_¡ršg
Ð*
buf
, *
tok’
, *
de¡
, 
Sšt32
 
maxËn
 );

22 
SDL_boÞ
 
»ad_cÚfig_boÞ
Ð*
buf
, *
tok’
, SDL_boÞ *
de¡
 );

23 
SDL_boÞ
 
»ad_cÚfig_ÝtiÚ
Ð*
buf
, *
tok’
, 
Sšt32
 *
de¡
, **
ÝtiÚs
 );

24 
SDL_boÞ
 
»ad_cÚfig_št
Ð*
buf
, *
tok’
, *
de¡
, 
mš
, 
max
 );

	@monitor.c

22 
	#MAX_CONS_INPUT
 127

23 
	#MAX_ASM_INPUT
 36

	)

24 
	#CONS_WIDTH
 46

25 

	)

26 
	~<¡dlib.h
>

27 
	~<¡dio.h
>

28 
	~<¡ršg.h
>

29 
	~<¡d¬g.h
>

30 
	~<ùy³.h
>

32 
	~"sy¡em.h
"

33 #undeà
REG_PC


34 
	#REG_PC
 
_REG_PC


	)

35 
	~"6502.h
"

36 
	~"vŸ.h
"

37 
	~"8912.h
"

38 
	~"gui.h
"

39 
	~"disk.h
"

40 
	~"mÚ™Ü.h
"

41 
	~"6551.h
"

42 
	~"machše.h
"

43 
	~"uÏ.h
"

44 
	~"³.h
"

45 
	~"¢­shÙ.h
"

47 
	#LOG_DEBUG
 0

	)

49 #ià
LOG_DEBUG


50 #ià
defšed
(
__amigaos4__
è|| defšed(
__MORPHOS__
)

51 *
	gdebug_logÇme
 = "RAM:debug.log";

53 *
	gdebug_logÇme
 = "debug_log.txt";

55 
FILE
 *
	gdebug_logfže
 = 
NULL
;

58 
	sdisšf


60 *
	mÇme
;

61 
	mamode
;

64 
	sasmšf


66 *
	mÇme
;

67 
	mimp
, 
	mimm
, 
	mzp
, 
	mzpx
, 
	mzpy
, 
	mabs
, 
	mabx
, 
	maby
, 
	mzix
, 
	mziy
, 
	m»l
, 
	mšd
;

70 
	sþick


72 
	mx
, 
	my
, 
	mtime
;

75 
þick
 
	gËáþick
[2];

77 
‹xtzÚe
 *
tz
[];

78 
v¥tmp
[];

79 
¢­·th
[], 
fž‘mp
[];

80 
SDL_boÞ
 
»äesh¡©us
;

82 
	gdi¡mp
[128];

83 
	gdi§ddrs
[10];

84 
	gibuf
[128], 
	gÏ¡cmd
;

85 
	ghi¡Üy
[10][128];

86 
	gž’
, 
	gžoff
=0, 
	gcursx
, 
	ghi¡u
=0, 
	ghi¡p
=-1;

87 
	gmÚ_addr
, 
	gmÚ_asmmode
 = 
SDL_FALSE
;

88 
SDL_boÞ
 
	gkshiáed
 = 
SDL_FALSE
, 
	gupd©•»v›w
 = SDL_FALSE;

89 
	gh–pcouÁ
=0;

91 
symbÞbË
 
	gdeçuÉsyms
;

93 
	gmÚ_bpmsg
[80];

95 
SDL_boÞ
 
	gmw_¥l™
 = 
SDL_FALSE
;

96 
	gmw_which
 = 0;

97 
	gmw_addr
[2];

98 
	gmw_mode
=0, 
	gmw_koffs
=0;

99 
	gmw_ibuf
[8];

100 
	gmw©ch_Þd
[65536];

101 
SDL_boÞ
 
	gmw©ch_Þdv®id
 = 
SDL_FALSE
;

102 
m6502
 
	gýu_Þd
;

103 
	gvid¿¡”_Þd
, 
	gäames_Þd
;

104 
SDL_boÞ
 
	gýu_Þdv®id
 = 
SDL_FALSE
;

105 
ay8912
 
	gay_Þd
;

106 
SDL_boÞ
 
	gay_Þdv®id
 = 
SDL_FALSE
;

107 
vŸ
 
	gvŸ_Þd
;

108 
SDL_boÞ
 
	gvŸ_Þdv®id
 = 
SDL_FALSE
;

109 
vŸ
 
	gvŸ2_Þd
;

110 
SDL_boÞ
 
	gvŸ2_Þdv®id
 = 
SDL_FALSE
;

111 
SDL_boÞ
 
	gmodif›d
 = 
SDL_FALSE
;

114 
msym
 
	gdefsym_‹Ë
[] = { { 0x0300, 0, "VIA_IORB" , "VIA_IORB" , "VIA_IORB" },

159 
msym
 
	gdefsym_©mos
[] = { { 0x0300, 0, "VIA_IORB" , "VIA_IORB" , "VIA_IORB" },

175 { 0xc000, 
SYMF_ROMDIS0
, "ROMStart" , "ROMStart" , "ROMStart" },

176 { 0xc000, 
SYMF_ROMDIS1
, "Overlay" , "Overlay" , "Overlay" } };

180 
	mMSHOW_VIA
=0,

181 
	mMSHOW_VIA2
,

182 
	mMSHOW_AY
,

183 
	mMSHOW_DISK
,

184 
	mMSHOW_LAST


189 
	mCSHOW_CONSOLE
=0,

190 
	mCSHOW_DEBUG
,

191 
	mCSHOW_MWATCH
,

192 
	mCSHOW_LAST


195 
	gmshow
, 
	gcshow
;

199 
	mREG_A
=0,

200 
	mREG_X
,

201 
	mREG_Y
,

202 
	mREG_PC
,

203 
	mREG_SP
,

204 
	mREG_VIA_PCR
,

205 
	mREG_VIA_ACR
,

206 
	mREG_VIA_SR
,

207 
	mREG_VIA_IFR
,

208 
	mREG_VIA_IER
,

209 
	mREG_VIA_IRA
,

210 
	mREG_VIA_ORA
,

211 
	mREG_VIA_DDRA
,

212 
	mREG_VIA_IRB
,

213 
	mREG_VIA_ORB
,

214 
	mREG_VIA_DDRB
,

215 
	mREG_VIA_T1L
,

216 
	mREG_VIA_T1C
,

217 
	mREG_VIA_T2L
,

218 
	mREG_VIA_T2C
,

219 
	mREG_VIA_CA1
,

220 
	mREG_VIA_CA2
,

221 
	mREG_VIA_CB1
,

222 
	mREG_VIA_CB2


227 
	mAM_IMP
=0,

228 
	mAM_IMM
,

229 
	mAM_ZP
,

230 
	mAM_ZPX
,

231 
	mAM_ZPY
,

232 
	mAM_ABS
,

233 
	mAM_ABX
,

234 
	mAM_ABY
,

235 
	mAM_ZIX
,

236 
	mAM_ZIY
,

237 
	mAM_REL
,

238 
	mAM_IND


241 
	#AMF_IMP
 (1<<
AM_IMP
)

	)

242 
	#AMF_IMM
 (1<<
AM_IMM
)

	)

243 
	#AMF_ZP
 (1<<
AM_ZP
)

	)

244 
	#AMF_ZPX
 (1<<
AM_ZPX
)

	)

245 
	#AMF_ZPY
 (1<<
AM_ZPY
)

	)

246 
	#AMF_ABS
 (1<<
AM_ABS
)

	)

247 
	#AMF_ABX
 (1<<
AM_ABX
)

	)

248 
	#AMF_ABY
 (1<<
AM_ABY
)

	)

249 
	#AMF_ZIX
 (1<<
AM_ZIX
)

	)

250 
	#AMF_ZIY
 (1<<
AM_ZIY
)

	)

251 
	#AMF_REL
 (1<<
AM_REL
)

	)

252 
	#AMF_IND
 (1<<
AM_IND
)

	)

255 
asmšf
 
	gasmb
[] = { { "BRK", 0x00, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1 },

336 { 
NULL
, } };

338 
disšf
 
	gdi¡ab
[] = { { "BRK", 
AM_IMM
 },

339 { "ORA", 
AM_ZIX
 },

340 { "JAM", 
AM_IMP
 },

341 { "SLO", 
AM_ZIX
 },

342 { "DOP", 
AM_ZP
 },

343 { "ORA", 
AM_ZP
 },

344 { "ASL", 
AM_ZP
 },

345 { "SLO", 
AM_ZP
 },

346 { "PHP", 
AM_IMP
 },

347 { "ORA", 
AM_IMM
 },

348 { "ASL", 
AM_IMP
 },

349 { "ANC", 
AM_IMM
 },

350 { "TOP", 
AM_IMP
 },

351 { "ORA", 
AM_ABS
 },

352 { "ASL", 
AM_ABS
 },

353 { "SLO", 
AM_ABS
 },

354 { "BPL", 
AM_REL
 },

355 { "ORA", 
AM_ZIY
 },

356 { "JAM", 
AM_IMP
 },

357 { "SLO", 
AM_ZIY
 },

358 { "DOP", 
AM_ZPX
 },

359 { "ORA", 
AM_ZPX
 },

360 { "ASL", 
AM_ZPX
 },

361 { "SLO", 
AM_ZPX
 },

362 { "CLC", 
AM_IMP
 },

363 { "ORA", 
AM_ABY
 },

364 { "NOP", 
AM_IMP
 },

365 { "SLO", 
AM_ABY
 },

366 { "TOP", 
AM_ABX
 },

367 { "ORA", 
AM_ABX
 },

368 { "ASL", 
AM_ABX
 },

369 { "SLO", 
AM_IMP
 },

370 { "JSR", 
AM_ABS
 },

371 { "AND", 
AM_ZIX
 },

372 { "JAM", 
AM_IMP
 },

373 { "RLA", 
AM_ZIX
 },

374 { "BIT", 
AM_ZP
 },

375 { "AND", 
AM_ZP
 },

376 { "ROL", 
AM_ZP
 },

377 { "RLA", 
AM_ZP
 },

378 { "PLP", 
AM_IMP
 },

379 { "AND", 
AM_IMM
 },

380 { "ROL", 
AM_IMP
 },

381 { "ANC", 
AM_IMP
 },

382 { "BIT", 
AM_ABS
 },

383 { "AND", 
AM_ABS
 },

384 { "ROL", 
AM_ABS
 },

385 { "RLA", 
AM_ABS
 },

386 { "BMI", 
AM_REL
 },

387 { "AND", 
AM_ZIY
 },

388 { "JAM", 
AM_IMP
 },

389 { "RLA", 
AM_ZIY
 },

390 { "DOP", 
AM_ZPX
 },

391 { "AND", 
AM_ZPX
 },

392 { "ROL", 
AM_ZPX
 },

393 { "RLA", 
AM_ZPX
 },

394 { "SEC", 
AM_IMP
 },

395 { "AND", 
AM_ABY
 },

396 { "NOP", 
AM_IMP
 },

397 { "RLA", 
AM_ABY
 },

398 { "TOP", 
AM_ABX
 },

399 { "AND", 
AM_ABX
 },

400 { "ROL", 
AM_ABX
 },

401 { "RLA", 
AM_ABX
 },

402 { "RTI", 
AM_IMP
 },

403 { "EOR", 
AM_ZIX
 },

404 { "JAM", 
AM_IMP
 },

405 { "SRE", 
AM_ZIX
 },

406 { "DOP", 
AM_ZP
 },

407 { "EOR", 
AM_ZP
 },

408 { "LSR", 
AM_ZP
 },

409 { "SRE", 
AM_ZP
 },

410 { "PHA", 
AM_IMP
 },

411 { "EOR", 
AM_IMM
 },

412 { "LSR", 
AM_IMP
 },

413 { "ALR", 
AM_IMM
 },

414 { "JMP", 
AM_ABS
 },

415 { "EOR", 
AM_ABS
 },

416 { "LSR", 
AM_ABS
 },

417 { "SRE", 
AM_ABS
 },

418 { "BVC", 
AM_REL
 },

419 { "EOR", 
AM_ZIY
 },

420 { "JAM", 
AM_IMP
 },

421 { "SRE", 
AM_ZIY
 },

422 { "DOP", 
AM_ZPX
 },

423 { "EOR", 
AM_ZPX
 },

424 { "LSR", 
AM_ZPX
 },

425 { "SRE", 
AM_ZPX
 },

426 { "CLI", 
AM_IMP
 },

427 { "EOR", 
AM_ABY
 },

428 { "NOP", 
AM_IMP
 },

429 { "SRE", 
AM_ABY
 },

430 { "TOP", 
AM_ABX
 },

431 { "EOR", 
AM_ABX
 },

432 { "LSR", 
AM_ABX
 },

433 { "SRE", 
AM_ABX
 },

434 { "RTS", 
AM_IMP
 },

435 { "ADC", 
AM_ZIX
 },

436 { "JAM", 
AM_IMP
 },

437 { "RRA", 
AM_ZIX
 },

438 { "DOP", 
AM_IMP
 },

439 { "ADC", 
AM_ZP
 },

440 { "ROR", 
AM_ZP
 },

441 { "RRA", 
AM_ZP
 },

442 { "PLA", 
AM_IMP
 },

443 { "ADC", 
AM_IMM
 },

444 { "ROR", 
AM_IMP
 },

445 { "ARR", 
AM_IMM
 },

446 { "JMP", 
AM_IND
 },

447 { "ADC", 
AM_ABS
 },

448 { "ROR", 
AM_ABS
 },

449 { "RRA", 
AM_ABS
 },

450 { "BVS", 
AM_REL
 },

451 { "ADC", 
AM_ZIY
 },

452 { "JAM", 
AM_IMP
 },

453 { "RRA", 
AM_ZIY
 },

454 { "DOP", 
AM_ZPX
 },

455 { "ADC", 
AM_ZPX
 },

456 { "ROR", 
AM_ZPX
 },

457 { "RRA", 
AM_ZPX
 },

458 { "SEI", 
AM_IMP
 },

459 { "ADC", 
AM_ABY
 },

460 { "NOP", 
AM_IMP
 },

461 { "RRA", 
AM_ABY
 },

462 { "TOP", 
AM_ABX
 },

463 { "ADC", 
AM_ABX
 },

464 { "ROR", 
AM_ABX
 },

465 { "RRA", 
AM_ABX
 },

466 { "DOP", 
AM_IMM
 },

467 { "STA", 
AM_ZIX
 },

468 { "DOP", 
AM_IMM
 },

469 { "SAX", 
AM_ZIX
 },

470 { "STY", 
AM_ZP
 },

471 { "STA", 
AM_ZP
 },

472 { "STX", 
AM_ZP
 },

473 { "SAX", 
AM_ZP
 },

474 { "DEY", 
AM_IMP
 },

475 { "DOP", 
AM_IMM
 },

476 { "TXA", 
AM_IMP
 },

477 { "XAA", 
AM_IMM
 },

478 { "STY", 
AM_ABS
 },

479 { "STA", 
AM_ABS
 },

480 { "STX", 
AM_ABS
 },

481 { "SAX", 
AM_ABS
 },

482 { "BCC", 
AM_REL
 },

483 { "STA", 
AM_ZIY
 },

484 { "JAM", 
AM_IMP
 },

485 { "AHX", 
AM_ZIY
 },

486 { "STY", 
AM_ZPX
 },

487 { "STA", 
AM_ZPX
 },

488 { "STX", 
AM_ZPY
 },

489 { "SAX", 
AM_ZPY
 },

490 { "TYA", 
AM_IMP
 },

491 { "STA", 
AM_ABY
 },

492 { "TXS", 
AM_IMP
 },

493 { "TAS", 
AM_IMM
 },

494 { "SHY", 
AM_ABY
 },

495 { "STA", 
AM_ABX
 },

496 { "SHX", 
AM_ABX
 },

497 { "AHX", 
AM_ABY
 },

498 { "LDY", 
AM_IMM
 },

499 { "LDA", 
AM_ZIX
 },

500 { "LDX", 
AM_IMM
 },

501 { "LAX", 
AM_ZIX
 },

502 { "LDY", 
AM_ZP
 },

503 { "LDA", 
AM_ZP
 },

504 { "LDX", 
AM_ZP
 },

505 { "LAX", 
AM_ZP
 },

506 { "TAY", 
AM_IMP
 },

507 { "LDA", 
AM_IMM
 },

508 { "TAX", 
AM_IMP
 },

509 { "LAX", 
AM_IMM
 },

510 { "LDY", 
AM_ABS
 },

511 { "LDA", 
AM_ABS
 },

512 { "LDX", 
AM_ABS
 },

513 { "LAX", 
AM_ABS
 },

514 { "BCS", 
AM_REL
 },

515 { "LDA", 
AM_ZIY
 },

516 { "JAM", 
AM_IMP
 },

517 { "LAX", 
AM_ZIY
 },

518 { "LDY", 
AM_ZPX
 },

519 { "LDA", 
AM_ZPX
 },

520 { "LDX", 
AM_ZPY
 },

521 { "LAX", 
AM_ZPY
 },

522 { "CLV", 
AM_IMP
 },

523 { "LDA", 
AM_ABY
 },

524 { "TSX", 
AM_IMP
 },

525 { "LAS", 
AM_IMP
 },

526 { "LDY", 
AM_ABX
 },

527 { "LDA", 
AM_ABX
 },

528 { "LDX", 
AM_ABY
 },

529 { "LAX", 
AM_ABY
 },

530 { "CPY", 
AM_IMM
 },

531 { "CMP", 
AM_ZIX
 },

532 { "DOP", 
AM_IMP
 },

533 { "DCP", 
AM_ZIX
 },

534 { "CPY", 
AM_ZP
 },

535 { "CMP", 
AM_ZP
 },

536 { "DEC", 
AM_ZP
 },

537 { "DCP", 
AM_ZP
 },

538 { "INY", 
AM_IMP
 },

539 { "CMP", 
AM_IMM
 },

540 { "DEX", 
AM_IMP
 },

541 { "AXS", 
AM_IMM
 },

542 { "CPY", 
AM_ABS
 },

543 { "CMP", 
AM_ABS
 },

544 { "DEC", 
AM_ABS
 },

545 { "DCP", 
AM_ABS
 },

546 { "BNE", 
AM_REL
 },

547 { "CMP", 
AM_ZIY
 },

548 { "JAM", 
AM_IMP
 },

549 { "DCP", 
AM_ZIY
 },

550 { "DOP", 
AM_ZPX
 },

551 { "CMP", 
AM_ZPX
 },

552 { "DEC", 
AM_ZPX
 },

553 { "DCP", 
AM_ZPX
 },

554 { "CLD", 
AM_IMP
 },

555 { "CMP", 
AM_ABY
 },

556 { "NOP", 
AM_IMP
 },

557 { "DCP", 
AM_ABY
 },

558 { "TOP", 
AM_ABX
 },

559 { "CMP", 
AM_ABX
 },

560 { "DEC", 
AM_ABX
 },

561 { "DCP", 
AM_ABX
 },

562 { "CPX", 
AM_IMM
 },

563 { "SBC", 
AM_ZIX
 },

564 { "DOP", 
AM_IMM
 },

565 { "ISC", 
AM_ZIX
 },

566 { "CPX", 
AM_ZP
 },

567 { "SBC", 
AM_ZP
 },

568 { "INC", 
AM_ZP
 },

569 { "ISC", 
AM_ZP
 },

570 { "INX", 
AM_IMP
 },

571 { "SBC", 
AM_IMM
 },

572 { "NOP", 
AM_IMP
 },

573 { "SBC", 
AM_IMM
 },

574 { "CPX", 
AM_ABS
 },

575 { "SBC", 
AM_ABS
 },

576 { "INC", 
AM_ABS
 },

577 { "ISC", 
AM_ABS
 },

578 { "BEQ", 
AM_REL
 },

579 { "SBC", 
AM_ZIY
 },

580 { "JAM", 
AM_IMP
 },

581 { "ISC", 
AM_ZIY
 },

582 { "DOP", 
AM_ZPX
 },

583 { "SBC", 
AM_ZPX
 },

584 { "INC", 
AM_ZPX
 },

585 { "ISC", 
AM_ZPX
 },

586 { "SED", 
AM_IMP
 },

587 { "SBC", 
AM_ABY
 },

588 { "NOP", 
AM_IMP
 },

589 { "ISC", 
AM_ABY
 },

590 { "TOP", 
AM_ABX
 },

591 { "SBC", 
AM_ABX
 },

592 { "INC", 
AM_ABX
 },

593 { "ISC", 
AM_ABX
 } };

595 
SDL_boÞ
 
	$isws
Ð
c
 )

597 ifÐÐ
c
 =ð9 ) || ( c =ð32 ) )  
SDL_TRUE
;

598  
SDL_FALSE
;

599 
	}
}

601 
SDL_boÞ
 
	$isbš
Ð
c
 )

603 ifÐÐ
c
 >ð'0' ) && ( c <ð'1' ) )  
SDL_TRUE
;

604  
SDL_FALSE
;

605 
	}
}

607 
SDL_boÞ
 
	$i¢um
Ð
c
 )

609 ifÐÐ
c
 >ð'0' ) && ( c <ð'9' ) )  
SDL_TRUE
;

610  
SDL_FALSE
;

611 
	}
}

613 
SDL_boÞ
 
	$ishex
Ð
c
 )

615 ifÐ
	`i¢um
Ð
c
 ) )  
SDL_TRUE
;

616 ifÐÐ
c
 >ð'a' ) && ( c <ð'f' ) )  
SDL_TRUE
;

617 ifÐÐ
c
 >ð'A' ) && ( c <ð'F' ) )  
SDL_TRUE
;

618  
SDL_FALSE
;

619 
	}
}

621 
SDL_boÞ
 
	$i§Íh
Ð
c
 )

623 ifÐÐ
c
 >ð'a' ) && ( c <ð'z' ) )  
SDL_TRUE
;

624 ifÐÐ
c
 >ð'A' ) && ( c <ð'Z' ) )  
SDL_TRUE
;

625  
SDL_FALSE
;

626 
	}
}

628 
SDL_boÞ
 
	$issym¡¬t
Ð
c
 )

630 ifÐ
	`i§Íh
Ð
c
 ) )  
SDL_TRUE
;

631 ifÐ
c
 =ð'_' )  
SDL_TRUE
;

632  
SDL_FALSE
;

633 
	}
}

635 
SDL_boÞ
 
	$issymch¬
Ð
c
 )

637 ifÐ
	`issym¡¬t
Ð
c
 ) )  
SDL_TRUE
;

638 ifÐ
	`i¢um
Ð
c
 ) )  
SDL_TRUE
;

639  
SDL_FALSE
;

640 
	}
}

642 
	$hex™
Ð
c
 )

644 ifÐ
	`i¢um
Ð
c
 ) )  c-'0';

645 ifÐÐ
c
 >= 'a' ) && ( c <= 'f' ) )  c-('a'-10);

646 ifÐÐ
c
 >= 'A' ) && ( c <= 'F' ) )  c-('A'-10);

648 
	}
}

650 
	$bp_©
Ð
machše
 *
Üic
, 
addr
, *
xbp
, *
mbp
 )

652 
bpmask
 = 0, 
i
;

654 ifÐ
xbp
 ) *xbp = -1;

655 ifÐ
mbp
 ) *mbp = -1;

657 
Üic
->
ýu
.
ªybp
 = 
SDL_FALSE
;

658  
i
=0; i<16; i++ )

660 ifÐ
Üic
->
ýu
.
b»akpošts
[
i
] != -1 )

662 
Üic
->
ýu
.
ªybp
 = 
SDL_TRUE
;

663 ifÐ
addr
 =ð
Üic
->
ýu
.
b»akpošts
[
i
] )

665 
bpmask
 |= 8;

666 ifÐ
xbp
 ) *xb°ð
i
;

672 
Üic
->
ýu
.
ªymbp
 = 
SDL_FALSE
;

673  
i
=0; i<16; i++ )

675 ifÐ
Üic
->
ýu
.
memb»akpošts
[
i
].
æags
 )

677 
Üic
->
ýu
.
ªymbp
 = 
SDL_TRUE
;

678 ifÐ
Üic
->
ýu
.
memb»akpošts
[
i
].
addr
 ==‡ddr )

680 
bpmask
 |ð
Üic
->
ýu
.
memb»akpošts
[
i
].
æags
;

681 ifÐ
mbp
 ) *mb°ð
i
;

687  
bpmask
;

688 
	}
}

691 
	$mÚ_»ad
Ð
machše
 *
Üic
, 
addr
 )

694 ifÐ
Üic
->
driv‘y³
 =ð
DRV_MICRODISC
 )

696  
addr
 )

699  
Üic
->
wddisk
.
r_¡©us
;

702  
Üic
->
wddisk
.
r_Œack
;

705  
Üic
->
wddisk
.
r_£ùÜ
;

708  
Üic
->
wddisk
.
r_d©a
;

711  
Üic
->
md
.
šŒq
|0x7f;

714  
Üic
->
md
.
drq
|0x7f;

718 ifÐ
Üic
->
driv‘y³
 =ð
DRV_PRAVETZ
 )

720 iàÐÐ0x300 <ð
addr
 ) && (‡ddr <= 0x30f ) )

722  
	`vŸ_mÚ_»ad
Ð&
Üic
->
vŸ
, 
addr
 );

724 iàÐÐ0x310 <ð
addr
 ) && (‡ddr <= 0x31f ) )

728  
Üic
->
ýu
.
	`»ad
Ð&Üic->ýu, 
addr
 );

731 ifÐÐ
addr
 & 0xff00 ) == 0x0300 )

733 iàÐÐ!
Üic
->
ligh’
 ) || ( 
addr
 < 0x3e0 ) || (‡ddr > 0x3e1 ) )

735  
	`vŸ_mÚ_»ad
Ð&
Üic
->
vŸ
, 
addr
 );

739  
Üic
->
ýu
.
	`»ad
Ð&Üic->ýu, 
addr
 );

740 
	}
}

742 
	$mÚ_¡Üe_¡©e
Ð
machše
 *
Üic
 )

744 
k
;

746  
k
=0; k<65536; k++ )

748 ifÐ
	`i¤am
Ð
Üic
, 
k
 ) )

749 
mw©ch_Þd
[
k
] = 
	`mÚ_»ad
Ð
Üic
, k );

751 
mw©ch_Þdv®id
 = 
SDL_TRUE
;

753 
ýu_Þd
 = 
Üic
->
ýu
;

754 
vid¿¡”_Þd
 = 
Üic
->
vid_¿¡”
;

755 
äames_Þd
 = 
Üic
->
äames
;

756 
ýu_Þdv®id
 = 
SDL_TRUE
;

758 
ay_Þd
 = 
Üic
->
ay
;

759 
ay_Þdv®id
 = 
SDL_TRUE
;

761 
vŸ_Þd
 = 
Üic
->
vŸ
;

762 
vŸ_Þdv®id
 = 
SDL_TRUE
;

764 
vŸ2_Þd
 = 
Üic
->
‹Ë_vŸ
;

765 
vŸ2_Þdv®id
 = 
SDL_TRUE
;

766 
	}
}

768 
	$mÚ_£t_modif›d
Ð
machše
 *
Üic
 )

770 ifÐ
modif›d
 ) ;

772 
modif›d
 = 
SDL_TRUE
;

773 
	`mÚ_¡Üe_¡©e
Ð
Üic
 );

774 
	}
}

776 
	$dbg_süÞl
( )

778 
x
, 
y
, 
s
, 
d
;

779 
‹xtzÚe
 *
±z
 = 
tz
[
TZ_DEBUG
];

781 
s
 = 
±z
->
w
*2+1;

782 
d
 = 
±z
->
w
+1;

783  
y
=0; y<18; y++ )

785  
x
=0; x<48; x++ )

787 
±z
->
tx
[
d
] =…tz->tx[
s
];

788 
±z
->
fc
[
d
] =…tz->fc[
s
];

789 
±z
->
bc
[
d
++] =…tz->bc[
s
++];

791 
d
 += 2;

792 
s
 += 2;

795  
x
=0; x<48; x++ )

797 
±z
->
tx
[
d
] = ' ';

798 
±z
->
fc
[
d
] = 2;

799 
±z
->
bc
[
d
++] = 3;

801 
	}
}

803 
	$dbg_´štf
Ð*
fmt
, ... )

805 
va_li¡
 
­
;

807 
	`dbg_süÞl
();

809 
	`va_¡¬t
Ð
­
, 
fmt
 );

810 ifÐ
	`v¢´štf
Ð
v¥tmp
, 
VSPTMPSIZE
, 
fmt
, 
­
 ) != -1 )

812 
v¥tmp
[
VSPTMPSIZE
-1] = 0;

813 #ià
LOG_DEBUG


814 ifÐ
debug_logfže
 )

816 
	`årštf
Ð
debug_logfže
, "%s\n", 
v¥tmp
 );

817 
	`fæush
Ð
debug_logfže
 );

820 
v¥tmp
[48] = 0;

821 
	`tz¡½os
Ð
tz
[
TZ_DEBUG
], 1, 19, 
v¥tmp
 );

823 
	`va_’d
Ð
­
 );

824 
	}
}

826 
msym
 *
	$mÚ_b_fšd_sym_by_addr
Ð
symbÞbË
 *
¡ab
, 
machše
 *
Üic
, 
addr
, 
SDL_boÞ
 *
ov”ride_romdis
 )

828 
i
, 
j
, 
k
;

829 
SDL_boÞ
 
romdis
;

831 
romdis
 = 
Üic
->romdis;

832 ifÐÐ
Üic
->
driv‘y³
 =ð
DRV_JASMIN
 ) && ( oric->
jasmš
.
Þay
 ) )

833 
romdis
 = 
SDL_FALSE
;

835 ià(
ov”ride_romdis
)

836 
romdis
 = *
ov”ride_romdis
;

838  
i
=0; i<
¡ab
->
numsyms
; i++ )

840 ifÐ
Üic
->
ty³
 =ð
MACH_TELESTRAT
 )

842 ifÐ
¡ab
->
syms
[
i
].
addr
 >= 0xc000 )

844  
j
=0, 
k
=
SYMF_TELEBANK0
; j<8; j++, k<<=1 )

846 ifÐ((
¡ab
->
syms
[
i
].
æags
&
k
)==0è&& ( 
Üic
->
‹Ë_cu¼bªk
 =ð
j
 ) )

850 ifÐ
j
 != 8 ) ;

853 ifÐ
¡ab
->
syms
[
i
].
æags
&
SYMF_MICRODISC
 )

855 ifÐÐ
Üic
->
driv‘y³
 !ð
DRV_MICRODISC
 ) || ( !Üic->
md
.
diskrom
 ) )

859 ifÐ(
¡ab
->
syms
[
i
].
æags
&
SYMF_JASMIN
è&& ( 
Üic
->
driv‘y³
 !ð
DRV_JASMIN
 ) )

862 ifÐ
romdis
 )

864 ifÐ(
¡ab
->
syms
[
i
].
æags
&
SYMF_ROMDIS0
) != 0 )

867 ifÐ(
¡ab
->
syms
[
i
].
æags
&
SYMF_ROMDIS1
) != 0 )

872 ifÐ
addr
 =ð
¡ab
->
syms
[
i
].addr )

873  &
¡ab
->
syms
[
i
];

876  
NULL
;

877 
	}
}

879 
msym
 *
	$mÚ_b_fšd_sym_by_Çme
Ð
symbÞbË
 *
¡ab
, 
machše
 *
Üic
, *
Çme
, *
symnum
 )

881 
i
, 
j
, 
k
, 
romdis
;

883 
romdis
 = 
Üic
->romdis;

884 ifÐÐ
Üic
->
driv‘y³
 =ð
DRV_JASMIN
 ) && ( oric->
jasmš
.
Þay
 ) )

885 
romdis
 = 1;

887  
i
=0; i<
¡ab
->
numsyms
; i++ )

889 ifÐ
Üic
->
ty³
 =ð
MACH_TELESTRAT
 )

891 ifÐ
¡ab
->
syms
[
i
].
addr
 >= 0xc000 )

893  
j
=0, 
k
=
SYMF_TELEBANK0
; j<8; j++, k<<=1 )

895 ifÐ((
¡ab
->
syms
[
i
].
æags
&
k
)==0è&& ( 
Üic
->
‹Ë_cu¼bªk
 =ð
j
 ) )

899 ifÐ
j
 != 8 ) ;

902 ifÐ
¡ab
->
syms
[
i
].
æags
&
SYMF_MICRODISC
 )

904 ifÐÐ
Üic
->
driv‘y³
 !ð
DRV_MICRODISC
 ) || ( !Üic->
md
.
diskrom
 ) )

908 ifÐ(
¡ab
->
syms
[
i
].
æags
&
SYMF_JASMIN
è&& ( 
Üic
->
driv‘y³
 !ð
DRV_JASMIN
 ) )

911 ifÐ
romdis
 )

913 ifÐ(
¡ab
->
syms
[
i
].
æags
&
SYMF_ROMDIS0
) != 0 )

916 ifÐ(
¡ab
->
syms
[
i
].
æags
&
SYMF_ROMDIS1
) != 0 )

921 ifÐ!
Üic
->
symbÞsÿ£
 )

923 ifÐ
	`¡rÿ£cmp
Ð
Çme
, 
¡ab
->
syms
[
i
].name ) == 0 )

925 ifÐ
symnum
 ) (*symnumèð
i
;

926  &
¡ab
->
syms
[
i
];

929 ifÐ
	`¡rcmp
Ð
Çme
, 
¡ab
->
syms
[
i
].name ) == 0 )

931 ifÐ
symnum
 ) (*symnumèð
i
;

932  &
¡ab
->
syms
[
i
];

937 ifÐ
symnum
 ) (*symnum) = -1;

938  
NULL
;

939 
	}
}

941 
msym
 *
	$mÚ_fšd_sym_by_addr
Ð
machše
 *
Üic
, 
addr
, 
SDL_boÞ
 *
ov”ride_romdis
 )

943 
msym
 *
»t
;

945 
»t
 = 
	`mÚ_b_fšd_sym_by_addr
Ð&
Üic
->
u£rsyms
, oric, 
addr
, 
ov”ride_romdis
 );

946 ifÐ!
»t
 )„‘ = 
	`mÚ_b_fšd_sym_by_addr
Ð&
Üic
->
romsyms
, oric, 
addr
, 
ov”ride_romdis
 );

947 ifÐÐ!
»t
 ) && ( 
Üic
->
ty³
 =ð
MACH_TELESTRAT
 ) )„‘ = 
	`mÚ_b_fšd_sym_by_addr
Ð&Üic->
‹Ë_bªksyms
[Üic->
‹Ë_cu¼bªk
], oric, 
addr
, 
ov”ride_romdis
 );

948 ifÐÐ!
»t
 ) && ( 
Üic
->
disksyms
 ) )„‘ = 
	`mÚ_b_fšd_sym_by_addr
ÐÜic->disksyms, oric, 
addr
, 
ov”ride_romdis
 );

949 ifÐ
»t
 ) „et;

951  
	`mÚ_b_fšd_sym_by_addr
Ð&
deçuÉsyms
, 
Üic
, 
addr
, 
ov”ride_romdis
 );

952 
	}
}

954 
msym
 *
	$mÚ_fšd_sym_by_Çme
Ð
machše
 *
Üic
, *
Çme
 )

956 
msym
 *
»t
;

958 
»t
 = 
	`mÚ_b_fšd_sym_by_Çme
Ð&
Üic
->
u£rsyms
, oric, 
Çme
, 
NULL
 );

959 ifÐ!
»t
 )„‘ = 
	`mÚ_b_fšd_sym_by_Çme
Ð&
Üic
->
romsyms
, oric, 
Çme
, 
NULL
 );

960 ifÐÐ!
»t
 ) && ( 
Üic
->
ty³
 =ð
MACH_TELESTRAT
 ) )„‘ = 
	`mÚ_b_fšd_sym_by_Çme
Ð&Üic->
‹Ë_bªksyms
[Üic->
‹Ë_cu¼bªk
], oric, 
Çme
, 
NULL
 );

961 ifÐÐ!
»t
 ) && ( 
Üic
->
disksyms
 ) )„‘ = 
	`mÚ_b_fšd_sym_by_Çme
ÐÜic->disksyms, oric, 
Çme
, 
NULL
 );

962 ifÐ
»t
 ) „et;

964  
	`mÚ_b_fšd_sym_by_Çme
Ð&
deçuÉsyms
, 
Üic
, 
Çme
, 
NULL
 );

965 
	}
}

967 
SDL_boÞ
 
	$mÚ_addsym
Ð
symbÞbË
 *
¡ab
, 
addr
, 
æags
, *
Çme
, 
msym
 **
sym±r
 )

969 
i
;

971 ifÐ
sym±r
 ) (*sym±rèð
NULL
;

974 ifÐ
¡ab
->
sym¥aû
 =ð-1 )  
SDL_FALSE
;

976 ifÐÐ!
¡ab
->
syms
 ) || ( sb->
sym¥aû
 < (¡ab->
numsyms
+1) ) )

978 
msym
 *
Ãwbuf
;

980 
Ãwbuf
 = 
	`m®loc
ÐÐ
msym
 ) * (
¡ab
->
sym¥aû
+64) );

981 ifÐ!
Ãwbuf
 )  
SDL_FALSE
;

983 ifÐÐ
¡ab
->
syms
 ) && ( sb->
numsyms
 > 0 ) )

984 
	`memýy
Ð
Ãwbuf
, 
¡ab
->
syms
, Ð
msym
 ) * sb->
numsyms
 );

986 
	`ä“
Ð
¡ab
->
syms
 );

987 
¡ab
->
syms
 = 
Ãwbuf
;

988 
¡ab
->
sym¥aû
 += 64;

990  
i
=
¡ab
->
numsyms
; i<¡ab->
sym¥aû
; i++ )

991 
¡ab
->
syms
[
i
].
Çme
 = 
NULL
;

994 ifÐ!
¡ab
->
syms
[¡ab->
numsyms
].
Çme
 )

996 
¡ab
->
syms
[¡ab->
numsyms
].
Çme
 = 
	`m®loc
( 128 );

997 ifÐ!
¡ab
->
syms
[¡ab->
numsyms
].
Çme
 )  
SDL_FALSE
;

1000 
¡ab
->
syms
[¡ab->
numsyms
].
addr
 =‡ddr;

1001 
¡ab
->
syms
[¡ab->
numsyms
].
æags
 = flags;

1002 
	`¡ºýy
Ð
¡ab
->
syms
[¡ab->
numsyms
].
Çme
,‚ame, 128 );

1003 
¡ab
->
syms
[¡ab->
numsyms
].
Çme
[127] = 0;

1005 ifÐ
	`¡¾’
Ð
Çme
 ) > 
SNAME_LEN
 )

1007 
	`¡ºýy
Ð
¡ab
->
syms
[¡ab->
numsyms
].
¢ame
, 
Çme
, (
SNAME_LEN
-1) );

1008 
¡ab
->
syms
[¡ab->
numsyms
].
¢ame
[
SNAME_LEN
-1] = 22;

1009 
¡ab
->
syms
[¡ab->
numsyms
].
¢ame
[
SNAME_LEN
] = 0;

1011 
	`¡rýy
Ð
¡ab
->
syms
[¡ab->
numsyms
].
¢ame
, 
Çme
 );

1014 ifÐ
	`¡¾’
Ð
Çme
 ) > 
SSNAME_LEN
 )

1016 
	`¡ºýy
Ð
¡ab
->
syms
[¡ab->
numsyms
].
s¢ame
, 
Çme
, (
SSNAME_LEN
-1) );

1017 
¡ab
->
syms
[¡ab->
numsyms
].
s¢ame
[
SSNAME_LEN
-1] = 22;

1018 
¡ab
->
syms
[¡ab->
numsyms
].
s¢ame
[
SSNAME_LEN
] = 0;

1020 
	`¡rýy
Ð
¡ab
->
syms
[¡ab->
numsyms
].
s¢ame
, 
Çme
 );

1023 ifÐ
sym±r
 ) *(sym±rèð&
¡ab
->
syms
[¡ab->
numsyms
];

1025 
¡ab
->
numsyms
++;

1027  
SDL_TRUE
;

1028 
	}
}

1030 
	$mÚ_š™_symb
Ð
symbÞbË
 *
¡ab
 )

1032 
¡ab
->
syms
 = 
NULL
;

1033 
¡ab
->
numsyms
 = 0;

1034 
¡ab
->
sym¥aû
 = 0;

1035 
	}
}

1037 
	$mÚ_ä“syms
Ð
symbÞbË
 *
¡ab
 )

1040 ifÐ
¡ab
->
sym¥aû
 == -1 ) ;

1041 ià(
¡ab
->
syms
)

1043 
i
;

1044 
i
 = 0; i < 
¡ab
->
numsyms
; i++)

1046 
	`ä“
(
¡ab
->
syms
[
i
].
Çme
);

1048 
	`ä“
(
¡ab
->
syms
);

1050 
¡ab
->
syms
 = 
NULL
;

1051 
¡ab
->
numsyms
 = 0;

1052 
¡ab
->
sym¥aû
 = 0;

1053 
	}
}

1057 *
	$mÚ_di§s£mbË
Ð
machše
 *
Üic
, *
·ddr
, 
SDL_boÞ
 *
loÝed
, SDL_boÞ 
fžemode
 )

1059 
Ÿddr
, 
addr
;

1060 
Ý
, 
a1
, 
a2
;

1061 
i
;

1062 *
tmp¢ame
, *
di¥Œ
;

1063 
¢ame
[
SNAME_LEN
+1];

1064 
msym
 *
csym
;

1066 
di¥Œ
 = 
di¡mp
;

1068 
Ÿddr
 = *
·ddr
;

1069 ifÐ
loÝed
 ) *loÝed = 
SDL_FALSE
;

1071 
tmp¢ame
 = "";

1072 ifÐ!
fžemode
 )

1074 
csym
 = 
	`mÚ_fšd_sym_by_addr
Ð
Üic
, 
Ÿddr
, 
NULL
 );

1075 ifÐ
csym
 ) 
tmp¢ame
 = csym->
¢ame
;

1077 
csym
 = 
	`mÚ_fšd_sym_by_addr
Ð
Üic
, 
Ÿddr
, 
NULL
 );

1078 ifÐ
csym
 )

1080 
tmp¢ame
 = 
csym
->
Çme
;

1082 ifÐ
	`¡¾’
Ð
tmp¢ame
 ) > 
SNAME_LEN
 )

1084 
	`¥rštf
Ð
di¡mp
, "%s\n", 
tmp¢ame
 );

1085 
di¥Œ
 = &
di¡mp
[
	`¡¾’
(distmp)];

1086 
tmp¢ame
 = "";

1091 
	`¡rýy
Ð
¢ame
, 
tmp¢ame
 );

1092  
i
=()
	`¡¾’
(
¢ame
); i<
SNAME_LEN
; i++ )

1093 
¢ame
[
i
] = 32;

1094 
¢ame
[
i
] = 0;

1096 
Ý
 = 
	`mÚ_»ad
Ð
Üic
, (*
·ddr
)++ );

1097  
di¡ab
[
Ý
].
amode
 )

1099 
AM_IMP
:

1100 
	`¥rštf
Ð
di¥Œ
, "%  %04X %02X %s", 
¢ame
, 
Ÿddr
, 
Ý
, 
di¡ab
[Ý].
Çme
 );

1103 
AM_IMM
:

1104 
a1
 = 
	`mÚ_»ad
Ð
Üic
, (*
·ddr
)++ );

1105 
	`¥rštf
Ð
di¥Œ
, "%  %04X %02X %02X % #$%02X", 
¢ame
, 
Ÿddr
, 
Ý
, 
a1
, 
di¡ab
[Ý].
Çme
,‡1 );

1108 
AM_ZP
:

1109 
AM_ZPX
:

1110 
AM_ZPY
:

1111 
a1
 = 
	`mÚ_»ad
Ð
Üic
, (*
·ddr
)++ );

1112 
csym
 = 
	`mÚ_fšd_sym_by_addr
Ð
Üic
, 
a1
, 
NULL
 );

1113 ifÐ
csym
 )

1114 
	`¥rštf
Ð
di¥Œ
, "%  %04X %02X %02X % %s", 
¢ame
, 
Ÿddr
, 
Ý
, 
a1
, 
di¡ab
[Ý].
Çme
, 
fžemode
 ? 
csym
->name : csym->sname );

1116 
	`¥rštf
Ð
di¥Œ
, "%  %04X %02X %02X % $%02X", 
¢ame
, 
Ÿddr
, 
Ý
, 
a1
, 
di¡ab
[Ý].
Çme
,‡1 );

1117 ifÐ
di¡ab
[
Ý
].
amode
 =ð
AM_ZP
 ) ;

1118 
	`¡rÿt
Ð
di¥Œ
, 
di¡ab
[
Ý
].
amode
 =ð
AM_ZPX
 ? ",X" : ",Y" );

1121 
AM_ABS
:

1122 
AM_ABX
:

1123 
AM_ABY
:

1124 
a1
 = 
	`mÚ_»ad
Ð
Üic
, (*
·ddr
)++ );

1125 
a2
 = 
	`mÚ_»ad
Ð
Üic
, (*
·ddr
)++ );

1126 
csym
 = 
	`mÚ_fšd_sym_by_addr
Ð
Üic
, (
a2
<<8)|
a1
, 
NULL
 );

1127 ifÐ
csym
 )

1128 
	`¥rštf
Ð
di¥Œ
, "%  %04X %02X %02X %02X % %s", 
¢ame
, 
Ÿddr
, 
Ý
, 
a1
, 
a2
, 
di¡ab
[Ý].
Çme
, 
fžemode
 ? 
csym
->name : csym->sname );

1130 
	`¥rštf
Ð
di¥Œ
, "%  %04X %02X %02X %02X % $%02X%02X", 
¢ame
, 
Ÿddr
, 
Ý
, 
a1
, 
a2
, 
di¡ab
[Ý].
Çme
,‡2,‡1 );

1131 ifÐ
di¡ab
[
Ý
].
amode
 =ð
AM_ABS
 ) ;

1132 
	`¡rÿt
Ð
di¥Œ
, 
di¡ab
[
Ý
].
amode
 =ð
AM_ABX
 ? ",X" : ",Y" );

1135 
AM_ZIX
:

1136 
a1
 = 
	`mÚ_»ad
Ð
Üic
, (*
·ddr
)++ );

1137 
csym
 = 
	`mÚ_fšd_sym_by_addr
Ð
Üic
, 
a1
, 
NULL
 );

1138 ifÐ
csym
 )

1139 
	`¥rštf
Ð
di¥Œ
, "%  %04X %02X %02X % (%s,X)", 
¢ame
, 
Ÿddr
, 
Ý
, 
a1
, 
di¡ab
[Ý].
Çme
, 
fžemode
 ? 
csym
->Çm: csym->
s¢ame
 );

1141 
	`¥rštf
Ð
di¥Œ
, "%  %04X %02X %02X % ($%02X,X)", 
¢ame
, 
Ÿddr
, 
Ý
, 
a1
, 
di¡ab
[Ý].
Çme
,‡1 );

1144 
AM_ZIY
:

1145 
a1
 = 
	`mÚ_»ad
Ð
Üic
, (*
·ddr
)++ );

1146 
csym
 = 
	`mÚ_fšd_sym_by_addr
Ð
Üic
, 
a1
, 
NULL
 );

1147 ifÐ
csym
 )

1148 
	`¥rštf
Ð
di¥Œ
, "%  %04X %02X %02X % (%s),Y", 
¢ame
, 
Ÿddr
, 
Ý
, 
a1
, 
di¡ab
[Ý].
Çme
, 
fžemode
 ? 
csym
->Çm: csym->
s¢ame
 );

1150 
	`¥rštf
Ð
di¥Œ
, "%  %04X %02X %02X % ($%02X),Y", 
¢ame
, 
Ÿddr
, 
Ý
, 
a1
, 
di¡ab
[Ý].
Çme
,‡1 );

1153 
AM_REL
:

1154 
a1
 = 
	`mÚ_»ad
Ð
Üic
, (*
·ddr
)++ );

1155 
addr
 = ((*
·ddr
)+((sigÃd )
a1
))&0xffff;

1156 
csym
 = 
	`mÚ_fšd_sym_by_addr
Ð
Üic
, 
addr
, 
NULL
 );

1157 ifÐ
csym
 )

1158 
	`¥rštf
Ð
di¥Œ
, "%  %04X %02X %02X % %s", 
¢ame
, 
Ÿddr
, 
Ý
, 
a1
, 
di¡ab
[Ý].
Çme
, 
fžemode
 ? 
csym
->name : csym->sname );

1160 
	`¥rštf
Ð
di¥Œ
, "%  %04X %02X %02X % $%04X", 
¢ame
, 
Ÿddr
, 
Ý
, 
a1
, 
di¡ab
[Ý].
Çme
, 
addr
 );

1163 
AM_IND
:

1164 
a1
 = 
	`mÚ_»ad
Ð
Üic
, (*
·ddr
)++ );

1165 
a2
 = 
	`mÚ_»ad
Ð
Üic
, (*
·ddr
)++ );

1166 
csym
 = 
	`mÚ_fšd_sym_by_addr
Ð
Üic
, (
a2
<<8)|
a1
, 
NULL
 );

1167 ifÐ
csym
 )

1168 
	`¥rštf
Ð
di¥Œ
, "%  %04X %02X %02X %02X % (%s)", 
¢ame
, 
Ÿddr
, 
Ý
, 
a1
, 
a2
, 
di¡ab
[Ý].
Çme
, 
fžemode
 ? 
csym
->name : csym->sname );

1170 
	`¥rštf
Ð
di¥Œ
, "%  %04X %02X %02X %02X % ($%02X%02X)", 
¢ame
, 
Ÿddr
, 
Ý
, 
a1
, 
a2
, 
di¡ab
[Ý].
Çme
,‡2,‡1 );

1174 
	`¡rýy
Ð
di¥Œ
, " WTF?" );

1178  
i
=()
	`¡¾’
(
di¥Œ
); i<47; i++ )

1179 
di¥Œ
[
i
] = 32;

1180 
di¥Œ
[
i
] = 0;

1182  
	`bp_©
Ð
Üic
, 
Ÿddr
, 
NULL
, NULL ) )

1184 Ð
MBPF_READ
): 
di¥Œ
[
SNAME_LEN
+1] = 'r'; ;

1185 Ð
MBPF_WRITE
 ): 
di¥Œ
[
SNAME_LEN
+1] = 'w'; ;

1186 Ð
MBPF_WRITE
|
MBPF_READ
): 
di¥Œ
[
SNAME_LEN
+1] = 'a'; ;

1187 Ð
MBPF_CHANGE
 ): 
di¥Œ
[
SNAME_LEN
+1] = 'c'; ;

1188 Ð
MBPF_CHANGE
 |
MBPF_READ
): 
di¥Œ
[
SNAME_LEN
+1] = 'g'; ;

1189 Ð
MBPF_CHANGE
|
MBPF_WRITE
 ): 
di¥Œ
[
SNAME_LEN
+1] = 'm'; ;

1190 Ð
MBPF_CHANGE
|
MBPF_WRITE
|
MBPF_READ
): 
di¥Œ
[
SNAME_LEN
+1] = '+'; ;

1191 (8 ): 
di¥Œ
[
SNAME_LEN
+1] = 'X'; ;

1192 (8| 
MBPF_READ
): 
di¥Œ
[
SNAME_LEN
+1] = 'R'; ;

1193 (8| 
MBPF_WRITE
 ): 
di¥Œ
[
SNAME_LEN
+1] = 'W'; ;

1194 (8| 
MBPF_WRITE
|
MBPF_READ
): 
di¥Œ
[
SNAME_LEN
+1] = 'A'; ;

1195 (8|
MBPF_CHANGE
 ): 
di¥Œ
[
SNAME_LEN
+1] = 'C'; ;

1196 (8|
MBPF_CHANGE
 |
MBPF_READ
): 
di¥Œ
[
SNAME_LEN
+1] = 'G'; ;

1197 (8|
MBPF_CHANGE
|
MBPF_WRITE
 ): 
di¥Œ
[
SNAME_LEN
+1] = 'M'; ;

1198 (8|
MBPF_CHANGE
|
MBPF_WRITE
|
MBPF_READ
): 
di¥Œ
[
SNAME_LEN
+1] = '*'; ;

1201 ifÐ
Ÿddr
 =ð
Üic
->
ýu
.
pc
 )

1202 
di¥Œ
[
SNAME_LEN
+2] = '>';

1204 ifÐÐ
loÝed
 ) && ( 
Ÿddr
 > *
·ddr
 ) )

1205 *
loÝed
 = 
SDL_TRUE
;

1207  
di¡mp
;

1208 
	}
}

1210 
	$mÚ_»gmod
Ð
x
, 
y
, 
w
 )

1212 
offs
, 
i
;

1214 
offs
 = 
y
*
tz
[
TZ_REGS
]->
w
+
x
;

1215  
i
=0; i<
w
; i++, 
offs
++ )

1217 
tz
[
TZ_REGS
]->
fc
[
offs
] = 1;

1218 
tz
[
TZ_REGS
]->
bc
[
offs
] = 8;

1220 
	}
}

1222 
	$mÚ_upd©e_»gs
Ð
machše
 *
Üic
 )

1224 
i
;

1225 
addr
, 
pc
;

1226 
msym
 *
csym
;

1227 
¡mp
[48];

1229 
pc
 = 
Üic
->
ýu
.pc;

1231 ifÐÐ
Üic
->
ýu
.
œq
 ) && ( oric->ýu.
f_i
 == 0 ) )

1232 
pc
 = (
	`mÚ_»ad
Ð
Üic
, 0xffff )<<8) | mon_read( oric, 0xfffe );

1234 
	`tz´štåos
Ð
tz
[
TZ_REGS
], 2, 2, "PC=%04X SP=01%02X A=%02X X=%02X Y=%02X LPC=%04X",

1235 
pc
,

1236 
Üic
->
ýu
.
¥
,

1237 
Üic
->
ýu
.
a
,

1238 
Üic
->
ýu
.
x
,

1239 
Üic
->
ýu
.
y
,

1240 
Üic
->
ýu
.
Ï¡pc
 );

1242 
csym
 = 
	`mÚ_fšd_sym_by_addr
Ð
Üic
, 
pc
, 
NULL
 );

1243 ifÐ
csym
 )

1245 ifÐ
	`¡¾’
Ð
csym
->
Çme
 ) > 46 )

1247 
	`¡ºýy
Ð
¡mp
, 
csym
->
Çme
, 46 );

1248 
¡mp
[46] = 0;

1250 
	`¡rýy
Ð
¡mp
, 
csym
->
Çme
 );

1252 
	`tz¡½os
Ð
tz
[
TZ_REGS
], 2, 3, 
¡mp
 );

1254 
	`tz´štåos
Ð
tz
[
TZ_REGS
], 2, 3, "%46s", " " );

1257 
	`tz´štåos
Ð
tz
[
TZ_REGS
], 2, 4, "CY=%09d", 
Üic
->
ýu
.
cyþes
 );

1258 
	`tz´štåos
Ð
tz
[
TZ_REGS
], 2, 5, "FM=%06d RS=%03d", 
Üic
->
äames
, oric->
vid_¿¡”
 );

1260 
	`tz¡½os
Ð
tz
[
TZ_REGS
], 35, 4, (
Üic
->
ýu
.
œq
&
IRQF_VIA
) ? "VIA" : " " );

1261 
	`tz¡½os
Ð
tz
[
TZ_REGS
], 35, 5, (
Üic
->
ýu
.
œq
&
IRQF_DISK
) ? "DISK" : " " );

1264 
	`tz¡½os
Ð
tz
[
TZ_REGS
], 20, 4, "NV-BDIZC" );

1265 
	`tz´štåos
Ð
tz
[
TZ_REGS
], 20, 5, "%01X%01X1%01X%01X%01X%01X%01X",

1266 
Üic
->
ýu
.
f_n
,

1267 
Üic
->
ýu
.
f_v
,

1268 
Üic
->
ýu
.
f_b
,

1269 
Üic
->
ýu
.
f_d
,

1270 
Üic
->
ýu
.
f_i
,

1271 
Üic
->
ýu
.
f_z
,

1272 
Üic
->
ýu
.
f_c
 );

1274 
	`tz´štåos
Ð
tz
[
TZ_REGS
], 30, 4, "NMI=%04X RST=%04X",

1275 (
Üic
->
ýu
.
	`»ad
( &oric->cpu, 0xfffb )<<8)|oric->cpu.read( &oric->cpu, 0xfffa ),

1276 (
Üic
->
ýu
.
	`»ad
( &oric->cpu, 0xfffd )<<8)|oric->cpu.read( &oric->cpu, 0xfffc ) );

1277 
	`tz´štåos
Ð
tz
[
TZ_REGS
], 30, 5, "IRQ=%04X", (
Üic
->
ýu
.
	`»ad
( &oric->cpu, 0xffff )<<8)|oric->cpu.read( &oric->cpu, 0xfffe ) );

1280 
addr
 = 
pc
;

1281  
i
=0; i<10; i++ )

1283 
di§ddrs
[
i
] = 
addr
;

1284 
	`tz£tcÞ
Ð
tz
[
TZ_REGS
], (
addr
==
pc
) ? 1 : 2, 3 );

1285 
	`tz¡½os
Ð
tz
[
TZ_REGS
], 23, 7+
i
, " " );

1286 
	`tz¡½os
Ð
tz
[
TZ_REGS
], 2, 7+
i
, 
	`mÚ_di§s£mbË
Ð
Üic
, &
addr
, 
NULL
, 
SDL_FALSE
 ) );

1289 ifÐ
ýu_Þdv®id
 )

1291 ifÐ
ýu_Þd
.
pc
 !ðpøè
	`mÚ_»gmod
( 5, 2, 4 );

1292 ifÐ
ýu_Þd
.
¥
 !ð
Üic
->
ýu
.¥ ) 
	`mÚ_»gmod
( 14, 2, 4 );

1293 ifÐ
ýu_Þd
.
a
 !ð
Üic
->
ýu
.¨è
	`mÚ_»gmod
( 22, 2, 2 );

1294 ifÐ
ýu_Þd
.
x
 !ð
Üic
->
ýu
.x ) 
	`mÚ_»gmod
( 28, 2, 2 );

1295 ifÐ
ýu_Þd
.
y
 !ð
Üic
->
ýu
.y ) 
	`mÚ_»gmod
( 34, 2, 2 );

1296 ifÐ
ýu_Þd
.
cyþes
 !ð
Üic
->
ýu
.cyþe è
	`mÚ_»gmod
( 5, 4, 9 );

1297 ifÐ
äames_Þd
 !ð
Üic
->
äames
 ) 
	`mÚ_»gmod
( 5, 5, 6 );

1298 ifÐ
vid¿¡”_Þd
 !ð
Üic
->
vid_¿¡”
 ) 
	`mÚ_»gmod
( 15, 5, 3 );

1299 ifÐ
ýu_Þd
.
f_n
 !ð
Üic
->
ýu
.f_Àè
	`mÚ_»gmod
( 20, 5, 1 );

1300 ifÐ
ýu_Þd
.
f_v
 !ð
Üic
->
ýu
.f_v ) 
	`mÚ_»gmod
( 21, 5, 1 );

1301 ifÐ
ýu_Þd
.
f_b
 !ð
Üic
->
ýu
.f_b ) 
	`mÚ_»gmod
( 23, 5, 1 );

1302 ifÐ
ýu_Þd
.
f_d
 !ð
Üic
->
ýu
.f_d ) 
	`mÚ_»gmod
( 24, 5, 1 );

1303 ifÐ
ýu_Þd
.
f_i
 !ð
Üic
->
ýu
.f_˜è
	`mÚ_»gmod
( 25, 5, 1 );

1304 ifÐ
ýu_Þd
.
f_z
 !ð
Üic
->
ýu
.f_z ) 
	`mÚ_»gmod
( 26, 5, 1 );

1305 ifÐ
ýu_Þd
.
f_c
 !ð
Üic
->
ýu
.f_øè
	`mÚ_»gmod
( 27, 5, 1 );

1307 ifÐ(
ýu_Þd
.
œq
&
IRQF_VIA
è!ð(
Üic
->
ýu
.œq&IRQF_VIAèè
	`mÚ_»gmod
( 35, 4, 3 );

1308 ifÐ(
ýu_Þd
.
œq
&
IRQF_DISK
è!ð(
Üic
->
ýu
.œq&IRQF_DISKèè
	`mÚ_»gmod
( 35, 5, 4 );

1310 
	}
}

1312 
	$mÚ_þick_»gs
Ð
machše
 *
Üic
, 
SDL_boÞ
 *
Ãed»nd”
, 
x
, 
y
, SDL_boÞ 
dblþk
 )

1314 
cmdtmp
[32];

1316 ifÐÐ
dblþk
 ) && ( 
y
 == 5 ) )

1318  
x
 )

1320 20: 
	`mÚ_£t_modif›d
Ð
Üic
 ); oric->
ýu
.
f_n
 ^ð1; *
Ãed»nd”
 = 
SDL_TRUE
; ;

1321 21: 
	`mÚ_£t_modif›d
Ð
Üic
 ); oric->
ýu
.
f_v
 ^ð1; *
Ãed»nd”
 = 
SDL_TRUE
; ;

1322 23: 
	`mÚ_£t_modif›d
Ð
Üic
 ); oric->
ýu
.
f_b
 ^ð1; *
Ãed»nd”
 = 
SDL_TRUE
; ;

1323 24: 
	`mÚ_£t_modif›d
Ð
Üic
 ); oric->
ýu
.
f_d
 ^ð1; *
Ãed»nd”
 = 
SDL_TRUE
; ;

1324 25: 
	`mÚ_£t_modif›d
Ð
Üic
 ); oric->
ýu
.
f_i
 ^ð1; *
Ãed»nd”
 = 
SDL_TRUE
; ;

1325 26: 
	`mÚ_£t_modif›d
Ð
Üic
 ); oric->
ýu
.
f_z
 ^ð1; *
Ãed»nd”
 = 
SDL_TRUE
; ;

1326 27: 
	`mÚ_£t_modif›d
Ð
Üic
 ); oric->
ýu
.
f_c
 ^ð1; *
Ãed»nd”
 = 
SDL_TRUE
; ;

1330 ifÐÐ
dblþk
 ) && ( 
y
 >= 7 ) && ( y < 17 ) )

1332 
i
;

1334 ifÐ
	`bp_©
Ð
Üic
, 
di§ddrs
[
y
-7], &
i
, 
NULL
 ) & 8 )

1336 
	`¥rštf
Ð
cmdtmp
, "bø%d", 
i
 );

1337 
	`mÚ_do_cmd
Ð
cmdtmp
, 
Üic
, 
Ãed»nd”
 );

1338 *
Ãed»nd”
 = 
SDL_TRUE
;

1340 
	`¥rštf
Ð
cmdtmp
, "b $%04x", 
di§ddrs
[
y
-7] );

1341 
	`mÚ_do_cmd
Ð
cmdtmp
, 
Üic
, 
Ãed»nd”
 );

1342 *
Ãed»nd”
 = 
SDL_TRUE
;

1347 
	}
}

1349 
	$mÚ_vŸmod
Ð
x
, 
y
, 
w
, 
‹xtzÚe
 *
vtz
 )

1351 
offs
, 
i
;

1353 
offs
 = 
y
*
vtz
->
w
+
x
;

1354  
i
=0; i<
w
; i++, 
offs
++ )

1356 
vtz
->
fc
[
offs
] = 1;

1357 
vtz
->
bc
[
offs
] = 8;

1359 
	}
}

1361 
	$mÚ_upd©e_vŸ
Ð
machše
 *
Üic
, 
‹xtzÚe
 *
vtz
, 
vŸ
 *
v
, vŸ *
Þd
, 
SDL_boÞ
 *
Þdv®id
 )

1363 
i
, 
j
, 
o
;

1364 
v®
;

1365 *
Çmes
[] = { "IORB ", "IORAh", "DDRB ", "DDRA ", "T1CL ", "T1CH ", "T1LL ", "T1LH ", "T2CL ", "T2CH ", "SR ", "ACR ", "PCR ", "IFR ", "IER ", "IORA " };

1367  
i
=0; i<16; i++ )

1369 
v®
 = 
	`vŸ_mÚ_»ad
Ð
v
, v =ð&
Üic
->
vŸ
 ? 0x300+
i
 : 0x320+i );

1370 
	`tz´štåos
Ð
vtz
, 2, 
i
+1, "%04X: % $%02X %%", (
v
 =ð&
Üic
->
vŸ
è? 0x300+˜: 0x320+i, 
Çmes
[i], 
v®
 );

1371  
j
=128; j; j>>=1 )

1372 
	`tzputc
(
vtz
, (
v®
&
j
)?'1':'0');

1374 ifÐ*
Þdv®id
 )

1376 
ov®
 = 
	`vŸ_mÚ_»ad
(
Þd
, (
v
 =ð&
Üic
->
vŸ
è? 0x300+
i
 : 0x320+i );

1377 ifÐ
v®
 !ð
ov®
 ) 
	`mÚ_vŸmod
Ð16, 
i
+1, 2, 
vtz
 );

1378  
j
=128, 
o
=19; j; j>>=1, o++ )

1380 ià((
v®
&
j
è!ð(
ov®
&j))

1381 
	`mÚ_vŸmod
Ð
o
, 
i
+1, 1, 
vtz
 );

1386 
	`tz´štåos
Ð
vtz
, 2, 18, "---------- TAPE ----------");

1387 
	`tz´štåos
Ð
vtz
, 2, 19, "OFS %08u LEN %08u", 
Üic
->
³offs
, oric->
³Ën
 );

1430 
	}
}

1432 
	$mÚ_aymod
Ð
x
, 
y
, 
w
 )

1434 
offs
, 
i
;

1436 
offs
 = 
y
*
tz
[
TZ_AY
]->
w
+
x
;

1437  
i
=0; i<
w
; i++, 
offs
++ )

1439 
tz
[
TZ_AY
]->
fc
[
offs
] = 1;

1440 
tz
[
TZ_AY
]->
bc
[
offs
] = 8;

1442 
	}
}

1444 
	$´šy»gb™s
Ð
machše
 *
Üic
, *
¡r
, 
Sšt16
 
x
, Sšt16 
y
, 
»g
, 
Ušt8
 
b™s
 )

1446 
i
, 
o
, 
fc
, 
bc
;

1447 
Ušt8
 
vÃw
, 
vÞd
;

1448 
‹xtzÚe
 *
±z
 = 
tz
[
TZ_AY
];

1450 
vÃw
 = 
Üic
->
ay
.
”egs
[
»g
];

1451 
vÞd
 = 
ay_Þd
.
”egs
[
»g
];

1453 
	`tz´štåos
Ð
±z
, 
x
, 
y
, 
¡r
, 
vÃw
 );

1454 
fc
 = 2;

1455 
bc
 = 3;

1456 ifÐÐ
ay_Þdv®id
 ) && ( 
ay_Þd
.
”egs
[
»g
] !ð
Üic
->
ay
.eregs[reg] ) )

1458 
fc
 = 1;

1459 
bc
 = 8;

1460 
	`mÚ_aymod
Ð
x
+14, 
y
, 2 );

1463 
x
+=18;

1464 
o
 = (
y
*
±z
->
w
)+
x
;

1465 
b™s
 = 8-bits;

1467  
i
=0; i<8; i++ )

1469 ifÐ
i
 >ð
b™s
 )

1470 
±z
->
tx
[
o
] = (
vÃw
&(0x80>>
i
)) ? '1' : '0';

1472 
±z
->
tx
[
o
] = ' ';

1474 ifÐ(
vÃw
&(0x80)>>
i
è!ð(
vÞd
&(0x80)>>i) )

1476 
±z
->
fc
[
o
] = fc;

1477 
±z
->
bc
[
o
] = bc;

1479 
±z
->
fc
[
o
] = 2;

1480 
±z
->
bc
[
o
] = 3;

1482 
o
++;

1484 
	}
}

1486 
	$mÚ_upd©e_ay
Ð
machše
 *
Üic
 )

1488 *
¡rs
[] = { "INACTIVE",

1492 
	`tz´štåos
Ð
tz
[
TZ_AY
], 2, 1, "CTRL=%s REG=%02X",

1493 
¡rs
[
Üic
->
ay
.
bmode
&3],

1494 
Üic
->
ay
.
üeg
 );

1496 ifÐ
ay_Þdv®id
 )

1498 ifÐ(
ay_Þd
.
bmode
&3è!ð(
Üic
->
ay
.bmode&3èè
	`mÚ_aymod
( 7, 1, 8 );

1499 ifÐ
ay_Þd
.
üeg
 !ð
Üic
->
ay
.üeg ) 
	`mÚ_aymod
( 21, 1, 2 );

1502 
	`´šy»gb™s
Ð
Üic
, "R0 P™ch A L $%02X %%", 2, 2, 
AY_CHA_PER_L
, 8 );

1503 
	`´šy»gb™s
Ð
Üic
, "R1 P™ch A H $%02X %%", 2, 3, 
AY_CHA_PER_H
, 4 );

1504 
	`´šy»gb™s
Ð
Üic
, "R2 P™ch B L $%02X %%", 2, 4, 
AY_CHB_PER_L
, 8 );

1505 
	`´šy»gb™s
Ð
Üic
, "R3 P™ch B H $%02X %%", 2, 5, 
AY_CHB_PER_H
, 4 );

1506 
	`´šy»gb™s
Ð
Üic
, "R4 P™ch C L $%02X %%", 2, 6, 
AY_CHC_PER_L
, 8 );

1507 
	`´šy»gb™s
Ð
Üic
, "R5 P™ch C H $%02X %%", 2, 7, 
AY_CHC_PER_H
, 4 );

1509 
	`´šy»gb™s
Ð
Üic
, "R6 Noi£ $%02X %%", 2, 9, 
AY_NOISE_PER
, 5 );

1510 
	`´šy»gb™s
Ð
Üic
, "R7 Stu  $%02X %%", 2,10, 
AY_STATUS
, 7 );

1512 
	`´šy»gb™s
Ð
Üic
, "R8 VÞumA $%02X %%", 2,12, 
AY_CHA_AMP
, 5 );

1513 
	`´šy»gb™s
Ð
Üic
, "R9 VÞumB $%02X %%", 2,13, 
AY_CHB_AMP
, 5 );

1514 
	`´šy»gb™s
Ð
Üic
, "RA VÞumC $%02X %%", 2,14, 
AY_CHC_AMP
, 5 );

1516 
	`´šy»gb™s
Ð
Üic
, "RB Env P” L $%02X %%", 2,16, 
AY_ENV_PER_L
, 8 );

1517 
	`´šy»gb™s
Ð
Üic
, "RC Env P” H $%02X %%", 2,17, 
AY_ENV_PER_H
, 8 );

1518 
	`´šy»gb™s
Ð
Üic
, "RD Env Cyþ$%02X %%", 2,18, 
AY_ENV_CYCLE
, 4 );

1519 
	`´šy»gb™s
Ð
Üic
, "RE Key CÞ $%02X %%", 2,19, 
AY_PORT_A
, 8 );

1539 
	}
}

1561 
	$mÚ_upd©e_disk
Ð
machše
 *
Üic
 )

1563 *
ÝÇme
;

1565 ifÐ
Üic
->
driv‘y³
 =ð
DRV_NONE
 )

1568 ifÐ
Üic
->
driv‘y³
 =ð
DRV_PRAVETZ
 )

1570 
i
 = 
Üic
->
wddisk
.
c_drive
;

1571 
	`tz´štåos
Ð
tz
[
TZ_DISK
], 2, 2, "DRIVE=%02X EXT=%04X",

1572 
Üic
->
wddisk
.
c_drive
,

1573 
Üic
->
´av‘z
.
ex‹nsiÚ
 );

1574 
	`tz´štåos
Ð
tz
[
TZ_DISK
], 2, 3, "VOL=%02X SEL=%02X",

1575 
Üic
->
´av‘z
.
drv
[
i
].
vÞume
,

1576 
Üic
->
´av‘z
.
drv
[
i
].
£Ëù
 );

1577 
	`tz´štåos
Ð
tz
[
TZ_DISK
], 2, 4, "MOTOR=%01X WRRDY=%01X",

1578 
Üic
->
´av‘z
.
drv
[
i
].
mÙÜ_Ú
,

1579 
Üic
->
´av‘z
.
drv
[
i
].
wr™e_»ady
 );

1580 
	`tz´štåos
Ð
tz
[
TZ_DISK
], 2, 5, "OVRAM=%s", 
Üic
->
´av‘z
.
Þay
 ? "ON " : "OFF" );

1584 
ÝÇme
 = "Unknown ";

1585  
Üic
->
wddisk
.
cu¼’tÝ
 )

1587 
COP_NUFFINK
: 
ÝÇme
 = "Idle "; ;

1588 
COP_READ_TRACK
: 
ÝÇme
 = "Readrack "; ;

1589 
COP_READ_SECTOR
: 
ÝÇme
 = "Read sector "; ;

1590 
COP_READ_SECTORS
: 
ÝÇme
 = "Read sectors "; ;

1591 
COP_WRITE_TRACK
: 
ÝÇme
 = "Writerack "; ;

1592 
COP_WRITE_SECTOR
: 
ÝÇme
 = "Write sector "; ;

1593 
COP_WRITE_SECTORS
: 
ÝÇme
 = "Write sectors"; ;

1594 
COP_READ_ADDRESS
: 
ÝÇme
 = "Read‡ddress "; ;

1597 
	`tz´štåos
Ð
tz
[
TZ_DISK
], 2, 2, "STATUS=%02X ROMDIS=%1X", 
Üic
->
wddisk
.
r_¡©us
, oric->
romdis
 );

1598 
	`tz´štåos
Ð
tz
[
TZ_DISK
], 2, 3, "DRIVE=%02X SIDE=%02X TRACK=%02X",

1599 
Üic
->
wddisk
.
c_drive
,

1600 
Üic
->
wddisk
.
c_side
,

1601 
Üic
->
wddisk
.
c_Œack
 );

1602 
	`tz´štåos
Ð
tz
[
TZ_DISK
], 2, 4, "SECTR=%02X DATA=%02X",

1603 
Üic
->
wddisk
.
r_£ùÜ
,

1604 
Üic
->
wddisk
.
r_d©a
 );

1605 
	`tz´štåos
Ð
tz
[
TZ_DISK
], 2, 5, "OP=%s", 
ÝÇme
 );

1606 
	`tz´štåos
Ð
tz
[
TZ_DISK
], 2, 6, "IRQC=%03d DRQC=%03d",

1607 
Üic
->
wddisk
.
d–ayedšt
,

1608 
Üic
->
wddisk
.
d–ayeddrq
 );

1610  
Üic
->
driv‘y³
 )

1612 
DRV_MICRODISC
:

1613 
	`tz´štåos
Ð
tz
[
TZ_DISK
], 2, 8, "MDSTAT=%02X INTRQ=%1X DRQ=%1X",

1614 
Üic
->
md
.
¡©us
,

1615 
Üic
->
md
.
šŒq
!=0,

1616 
Üic
->
md
.
drq
!=0 );

1617 
	`tz´štåos
Ð
tz
[
TZ_DISK
], 2, 9, "EPROM=%1X", 
Üic
->
md
.
diskrom
 );

1620 
DRV_JASMIN
:

1621 
	`tz´štåos
Ð
tz
[
TZ_DISK
], 2, 8, "OVRAM=%s", 
Üic
->
jasmš
.
Þay
 ? "ON " : "OFF" );

1624 
	}
}

1626 
	$mÚ_¡©e_»£t
Ð
machše
 *
Üic
 )

1628 
mw©ch_Þdv®id
 = 
SDL_FALSE
;

1629 
ýu_Þdv®id
 = 
SDL_FALSE
;

1630 
ay_Þdv®id
 = 
SDL_FALSE
;

1631 
vŸ_Þdv®id
 = 
SDL_FALSE
;

1632 
vŸ2_Þdv®id
 = 
SDL_FALSE
;

1633 
	}
}

1635 
	$mÚ_upd©e_mw©ch
Ð
machše
 *
Üic
 )

1637 
addr
;

1638 
j
,
k
,
l
;

1639 
v
;

1641 ifÐ
mw_¥l™
 )

1643 
tz
[
TZ_MEMWATCH
]->
tx
[ 50] = 
mw_which
==0 ? 14 : 5;

1644 
tz
[
TZ_MEMWATCH
]->
tx
[550] = 
mw_which
==1 ? 14 : 5;

1646 
offs
 = 10*
tz
[
TZ_MEMWATCH
]->
w
+1;

1647  
k
=0; k<48; k++ )

1648 
tz
[
TZ_MEMWATCH
]->
tx
[
offs
+
k
] = 32;

1649 
tz
[
TZ_MEMWATCH
]->
tx
[ 50] = 5;

1650 
tz
[
TZ_MEMWATCH
]->
tx
[550] = 5;

1654 
addr
 = 
mw_addr
[0];

1655  
j
=0; j<19; j++, 
addr
+=8 )

1657 ifÐÐ
mw_¥l™
 ) && ( 
j
 == 9 ) )

1659 
offs
 = 10*
tz
[
TZ_MEMWATCH
]->
w
+1;

1660  
k
=0; k<48; k++ )

1662 
tz
[
TZ_MEMWATCH
]->
tx
[
offs
+
k
] = 2;

1663 
tz
[
TZ_MEMWATCH
]->
bc
[
offs
+
k
] = 3;

1664 
tz
[
TZ_MEMWATCH
]->
fc
[
offs
+
k
] = 2;

1666 
j
++;

1667 
addr
 = 
mw_addr
[1];

1670 
	`¥rštf
Ð
v¥tmp
, "%04X ", 
addr
 );

1671  
k
=0; k<8; k++ )

1673 
tmp
[8];

1674 
	`¢´štf
Ð
tmp
, 7, "%02X ", 
	`mÚ_»ad
Ð
Üic
, 
addr
+
k
 ) );

1675 
	`¡rÿt
Ð
v¥tmp
, 
tmp
 );

1677 
l
 = ()
	`¡¾’
Ð
v¥tmp
 );

1678 
v¥tmp
[
l
++] = 32;

1679 
v¥tmp
[
l
++] = '\'';

1680  
k
=0; k<8; k++ )

1682 
v
 = 
	`mÚ_»ad
Ð
Üic
, 
addr
+
k
 );

1683 
v¥tmp
[
l
++] = ((
v
>31)&&(v<128))?v:'.';

1685 
v¥tmp
[
l
++] = '\'';

1686 
v¥tmp
[
l
++] = 0;

1687 
	`tz¡½os
Ð
tz
[
TZ_MEMWATCH
], 1, 
j
+1, 
v¥tmp
 );

1689 ifÐ
mw©ch_Þdv®id
 )

1691  
k
=0; k<8; k++ )

1693 ifÐ
	`i¤am
Ð
Üic
, 
addr
+
k
 ) && ( 
mw©ch_Þd
[addr+k] !ð
	`mÚ_»ad
( oric,‡ddr+k ) ) )

1695 
offs
 = (
j
+1)*
tz
[
TZ_MEMWATCH
]->
w
;

1696 
tz
[
TZ_MEMWATCH
]->
fc
[
offs
+(
k
*3+7)] = 1;

1697 
tz
[
TZ_MEMWATCH
]->
fc
[
offs
+(
k
*3+8)] = 1;

1698 
tz
[
TZ_MEMWATCH
]->
fc
[
offs
+(
k
+33)] = 1;

1699 
tz
[
TZ_MEMWATCH
]->
bc
[
offs
+(
k
*3+7)] = 8;

1700 
tz
[
TZ_MEMWATCH
]->
bc
[
offs
+(
k
*3+8)] = 8;

1701 
tz
[
TZ_MEMWATCH
]->
bc
[
offs
+(
k
+33)] = 8;

1707 ifÐ
mw_mode
 == 0 ) ;

1709 
	`makebox
Ð
tz
[
TZ_MEMWATCH
], 17, 8, 7, 3, 2, 3 );

1710 
	`tz¡½os
Ð
tz
[
TZ_MEMWATCH
], 18, 9, 
mw_ibuf
 );

1711 
	}
}

1713 
	$mÚ_upd©e
Ð
machše
 *
Üic
 )

1715 
	`mÚ_upd©e_»gs
Ð
Üic
 );

1716  
mshow
 )

1718 
MSHOW_VIA
:

1719 
	`mÚ_upd©e_vŸ
Ð
Üic
, 
tz
[
TZ_VIA
], &Üic->
vŸ
, &
vŸ_Þd
, &
vŸ_Þdv®id
 );

1722 
MSHOW_VIA2
:

1723 
	`mÚ_upd©e_vŸ
Ð
Üic
, 
tz
[
TZ_VIA2
], &Üic->
‹Ë_vŸ
, &
vŸ2_Þd
, &
vŸ2_Þdv®id
 );

1726 
MSHOW_AY
:

1727 
	`mÚ_upd©e_ay
Ð
Üic
 );

1730 
MSHOW_DISK
:

1731 
	`mÚ_upd©e_disk
Ð
Üic
 );

1735  
cshow
 )

1737 
CSHOW_MWATCH
:

1738 
	`mÚ_upd©e_mw©ch
Ð
Üic
 );

1741 
	}
}

1743 
	$mÚ_»nd”
Ð
machše
 *
Üic
 )

1745 ià(
upd©•»v›w
)

1746 
	`uÏ_»nd”sü“n
Ð
Üic
 );

1747 
Üic
->
	`»nd”_video
ÐÜic, 
SDL_FALSE
 );

1749  
mshow
 )

1751 
MSHOW_VIA
:

1752 
Üic
->
	`»nd”_‹xtzÚe
ÐÜic, 
TZ_VIA
 );

1755 
MSHOW_VIA2
:

1756 
Üic
->
	`»nd”_‹xtzÚe
ÐÜic, 
TZ_VIA2
 );

1759 
MSHOW_AY
:

1760 
Üic
->
	`»nd”_‹xtzÚe
ÐÜic, 
TZ_AY
 );

1763 
MSHOW_DISK
:

1764 
Üic
->
	`»nd”_‹xtzÚe
ÐÜic, 
TZ_DISK
 );

1768  
cshow
 )

1770 
CSHOW_CONSOLE
:

1771 
Üic
->
	`»nd”_‹xtzÚe
ÐÜic, 
TZ_MONITOR
 );

1774 
CSHOW_DEBUG
:

1775 
Üic
->
	`»nd”_‹xtzÚe
ÐÜic, 
TZ_DEBUG
 );

1778 
CSHOW_MWATCH
:

1779 
Üic
->
	`»nd”_‹xtzÚe
ÐÜic, 
TZ_MEMWATCH
 );

1782 
Üic
->
	`»nd”_‹xtzÚe
ÐÜic, 
TZ_REGS
 );

1783 
	}
}

1785 
	$mÚ_hide_curs
( )

1787 
‹xtzÚe
 *
±z
 = 
tz
[
TZ_MONITOR
];

1788 
x
 = 
cursx
-
žoff
;

1790 ifÐ
mÚ_asmmode
 )

1792 
±z
->
fc
[±z->
w
*19+8+
x
] = 2;

1793 
±z
->
bc
[±z->
w
*19+8+
x
] = 3;

1797 ifÐÐ
x
 < 0 ) || ( x > 
CONS_WIDTH
 ) ) ;

1798 
±z
->
fc
[±z->
w
*19+2+
x
] = 2;

1799 
±z
->
bc
[±z->
w
*19+2+
x
] = 3;

1800 
	}
}

1802 
	$mÚ_show_curs
( )

1804 
‹xtzÚe
 *
±z
 = 
tz
[
TZ_MONITOR
];

1805 
x
 = 
cursx
-
žoff
;

1807 ifÐ
mÚ_asmmode
 )

1809 
±z
->
fc
[±z->
w
*19+8+
x
] = 3;

1810 
±z
->
bc
[±z->
w
*19+8+
x
] = 2;

1814 ifÐÐ
x
 < 0 ) || ( x > 
CONS_WIDTH
 ) ) ;

1815 
±z
->
fc
[±z->
w
*19+2+
x
] = 3;

1816 
±z
->
bc
[±z->
w
*19+2+
x
] = 2;

1817 
	}
}

1819 
	$mÚ_süÞl
Ð
SDL_boÞ
 
above
 )

1821 
x
, 
y
, 
s
, 
d
, 
h
;

1822 
‹xtzÚe
 *
±z
 = 
tz
[
TZ_MONITOR
];

1824 
h
 = 
above
 ? 17 : 18;

1826 
s
 = 
±z
->
w
*2+1;

1827 
d
 = 
±z
->
w
+1;

1828  
y
=0; y<
h
; y++ )

1830  
x
=0; x<48; x++ )

1832 
±z
->
tx
[
d
] =…tz->tx[
s
];

1833 
±z
->
fc
[
d
] =…tz->fc[
s
];

1834 
±z
->
bc
[
d
++] =…tz->bc[
s
++];

1836 
d
 += 2;

1837 
s
 += 2;

1840  
x
=0; x<48; x++ )

1842 
±z
->
tx
[
d
] = ' ';

1843 
±z
->
fc
[
d
] = 2;

1844 
±z
->
bc
[
d
++] = 3;

1846 
	}
}

1848 
	$mÚ_Ýrštf
Ð*
fmt
, ... )

1850 
va_li¡
 
­
;

1851 
i
;

1852 
¡mp
[48];

1854 
	`va_¡¬t
Ð
­
, 
fmt
 );

1855 ifÐ
	`v¢´štf
Ð
v¥tmp
, 
VSPTMPSIZE
, 
fmt
, 
­
 ) != -1 )

1857 
v¥tmp
[
VSPTMPSIZE
-1] = 0;

1858 
i
 = 0;

1859  
	`¡¾’
Ð&
v¥tmp
[
i
] ) > 47 )

1861 
	`¡ºýy
Ð
¡mp
, &
v¥tmp
[
i
], 47 );

1862 
¡mp
[47] = 0;

1863 
	`tz¡½os
Ð
tz
[
TZ_MONITOR
], 1, 19, 
¡mp
 );

1864 
	`mÚ_süÞl
Ð
SDL_FALSE
 );

1865 
i
 += 47;

1867 
	`tz¡½os
Ð
tz
[
TZ_MONITOR
], 1, 19, &
v¥tmp
[
i
] );

1869 
	`va_’d
Ð
­
 );

1870 
	}
}

1872 
	$mÚ_´štf
Ð*
fmt
, ... )

1874 
va_li¡
 
­
;

1875 
i
;

1876 
¡mp
[48];

1878 
	`mÚ_süÞl
Ð
SDL_FALSE
 );

1880 
	`va_¡¬t
Ð
­
, 
fmt
 );

1881 ifÐ
	`v¢´štf
Ð
v¥tmp
, 
VSPTMPSIZE
, 
fmt
, 
­
 ) != -1 )

1883 
v¥tmp
[
VSPTMPSIZE
-1] = 0;

1884 
i
 = 0;

1885  
	`¡¾’
Ð&
v¥tmp
[
i
] ) > 46 )

1887 
	`¡ºýy
Ð
¡mp
, &
v¥tmp
[
i
], 46 );

1888 
¡mp
[46] = 0;

1889 
	`tz¡½os
Ð
tz
[
TZ_MONITOR
], 1, 19, 
¡mp
 );

1890 
	`mÚ_süÞl
Ð
SDL_FALSE
 );

1891 
i
 += 46;

1893 
	`tz¡½os
Ð
tz
[
TZ_MONITOR
], 1, 19, &
v¥tmp
[
i
] );

1895 
	`va_’d
Ð
­
 );

1896 
	}
}

1898 
	$mÚ_´štf_above
Ð*
fmt
, ... )

1900 
va_li¡
 
­
;

1901 
i
;

1902 
¡mp
[48];

1904 
	`mÚ_süÞl
Ð
SDL_TRUE
 );

1906 
	`va_¡¬t
Ð
­
, 
fmt
 );

1907 ifÐ
	`v¢´štf
Ð
v¥tmp
, 
VSPTMPSIZE
, 
fmt
, 
­
 ) != -1 )

1909 
v¥tmp
[
VSPTMPSIZE
-1] = 0;

1910 
i
 = 0;

1911  
	`¡¾’
Ð&
v¥tmp
[
i
] ) > 46 )

1913 
	`¡ºýy
Ð
¡mp
, &
v¥tmp
[
i
], 46 );

1914 
¡mp
[46] = 0;

1915 
	`tz¡½os
Ð
tz
[
TZ_MONITOR
], 1, 18, 
¡mp
 );

1916 
	`mÚ_süÞl
Ð
SDL_TRUE
 );

1917 
i
 += 46;

1919 
	`tz¡½os
Ð
tz
[
TZ_MONITOR
], 1, 18, &
v¥tmp
[
i
] );

1921 
	`va_’d
Ð
­
 );

1922 
	}
}

1924 
	$mÚ_¡r
Ð*
¡r
 )

1926 
	`mÚ_süÞl
Ð
SDL_FALSE
 );

1927 
	`tz¡½os
Ð
tz
[
TZ_MONITOR
], 1, 19, 
¡r
 );

1928 
	}
}

1930 
	$mÚ_¡r_above
Ð*
¡r
 )

1932 
	`mÚ_süÞl
Ð
SDL_TRUE
 );

1933 
	`tz¡½os
Ð
tz
[
TZ_MONITOR
], 1, 18, 
¡r
 );

1934 
	}
}

1936 
	$mÚ_¡¬t_šput
( )

1938 
	`mÚ_süÞl
Ð
SDL_FALSE
 );

1939 
ibuf
[0] = 0;

1940 
ž’
 = 0;

1941 
žoff
 = 0;

1942 
cursx
 = 0;

1944 ifÐ
mÚ_asmmode
 )

1946 
	`tz£tcÞ
Ð
tz
[
TZ_MONITOR
], 1, 3 );

1947 
	`tz´štåos
Ð
tz
[
TZ_MONITOR
], 1, 19, " %04X:", 
mÚ_addr
 );

1950 
	`tz£tcÞ
Ð
tz
[
TZ_MONITOR
], 1, 3 );

1951 
	`tz¡½os
Ð
tz
[
TZ_MONITOR
], 1, 19, "]" );

1952 
	}
}

1954 
	$mÚ_’‹r
Ð
machše
 *
Üic
 )

1956 
deçuÉsyms
.
syms
 = 
NULL
;

1957 
deçuÉsyms
.
numsyms
 = 0;

1958 
deçuÉsyms
.
sym¥aû
 = -1;

1959  
Üic
->
ty³
 )

1961 
MACH_ORIC1
:

1962 
MACH_ORIC1_16K
:

1963 
MACH_ATMOS
:

1964 
MACH_PRAVETZ
:

1965 
deçuÉsyms
.
syms
 = 
defsym_©mos
;

1966 
deçuÉsyms
.
numsyms
 = Ð
defsym_©mos
 ) / Ð
msym
 );

1969 
MACH_TELESTRAT
:

1970 
deçuÉsyms
.
syms
 = 
defsym_‹Ë
;

1971 
deçuÉsyms
.
numsyms
 = Ð
defsym_‹Ë
 ) / Ð
msym
 );

1975 ifÐ
mÚ_bpmsg
[0] )

1977 
	`mÚ_´štf_above
Ð
mÚ_bpmsg
 );

1978 
mÚ_bpmsg
[0] = 0;

1981 
modif›d
 = 
SDL_FALSE
;

1982 
upd©•»v›w
 = 
SDL_TRUE
;

1983 
	}
}

1985 
	$mÚ_w¬mš™
Ð
machše
 *
Üic
 )

1987 
	`mÚ_¡¬t_šput
();

1988 
	`mÚ_show_curs
();

1989 
	}
}

1991 
	$mÚ_š™
Ð
machše
 *
Üic
 )

1993 
deçuÉsyms
.
numsyms
 = 0;

1994 
deçuÉsyms
.
sym¥aû
 = 0;

1995 
deçuÉsyms
.
syms
 = 
NULL
;

1996 
Üic
->
u£rsyms
.
numsyms
 = 0;

1997 
Üic
->
u£rsyms
.
sym¥aû
 = 0;

1998 
Üic
->
u£rsyms
.
syms
 = 
NULL
;

2000 
mÚ_bpmsg
[0] = 0;

2001 
mshow
 = 
MSHOW_VIA
;

2002 
cshow
 = 
CSHOW_CONSOLE
;

2003 
mÚ_asmmode
 = 
SDL_FALSE
;

2004 
	`mÚ_¡¬t_šput
();

2005 
	`mÚ_show_curs
();

2006 
mÚ_addr
 = 
Üic
->
ýu
.
pc
;

2007 
Ï¡cmd
 = 0;

2008 
mw_¥l™
 = 
SDL_FALSE
;

2009 
mw_which
 = 0;

2010 
mw©ch_Þdv®id
 = 
SDL_FALSE
;

2011 
ýu_Þdv®id
 = 
SDL_FALSE
;

2012 
ay_Þdv®id
 = 
SDL_FALSE
;

2013 
vŸ_Þdv®id
 = 
SDL_FALSE
;

2014 #ià
LOG_DEBUG


2015 
debug_logfže
 = 
	`fÝ’
Ð
debug_logÇme
, "w" );

2017 
	}
}

2019 
	$mÚ_shut
Ð
machše
 *
Üic
 )

2021 
	`mÚ_ä“syms
Ð&
Üic
->
u£rsyms
 );

2022 #ià
LOG_DEBUG


2023 ifÐ
debug_logfže
 ) 
	`fþo£
( debug_logfile );

2024 
debug_logfže
 = 
NULL
;

2026 
	}
}

2028 
	$mÚ_g‘»g
Ð*
buf
, *
off
, 
SDL_boÞ
 
add¼egs
, SDL_boÞ 
Äegs
, SDL_boÞ 
vŸ»gs
 )

2030 
i
;

2032 
i
 = *
off
;

2034  
	`isws
Ð
buf
[
i
] ) ) i++;

2036 ifÐ
vŸ»gs
 )

2038 ifÐ
	`¡ºÿ£cmp
Ð&
buf
[
i
], "vpcr", 4 ) == 0 )

2040 
i
+=4;

2041 *
off
 = 
i
;

2042  
REG_VIA_PCR
;

2045 ifÐ
	`¡ºÿ£cmp
Ð&
buf
[
i
], "vacr", 4 ) == 0 )

2047 
i
+=4;

2048 *
off
 = 
i
;

2049  
REG_VIA_ACR
;

2052 ifÐ
	`¡ºÿ£cmp
Ð&
buf
[
i
], "vsr", 3 ) == 0 )

2054 
i
+=3;

2055 *
off
 = 
i
;

2056  
REG_VIA_SR
;

2059 ifÐ
	`¡ºÿ£cmp
Ð&
buf
[
i
], "vifr", 4 ) == 0 )

2061 
i
+=4;

2062 *
off
 = 
i
;

2063  
REG_VIA_IFR
;

2066 ifÐ
	`¡ºÿ£cmp
Ð&
buf
[
i
], "vier", 4 ) == 0 )

2068 
i
+=4;

2069 *
off
 = 
i
;

2070  
REG_VIA_IER
;

2073 ifÐ
	`¡ºÿ£cmp
Ð&
buf
[
i
], "vira", 4 ) == 0 )

2075 
i
+=4;

2076 *
off
 = 
i
;

2077  
REG_VIA_IRA
;

2080 ifÐ
	`¡ºÿ£cmp
Ð&
buf
[
i
], "vora", 4 ) == 0 )

2082 
i
+=4;

2083 *
off
 = 
i
;

2084  
REG_VIA_ORA
;

2087 ifÐ
	`¡ºÿ£cmp
Ð&
buf
[
i
], "vddra", 5 ) == 0 )

2089 
i
+=5;

2090 *
off
 = 
i
;

2091  
REG_VIA_DDRA
;

2094 ifÐ
	`¡ºÿ£cmp
Ð&
buf
[
i
], "virb", 4 ) == 0 )

2096 
i
+=4;

2097 *
off
 = 
i
;

2098  
REG_VIA_IRB
;

2101 ifÐ
	`¡ºÿ£cmp
Ð&
buf
[
i
], "vorb", 4 ) == 0 )

2103 
i
+=4;

2104 *
off
 = 
i
;

2105  
REG_VIA_ORB
;

2108 ifÐ
	`¡ºÿ£cmp
Ð&
buf
[
i
], "vddrb", 5 ) == 0 )

2110 
i
+=5;

2111 *
off
 = 
i
;

2112  
REG_VIA_DDRB
;

2115 ifÐ
	`¡ºÿ£cmp
Ð&
buf
[
i
], "vt1l", 4 ) == 0 )

2117 
i
+=4;

2118 *
off
 = 
i
;

2119  
REG_VIA_T1L
;

2122 ifÐ
	`¡ºÿ£cmp
Ð&
buf
[
i
], "vt1c", 4 ) == 0 )

2124 
i
+=4;

2125 *
off
 = 
i
;

2126  
REG_VIA_T1C
;

2129 ifÐ
	`¡ºÿ£cmp
Ð&
buf
[
i
], "vt2l", 4 ) == 0 )

2131 
i
+=4;

2132 *
off
 = 
i
;

2133  
REG_VIA_T2L
;

2136 ifÐ
	`¡ºÿ£cmp
Ð&
buf
[
i
], "vt2c", 4 ) == 0 )

2138 
i
+=4;

2139 *
off
 = 
i
;

2140  
REG_VIA_T2C
;

2143 ifÐ
	`¡ºÿ£cmp
Ð&
buf
[
i
], "vca1", 4 ) == 0 )

2145 
i
+=4;

2146 *
off
 = 
i
;

2147  
REG_VIA_CA1
;

2150 ifÐ
	`¡ºÿ£cmp
Ð&
buf
[
i
], "vca2", 4 ) == 0 )

2152 
i
+=4;

2153 *
off
 = 
i
;

2154  
REG_VIA_CA2
;

2157 ifÐ
	`¡ºÿ£cmp
Ð&
buf
[
i
], "vcb1", 4 ) == 0 )

2159 
i
+=4;

2160 *
off
 = 
i
;

2161  
REG_VIA_CB1
;

2164 ifÐ
	`¡ºÿ£cmp
Ð&
buf
[
i
], "vcb2", 4 ) == 0 )

2166 
i
+=4;

2167 *
off
 = 
i
;

2168  
REG_VIA_CA2
;

2172 ifÐ
add¼egs
 )

2174 ifÐ
	`¡ºÿ£cmp
Ð&
buf
[
i
], "pc", 2 ) == 0 )

2176 
i
+=2;

2177 *
off
 = 
i
;

2178  
REG_PC
;

2181 ifÐ
	`¡ºÿ£cmp
Ð&
buf
[
i
], "sp", 2 ) == 0 )

2183 
i
+=2;

2184 *
off
 = 
i
;

2185  
REG_SP
;

2189 ifÐ
Äegs
 )

2191  
buf
[
i
] )

2195 
i
++;

2196 *
off
 = 
i
;

2197  
REG_A
;

2201 
i
++;

2202 *
off
 = 
i
;

2203  
REG_X
;

2207 
i
++;

2208 *
off
 = 
i
;

2209  
REG_Y
;

2214 
	}
}

2216 
SDL_boÞ
 
	$mÚ_g‘num
Ð
machše
 *
Üic
, *
num
, *
buf
, *
off
, 
SDL_boÞ
 
add¼egs
, SDL_boÞ 
Äegs
, SDL_boÞ 
vŸ»gs
, SDL_boÞ 
symbÞs
 )

2218 
i
, 
j
;

2219 
c
;

2220 
v
;

2222 
i
 = *
off
;

2223  
	`isws
Ð
buf
[
i
] ) ) i++;

2225 ifÐÐ
symbÞs
 ) && ( 
	`issym¡¬t
Ð
buf
[
i
] ) ) )

2227 
msym
 *
fsym
;

2229  
j
=0; 
	`issymch¬
Ð
buf
[
i
+j] ); j++ ) ;

2230 
c
 = 
buf
[
i
+
j
];

2231 ifÐ
	`isws
Ð
c
 ) || ( c == 13 ) || ( c == 10 ) || ( c == 0 ) || ( c == ',' ) || ( c == ')' ) )

2233 
buf
[
i
+
j
] = 0;

2234 
fsym
 = 
	`mÚ_fšd_sym_by_Çme
Ð
Üic
, &
buf
[
i
] );

2235 
buf
[
i
+
j
] = 
c
;

2236 ifÐ
fsym
 )

2238 (*
num
èð
fsym
->
addr
;

2239 (*
off
èð
i
+
j
;

2240  
SDL_TRUE
;

2245 
j
 = 
	`mÚ_g‘»g
Ð
buf
, 
off
, 
add¼egs
, 
Äegs
, 
vŸ»gs
 );

2246 ifÐ
j
 != -1 )

2248  
j
 )

2250 
REG_A
:

2251 *
num
 = 
Üic
->
ýu
.
a
;

2252  
SDL_TRUE
;

2253 
REG_X
:

2254 *
num
 = 
Üic
->
ýu
.
x
;

2255  
SDL_TRUE
;

2256 
REG_Y
:

2257 *
num
 = 
Üic
->
ýu
.
y
;

2258  
SDL_TRUE
;

2259 
REG_PC
:

2260 *
num
 = 
Üic
->
ýu
.
pc
;

2261  
SDL_TRUE
;

2262 
REG_SP
:

2263 *
num
 = 
Üic
->
ýu
.
¥
|0x100;

2264  
SDL_TRUE
;

2265 
REG_VIA_PCR
:

2266 *
num
 = 
Üic
->
vŸ
.
pü
;

2267  
SDL_TRUE
;

2268 
REG_VIA_ACR
:

2269 *
num
 = 
Üic
->
vŸ
.
aü
;

2270  
SDL_TRUE
;

2271 
REG_VIA_SR
:

2272 *
num
 = 
Üic
->
vŸ
.
¤
;

2273  
SDL_TRUE
;

2274 
REG_VIA_IFR
:

2275 *
num
 = 
Üic
->
vŸ
.
iä
;

2276  
SDL_TRUE
;

2277 
REG_VIA_IER
:

2278 *
num
 = 
Üic
->
vŸ
.
›r
;

2279  
SDL_TRUE
;

2280 
REG_VIA_IRA
:

2281 *
num
 = 
Üic
->
vŸ
.
œa
;

2282  
SDL_TRUE
;

2283 
REG_VIA_ORA
:

2284 *
num
 = 
Üic
->
vŸ
.
Üa
;

2285  
SDL_TRUE
;

2286 
REG_VIA_DDRA
:

2287 *
num
 = 
Üic
->
vŸ
.
dd¿
;

2288  
SDL_TRUE
;

2289 
REG_VIA_IRB
:

2290 *
num
 = 
Üic
->
vŸ
.
œb
;

2291  
SDL_TRUE
;

2292 
REG_VIA_ORB
:

2293 *
num
 = 
Üic
->
vŸ
.
Üb
;

2294  
SDL_TRUE
;

2295 
REG_VIA_DDRB
:

2296 *
num
 = 
Üic
->
vŸ
.
ddrb
;

2297  
SDL_TRUE
;

2298 
REG_VIA_T1L
:

2299 *
num
 = (
Üic
->
vŸ
.
t1l_h
<<8)|Üic->vŸ.
t1l_l
;

2300  
SDL_TRUE
;

2301 
REG_VIA_T1C
:

2302 *
num
 = 
Üic
->
vŸ
.
t1c
;

2303  
SDL_TRUE
;

2304 
REG_VIA_T2L
:

2305 *
num
 = (
Üic
->
vŸ
.
t2l_h
<<8)|Üic->vŸ.
t2l_l
;

2306  
SDL_TRUE
;

2307 
REG_VIA_T2C
:

2308 *
num
 = 
Üic
->
vŸ
.
t2c
;

2309  
SDL_TRUE
;

2310 
REG_VIA_CA1
:

2311 *
num
 = 
Üic
->
vŸ
.
ÿ1
;

2312  
SDL_TRUE
;

2313 
REG_VIA_CA2
:

2314 *
num
 = 
Üic
->
vŸ
.
ÿ2
;

2315  
SDL_TRUE
;

2316 
REG_VIA_CB1
:

2317 *
num
 = 
Üic
->
vŸ
.
cb1
;

2318  
SDL_TRUE
;

2319 
REG_VIA_CB2
:

2320 *
num
 = 
Üic
->
vŸ
.
cb2
;

2321  
SDL_TRUE
;

2325 ifÐ
buf
[
i
] == '%' )

2328 
i
++;

2329 ifÐ!
	`isbš
Ð
buf
[
i
] ) )  
SDL_FALSE
;

2331 
v
 = 0;

2332  
	`isbš
Ð
buf
[
i
] ) )

2334 
v
 = (v<<1è| (
buf
[
i
]-'0');

2335 
i
++;

2338 *
num
 = 
v
;

2339 *
off
 = 
i
;

2340  
SDL_TRUE
;

2343 ifÐ
buf
[
i
] == '$' )

2346 
i
++;

2347 ifÐ!
	`ishex
Ð
buf
[
i
] ) )  
SDL_FALSE
;

2349 
v
 = 0;

2352 
j
 = 
	`hex™
Ð
buf
[
i
] );

2353 ifÐ
j
 == -1 ) ;

2354 
v
 = (v<<4è| 
j
;

2355 
i
++;

2358 *
num
 = 
v
;

2359 *
off
 = 
i
;

2360  
SDL_TRUE
;

2363 ifÐ!
	`i¢um
Ð
buf
[
i
] ) )  
SDL_FALSE
;

2365 
v
 = 0;

2366  
	`i¢um
Ð
buf
[
i
] ) )

2368 
v
 = (v*10è+ (
buf
[
i
]-'0');

2369 
i
++;

2372 *
num
 = 
v
;

2373 *
off
 = 
i
;

2374  
SDL_TRUE
;

2375 
	}
}

2377 
Ušt16
 
	$mÚ_sym_be¡_guess
Ð
machše
 *
Üic
, 
Ušt16
 
addr
, *
symÇme
, 
SDL_boÞ
 
u£_emu_¡©e
 )

2380 ifÐ
addr
 >= 0xc000 )

2383 ifÐ
Üic
->
ty³
 =ð
MACH_TELESTRAT
 )

2386 ifÐÐ
symÇme
[0] == 't' ) &&

2387 ÐÐ
symÇme
[1] >= '0' ) && ( symname[1] <= '7' ) ) &&

2388 Ð
symÇme
[2] == '_' ) )

2389  
SYMF_TELEBANK0
 << (
symÇme
[1]-'0');

2392 ifÐ
u£_emu_¡©e
 )

2393  
SYMF_TELEBANK0
 << 
Üic
->
‹Ë_cu¼bªk
;

2396  
SYMF_TELEBANK0
|
SYMF_TELEBANK1
|
SYMF_TELEBANK2
|
SYMF_TELEBANK3
|
SYMF_TELEBANK4
|
SYMF_TELEBANK5
|
SYMF_TELEBANK6
|
SYMF_TELEBANK7
;

2400 ifÐ
u£_emu_¡©e
 )

2402 
romdis
 = 
Üic
->romdis;

2403 ifÐÐ
Üic
->
driv‘y³
 =ð
DRV_JASMIN
 ) && ( oric->
jasmš
.
Þay
 ) )

2404 
romdis
 = 1;

2406  
romdis
 ? 
SYMF_ROMDIS1
 : 
SYMF_ROMDIS0
;

2409  
SYMF_ROMDIS1
;

2414 
	}
}

2416 
msym
 *
	$mÚ_»¶aû_Ü_add_symbÞ
Ð
symbÞbË
 *
¡ab
, 
machše
 *
Üic
, *
symÇme
, 
æags
, 
Ušt16
 
addr
 )

2418 
i
;

2419 
symtmp
[160];

2420 
msym
 *
»tv®
 = 
NULL
;

2422  
i
=0; 
	`issymch¬
(
symÇme
[i]); i++ )

2423 
symtmp
[
i
] = 
symÇme
[i];

2424 
symtmp
[
i
] = 0;

2427 ifÐ
¡ab
->
sym¥aû
 =ð-1 )  
»tv®
;

2429 ifÐ
æags
 =ð
SYM_BESTGUESS
 )

2430 
æags
 = 
	`mÚ_sym_be¡_guess
Ð
Üic
, 
addr
, 
symtmp
, 
SDL_TRUE
 );

2432  
i
=0; i<
¡ab
->
numsyms
; i++ )

2434 ifÐ!
Üic
->
symbÞsÿ£
 )

2436 ifÐ
	`¡rÿ£cmp
Ð
symtmp
, 
¡ab
->
syms
[
i
].
Çme
 ) == 0 )

2439 ifÐ
	`¡rcmp
Ð
symtmp
, 
¡ab
->
syms
[
i
].
Çme
 ) == 0 )

2445 ifÐ
i
 < 
¡ab
->
numsyms
 )

2447 
¡ab
->
syms
[
i
].
addr
 =‡ddr;

2448 
¡ab
->
syms
[
i
].
æags
 = flags;

2449  &
¡ab
->
syms
[
i
];

2452 
	`mÚ_addsym
Ð
¡ab
, 
addr
, 
æags
, 
symtmp
, &
»tv®
 );

2453  
»tv®
;

2454 
	}
}

2456 
SDL_boÞ
 
	$mÚ_symsäom¢­shÙ
Ð
symbÞbË
 *
¡ab
, *
bufãr
, 
Ën
)

2458 
offs
, 
symËn
, 
addr
, 
æags
;

2459 *
symÇme
;

2461 
¡ab
->
numsyms
 = 0;

2463 
offs
 = 0;

2464 
offs
 < 
Ën
)

2466 
symËn
 = (
bufãr
[
offs
]<<24)|(buffer[offs+1]<<16)|(buffer[offs+2]<<8)|buffer[offs+3];

2467 
offs
+=4;

2468 ià(
symËn
+
offs
 >ð
Ën
è 
SDL_FALSE
;

2470 
symÇme
 = (*)(&
bufãr
[
offs
]);

2471 
offs
 +ð
symËn
;

2473 
addr
 = (
bufãr
[
offs
]<<8)|buffer[offs+1];

2474 
offs
 += 2;

2476 
æags
 = (
bufãr
[
offs
]<<8)|buffer[offs+1];

2477 
offs
 += 2;

2479 
	`mÚ_addsym
Ð
¡ab
, 
addr
, 
æags
, 
symÇme
, 
NULL
 );

2482  
SDL_TRUE
;

2483 
	}
}

2487 
SDL_boÞ
 
	$mÚ_Ãw_symbÞs
Ð
symbÞbË
 *
¡ab
, 
machše
 *
Üic
, *
âame
, 
æags
, 
SDL_boÞ
 
above
, SDL_boÞ 
v”bo£
 )

2489 
FILE
 *
f
;

2490 
i
, 
j
;

2491 
v
;

2493 
f
 = 
	`fÝ’
Ð
âame
, "r" );

2494 ifÐ!
f
 )

2496 ifÐ
v”bo£
 )

2498 ifÐ
above
 )

2499 
	`mÚ_´štf_above
Ð"UÇbËØÝ’ '%s'", 
âame
 );

2501 
	`mÚ_´štf
Ð"UÇbËØÝ’ '%s'", 
âame
 );

2503  
SDL_FALSE
;

2506 
¡ab
->
numsyms
 = 0;

2507  !
	`ãof
Ð
f
 ) )

2509 
lš‘mp
[256];

2511 ifÐ!
	`fg‘s
Ð
lš‘mp
, 256, 
f
 ) ) ;

2513 ifÐ
	`ssÿnf
Ð
lš‘mp
, "® %06X .%s", &
v
,†inetmp ) != 2 )

2515  
i
=0, 
v
=0; i<4; i++ )

2517 
j
 = 
	`hex™
Ð
lš‘mp
[
i
] );

2518 ifÐ
j
 == -1 ) ;

2519 
v
 = (v<<4)|
j
;

2521 ifÐ
i
 < 4 ) ;

2522 ifÐ
lš‘mp
[4] != 32 ) ;

2523 ifÐ!
	`issym¡¬t
Ð
lš‘mp
[5] ) ) ;

2525  
i
=5,
j
=0; 
	`issymch¬
(
lš‘mp
[i]); i++,j++ )

2526 
lš‘mp
[
j
] =†š‘mp[
i
];

2527 
lš‘mp
[
j
] = 0;

2531 
	`fæush
Ð
¡dout
 );

2534 ifÐ
æags
 =ð
SYM_BESTGUESS
 )

2536 
	`mÚ_addsym
Ð
¡ab
, 
v
, 
	`mÚ_sym_be¡_guess
Ð
Üic
, v, 
lš‘mp
, 
SDL_FALSE
 ),†š‘mp, 
NULL
 );

2538 
	`mÚ_addsym
Ð
¡ab
, 
v
, 
æags
, 
lš‘mp
, 
NULL
 );

2542 
	`fþo£
Ð
f
 );

2544 ifÐ
v”bo£
 )

2546 ifÐ
above
 )

2547 
	`mÚ_´štf_above
Ð"SymbÞ lßded from '%s'", 
âame
 );

2549 
	`mÚ_´štf
Ð"SymbÞ lßded from '%s'", 
âame
 );

2551  
SDL_TRUE
;

2552 
	}
}

2554 
SDL_boÞ
 
	$mÚ_cmd
Ð*
cmd
, 
machše
 *
Üic
, 
SDL_boÞ
 *
Ãed»nd”
 )

2556 
i
, 
j
, 
k
, 
l
;

2557 
v
, 
w
;

2558 
SDL_boÞ
 
dÚe
 = 
SDL_FALSE
;

2559 *
tmem
;

2560 
msym
 *
tmpsym
;

2561 
FILE
 *
f
;

2563 
i
=0;

2564  
	`isws
Ð
cmd
[
i
] ) ) i++;

2566 ifÐ
cmd
[
i
] != '?' )

2567 
h–pcouÁ
 = 0;

2569  
cmd
[
i
] )

2572 
Ï¡cmd
 = 
cmd
[
i
];

2573 
i
++;

2575 ifÐ
	`mÚ_g‘num
Ð
Üic
, &
v
, 
cmd
, &
i
, 
SDL_TRUE
, 
SDL_FALSE
, SDL_FALSE, SDL_TRUE ) )

2576 
mÚ_addr
 = 
v
;

2578 
mÚ_asmmode
 = 
SDL_TRUE
;

2582 
Ï¡cmd
 = 0;

2583 
i
++;

2584  
cmd
[
i
] )

2587 
Üic
->
symbÞsÿ£
 = 
SDL_FALSE
;

2588 
	`mÚ_¡r
( "Symbols‡re‚ot case-sensitive" );

2592 
Üic
->
symbÞsÿ£
 = 
SDL_TRUE
;

2593 
	`mÚ_¡r
( "Symbols‡re case-sensitive" );

2597 ifÐ!
	`isws
Ð
cmd
[
i
+1] ) )

2599 
	`mÚ_¡r
( "???" );

2603 
i
+=2;

2604  
	`isws
Ð
cmd
[
i
] ) ) i++;

2606 ifÐ!
	`issym¡¬t
Ð
cmd
[
i
] ) )

2608 
	`mÚ_¡r
( "Expected symbol‚ame‡nd‡ddress" );

2612 
j
 = 
i
;

2613  
	`issymch¬
Ð
cmd
[
i
] ) ) i++;

2615 ifÐ!
	`isws
Ð
cmd
[
i
] ) )

2617 
	`mÚ_¡r
( "Expected symbol‚ame‡nd‡ddress" );

2621 ifÐ!
	`mÚ_g‘num
Ð
Üic
, &
v
, 
cmd
, &
i
, 
SDL_TRUE
, 
SDL_FALSE
, SDL_FALSE, SDL_TRUE ) )

2623 
	`mÚ_¡r
( "Addressƒxpected" );

2627 
tmpsym
 = 
	`mÚ_»¶aû_Ü_add_symbÞ
Ð&
Üic
->
u£rsyms
, oric, &
cmd
[
j
], 
SYM_BESTGUESS
, 
v
 );

2628 ifÐ!
tmpsym
 )

2630 
	`mÚ_¡r
( "Failed for some„eason" );

2634 
	`mÚ_´štf
Ð"% ð%04X", 
tmpsym
->
Çme
,mpsym->
addr
 );

2638 ifÐ!
	`isws
Ð
cmd
[
i
+1] ) )

2640 
	`mÚ_¡r
( "???" );

2644 
i
+=2;

2645  
	`isws
Ð
cmd
[
i
] ) ) i++;

2647 ifÐ!
	`issym¡¬t
Ð
cmd
[
i
] ) )

2649 
	`mÚ_¡r
( "Symbolƒxpected" );

2653 
j
 = 
i
;

2654  
	`issymch¬
Ð
cmd
[
i
] ) ) i++;

2656 ifÐ
cmd
[
i
] != 0 )

2658 
	`mÚ_´štf
Ð"Ex³ùedƒnd oàlš© '%s'", &
cmd
[
i
] );

2662 ifÐ!
	`mÚ_b_fšd_sym_by_Çme
Ð&
Üic
->
u£rsyms
, oric, &
cmd
[
j
], &
k
 ) )

2664 
	`mÚ_´štf
Ð"Couldn'ˆfšd '%s' iÀthu£¸symbÞabË", &
cmd
[
j
] );

2668  ; 
k
<(
Üic
->
u£rsyms
.
numsyms
-1); k++ )

2669 
Üic
->
u£rsyms
.
syms
[
k
] = oric->usersyms.syms[k+1];

2670 
Üic
->
u£rsyms
.
numsyms
--;

2671 
	`mÚ_´štf
Ð"KžËd symbÞ '%s'", &
cmd
[
j
] );

2675 
Üic
->
u£rsyms
.
numsyms
 = 0;

2676 
	`mÚ_¡r
( "Symbols zapped!" );

2680 ifÐ!
	`isws
Ð
cmd
[
i
+1] ) )

2682 
	`mÚ_¡r
( "???" );

2686 
i
+=2;

2688 
	`mÚ_Ãw_symbÞs
Ð&
Üic
->
u£rsyms
, oric, &
cmd
[
i
], 
SYM_BESTGUESS
, 
SDL_FALSE
, 
SDL_TRUE
 );

2692 ifÐ!
	`isws
Ð
cmd
[
i
+1] ) )

2694 
	`mÚ_¡r
( "???" );

2698 
i
+=2;

2700 
f
 = 
	`fÝ’
Ð&
cmd
[
i
], "w" );

2701 ifÐ!
f
 )

2703 
	`mÚ_´štf
Ð"UÇbËØÝ’ '%s' fÜ wr™šg", &
cmd
[
i
] );

2707  
j
=0; j<
Üic
->
u£rsyms
.
numsyms
; j++ )

2708 
	`årštf
Ð
f
, "%04X %s\n", 
Üic
->
u£rsyms
.
syms
[
j
].
addr
, oric->u£rsyms.syms[j].
Çme
 );

2709 
	`fþo£
Ð
f
 );

2711 
	`mÚ_´štf
Ð"U£¸symbÞ expÜ‹dØ'%s'", &
cmd
[
i
] );

2715 
	`mÚ_¡r
( "???" );

2721 
Ï¡cmd
 = 0;

2722 
i
++;

2723  
cmd
[
i
] )

2726 ifÐ
cmd
[
i
+1] == 'm' )

2728 
Üic
->
ýu
.
ªymbp
 = 
SDL_FALSE
;

2729  
j
=0; j<16; j++ )

2731 ifÐ
Üic
->
ýu
.
memb»akpošts
[
j
].
æags
 )

2733 
	`mÚ_´štf
( "%02d: $%04X %c%c%c",

2734 
j
,

2735 
Üic
->
ýu
.
memb»akpošts
[
j
].
addr
,

2736 (
Üic
->
ýu
.
memb»akpošts
[
j
].
æags
&
MBPF_READ
) ? 'r' : ' ',

2737 (
Üic
->
ýu
.
memb»akpošts
[
j
].
æags
&
MBPF_WRITE
) ? 'w' : ' ',

2738 (
Üic
->
ýu
.
memb»akpošts
[
j
].
æags
&
MBPF_CHANGE
) ? 'c' : ' ' );

2739 
Üic
->
ýu
.
ªymbp
 = 
SDL_TRUE
;

2745 
Üic
->
ýu
.
ªybp
 = 
SDL_FALSE
;

2746  
j
=0; j<16; j++ )

2748 ifÐ
Üic
->
ýu
.
b»akpošts
[
j
] != -1 )

2750 
	`mÚ_´štf
( "%02d: $%04X %s%s",

2751 
j
,

2752 
Üic
->
ýu
.
b»akpošts
[
j
],

2753 (
Üic
->
ýu
.
b»akpošt_æags
[
j
]&
MBPF_RESETCYCLES
) ? "z" : "",

2754 (
Üic
->
ýu
.
b»akpošt_æags
[
j
]&
MBPF_RESETCYCLESCONTINUE
) ? "c" : "");

2755 
Üic
->
ýu
.
ªybp
 = 
SDL_TRUE
;

2761 ifÐ
cmd
[
i
+1] == 'm' )

2763  
j
=0; j<16; j++ )

2765 ifÐ
Üic
->
ýu
.
memb»akpošts
[
j
].
æags
 == 0 )

2769 ifÐ
j
 == 16 )

2771 
	`mÚ_¡r
( "Max 16 breakpoints" );

2775 
i
 += 2;

2776 ifÐ!
	`mÚ_g‘num
Ð
Üic
, &
v
, 
cmd
, &
i
, 
SDL_TRUE
, SDL_TRUE, SDL_TRUE, SDL_TRUE ) )

2778 
	`mÚ_¡r
( "Addressƒxpected" );

2782 
Üic
->
ýu
.
memb»akpošts
[
j
].
addr
 = 
v
 & 0xffff;

2783 
Üic
->
ýu
.
memb»akpošts
[
j
].
Ï¡v®
 = 
	`mÚ_»ad
ÐÜic, 
v
&0xffff );

2784 
Üic
->
ýu
.
memb»akpošts
[
j
].
æags
 = 0;

2786  
	`isws
Ð
cmd
[
i
] ) ) i++;

2790  
cmd
[
i
] )

2793 
Üic
->
ýu
.
memb»akpošts
[
j
].
æags
 |ð
MBPF_READ
;

2794 
i
++;

2798 
Üic
->
ýu
.
memb»akpošts
[
j
].
æags
 |ð
MBPF_WRITE
;

2799 
i
++;

2803 
Üic
->
ýu
.
memb»akpošts
[
j
].
æags
 |ð
MBPF_CHANGE
;

2804 
i
++;

2810 ifÐ!
Üic
->
ýu
.
memb»akpošts
[
j
].
æags
 )

2811 
Üic
->
ýu
.
memb»akpošts
[
j
].
æags
 = 
MBPF_READ
|
MBPF_WRITE
;

2812 
Üic
->
ýu
.
ªymbp
 = 
SDL_TRUE
;

2814 
	`mÚ_´štf
Ð"m%02d: $%04X %s%s%s", 
j
, 
Üic
->
ýu
.
memb»akpošts
[j].
addr
,

2815 (
Üic
->
ýu
.
memb»akpošts
[
j
].
æags
&
MBPF_READ
) ? "r" : "",

2816 (
Üic
->
ýu
.
memb»akpošts
[
j
].
æags
&
MBPF_WRITE
) ? "w" : "",

2817 (
Üic
->
ýu
.
memb»akpošts
[
j
].
æags
&
MBPF_CHANGE
) ? "c" : "" );

2821  
j
=0; j<16; j++ )

2823 ifÐ
Üic
->
ýu
.
b»akpošts
[
j
] == -1 )

2827 ifÐ
j
 == 16 )

2829 
	`mÚ_¡r
( "Max 16 breakpoints" );

2833 
i
++;

2834 ifÐ!
	`mÚ_g‘num
Ð
Üic
, &
v
, 
cmd
, &
i
, 
SDL_TRUE
, SDL_TRUE, SDL_TRUE, SDL_TRUE ) )

2836 
	`mÚ_¡r
( "Addressƒxpected" );

2840 
Üic
->
ýu
.
b»akpošts
[
j
] = 
v
 & 0xffff;

2841 
Üic
->
ýu
.
b»akpošt_æags
[
j
] = 0;

2842 
Üic
->
ýu
.
ªybp
 = 
SDL_TRUE
;

2844  
	`isws
Ð
cmd
[
i
] ) ) i++;

2848  
cmd
[
i
] )

2851 
Üic
->
ýu
.
b»akpošt_æags
[
j
] |ð
MBPF_RESETCYCLES
;

2852 
i
++;

2855 
Üic
->
ýu
.
b»akpošt_æags
[
j
] |ð
MBPF_RESETCYCLESCONTINUE
;

2856 
i
++;

2862 
	`mÚ_´štf
( "%02d: $%04X %s%s",

2863 
j
,

2864 
Üic
->
ýu
.
b»akpošts
[
j
],

2865 (
Üic
->
ýu
.
b»akpošt_æags
[
j
]&
MBPF_RESETCYCLES
) ? "z" : "",

2866 (
Üic
->
ýu
.
b»akpošt_æags
[
j
]&
MBPF_RESETCYCLESCONTINUE
) ? "c" : "" );

2870 
j
 = 0;

2871 ifÐ
cmd
[
i
+1] == 'm' )

2873 
j
 = 1;

2874 
i
++;

2877 
i
++;

2878 ifÐ!
	`mÚ_g‘num
Ð
Üic
, &
v
, 
cmd
, &
i
, 
SDL_FALSE
, SDL_FALSE, SDL_FALSE, SDL_FALSE ) )

2880 
	`mÚ_¡r
( "Breakpoint IDƒxpected" );

2884 ifÐ
v
 > 15 )

2886 
	`mÚ_¡r
( "Invalid breakpoint ID" );

2890 ifÐ
j
 )

2892 
Üic
->
ýu
.
memb»akpošts
[
v
].
æags
 = 0;

2893 
Üic
->
ýu
.
ªymbp
 = 
SDL_FALSE
;

2894  
j
=0; j<16; j++ )

2896 ifÐ
Üic
->
ýu
.
memb»akpošts
[
j
].
æags
 != 0 )

2898 
Üic
->
ýu
.
ªymbp
 = 
SDL_TRUE
;

2905 
Üic
->
ýu
.
b»akpošts
[
v
] = -1;

2906 
Üic
->
ýu
.
ªybp
 = 
SDL_FALSE
;

2907  
j
=0; j<16; j++ )

2909 ifÐ
Üic
->
ýu
.
b»akpošts
[
j
] != -1 )

2911 
Üic
->
ýu
.
ªybp
 = 
SDL_TRUE
;

2918 ifÐ
cmd
[
i
+1] == 'm' )

2920  
i
=0; i<16; i++ )

2921 
Üic
->
ýu
.
memb»akpošts
[
i
].
æags
 = 0;

2922 
Üic
->
ýu
.
ªymbp
 = 
SDL_FALSE
;

2926  
i
=0; i<16; i++ )

2927 
Üic
->
ýu
.
b»akpošts
[
i
] = -1;

2928 
Üic
->
ýu
.
ªybp
 = 
SDL_FALSE
;

2932 
	`mÚ_¡r
( "???" );

2938 
Ï¡cmd
 = 
cmd
[
i
];

2939 
i
++;

2941  
cmd
[
i
] )

2944 
Ï¡cmd
 = 0;

2945 
i
++;

2947 ifÐ!
	`mÚ_g‘num
Ð
Üic
, &
v
, 
cmd
, &
i
, 
SDL_TRUE
, 
SDL_FALSE
, SDL_FALSE, SDL_TRUE ) )

2949 
	`mÚ_¡r
( "Bad‡ddress" );

2953 ifÐ!
	`mÚ_g‘num
Ð
Üic
, &
w
, 
cmd
, &
i
, 
SDL_TRUE
, 
SDL_FALSE
, SDL_FALSE, SDL_TRUE ) )

2955 
	`mÚ_¡r
( "Valueƒxpected" );

2959 
	`mÚ_£t_modif›d
Ð
Üic
 );

2960 
Üic
->
ýu
.
	`wr™e
Ð&Üic->ýu, 
v
, 
w
 );

2961 
upd©•»v›w
 = 
SDL_TRUE
;

2965 
Ï¡cmd
 = 0;

2966 
i
++;

2968 ifÐ!
	`mÚ_g‘num
Ð
Üic
, &
v
, 
cmd
, &
i
, 
SDL_TRUE
, 
SDL_FALSE
, SDL_FALSE, SDL_TRUE ) )

2970 
	`mÚ_¡r
( "Bad‡ddress" );

2974 ifÐ
mw_¥l™
 )

2976 
mw_addr
[
mw_which
] = 
v
;

2978 
mw_which
 = 0;

2979 
mw_addr
[0] = 
v
;

2981 
cshow
 = 
CSHOW_MWATCH
;

2985 ifÐÐ
cmd
[
i
] !ð0 ) && ( !
	`isws
( cmd[i] ) ) )

2987 
	`mÚ_¡r
( "???" );

2992 ifÐ
	`mÚ_g‘num
Ð
Üic
, &
v
, 
cmd
, &
i
, 
SDL_TRUE
, 
SDL_FALSE
, SDL_FALSE, SDL_TRUE ) )

2993 
mÚ_addr
 = 
v
;

2995  
j
=0; j<16; j++ )

2997 
	`¥rštf
Ð
v¥tmp
, "%04X ", 
mÚ_addr
 );

2998  
k
=0; k<8; k++ )

3000 
tmp
[8];

3001 
	`¢´štf
Ð
tmp
, 7, "%02X ", 
	`mÚ_»ad
Ð
Üic
, 
mÚ_addr
+
k
 ) );

3002 
	`¡rÿt
Ð
v¥tmp
, 
tmp
 );

3004 
l
 = ()
	`¡¾’
Ð
v¥tmp
 );

3005 
v¥tmp
[
l
++] = 32;

3006 
v¥tmp
[
l
++] = '\'';

3007  
k
=0; k<8; k++ )

3009 
v
 = 
	`mÚ_»ad
Ð
Üic
, 
mÚ_addr
++ );

3010 
v¥tmp
[
l
++] = ((
v
>31)&&(v<128))?v:'.';

3012 
v¥tmp
[
l
++] = '\'';

3013 
v¥tmp
[
l
++] = 0;

3014 
	`mÚ_¡r
Ð
v¥tmp
 );

3021 ifÐ
cmd
[
i
+1] == 'f' )

3023 
i
+=2;

3025 ifÐ!
	`mÚ_g‘num
Ð
Üic
, &
v
, 
cmd
, &
i
, 
SDL_TRUE
, 
SDL_FALSE
, SDL_FALSE, SDL_TRUE ) )

3027 
	`mÚ_¡r
( "Start‡ddressƒxpected\n" );

3031 
mÚ_addr
 = 
v
;

3032 ifÐ!
	`mÚ_g‘num
Ð
Üic
, &
v
, 
cmd
, &
i
, 
SDL_TRUE
, 
SDL_FALSE
, SDL_FALSE, SDL_TRUE ) )

3034 
	`mÚ_¡r
( "End‡ddressƒxpected\n" );

3038  
	`isws
Ð
cmd
[
i
] ) ) i++;

3039 ifÐ!
cmd
[
i
] )

3041 
	`mÚ_¡r
( "Filenameƒxpected" );

3045 
f
 = 
	`fÝ’
Ð&
cmd
[
i
], "w" );

3046 ifÐ!
f
 )

3048 
	`mÚ_´štf
Ð"UÇbËØÝ’ '%s'", &
cmd
[
i
] );

3052  
mÚ_addr
 <ð
v
 )

3054 
SDL_boÞ
 
loÝed
;

3055 
	`årštf
Ð
f
, "%s\n", 
	`mÚ_di§s£mbË
Ð
Üic
, &
mÚ_addr
, &
loÝed
, 
SDL_TRUE
 ) );

3056 ifÐ
loÝed
 ) ;

3059 
	`fþo£
Ð
f
 );

3063 
Ï¡cmd
 = 
cmd
[
i
];

3064 
i
++;

3065 ifÐ
	`mÚ_g‘num
Ð
Üic
, &
v
, 
cmd
, &
i
, 
SDL_TRUE
, 
SDL_FALSE
, SDL_FALSE, SDL_TRUE ) )

3066 
mÚ_addr
 = 
v
;

3068  
j
=0; j<16; j++ )

3069 
	`mÚ_¡r
Ð
	`mÚ_di§s£mbË
Ð
Üic
, &
mÚ_addr
, 
NULL
, 
SDL_FALSE
 ) );

3073 
Ï¡cmd
 = 0;

3074 
i
++;

3076 
j
 = 
	`mÚ_g‘»g
Ð
cmd
, &
i
, 
SDL_TRUE
, SDL_TRUE, SDL_TRUE );

3077 ifÐ
j
 == -1 )

3079 
	`mÚ_¡r
( "Registerƒxpected" );

3083 ifÐ!
	`mÚ_g‘num
Ð
Üic
, &
v
, 
cmd
, &
i
, 
SDL_TRUE
, SDL_TRUE, SDL_TRUE, SDL_TRUE ) )

3085 
	`mÚ_¡r
( "Expressionƒxpected" );

3089  
j
 )

3091 
REG_PC
: 
	`mÚ_£t_modif›d
Ð
Üic
 ); oric->
ýu
.
pc
 = 
v
; ;

3092 
REG_SP
: 
	`mÚ_£t_modif›d
Ð
Üic
 ); oric->
ýu
.
¥
 = 
v
; ;

3093 
REG_A
: 
	`mÚ_£t_modif›d
Ð
Üic
 ); oric->
ýu
.
a
 = 
v
; ;

3094 
REG_X
: 
	`mÚ_£t_modif›d
Ð
Üic
 ); oric->
ýu
.
x
 = 
v
; ;

3095 
REG_Y
: 
	`mÚ_£t_modif›d
Ð
Üic
 ); oric->
ýu
.
y
 = 
v
; ;

3097 
REG_VIA_PCR
: 
	`mÚ_£t_modif›d
Ð
Üic
 ); 
	`vŸ_wr™e
Ð&Üic->
vŸ
, 
VIA_PCR
, 
v
 ); ;

3098 
REG_VIA_ACR
: 
	`mÚ_£t_modif›d
Ð
Üic
 ); 
	`vŸ_wr™e
Ð&Üic->
vŸ
, 
VIA_ACR
, 
v
 ); ;

3099 
REG_VIA_SR
: 
	`mÚ_£t_modif›d
Ð
Üic
 ); 
	`vŸ_wr™e
Ð&Üic->
vŸ
, 
VIA_SR
, 
v
 ); ;

3100 
REG_VIA_IFR
: 
	`mÚ_£t_modif›d
Ð
Üic
 ); 
	`vŸ_mÚ_wr™e_iä
Ð&Üic->
vŸ
, 
v
 ); ;

3101 
REG_VIA_IER
: 
	`mÚ_£t_modif›d
Ð
Üic
 ); oric->
vŸ
.
›r
 = 
v
&0x7f; ;

3102 
REG_VIA_IRA
: 
	`mÚ_£t_modif›d
Ð
Üic
 ); oric->
vŸ
.
	`wr™e_pÜt_a
Ð&Üic->vŸ, 0xff, 
v
 ); ;

3103 
REG_VIA_ORA
: 
	`mÚ_£t_modif›d
Ð
Üic
 ); 
	`vŸ_wr™e
Ð&Üic->
vŸ
, 
VIA_IORA
, 
v
 ); ;

3104 
REG_VIA_DDRA
: 
	`mÚ_£t_modif›d
Ð
Üic
 ); 
	`vŸ_wr™e
Ð&Üic->
vŸ
, 
VIA_DDRA
, 
v
 ); ;

3105 
REG_VIA_IRB
: 
	`mÚ_£t_modif›d
Ð
Üic
 ); oric->
vŸ
.
	`wr™e_pÜt_b
Ð&Üic->vŸ, 0xff, 
v
 ); ;

3106 
REG_VIA_ORB
: 
	`mÚ_£t_modif›d
Ð
Üic
 ); 
	`vŸ_wr™e
Ð&Üic->
vŸ
, 
VIA_IORB
, 
v
 ); ;

3107 
REG_VIA_DDRB
: 
	`mÚ_£t_modif›d
Ð
Üic
 ); 
	`vŸ_wr™e
Ð&Üic->
vŸ
, 
VIA_DDRB
, 
v
 ); ;

3108 
REG_VIA_T1C
: 
	`mÚ_£t_modif›d
Ð
Üic
 ); oric->
vŸ
.
t1c
 = 
v
; ;

3109 
REG_VIA_CA1
: 
	`mÚ_£t_modif›d
Ð
Üic
 ); 
	`vŸ_wr™e_CA1
Ð&Üic->
vŸ
, 
v
 ); ;

3110 
REG_VIA_CA2
: 
	`mÚ_£t_modif›d
Ð
Üic
 ); 
	`vŸ_wr™e_CA2
Ð&Üic->
vŸ
, 
v
 ); ;

3111 
REG_VIA_CB1
: 
	`mÚ_£t_modif›d
Ð
Üic
 ); 
	`vŸ_wr™e_CB1
Ð&Üic->
vŸ
, 
v
 ); ;

3112 
REG_VIA_CB2
: 
	`mÚ_£t_modif›d
Ð
Üic
 ); 
	`vŸ_wr™e_CB2
Ð&Üic->
vŸ
, 
v
 ); ;

3113 
REG_VIA_T2C
: 
	`mÚ_£t_modif›d
Ð
Üic
 ); oric->
vŸ
.
t2c
 = 
v
; ;

3115 
REG_VIA_T1L
:

3116 
	`mÚ_£t_modif›d
Ð
Üic
 );

3117 
	`vŸ_wr™e
Ð&
Üic
->
vŸ
, 
VIA_T1L_L
, 
v
&0xff );

3118 
	`vŸ_wr™e
Ð&
Üic
->
vŸ
, 
VIA_T1L_H
, (
v
>>8)&0xff );

3121 
REG_VIA_T2L
:

3122 
	`mÚ_£t_modif›d
Ð
Üic
 );

3123 
	`vŸ_wr™e
Ð&
Üic
->
vŸ
, 
VIA_T2C_L
, 
v
&0xff );

3124 
	`vŸ_wr™e
Ð&
Üic
->
vŸ
, 
VIA_T2C_H
, (
v
>>8)&0xff );

3128 *
Ãed»nd”
 = 
SDL_TRUE
;

3129 
upd©•»v›w
 = 
SDL_TRUE
;

3133  
SDL_FALSE
;

3136 
Ï¡cmd
 = 
cmd
[
i
];

3137  
cmd
[
i
+1] )

3142 
	`mÚ_¡Üe_¡©e
Ð
Üic
 );

3143 
	`£‹mumode
Ð
Üic
, 
NULL
, 
EM_RUNNING
 );

3147 
dÚe
 = 
SDL_TRUE
;

3151 
	`mÚ_´štf
( "???" );

3157 
	`mÚ_¡Üe_¡©e
Ð
Üic
 );

3158 
	`£‹mumode
Ð
Üic
, 
NULL
, 
EM_RUNNING
 );

3162 
Ï¡cmd
 = 0;

3163 
i
++;

3164  
cmd
[
i
] )

3167 
i
++;

3168 ifÐ!
	`mÚ_g‘num
Ð
Üic
, &
v
, 
cmd
, &
i
, 
SDL_TRUE
, SDL_TRUE, SDL_TRUE, SDL_TRUE ) )

3170 
	`mÚ_¡r
( "Addressƒxpected" );

3174 ifÐ!
	`mÚ_g‘num
Ð
Üic
, &
w
, 
cmd
, &
i
, 
SDL_TRUE
, SDL_TRUE, SDL_TRUE, SDL_TRUE ) )

3176 
	`mÚ_¡r
( "Sizeƒxpected" );

3180  
	`isws
Ð
cmd
[
i
] ) ) i++;

3181 ifÐ!
cmd
[
i
] )

3183 
	`mÚ_¡r
( "Filenameƒxpected" );

3187 
tmem
 = 
	`m®loc
Ð
w
 );

3188 ifÐ!
tmem
 )

3190 
	`mÚ_¡r
( "Amnesia!" );

3194  
j
=0; j<
w
; j++ )

3195 
tmem
[
j
] = 
	`mÚ_»ad
Ð
Üic
, 
v
+j );

3197 
f
 = 
	`fÝ’
Ð&
cmd
[
i
], "wb" );

3198 ifÐ!
f
 )

3200 
	`ä“
Ð
tmem
 );

3201 
	`mÚ_´štf
Ð"UÇbËØÝ’ '%s'", &
cmd
[
i
] );

3205 
	`fwr™e
Ð
tmem
, 
w
, 1, 
f
 );

3206 
	`fþo£
Ð
f
 );

3207 
	`ä“
Ð
tmem
 );

3208 
	`mÚ_´štf
Ð"Wr™‹À%d by‹ tØ'%s'", 
w
, &
cmd
[
i
] );

3214 
Ï¡cmd
 = 0;

3215 
i
++;

3216 
j
 = 
cmd
[
i
];

3217  
j
 )

3221 
i
++;

3222  
	`isws
Ð
cmd
[
i
] ) ) i++;

3223 ifÐ!
cmd
[
i
] )

3225 
	`mÚ_¡r
( "Filenameƒxpected" );

3229 
	`još·th
(
¢­·th
, &
cmd
[
i
]);

3230 ià(
j
 == 'l')

3232 ià(!
	`lßd_¢­shÙ
(
Üic
, 
fž‘mp
))

3233 
	`mÚ_´štf
("Snapshot†oad failed");

3235 
	`mÚ_´štf
("Snapshot†oaded");

3239 ià(!
	`§ve_¢­shÙ
(
Üic
, 
fž‘mp
))

3240 
	`mÚ_´štf
("Snapshot save failed");

3242 
	`mÚ_´štf
("Snapshot saved");

3247 
	`mÚ_´štf
( "???" );

3253 
Ï¡cmd
 = 
cmd
[
i
];

3254  
h–pcouÁ
 )

3257 
	`mÚ_¡r
( "KEYS:" );

3259 
	`mÚ_¡r
( " F2 : Quit Monitor F3 : Toggle Console" );

3260 
	`mÚ_¡r
( " F4 : Toggle info F9 : Reset cycles" );

3261 
	`mÚ_¡r
( " F10: Step into F11: Step over" );

3262 
	`mÚ_¡r
( " F12: Skip inst." );

3263 
	`mÚ_¡r
( " " );

3264 
	`mÚ_¡r
( "COMMANDS:" );

3265 
	`mÚ_¡r
( "‡ <addr> - Assemble" );

3266 
	`mÚ_¡r
( " bc <bp id> - Clear breakpoint" );

3267 
	`mÚ_¡r
( " bcm <bp id> - Clear mem breakpoint" );

3268 
	`mÚ_¡r
( " bl - List breakpoints" );

3269 
	`mÚ_¡r
( " blm - List mem breakpoints" );

3270 
	`mÚ_¡r
( " bs <addr> [zc] - Set breakpoint/cycles" );

3271 
	`mÚ_¡r
( " bsm <addr> [rwc] - Set mem breakpoint" );

3272 
	`mÚ_¡r
( " bz - Zap breakpoints" );

3273 
	`mÚ_¡r
( " bzm - Zap mem breakpoints" );

3274 
	`mÚ_¡r
( " d <addr> - Disassemble" );

3275 
	`mÚ_¡r
( "---- MORE" );

3276 
h–pcouÁ
++;

3280 
	`mÚ_¡r
( " df <addr> <end> <file>- Disassembleo file" );

3281 
	`mÚ_¡r
( " m <addr> - Dump memory" );

3282 
	`mÚ_¡r
( " mm <addr> <value> - Modify memory" );

3283 
	`mÚ_¡r
( " mw <addr> - Memory watch‡t‡ddr" );

3284 
	`mÚ_¡r
( "‚l <filename> - Load snapshot" );

3285 
	`mÚ_¡r
( "‚s <filename> - Save snapshot" );

3286 
	`mÚ_¡r
( "„ <reg> <val> - Set <reg>o <val>" );

3287 
	`mÚ_¡r
( " q, x or qm - Quit monitor" );

3288 
	`mÚ_¡r
( " qe - Quitƒmulator" );

3289 
	`mÚ_¡r
( " sa <name> <addr> - Add or move user sym." );

3290 
	`mÚ_¡r
( " sk <name> - Kill user symbol" );

3291 
	`mÚ_¡r
( " sc - Symbols‚ot case-sens." );

3292 
	`mÚ_¡r
( " sC - Symbols case-sensitive" );

3293 
	`mÚ_¡r
( " sl <file> - Load user symbols" );

3294 
	`mÚ_¡r
( " sx <file> - Export user symbols" );

3295 
	`mÚ_¡r
( " sz - Zap user symbols" );

3296 
	`mÚ_¡r
( " wm <addr> <len> <file>- Write memo disk" );

3297 
h–pcouÁ
 = 0;

3298 
Ï¡cmd
 = 0;

3304 
Ï¡cmd
 = 0;

3305 
	`mÚ_´štf
( "???" );

3309  
dÚe
;

3310 
	}
}

3312 
SDL_boÞ
 
	$mÚ_do_cmd
Ð*
cmd
, 
machše
 *
Üic
, 
SDL_boÞ
 *
Ãed»nd”
 )

3314 
i
;

3315 
SDL_boÞ
 
»t
;

3317 
	`mÚ_hide_curs
();

3318 
i
=2; i<49; i++è
tz
[
TZ_MONITOR
]->
tx
[50*19+i] = 32;

3319 
	`tz¡½os
Ð
tz
[
TZ_MONITOR
], 2, 19, 
cmd
 );

3320 
	`tz£tcÞ
Ð
tz
[
TZ_MONITOR
], 2, 3 );

3321 
»t
 = 
	`mÚ_cmd
Ð
cmd
, 
Üic
, 
Ãed»nd”
 );

3322 
	`mÚ_¡¬t_šput
();

3323 
	`mÚ_show_curs
();

3324  
»t
;

3325 
	}
}

3327 
	$mÚ_wr™e_ibuf
( )

3329 
ibtmp
[
CONS_WIDTH
+1];

3331 
	`¡ºýy
Ð
ibtmp
, &
ibuf
[
žoff
], 
CONS_WIDTH
 );

3332 
ibtmp
[
CONS_WIDTH
] = 0;

3334 
	`tz¡½os
Ð
tz
[
TZ_MONITOR
], 1, 19, 
žoff
 > 0 ? "\x16" : "]" );

3335 
	`tz¡½os
Ð
tz
[
TZ_MONITOR
], 2, 19, 
ibtmp
 );

3336 ifÐ
	`¡¾’
Ð&
ibuf
[
žoff
] ) > 
CONS_WIDTH
 )

3338 
	`tz¡½os
Ð
tz
[
TZ_MONITOR
], 2+
CONS_WIDTH
, 19, "\x16" );

3340 
	`tz¡r
Ð
tz
[
TZ_MONITOR
], " " );

3341 
	`tz¡½os
Ð
tz
[
TZ_MONITOR
], 2+
CONS_WIDTH
, 19, " " );

3343 
	}
}

3345 
	$mÚ_wr™e_ibuf_asm
( )

3347 
ibtmp
[
CONS_WIDTH
+1];

3349 
	`¡ºýy
Ð
ibtmp
, 
ibuf
, 
CONS_WIDTH
 );

3350 
ibtmp
[
CONS_WIDTH
] = 0;

3352 
	`tz¡½os
Ð
tz
[
TZ_MONITOR
], 8, 19, 
ibtmp
 );

3353 
	`tz¡r
Ð
tz
[
TZ_MONITOR
], " " );

3354 
	}
}

3356 
	$mÚ_£t_curs_to_’d
( )

3358 
cursx
 = 
ž’
;

3359 
žoff
 = 
ž’
-
CONS_WIDTH
;

3360 ifÐ
žoff
 < 0 ) iloff = 0;

3361 
	}
}

3363 
	$mÚ_£t_žoff
( )

3365 ifÐ
cursx
 < 
žoff
 ) iloff = cursx;

3366 ifÐ
cursx
 >ð(
žoff
+
CONS_WIDTH
) ) iloff = cursx-CONS_WIDTH;

3367 ifÐ
žoff
 < 0 ) iloff =0;

3368 
	}
}

3384 
SDL_boÞ
 
	$mÚ_decodeÝ”ªd
Ð
machše
 *
Üic
, *
±r
, *
ty³
, *
v®
 )

3386 
i
;

3387 
v
;

3389 
i
=0;

3390  
	`isws
Ð
±r
[
i
] ) ) i++;

3393 ifÐ
±r
[
i
] == 0 )

3395 (*
ty³
èð
AM_IMP
;

3396  
SDL_TRUE
;

3400 ifÐ
±r
[
i
] == '#' )

3402 
i
++;

3403 ifÐ!
	`mÚ_g‘num
Ð
Üic
, &
v
, 
±r
, &
i
, 
SDL_FALSE
, SDL_FALSE, SDL_FALSE, 
SDL_TRUE
 ) )

3404  
SDL_FALSE
;

3405 (*
ty³
èð
AM_IMM
;

3406 (*
v®
èð
v
;

3407  
SDL_TRUE
;

3411 ifÐ
±r
[
i
] == '(' )

3413 
i
++;

3414 ifÐ!
	`mÚ_g‘num
Ð
Üic
, &
v
, 
±r
, &
i
, 
SDL_TRUE
, SDL_TRUE, 
SDL_FALSE
, SDL_TRUE ) )

3415  
SDL_FALSE
;

3417 ifÐ
	`¡ºÿ£cmp
Ð&
±r
[
i
], ",X)", 3 ) == 0 )

3419 (*
ty³
èð
AM_ZIX
;

3420 (*
v®
èð
v
&0xff;

3421  
SDL_TRUE
;

3424 ifÐ
	`¡ºÿ£cmp
Ð&
±r
[
i
], "),Y", 3 ) == 0 )

3426 (*
ty³
èð
AM_ZIY
;

3427 (*
v®
èð
v
&0xff;

3428  
SDL_TRUE
;

3431 ifÐ
±r
[
i
] == ')' )

3433 (*
ty³
èð
AM_IND
;

3434 (*
v®
èð
v
;

3435  
SDL_TRUE
;

3438  
SDL_FALSE
;

3441 ifÐ!
	`mÚ_g‘num
Ð
Üic
, &
v
, 
±r
, &
i
, 
SDL_TRUE
, SDL_TRUE, 
SDL_FALSE
, SDL_TRUE ) )

3442  
SDL_FALSE
;

3444 ifÐ
	`¡ºÿ£cmp
Ð&
±r
[
i
], ",X", 2 ) == 0 )

3446 (*
ty³
èð
AM_ABX
;

3447 (*
v®
èð
v
;

3448  
SDL_TRUE
;

3451 ifÐ
	`¡ºÿ£cmp
Ð&
±r
[
i
], ",Y", 2 ) == 0 )

3453 (*
ty³
èð
AM_ABY
;

3454 (*
v®
èð
v
;

3455  
SDL_TRUE
;

3458 (*
ty³
èð
AM_ABS
;

3459 (*
v®
èð
v
;

3460  
SDL_TRUE
;

3461 
	}
}

3463 
SDL_boÞ
 
	$mÚ_as£mbË_lše
Ð
machše
 *
Üic
 )

3465 
i
, 
j
, 
addsym
, 
amode
;

3466 
v®
;

3468 
i
=0;

3469  
	`isws
Ð
ibuf
[
i
] ) ) i++;

3471 ifÐ
ibuf
[
i
] =ð0 )  
SDL_TRUE
;

3474 
j
 = 
i
;

3475 
addsym
 = -1;

3476 ifÐ
	`issym¡¬t
Ð
ibuf
[
j
] ) )

3478  
	`issymch¬
Ð
ibuf
[
j
] ) ) j++;

3479 ifÐ
ibuf
[
j
] == ':' )

3481 
addsym
 = 
i
;

3482 
i
 = 
j
+1;

3483  
	`isws
Ð
ibuf
[
i
] ) ) i++;

3487  
j
=0; 
asmb
[j].
Çme
; j++ )

3489 ifÐ
	`¡ºÿ£cmp
Ð
asmb
[
j
].
Çme
, &
ibuf
[
i
], 3 ) == 0 )

3493 ifÐ!
asmb
[
j
].
Çme
 )

3495 
	`mÚ_Ýrštf
Ð" %04X %c%c%ø ??? ", 
mÚ_addr
, 
ibuf
[
i
], ibuf[i+1], ibuf[i+2] );

3496  
SDL_FALSE
;

3499 
i
 += 3;

3500 ifÐ!
	`mÚ_decodeÝ”ªd
Ð
Üic
, &
ibuf
[
i
], &
amode
, &
v®
 ) )

3502 
	`mÚ_¡r
( "Illegal operand" );

3503  
SDL_FALSE
;

3506  
amode
 )

3508 
AM_IMP
:

3509 ifÐ
asmb
[
j
].
imp
 =ð-1 ) { 
	`mÚ_¡r
Ð"O³¿ndƒx³ùed" );  
SDL_FALSE
; }

3510 
	`mÚ_£t_modif›d
Ð
Üic
 );

3511 
Üic
->
ýu
.
	`wr™e
Ð&Üic->ýu, 
mÚ_addr
, 
asmb
[
j
].
imp
 );

3514 
AM_IMM
:

3515 ifÐ
asmb
[
j
].
imm
 =ð-1 ) { 
	`mÚ_¡r
Ð"IÎeg® o³¿nd" );  
SDL_FALSE
; }

3516 
	`mÚ_£t_modif›d
Ð
Üic
 );

3517 
Üic
->
ýu
.
	`wr™e
Ð&Üic->ýu, 
mÚ_addr
, 
asmb
[
j
].
imm
 );

3518 
Üic
->
ýu
.
	`wr™e
Ð&Üic->ýu, 
mÚ_addr
+1, 
v®
 );

3521 
AM_ABS
:

3522 ifÐ
asmb
[
j
].
»l
 != -1 )

3524 
i
 = (()
v®
)-(()(
mÚ_addr
+2));

3525 ifÐÐ
i
 < -128 ) || ( i > 127 ) )

3527 
	`mÚ_¡r
( "Branch out of„ange" );

3528  
SDL_FALSE
;

3530 
	`mÚ_£t_modif›d
Ð
Üic
 );

3531 
Üic
->
ýu
.
	`wr™e
Ð&Üic->ýu, 
mÚ_addr
, 
asmb
[
j
].
»l
 );

3532 
Üic
->
ýu
.
	`wr™e
Ð&Üic->ýu, 
mÚ_addr
+1, 
i
&0xff );

3536 ifÐÐ
asmb
[
j
].
zp
 !ð-1 ) && ( (
v®
&0xff00)==0 ) )

3538 
	`mÚ_£t_modif›d
Ð
Üic
 );

3539 
Üic
->
ýu
.
	`wr™e
Ð&Üic->ýu, 
mÚ_addr
, 
asmb
[
j
].
zp
 );

3540 
Üic
->
ýu
.
	`wr™e
Ð&Üic->ýu, 
mÚ_addr
+1, 
v®
 );

3544 ifÐ
asmb
[
j
].
abs
 =ð-1 ) { 
	`mÚ_¡r
Ð"IÎeg® o³¿nd" );  
SDL_FALSE
; }

3545 
	`mÚ_£t_modif›d
Ð
Üic
 );

3546 
Üic
->
ýu
.
	`wr™e
Ð&Üic->ýu, 
mÚ_addr
, 
asmb
[
j
].
abs
 );

3547 
Üic
->
ýu
.
	`wr™e
Ð&Üic->ýu, 
mÚ_addr
+1, 
v®
&0xff );

3548 
Üic
->
ýu
.
	`wr™e
Ð&Üic->ýu, 
mÚ_addr
+2, (
v®
>>8)&0xff );

3551 
AM_IND
:

3552 ifÐ
asmb
[
j
].
šd
 =ð-1 ) { 
	`mÚ_¡r
Ð"IÎeg® o³¿nd" );  
SDL_FALSE
; }

3553 
	`mÚ_£t_modif›d
Ð
Üic
 );

3554 
Üic
->
ýu
.
	`wr™e
Ð&Üic->ýu, 
mÚ_addr
, 
asmb
[
j
].
šd
 );

3555 
Üic
->
ýu
.
	`wr™e
Ð&Üic->ýu, 
mÚ_addr
+1, 
v®
&0xff );

3556 
Üic
->
ýu
.
	`wr™e
Ð&Üic->ýu, 
mÚ_addr
+2, (
v®
>>8)&0xff );

3559 
AM_ZPX
:

3560 ifÐ
asmb
[
j
].
zpx
 =ð-1 ) { 
	`mÚ_¡r
Ð"IÎeg® o³¿nd" );  
SDL_FALSE
; }

3561 
	`mÚ_£t_modif›d
Ð
Üic
 );

3562 
Üic
->
ýu
.
	`wr™e
Ð&Üic->ýu, 
mÚ_addr
, 
asmb
[
j
].
zpx
 );

3563 
Üic
->
ýu
.
	`wr™e
Ð&Üic->ýu, 
mÚ_addr
+1, 
v®
 );

3566 
AM_ZPY
:

3567 ifÐ
asmb
[
j
].
zpy
 =ð-1 ) { 
	`mÚ_¡r
Ð"IÎeg® o³¿nd" );  
SDL_FALSE
; }

3568 
	`mÚ_£t_modif›d
Ð
Üic
 );

3569 
Üic
->
ýu
.
	`wr™e
Ð&Üic->ýu, 
mÚ_addr
, 
asmb
[
j
].
zpy
 );

3570 
Üic
->
ýu
.
	`wr™e
Ð&Üic->ýu, 
mÚ_addr
+1, 
v®
 );

3573 
AM_ZIX
:

3574 ifÐ
asmb
[
j
].
zix
 =ð-1 ) { 
	`mÚ_¡r
Ð"IÎeg® o³¿nd" );  
SDL_FALSE
; }

3575 
	`mÚ_£t_modif›d
Ð
Üic
 );

3576 
Üic
->
ýu
.
	`wr™e
Ð&Üic->ýu, 
mÚ_addr
, 
asmb
[
j
].
zix
 );

3577 
Üic
->
ýu
.
	`wr™e
Ð&Üic->ýu, 
mÚ_addr
+1, 
v®
 );

3580 
AM_ZIY
:

3581 ifÐ
asmb
[
j
].
ziy
 =ð-1 ) { 
	`mÚ_¡r
Ð"IÎeg® o³¿nd" );  
SDL_FALSE
; }

3582 
	`mÚ_£t_modif›d
Ð
Üic
 );

3583 
Üic
->
ýu
.
	`wr™e
Ð&Üic->ýu, 
mÚ_addr
, 
asmb
[
j
].
ziy
 );

3584 
Üic
->
ýu
.
	`wr™e
Ð&Üic->ýu, 
mÚ_addr
+1, 
v®
 );

3587 
AM_ABX
:

3588 ifÐÐ
asmb
[
j
].
zpx
 !ð-1 ) && ( (
v®
&0xff00)==0 ) )

3590 
	`mÚ_£t_modif›d
Ð
Üic
 );

3591 
Üic
->
ýu
.
	`wr™e
Ð&Üic->ýu, 
mÚ_addr
, 
asmb
[
j
].
zpx
 );

3592 
Üic
->
ýu
.
	`wr™e
Ð&Üic->ýu, 
mÚ_addr
+1, 
v®
 );

3596 ifÐ
asmb
[
j
].
abx
 =ð-1 ) { 
	`mÚ_¡r
Ð"IÎeg® o³¿nd" );  
SDL_FALSE
; }

3597 
	`mÚ_£t_modif›d
Ð
Üic
 );

3598 
Üic
->
ýu
.
	`wr™e
Ð&Üic->ýu, 
mÚ_addr
, 
asmb
[
j
].
abx
 );

3599 
Üic
->
ýu
.
	`wr™e
Ð&Üic->ýu, 
mÚ_addr
+1, 
v®
&0xff );

3600 
Üic
->
ýu
.
	`wr™e
Ð&Üic->ýu, 
mÚ_addr
+2, (
v®
>>8)&0xff );

3603 
AM_ABY
:

3604 ifÐÐ
asmb
[
j
].
zpy
 !ð-1 ) && ( (
v®
&0xff00)==0 ) )

3606 
	`mÚ_£t_modif›d
Ð
Üic
 );

3607 
Üic
->
ýu
.
	`wr™e
Ð&Üic->ýu, 
mÚ_addr
, 
asmb
[
j
].
zpy
 );

3608 
Üic
->
ýu
.
	`wr™e
Ð&Üic->ýu, 
mÚ_addr
+1, 
v®
 );

3612 ifÐ
asmb
[
j
].
aby
 =ð-1 ) { 
	`mÚ_¡r
Ð"IÎeg® o³¿nd" );  
SDL_FALSE
; }

3613 
	`mÚ_£t_modif›d
Ð
Üic
 );

3614 
Üic
->
ýu
.
	`wr™e
Ð&Üic->ýu, 
mÚ_addr
, 
asmb
[
j
].
aby
 );

3615 
Üic
->
ýu
.
	`wr™e
Ð&Üic->ýu, 
mÚ_addr
+1, 
v®
&0xff );

3616 
Üic
->
ýu
.
	`wr™e
Ð&Üic->ýu, 
mÚ_addr
+2, (
v®
>>8)&0xff );

3620 ifÐ
addsym
 != -1 )

3621 
	`mÚ_»¶aû_Ü_add_symbÞ
Ð&
Üic
->
u£rsyms
, oric, &
ibuf
[
addsym
], 
SYM_BESTGUESS
, 
mÚ_addr
 );

3623 
	`mÚ_Ýrštf
Ð
	`mÚ_di§s£mbË
Ð
Üic
, &
mÚ_addr
, 
NULL
, 
SDL_FALSE
 ) );

3624  
SDL_FALSE
;

3625 
	}
}

3627 
SDL_boÞ
 
	$mÚ_cÚsÞe_keydown
Ð
SDL_Ev’t
 *
ev
, 
machše
 *
Üic
, 
SDL_boÞ
 *
Ãed»nd”
 )

3629 
i
;

3630 
SDL_boÞ
 
dÚe
;

3632 
dÚe
 = 
SDL_FALSE
;

3634 ifÐ
mÚ_asmmode
 )

3636  
ev
->
key
.
keysym
.
sym
 )

3638 
SDLK_LEFT
:

3639 ifÐ
cursx
 > 0 )

3641 
	`mÚ_hide_curs
();

3642 
cursx
--;

3643 
	`mÚ_wr™e_ibuf_asm
();

3644 
	`mÚ_show_curs
();

3645 *
Ãed»nd”
 = 
SDL_TRUE
;

3649 
SDLK_RIGHT
:

3650 ifÐ
cursx
 < 
ž’
 )

3652 
	`mÚ_hide_curs
();

3653 
cursx
++;

3654 
	`mÚ_wr™e_ibuf_asm
();

3655 
	`mÚ_show_curs
();

3656 *
Ãed»nd”
 = 
SDL_TRUE
;

3660 
SDLK_BACKSPACE
:

3661 ifÐ
cursx
 > 0 )

3663 
	`mÚ_hide_curs
();

3664  
i
=
cursx
-1; i<
ž’
; i++ )

3665 
ibuf
[
i
] = ibuf[i+1];

3666 
cursx
--;

3667 
ž’
 = ()
	`¡¾’
Ð
ibuf
 );

3668 
	`mÚ_£t_žoff
();

3669 
	`mÚ_wr™e_ibuf_asm
();

3670 
	`mÚ_show_curs
();

3671 *
Ãed»nd”
 = 
SDL_TRUE
;

3675 
SDLK_RETURN
:

3676 
SDLK_KP_ENTER
:

3677 
	`mÚ_hide_curs
();

3678 
ibuf
[
ž’
] = 0;

3680 ifÐ
	`mÚ_as£mbË_lše
Ð
Üic
 ) )

3682 
mÚ_asmmode
 = 
SDL_FALSE
;

3683 
	`mÚ_¡¬t_šput
();

3684 
	`mÚ_show_curs
();

3685 *
Ãed»nd”
 = 
SDL_TRUE
;

3686 
upd©•»v›w
 = 
SDL_TRUE
;

3690 
	`mÚ_¡¬t_šput
();

3691 
	`mÚ_show_curs
();

3692 *
Ãed»nd”
 = 
SDL_TRUE
;

3693 
upd©•»v›w
 = 
SDL_TRUE
;

3700  
	`SDL_COMPAT_G‘KeysymUnicode
Ð
ev
->
key
.
keysym
 ) )

3703 ifÐÐ
	`SDL_COMPAT_G‘KeysymUnicode
Ð
ev
->
key
.
keysym
 ) > 31 ) && ( SDL_COMPAT_GetKeysymUnicode(ƒv->key.keysym ) < 127 ) )

3705 ifÐ
ž’
 >ð
MAX_ASM_INPUT
 ) ;

3707 
	`mÚ_hide_curs
();

3708  
i
=
ž’
+1; i>
cursx
; i-- )

3709 
ibuf
[
i
] = ibuf[i-1];

3710 
ibuf
[
cursx
] = 
	`SDL_COMPAT_T¿n¦©eUnicode
Ð
ev
->
key
.
keysym
 );

3711 
cursx
++;

3712 
ž’
++;

3713 
	`mÚ_wr™e_ibuf_asm
();

3714 
	`mÚ_show_curs
();

3715 *
Ãed»nd”
 = 
SDL_TRUE
;

3719  
dÚe
;

3722  
ev
->
key
.
keysym
.
sym
 )

3724 
SDLK_UP
:

3725 ifÐ
hi¡p
 >ð(
hi¡u
-1) ) ;

3726 
	`mÚ_hide_curs
();

3727 
	`¡rýy
Ð
ibuf
, &
hi¡Üy
[++
hi¡p
][0] );

3728 
ž’
 = ()
	`¡¾’
Ð
ibuf
 );

3729 
	`mÚ_£t_curs_to_’d
();

3730 
	`mÚ_£t_žoff
();

3731 
	`tz¡½os
Ð
tz
[
TZ_MONITOR
], 2, 19, " " );

3732 
	`mÚ_wr™e_ibuf
();

3733 
	`mÚ_show_curs
();

3734 *
Ãed»nd”
 = 
SDL_TRUE
;

3737 
SDLK_DOWN
:

3738 
	`mÚ_hide_curs
();

3739 ifÐ
hi¡p
 <= 0 )

3741 
hi¡p
 = -1;

3742 
ibuf
[0] = 0;

3743 
ž’
 = 0;

3744 
žoff
 = 0;

3745 
cursx
 = 0;

3747 
	`¡rýy
Ð
ibuf
, &
hi¡Üy
[--
hi¡p
][0] );

3748 
	`mÚ_£t_curs_to_’d
();

3749 
	`mÚ_£t_žoff
();

3751 
	`tz¡½os
Ð
tz
[
TZ_MONITOR
], 2, 19, " " );

3752 
	`mÚ_wr™e_ibuf
();

3753 
	`mÚ_show_curs
();

3754 *
Ãed»nd”
 = 
SDL_TRUE
;

3757 
SDLK_LEFT
:

3758 ifÐ
cursx
 > 0 )

3760 
	`mÚ_hide_curs
();

3761 
cursx
--;

3762 
	`mÚ_£t_žoff
();

3763 
	`mÚ_wr™e_ibuf
();

3764 
	`mÚ_show_curs
();

3765 *
Ãed»nd”
 = 
SDL_TRUE
;

3769 
SDLK_RIGHT
:

3770 ifÐ
cursx
 < 
ž’
 )

3772 
	`mÚ_hide_curs
();

3773 
cursx
++;

3774 
	`mÚ_£t_žoff
();

3775 
	`mÚ_wr™e_ibuf
();

3776 
	`mÚ_show_curs
();

3777 *
Ãed»nd”
 = 
SDL_TRUE
;

3784 
SDLK_BACKSPACE
:

3785 ifÐ
cursx
 > 0 )

3787 
	`mÚ_hide_curs
();

3788  
i
=
cursx
-1; i<
ž’
; i++ )

3789 
ibuf
[
i
] = ibuf[i+1];

3790 
cursx
--;

3791 
ž’
 = ()
	`¡¾’
Ð
ibuf
 );

3792 
	`mÚ_£t_žoff
();

3793 
	`mÚ_wr™e_ibuf
();

3794 
	`mÚ_show_curs
();

3795 *
Ãed»nd”
 = 
SDL_TRUE
;

3799 
SDLK_RETURN
:

3800 
SDLK_KP_ENTER
:

3801 
	`mÚ_hide_curs
();

3802 
ibuf
[
ž’
] = 0;

3803 ifÐ
ž’
 == 0 )

3805  
Ï¡cmd
 )

3810 
ibuf
[
cursx
++] = 
Ï¡cmd
;

3811 
ibuf
[
cursx
] = 0;

3812 
ž’
 = 1;

3816 ifÐÐ
hi¡u
 > 0 ) && ( 
	`¡rcmp
Ð&
hi¡Üy
[0][0], 
ibuf
 ) == 0 ) )

3819 ifÐ
hi¡u
 > 0 )

3821  
i
=
hi¡u
; i>0; i-- )

3822 
	`¡rýy
Ð&
hi¡Üy
[
i
][0], &history[i-1][0] );

3825 
	`¡rýy
Ð&
hi¡Üy
[0][0], 
ibuf
 );

3826 ifÐ
hi¡u
 < 10 ) histu++;

3829 
hi¡p
 = -1;

3831 
	`tz£tcÞ
Ð
tz
[
TZ_MONITOR
], 2, 3 );

3832 
dÚe
 |ð
	`mÚ_cmd
Ð
ibuf
, 
Üic
, 
Ãed»nd”
 );

3833 
	`mÚ_¡¬t_šput
();

3834 
	`mÚ_show_curs
();

3835 *
Ãed»nd”
 = 
SDL_TRUE
;

3839  
	`SDL_COMPAT_G‘KeysymUnicode
Ð
ev
->
key
.
keysym
 ) )

3842 ifÐÐ
	`SDL_COMPAT_G‘KeysymUnicode
Ð
ev
->
key
.
keysym
 ) > 31 ) && ( SDL_COMPAT_GetKeysymUnicode(ƒv->key.keysym ) < 127 ) )

3844 ifÐ
ž’
 >ð
MAX_CONS_INPUT
 ) ;

3846 
	`mÚ_hide_curs
();

3847  
i
=
ž’
+1; i>
cursx
; i-- )

3848 
ibuf
[
i
] = ibuf[i-1];

3849 
ibuf
[
cursx
] = 
	`SDL_COMPAT_T¿n¦©eUnicode
Ð
ev
->
key
.
keysym
 );

3850 
cursx
++;

3851 
ž’
++;

3852 
	`mÚ_£t_žoff
();

3853 
	`mÚ_wr™e_ibuf
();

3854 
	`mÚ_show_curs
();

3855 *
Ãed»nd”
 = 
SDL_TRUE
;

3859  
dÚe
;

3860 
	}
}

3862 
SDL_boÞ
 
	$mÚ_mw©ch_keydown
Ð
SDL_Ev’t
 *
ev
, 
machše
 *
Üic
, 
SDL_boÞ
 *
Ãed»nd”
 )

3864 
SDL_boÞ
 
dÚe
;

3865 
v
;

3866 
i
, 
·ge
;

3868 
·ge
 = 
mw_¥l™
 ? 8*8 : 8*18;

3870 
dÚe
 = 
SDL_FALSE
;

3871  
ev
->
key
.
keysym
.
sym
 )

3873 
SDLK_UP
:

3874 
mw_addr
[
mw_which
] -ð
kshiáed
 ? 
·ge
 : 8;

3875 *
Ãed»nd”
 = 
SDL_TRUE
;

3878 
SDLK_DOWN
:

3879 
mw_addr
[
mw_which
] +ð
kshiáed
 ? 
·ge
 : 8;

3880 *
Ãed»nd”
 = 
SDL_TRUE
;

3883 
SDLK_PAGEUP
:

3884 
mw_addr
[
mw_which
] -ð
·ge
;

3885 *
Ãed»nd”
 = 
SDL_TRUE
;

3888 
SDLK_PAGEDOWN
:

3889 
mw_addr
[
mw_which
] +ð
·ge
;

3890 *
Ãed»nd”
 = 
SDL_TRUE
;

3893 
SDLK_RETURN
:

3894 
SDLK_KP_ENTER
:

3895 ifÐ
mw_mode
 != 1 ) ;

3896 
mw_ibuf
[5] = 0;

3897 
mw_mode
 = 0;

3898 
i
 = 0;

3899 ifÐ
	`mÚ_g‘num
Ð
Üic
, &
v
, 
mw_ibuf
, &
i
, 
SDL_FALSE
, SDL_FALSE, SDL_FALSE, SDL_FALSE ) )

3900 
mw_addr
[
mw_which
] = 
v
;

3901 *
Ãed»nd”
 = 
SDL_TRUE
;

3904 
SDLK_ESCAPE
:

3905 
mw_mode
 = 0;

3906 *
Ãed»nd”
 = 
SDL_TRUE
;

3909 
SDLK_BACKSPACE
:

3910 ifÐ
mw_mode
 != 1 ) ;

3911 ifÐ
mw_koffs
 <= 0 ) ;

3912 
mw_ibuf
[
mw_koffs
--] = 0;

3913 *
Ãed»nd”
 = 
SDL_TRUE
;

3916 
SDLK_s
:

3917 ifÐ
mw_mode
 != 0 ) ;

3918 
mw_¥l™
 = !mw_split;

3919 ifÐÐ!
mw_¥l™
 ) && ( 
mw_which
 != 0 ) )

3920 
mw_which
 = 0;

3921 *
Ãed»nd”
 = 
SDL_TRUE
;

3924 
SDLK_TAB
:

3925 ifÐ!
mw_¥l™
 ) ;

3926 ifÐ
mw_mode
 != 0 ) mw_mode = 0;

3927 
mw_which
 ^= 1;

3928 *
Ãed»nd”
 = 
SDL_TRUE
;

3935 ifÐ
	`ishex
Ð
	`SDL_COMPAT_G‘KeysymUnicode
Ð
ev
->
key
.
keysym
 ) ) )

3937 ifÐ
mw_mode
 != 1 )

3939 
mw_mode
 = 1;

3940 
mw_ibuf
[0] = '$';

3941 
mw_ibuf
[1] = 0;

3942 
mw_koffs
 = 0;

3945 ifÐ
mw_koffs
 < 4 )

3947 
mw_ibuf
[++
mw_koffs
] = 
	`SDL_COMPAT_T¿n¦©eUnicode
Ð
ev
->
key
.
keysym
 );

3948 
mw_ibuf
[
mw_koffs
+1] = 0;

3951 *
Ãed»nd”
 = 
SDL_TRUE
;

3954  
dÚe
;

3955 
	}
}

3957 
	$¡•py_¡•
Ð
machše
 *
Üic
 )

3959 
	`m6502_£t_icyþes
Ð&
Üic
->
ýu
, 
SDL_FALSE
, 
mÚ_bpmsg
 );

3960 
	`³_·tches
Ð
Üic
 );

3961 
	`vŸ_þock
Ð&
Üic
->
vŸ
, oric->
ýu
.
icyþes
 );

3962 
	`ay_ticktock
Ð&
Üic
->
ay
, oric->
ýu
.
icyþes
 );

3963 if((
Üic
->
driv‘y³
 =ð
DRV_MICRODISC
è|| (Üic->driv‘y³ =ð
DRV_JASMIN
)è
	`wd17xx_ticktock
Ð&Üic->
wddisk
, oric->
ýu
.
icyþes
 );

3964 ifÐ
Üic
->
ty³
 =ð
MACH_TELESTRAT
 )

3966 
	`vŸ_þock
Ð&
Üic
->
‹Ë_vŸ
, oric->
ýu
.
icyþes
 );

3968 ifÐ
Üic
->
acŸback’d
 )

3969 
	`acŸ_þock
Ð&
Üic
->
‹Ë_acŸ
, oric->
ýu
.
icyþes
 );

3971 
Üic
->
ýu
.
¿¡”cyþes
 -ðÜic->ýu.
icyþes
;

3972 
	`m6502_š¡
Ð&
Üic
->
ýu
 );

3974 ifÐ
Üic
->
ýu
.
¿¡”cyþes
 <= 0 )

3976 
	`uÏ_dÜa¡”
Ð
Üic
 );

3977 
Üic
->
ýu
.
¿¡”cyþes
 +ðÜic->
cyþe¥”¿¡”
;

3980 ifÐ
mÚ_bpmsg
[0] )

3982 
	`mÚ_´štf_above
Ð
mÚ_bpmsg
 );

3983 
mÚ_bpmsg
[0] = 0;

3987  
Üic
->
ýu
.
icyþes
;

3988 
	}
}

3990 
SDL_boÞ
 
	$þickzÚe
Ð
‹xtzÚe
 *
tz
, *
tx
, *
ty
, 
SDL_boÞ
 *
dblþk
 )

3992 
dx
, 
dy
;

3994 ifÐ!
	`š_‹xtzÚe
Ð
tz
, 
Ëáþick
[0].
x
,†eáþick[0].
y
 ) )

3995  
SDL_FALSE
;

3997 *
tx
 = (
Ëáþick
[0].
x
 - 
tz
->x) / 8;

3998 *
ty
 = (
Ëáþick
[0].
y
 - 
tz
->y) / 12;

4000 
dx
 = (
Ëáþick
[1].
x
 - 
tz
->x) / 8;

4001 
dy
 = (
Ëáþick
[1].
y
 - 
tz
->y) / 12;

4003 ifÐÐ(*
tx
è=ð
dx
 ) && ( (*
ty
è=ð
dy
 ) && ( (
Ëáþick
[0].
time
-leftclick[1].time) < 1000 ) )

4005 *
dblþk
 = 
SDL_TRUE
;

4008 
Ëáþick
[0].
time
 = -1;

4010 *
dblþk
 = 
SDL_FALSE
;

4013  
SDL_TRUE
;

4014 
	}
}

4016 
SDL_boÞ
 
	$mÚ_ev’t
Ð
SDL_Ev’t
 *
ev
, 
machše
 *
Üic
, 
SDL_boÞ
 *
Ãed»nd”
 )

4018 
SDL_boÞ
 
dÚe
;

4019 
SDL_boÞ
 
dÚkey
;

4021 
dÚe
 = 
SDL_FALSE
;

4022 
dÚkey
 = 
SDL_FALSE
;

4023  
ev
->
ty³
 )

4025 
SDL_COMPAT_ACTIVEEVENT
:

4026 if(
	`SDL_COMPAT_IsAµFocu£d
(
ev
)) {

4027 *
Ãed»nd”
 = 
SDL_TRUE
;

4031 
SDL_MOUSEBUTTONDOWN
:

4033 
tx
, 
ty
;

4034 
SDL_boÞ
 
dblþk
;

4036 
Ëáþick
[1] =†eftclick[0];

4037 
Ëáþick
[0].
x
 = 
ev
->
bu‰Ú
.x;

4038 
Ëáþick
[0].
y
 = 
ev
->
bu‰Ú
.y;

4039 
Ëáþick
[0].
time
 = 
	`SDL_G‘Ticks
();

4041 ifÐ
	`þickzÚe
Ð
tz
[
TZ_REGS
], &
tx
, &
ty
, &
dblþk
 ) )

4043 
	`mÚ_þick_»gs
Ð
Üic
, 
Ãed»nd”
, 
tx
, 
ty
, 
dblþk
 );

4048 
SDL_KEYUP
:

4049  
ev
->
key
.
keysym
.
sym
 )

4051 
SDLK_F9
:

4052 
Üic
->
ýu
.
cyþes
 = 0;

4053 *
Ãed»nd”
 = 
SDL_TRUE
;

4056 
SDLK_LSHIFT
:

4057 
SDLK_RSHIFT
:

4058 
kshiáed
 = 
SDL_FALSE
;

4061 
SDLK_F1
:

4062 
»äesh¡©us
 = 
SDL_TRUE
;

4063 *
Ãed»nd”
 = 
SDL_TRUE
;

4064 
	`mÚ_¡Üe_¡©e
Ð
Üic
 );

4065 
	`uÏ_£t_dœty
Ð
Üic
 );

4066 
	`£‹mumode
Ð
Üic
, 
NULL
, 
EM_MENU
 );

4069 
SDLK_F2
:

4071 
	`m6502_£t_icyþes
Ð&
Üic
->
ýu
, 
SDL_FALSE
, 
mÚ_bpmsg
 );

4072 
	`³_·tches
Ð
Üic
 );

4073 
	`vŸ_þock
Ð&
Üic
->
vŸ
, oric->
ýu
.
icyþes
 );

4074 
	`ay_ticktock
Ð&
Üic
->
ay
, oric->
ýu
.
icyþes
 );

4075 if((
Üic
->
driv‘y³
 =ð
DRV_MICRODISC
è|| (Üic->driv‘y³ =ð
DRV_JASMIN
)è
	`wd17xx_ticktock
Ð&Üic->
wddisk
, oric->
ýu
.
icyþes
 );

4076 ifÐ
Üic
->
ty³
 =ð
MACH_TELESTRAT
 )

4078 
	`vŸ_þock
Ð&
Üic
->
‹Ë_vŸ
, oric->
ýu
.
icyþes
 );

4080 ifÐ
Üic
->
acŸback’d
 )

4081 
	`acŸ_þock
Ð&
Üic
->
‹Ë_acŸ
, oric->
ýu
.
icyþes
 );

4082 
Üic
->
ýu
.
¿¡”cyþes
 -ðÜic->ýu.
icyþes
;

4083 
	`m6502_š¡
Ð&
Üic
->
ýu
 );

4084 ifÐ
Üic
->
ýu
.
¿¡”cyþes
 <= 0 )

4086 
	`uÏ_dÜa¡”
Ð
Üic
 );

4087 
Üic
->
ýu
.
¿¡”cyþes
 +ðÜic->
cyþe¥”¿¡”
;

4089 *
Ãed»nd”
 = 
SDL_TRUE
;

4090 
	`mÚ_¡Üe_¡©e
Ð
Üic
 );

4091 
	`£‹mumode
Ð
Üic
, 
NULL
, 
EM_RUNNING
 );

4094 
SDLK_F3
:

4095 
cshow
 = (cshow+1)%
CSHOW_LAST
;

4096 *
Ãed»nd”
 = 
SDL_TRUE
;

4099 
SDLK_F4
:

4100 
mshow
 = (mshow+1)%
MSHOW_LAST
;

4101 ifÐÐ
mshow
 =ð
MSHOW_VIA2
 ) && ( 
Üic
->
ty³
 !ð
MACH_TELESTRAT
 ) )

4102 
mshow
 = (mshow+1)%
MSHOW_LAST
;

4103 ifÐÐ
Üic
->
driv‘y³
 =ð
DRV_NONE
 ) && ( 
mshow
 =ð
MSHOW_DISK
 ) )

4104 
mshow
 = (mshow+1)%
MSHOW_LAST
;

4105 *
Ãed»nd”
 = 
SDL_TRUE
;

4113 
SDL_KEYDOWN
:

4114  
ev
->
key
.
keysym
.
sym
 )

4116 
SDLK_LSHIFT
:

4117 
SDLK_RSHIFT
:

4118 
kshiáed
 = 
SDL_TRUE
;

4119 
dÚkey
 = 
SDL_TRUE
;

4122 
SDLK_F10
:

4123 ifÐ!
kshiáed
 )

4125 
	`mÚ_¡Üe_¡©e
Ð
Üic
 );

4126 
	`¡•py_¡•
Ð
Üic
 );

4127 *
Ãed»nd”
 = 
SDL_TRUE
;

4128 
dÚkey
 = 
SDL_TRUE
;

4132 
SDLK_F11
:

4133 ifÐ
	`mÚ_»ad
Ð
Üic
, oric->
ýu
.
pc
 ) == 0x20 )

4135 
Ušt16
 
Ãwpc
;

4136 
’dticks
;

4138 
Ãwpc
 = 
Üic
->
ýu
.
pc
+3;

4140 
	`mÚ_¡Üe_¡©e
Ð
Üic
 );

4141 
’dticks
 = 
	`SDL_G‘Ticks
()+5000;

4142  ( 
Üic
->
ýu
.
pc
 !ð
Ãwpc
 ) && ( 
	`SDL_G‘Ticks
(è< 
’dticks
 ) )

4143 
	`¡•py_¡•
Ð
Üic
 );

4145 *
Ãed»nd”
 = 
SDL_TRUE
;

4146 
dÚkey
 = 
SDL_TRUE
;

4150 
	`mÚ_¡Üe_¡©e
Ð
Üic
 );

4151 
	`¡•py_¡•
Ð
Üic
 );

4152 *
Ãed»nd”
 = 
SDL_TRUE
;

4153 
dÚkey
 = 
SDL_TRUE
;

4156 
SDLK_F12
:

4157  
di¡ab
[
	`mÚ_»ad
Ð
Üic
, oric->
ýu
.
pc
 )].
amode
 )

4159 
AM_IMM
:

4160 
AM_ZP
:

4161 
AM_ZPX
:

4162 
AM_ZPY
:

4163 
AM_ZIX
:

4164 
AM_ZIY
:

4165 
AM_REL
:

4166 
Üic
->
ýu
.
pc
 += 2;

4169 
AM_ABS
:

4170 
AM_ABX
:

4171 
AM_ABY
:

4172 
AM_IND
:

4173 
Üic
->
ýu
.
pc
 += 3;

4176 
AM_IMP
:

4178 
Üic
->
ýu
.
pc
++;

4181 *
Ãed»nd”
 = 
SDL_TRUE
;

4182 
dÚkey
 = 
SDL_TRUE
;

4189 ifÐ!
dÚkey
 )

4191  
cshow
 )

4193 
CSHOW_CONSOLE
:

4194 
dÚe
 |ð
	`mÚ_cÚsÞe_keydown
Ð
ev
, 
Üic
, 
Ãed»nd”
 );

4197 
CSHOW_MWATCH
:

4198 
dÚe
 |ð
	`mÚ_mw©ch_keydown
Ð
ev
, 
Üic
, 
Ãed»nd”
 );

4205  
dÚe
;

4206 
	}
}

4209 #ià
defšed
(
DEBUG_CPU_TRACE
) && DEBUG_CPU_TRACE > 0

4210 
ýu_Œaû_’Œy
 
	gýuŒaû
[
DEBUG_CPU_TRACE
], *
	gli¡_¡¬t
 = 
NULL
, *
	gli¡_’d
, *
	gÃxt
 = NULL;

4212 
	$mÚ_Œaûš¡
(
m6502
 *
ýu
)

4214 
machše
 *
Üic
 = (machš*)
ýu
->
u£rd©a
;

4216 ià(!
li¡_¡¬t
)

4218 
i
;

4219 
li¡_¡¬t
 = &
ýuŒaû
[0];

4220 
li¡_’d
 = &
ýuŒaû
[
DEBUG_CPU_TRACE
-1];

4221 
i
=0; i<
DEBUG_CPU_TRACE
; i++)

4223 
ýuŒaû
[
i
].
´ev
 = (i==0è? 
NULL
 : &cputrace[i-1];

4224 
ýuŒaû
[
i
].
Ãxt
 = (i==(
DEBUG_CPU_TRACE
-1)è? 
NULL
 : &cputrace[i+1];

4226 
Ãxt
 = 
li¡_¡¬t
;

4230 ià(
Ãxt
 =ð
NULL
)

4232 
Ãxt
 = 
li¡_¡¬t
;

4233 
li¡_¡¬t
 =†i¡_¡¬t->
Ãxt
;

4234 
li¡_’d
->
Ãxt
 =‚ext;

4235 
Ãxt
->
´ev
 = 
li¡_’d
;

4236 
Ãxt
->Ãxˆð
NULL
;

4237 
li¡_¡¬t
->
´ev
 = 
NULL
;

4238 
li¡_’d
 = 
Ãxt
;

4241 
Ãxt
->
pc
 = 
ýu
->
ÿlýc
;

4242 
Ãxt
->
a
 = 
ýu
->a;

4243 
Ãxt
->
x
 = 
ýu
->x;

4244 
Ãxt
->
y
 = 
ýu
->y;

4245 
Ãxt
->
¥
 = 
ýu
->sp;

4246 
Ãxt
->
æags
 = 
MAKEFLAGS
;

4247 
Ãxt
->
š¡
[0] = 
	`mÚ_»ad
(
Üic
, 
ýu
->
ÿlýc
);

4248 
Ãxt
->
š¡
[1] = 
	`mÚ_»ad
(
Üic
, 
ýu
->
ÿlýc
+1);

4249 
Ãxt
->
š¡
[2] = 
	`mÚ_»ad
(
Üic
, 
ýu
->
ÿlýc
+2);

4250 
Ãxt
->
romdis
 = 
Üic
->romdis;

4251 ifÐÐ
Üic
->
driv‘y³
 =ð
DRV_JASMIN
 ) && ( oric->
jasmš
.
Þay
 ) )

4252 
Ãxt
->
romdis
 = 
SDL_FALSE
;

4253 
Ãxt
 =‚ext->next;

4254 
	}
}

4256 *
	$ýuŒaû_´št
Ð
machše
 *
Üic
, 
ýu_Œaû_’Œy
 *
ùe
 )

4258 
Ÿddr
, 
addr
;

4259 
Ý
, 
a1
, 
a2
;

4260 
i
;

4261 *
tmp¢ame
, *
di¥Œ
;

4262 
¢ame
[
SNAME_LEN
+1];

4263 
msym
 *
csym
;

4265 
di¥Œ
 = 
di¡mp
;

4267 
tmp¢ame
 = "";

4268 
csym
 = 
	`mÚ_fšd_sym_by_addr
Ð
Üic
, 
ùe
->
pc
, &ùe->
romdis
 );

4269 ifÐ
csym
 )

4271 
tmp¢ame
 = 
csym
->
Çme
;

4273 ifÐ
	`¡¾’
Ð
tmp¢ame
 ) > 
SNAME_LEN
 )

4275 
	`¥rštf
Ð
di¡mp
, "%s\n", 
tmp¢ame
 );

4276 
di¥Œ
 = &
di¡mp
[
	`¡¾’
(distmp)];

4277 
tmp¢ame
 = "";

4281 
	`¡rýy
Ð
¢ame
, 
tmp¢ame
 );

4282  
i
=
	`¡¾’
(
¢ame
); i<
SNAME_LEN
; i++ )

4283 
¢ame
[
i
] = 32;

4284 
¢ame
[
i
] = 0;

4286 
Ÿddr
 = 
ùe
->
pc
;

4287 
Ý
 = 
ùe
->
š¡
[0];

4288 
a1
 = 
ùe
->
š¡
[1];

4289 
a2
 = 
ùe
->
š¡
[2];

4290  
di¡ab
[
Ý
].
amode
 )

4292 
AM_IMP
:

4293 
	`¥rštf
Ð
di¥Œ
, "%  %04X %02X %s", 
¢ame
, 
Ÿddr
, 
Ý
, 
di¡ab
[Ý].
Çme
 );

4296 
AM_IMM
:

4297 
	`¥rštf
Ð
di¥Œ
, "%  %04X %02X %02X % #$%02X", 
¢ame
, 
Ÿddr
, 
Ý
, 
a1
, 
di¡ab
[Ý].
Çme
,‡1 );

4300 
AM_ZP
:

4301 
AM_ZPX
:

4302 
AM_ZPY
:

4303 
csym
 = 
	`mÚ_fšd_sym_by_addr
Ð
Üic
, 
a1
, &
ùe
->
romdis
 );

4304 ifÐ
csym
 )

4305 
	`¥rštf
Ð
di¥Œ
, "%  %04X %02X %02X % %s", 
¢ame
, 
Ÿddr
, 
Ý
, 
a1
, 
di¡ab
[Ý].
Çme
, 
csym
->name );

4307 
	`¥rštf
Ð
di¥Œ
, "%  %04X %02X %02X % $%02X", 
¢ame
, 
Ÿddr
, 
Ý
, 
a1
, 
di¡ab
[Ý].
Çme
,‡1 );

4308 ifÐ
di¡ab
[
Ý
].
amode
 =ð
AM_ZP
 ) ;

4309 
	`¡rÿt
Ð
di¥Œ
, 
di¡ab
[
Ý
].
amode
 =ð
AM_ZPX
 ? ",X" : ",Y" );

4312 
AM_ABS
:

4313 
AM_ABX
:

4314 
AM_ABY
:

4315 
csym
 = 
	`mÚ_fšd_sym_by_addr
Ð
Üic
, (
a2
<<8)|
a1
, &
ùe
->
romdis
 );

4316 ifÐ
csym
 )

4317 
	`¥rštf
Ð
di¥Œ
, "%  %04X %02X %02X %02X % %s", 
¢ame
, 
Ÿddr
, 
Ý
, 
a1
, 
a2
, 
di¡ab
[Ý].
Çme
, 
csym
->name );

4319 
	`¥rštf
Ð
di¥Œ
, "%  %04X %02X %02X %02X % $%02X%02X", 
¢ame
, 
Ÿddr
, 
Ý
, 
a1
, 
a2
, 
di¡ab
[Ý].
Çme
,‡2,‡1 );

4320 ifÐ
di¡ab
[
Ý
].
amode
 =ð
AM_ABS
 ) ;

4321 
	`¡rÿt
Ð
di¥Œ
, 
di¡ab
[
Ý
].
amode
 =ð
AM_ABX
 ? ",X" : ",Y" );

4324 
AM_ZIX
:

4325 
csym
 = 
	`mÚ_fšd_sym_by_addr
Ð
Üic
, 
a1
, &
ùe
->
romdis
 );

4326 ifÐ
csym
 )

4327 
	`¥rštf
Ð
di¥Œ
, "%  %04X %02X %02X % (%s,X)", 
¢ame
, 
Ÿddr
, 
Ý
, 
a1
, 
di¡ab
[Ý].
Çme
, 
csym
->name );

4329 
	`¥rštf
Ð
di¥Œ
, "%  %04X %02X %02X % ($%02X,X)", 
¢ame
, 
Ÿddr
, 
Ý
, 
a1
, 
di¡ab
[Ý].
Çme
,‡1 );

4332 
AM_ZIY
:

4333 
csym
 = 
	`mÚ_fšd_sym_by_addr
Ð
Üic
, 
a1
, &
ùe
->
romdis
 );

4334 ifÐ
csym
 )

4335 
	`¥rštf
Ð
di¥Œ
, "%  %04X %02X %02X % (%s),Y", 
¢ame
, 
Ÿddr
, 
Ý
, 
a1
, 
di¡ab
[Ý].
Çme
, 
csym
->name );

4337 
	`¥rštf
Ð
di¥Œ
, "%  %04X %02X %02X % ($%02X),Y", 
¢ame
, 
Ÿddr
, 
Ý
, 
a1
, 
di¡ab
[Ý].
Çme
,‡1 );

4340 
AM_REL
:

4341 
addr
 = ((
ùe
->
pc
+2)+((sigÃd )
a1
))&0xffff;

4342 
csym
 = 
	`mÚ_fšd_sym_by_addr
Ð
Üic
, 
addr
, &
ùe
->
romdis
 );

4343 ifÐ
csym
 )

4344 
	`¥rštf
Ð
di¥Œ
, "%  %04X %02X %02X % %s", 
¢ame
, 
Ÿddr
, 
Ý
, 
a1
, 
di¡ab
[Ý].
Çme
, 
csym
->name );

4346 
	`¥rštf
Ð
di¥Œ
, "%  %04X %02X %02X % $%04X", 
¢ame
, 
Ÿddr
, 
Ý
, 
a1
, 
di¡ab
[Ý].
Çme
, 
addr
 );

4349 
AM_IND
:

4350 
csym
 = 
	`mÚ_fšd_sym_by_addr
Ð
Üic
, (
a2
<<8)|
a1
, &
ùe
->
romdis
 );

4351 ifÐ
csym
 )

4352 
	`¥rštf
Ð
di¥Œ
, "%  %04X %02X %02X %02X % (%s)", 
¢ame
, 
Ÿddr
, 
Ý
, 
a1
, 
a2
, 
di¡ab
[Ý].
Çme
, 
csym
->name );

4354 
	`¥rštf
Ð
di¥Œ
, "%  %04X %02X %02X %02X % ($%02X%02X)", 
¢ame
, 
Ÿddr
, 
Ý
, 
a1
, 
a2
, 
di¡ab
[Ý].
Çme
,‡2,‡1 );

4358 
	`¡rýy
Ð
di¥Œ
, " WTF?" );

4362  
i
=
	`¡¾’
(
di¥Œ
); i<60; i++ )

4363 
di¥Œ
[
i
] = 32;

4364 
di¥Œ
[
i
] = 0;

4366 
	`¥rštf
(&
di¥Œ
[60], "%c%c-%c%c%c%c%c A=%02X X=%02X Y=%02X SP=%04X ROMDIS=%d",

4367 (
ùe
->
æags
&0x80) ? 'N' : '-',

4368 (
ùe
->
æags
&0x40) ? 'V' : '-',

4369 (
ùe
->
æags
&0x10) ? 'B' : '-',

4370 (
ùe
->
æags
&0x08) ? 'D' : '-',

4371 (
ùe
->
æags
&0x04) ? 'I' : '-',

4372 (
ùe
->
æags
&0x02) ? 'Z' : '-',

4373 (
ùe
->
æags
&0x01) ? 'C' : '-',

4374 
ùe
->
a
,

4375 
ùe
->
x
,

4376 
ùe
->
y
,

4377 
ùe
->
¥
+0x100,

4378 
ùe
->
romdis
);

4380  
di¡mp
;

4381 
	}
}

4383 
	$dump_ýuŒaû
(
machše
 *
Üic
)

4385 
ýu_Œaû_’Œy
 *
™”
 = 
li¡_¡¬t
;

4387 
™”
 !ð
Ãxt
)

4389 
	`´štf
("%s\n", 
	`ýuŒaû_´št
(
Üic
, 
™”
));

4390 
™”
 = i‹r->
Ãxt
;

4392 
	}
}

	@monitor.h

22 
	#SNAME_LEN
 11

23 
	#SSNAME_LEN
 (
SNAME_LEN
-3)

24 

	)

25 
	#SYMB_ROMDIS0
 0

	)

26 
	#SYMF_ROMDIS0
 (1<<
SYMB_ROMDIS0
)

	)

27 
	#SYMB_ROMDIS1
 1

	)

28 
	#SYMF_ROMDIS1
 (1<<
SYMB_ROMDIS1
)

	)

29 
	#SYMB_MICRODISC
 2

	)

30 
	#SYMF_MICRODISC
 (1<<
SYMB_MICRODISC
)

	)

31 
	#SYMB_JASMIN
 3

	)

32 
	#SYMF_JASMIN
 (1<<
SYMB_JASMIN
)

	)

33 
	#SYMB_TELEBANK0
 4

	)

34 
	#SYMF_TELEBANK0
 (1<<
SYMB_TELEBANK0
)

	)

35 
	#SYMB_TELEBANK1
 5

	)

36 
	#SYMF_TELEBANK1
 (1<<
SYMB_TELEBANK1
)

	)

37 
	#SYMB_TELEBANK2
 6

	)

38 
	#SYMF_TELEBANK2
 (1<<
SYMB_TELEBANK2
)

	)

39 
	#SYMB_TELEBANK3
 7

	)

40 
	#SYMF_TELEBANK3
 (1<<
SYMB_TELEBANK3
)

	)

41 
	#SYMB_TELEBANK4
 8

	)

42 
	#SYMF_TELEBANK4
 (1<<
SYMB_TELEBANK4
)

	)

43 
	#SYMB_TELEBANK5
 9

	)

44 
	#SYMF_TELEBANK5
 (1<<
SYMB_TELEBANK5
)

	)

45 
	#SYMB_TELEBANK6
 10

	)

46 
	#SYMF_TELEBANK6
 (1<<
SYMB_TELEBANK6
)

	)

47 
	#SYMB_TELEBANK7
 11

	)

48 
	#SYMF_TELEBANK7
 (1<<
SYMB_TELEBANK7
)

	)

49 
	#SYMB_PRAVZ8D
 12

	)

50 
	#SYMF_PRAVZ8D
 (1<<
SYMB_PRAVZ8D
)

	)

52 
	#SYM_BESTGUESS
 0xffff

	)

54 
	smsym


56 
	maddr
;

57 
	mæags
;

58 
	m¢ame
[
SNAME_LEN
+1];

59 
	ms¢ame
[
SSNAME_LEN
+1];

60 *
	mÇme
;

63 
	ssymbÞbË


65 
	mnumsyms
, 
	msym¥aû
;

66 
msym
 *
	msyms
;

69 
SDL_boÞ
 
isws
Ð
c
 );

70 
SDL_boÞ
 
ishex
Ð
c
 );

71 
hex™
Ð
c
 );

73 
mÚ_w¬mš™
Ð
machše
 *
Üic
 );

74 
mÚ_š™
Ð
machše
 *
Üic
 );

75 
mÚ_»nd”
Ð
machše
 *
Üic
 );

76 
mÚ_upd©e_»gs
Ð
machše
 *
Üic
 );

77 
mÚ_upd©e
Ð
machše
 *
Üic
 );

78 
SDL_boÞ
 
mÚ_ev’t
Ð
SDL_Ev’t
 *
ev
, 
machše
 *
Üic
, SDL_boÞ *
Ãed»nd”
 );

79 
dbg_´štf
Ð*
fmt
, ... );

80 
mÚ_´štf_above
Ð*
fmt
, ... );

81 
mÚ_’‹r
Ð
machše
 *
Üic
 );

82 
mÚ_shut
Ð
machše
 *
Üic
 );

83 
mÚ_š™_symb
Ð
symbÞbË
 *
¡ab
 );

84 
mÚ_ä“syms
Ð
symbÞbË
 *
¡ab
 );

85 
SDL_boÞ
 
mÚ_Ãw_symbÞs
Ð
symbÞbË
 *
¡ab
, 
machše
 *
Üic
, *
âame
, 
æags
, SDL_boÞ 
above
, SDL_boÞ 
v”bo£
 );

86 
SDL_boÞ
 
mÚ_symsäom¢­shÙ
Ð
symbÞbË
 *
¡ab
, *
bufãr
, 
Ën
);

87 
mÚ_¡©e_»£t
Ð
machše
 *
Üic
 );

88 
SDL_boÞ
 
mÚ_g‘num
Ð
machše
 *
Üic
, *
num
, *
buf
, *
off
, SDL_boÞ 
add¼egs
, SDL_boÞ 
Äegs
, SDL_boÞ 
vŸ»gs
, SDL_boÞ 
symbÞs
 );

89 
SDL_boÞ
 
mÚ_do_cmd
Ð*
cmd
, 
machše
 *
Üic
, SDL_boÞ *
Ãed»nd”
 );

90 
SDL_boÞ
 
mÚ_cmd
Ð*
cmd
, 
machše
 *
Üic
, SDL_boÞ *
Ãed»nd”
 );

92 #ià
defšed
(
DEBUG_CPU_TRACE
) && DEBUG_CPU_TRACE > 0

93 
	sýu_Œaû_’Œy


95 
ýu_Œaû_’Œy
 *
	mÃxt
, *
	m´ev
;

96 
Ušt16
 
	mpc
;

97 
Ušt8
 
	ma
, 
	mx
, 
	my
, 
	m¥
, 
	mæags
;

98 
Ušt8
 
	mš¡
[3];

99 
SDL_boÞ
 
	mromdis
;

101 
mÚ_Œaûš¡
(
m6502
 *
ýu
);

102 
dump_ýuŒaû
(
machše
 *
Üic
);

	@msgbox.h

24 
	mMSGBOX_YES_NO
 = 0,

25 
	mMSGBOX_OK_CANCEL
,

26 
	mMSGBOX_OK


29 
SDL_boÞ
 
š™_msgbox
Ð
machše
 *
Üic
 );

30 
shut_msgbox
Ð
machše
 *
Üic
 );

31 
SDL_boÞ
 
msgbox
Ð
machše
 *
Üic
, 
ty³
, *
msg
 );

	@msgbox_beos.cpp

22 
	~<¡dlib.h
>

23 
	~<¡dio.h
>

24 
	~<¡ršg.h
>

25 
	~<uni¡d.h
>

26 
	~<dœ’t.h
>

27 
	~<sys/¡©.h
>

28 
	~<AË¹.h
>

31 
	~"sy¡em.h
"

32 
	~"6502.h
"

33 
	~"vŸ.h
"

34 
	~"8912.h
"

35 
	~"gui.h
"

36 
	~"disk.h
"

37 
	~"mÚ™Ü.h
"

38 
	~"6551.h
"

39 
	~"machše.h
"

40 
	~"msgbox.h
"

43 
SDL_boÞ
 
	$š™_msgbox
Ð
machše
 *
Üic
 )

45  
SDL_TRUE
;

46 
	}
}

48 
	$shut_msgbox
Ð
machše
 *
Üic
 )

50 
	}
}

52 
SDL_boÞ
 
	$msgbox
Ð
machše
 *
Üic
, 
ty³
, *
msg
 )

54  
ty³
 )

56 
MSGBOX_YES_NO
:

57  ((
Ãw
 
	`BAË¹
("OricuŒÚ Reque¡", 
msg
, "Yes", "No"))->
	`Go
(è=ð0è? 
SDL_TRUE
 : 
SDL_FALSE
;

60 
MSGBOX_OK_CANCEL
:

61  ((
Ãw
 
	`BAË¹
("OricuŒÚ Reque¡", 
msg
, "Ok", "Cªûl"))->
	`Go
(è=ð0è? 
SDL_TRUE
 : 
SDL_FALSE
;

64 
MSGBOX_OK
:

65 (
Ãw
 
	`BAË¹
("OricuŒÚ Reque¡", 
msg
, "Ok"))->
	`Go
();

66  
SDL_TRUE
;

69  
SDL_TRUE
;

70 
	}
}

	@msgbox_gtk.c

22 
	~<¡dlib.h
>

23 
	~<¡dio.h
>

24 
	~<¡ršg.h
>

25 
	~<uni¡d.h
>

26 
	~<dœ’t.h
>

27 
	~<sys/¡©.h
>

29 
	~<gtk/gtk.h
>

31 
	~"sy¡em.h
"

32 
	~"6502.h
"

33 
	~"vŸ.h
"

34 
	~"8912.h
"

35 
	~"gui.h
"

36 
	~"disk.h
"

37 
	~"mÚ™Ü.h
"

38 
	~"6551.h
"

39 
	~"machše.h
"

40 
	~"msgbox.h
"

42 
SDL_boÞ
 
fuÎsü“n
;

43 
toggËfuÎsü“n
Ð
machše
 *
Üic
, 
osdm’u™em
 *
m™em
, 
dummy
 );

45 
SDL_boÞ
 
	$š™_msgbox
Ð
machše
 *
Üic
 )

48  
SDL_TRUE
;

49 
	}
}

51 
	$shut_msgbox
Ð
machše
 *
Üic
 )

53 
	}
}

55 
SDL_boÞ
 
	$msgbox
Ð
machše
 *
Üic
, 
ty³
, *
msg
 )

57 
GtkWidg‘
 *
dŸlog
 = 
NULL
;

58 
GtkBu‰ÚsTy³
 
bŠs
 = 
GTK_BUTTONS_OK
;

59 
GtkMes§geTy³
 
mtyp
 = 
GTK_MESSAGE_INFO
;

60 
SDL_boÞ
 
»suÉ
 = 
SDL_FALSE
;

61 
gšt
 
»s
;

62 
SDL_boÞ
 
was_fuÎsü“n
 = 
fuÎsü“n
;

64 ià(
fuÎsü“n
)

65 
	`toggËfuÎsü“n
(
Üic
, 
NULL
, 0);

67  
ty³
 )

69 
MSGBOX_YES_NO
:

70 
bŠs
 = 
GTK_BUTTONS_YES_NO
;

71 
mtyp
 = 
GTK_MESSAGE_QUESTION
;

74 
MSGBOX_OK_CANCEL
:

75 
bŠs
 = 
GTK_BUTTONS_OK_CANCEL
;

82 
dŸlog
 = 
	`gtk_mes§ge_dŸlog_Ãw
(
NULL
, 
GTK_DIALOG_MODAL
, 
mtyp
, 
bŠs
, "%s", 
msg
);

83 
»s
 = 
	`gtk_dŸlog_run
(
	`GTK_DIALOG
 (
dŸlog
));

84 ià((
»s
 =ð
GTK_RESPONSE_OK
è|| (» =ð
GTK_RESPONSE_YES
è|| (» =ð
GTK_RESPONSE_ACCEPT
))

85 
»suÉ
 = 
SDL_TRUE
;

87 
	`gtk_widg‘_de¡roy
(
dŸlog
);

88 
	`gtk_ev’ts_³ndšg
())

89 
	`gtk_maš_™”©iÚ
();

91 ià(
was_fuÎsü“n
)

92 
	`toggËfuÎsü“n
(
Üic
, 
NULL
, 0);

94  
»suÉ
;

95 
	}
}

	@msgbox_os2.c

22 
	~<´Ùo/štu™iÚ.h
>

24 
	~"sy¡em.h
"

25 
	~"6502.h
"

26 
	~"vŸ.h
"

27 
	~"8912.h
"

28 
	~"gui.h
"

29 
	~"disk.h
"

30 
	~"mÚ™Ü.h
"

31 
	~"6551.h
"

32 
	~"machše.h
"

33 
	~"msgbox.h
"

35 
SDL_boÞ
 
	$š™_msgbox
Ð
machše
 *
Üic
 )

37  
SDL_TRUE
;

38 
	}
}

40 
	$shut_msgbox
Ð
machše
 *
Üic
 )

42 
	}
}

44 
SDL_boÞ
 
	$msgbox
Ð
machše
 *
Üic
, 
ty³
, *
msg
 )

46 *
bŠs
 = "OK|Cancel";

47 
EasySŒuù
 
myES
 =

49 (
EasySŒuù
),

52 
msg
,

53 
bŠs
,

56  
ty³
 )

58 
MSGBOX_YES_NO
:

59 
	`¡rýy
(
bŠs
, "Yes|No");

62 
MSGBOX_OK
:

63 
	`¡rýy
(
bŠs
, "OK");

66 
MSGBOX_OK_CANCEL
:

70  
	`EasyReque¡
(
NULL
, &
myES
, NULL);

71 
	}
}

	@msgbox_os4.c

22 
	~<¡dlib.h
>

23 
	~<¡dio.h
>

24 
	~<¡ršg.h
>

25 
	~<uni¡d.h
>

26 
	~<dœ’t.h
>

27 
	~<sys/¡©.h
>

29 
	~<þas£s/»que¡”.h
>

31 
	~<´Ùo/exec.h
>

32 
	~<´Ùo/štu™iÚ.h
>

33 
	~<´Ùo/»que¡”.h
>

35 
	~"sy¡em.h
"

36 
	~"6502.h
"

37 
	~"vŸ.h
"

38 
	~"8912.h
"

39 
	~"gui.h
"

40 
	~"disk.h
"

41 
	~"mÚ™Ü.h
"

42 
	~"6551.h
"

43 
	~"machše.h
"

44 
	~"msgbox.h
"

46 
Lib¿ry
 *
	gIÁu™iÚBa£
 = 
NULL
;

47 
Lib¿ry
 *
	gReque¡”Ba£
 = 
NULL
;

49 
IÁu™iÚIFaû
 *
	gIIÁu™iÚ
 = 
NULL
;

50 
Reque¡”IFaû
 *
	gIReque¡”
 = 
NULL
;

52 
SDL_boÞ
 
	$š™_msgbox
Ð
machše
 *
Üic
 )

54 
IÁu™iÚBa£
 = 
IExec
->
	`O³nLib¿ry
( "intuition.library", 51 );

55 ifÐ!
IÁu™iÚBa£
 )

57 
	`´štf
( "Unableo open intuition.library v51+\n" );

58  
SDL_FALSE
;

61 
IIÁu™iÚ
 = (
IÁu™iÚIFaû
 *)
IExec
->
	`G‘IÁ”çû
Ð
IÁu™iÚBa£
, "maš", 1, 
NULL
 );

62 ifÐ!
IIÁu™iÚ
 )

64 
	`´štf
( "Unableo obtain main interface for intuition.library\n" );

65  
SDL_FALSE
;

68 
Reque¡”Ba£
 = 
IExec
->
	`O³nLib¿ry
( "requester.class", 51 );

69 ifÐ!
Reque¡”Ba£
 )

71 
	`´štf
( "Unableo open„equester.class v51+\n" );

72  
SDL_FALSE
;

75 
IReque¡”
 = (
Reque¡”IFaû
 *)
IExec
->
	`G‘IÁ”çû
Ð
Reque¡”Ba£
, "maš", 1, 
NULL
 );

76 ifÐ!
IReque¡”
 )

78 
	`´štf
( "Unableo obtain main interface for„equester.library\n" );

79  
SDL_FALSE
;

82  
SDL_TRUE
;

83 
	}
}

85 
	$shut_msgbox
Ð
machše
 *
Üic
 )

87 ifÐ
IReque¡”
 ) 
IExec
->
	`DrÝIÁ”çû
Ð(
IÁ”çû
 *)IRequester );

88 ifÐ
Reque¡”Ba£
 ) 
IExec
->
	`Clo£Lib¿ry
( RequesterBase );

89 ifÐ
IIÁu™iÚ
 ) 
IExec
->
	`DrÝIÁ”çû
Ð(
IÁ”çû
 *)IIntuition );

90 ifÐ
IÁu™iÚBa£
 ) 
IExec
->
	`Clo£Lib¿ry
( IntuitionBase );

91 
	}
}

93 
SDL_boÞ
 
	$msgbox
Ð
machše
 *
Üic
, 
ty³
, *
msg
 )

95 
Objeù
 *
»q_obj
;

96 
št32
 
»suÉ
, 
imgty³
=
REQIMAGE_INFO
;

97 
STRPTR
 
bŠs
 = "huh?!";

99  
ty³
 )

101 
MSGBOX_YES_NO
:

102 
bŠs
 = "Yes|No";

103 
imgty³
 = 
REQIMAGE_QUESTION
;

106 
MSGBOX_OK_CANCEL
:

107 
bŠs
 = "OK|Cancel";

108 
imgty³
 = 
REQIMAGE_QUESTION
;

111 
MSGBOX_OK
:

112 
bŠs
 = "OK";

113 
imgty³
 = 
REQIMAGE_INFO
;

117 
»q_obj
 = (
Objeù
 *)
IIÁu™iÚ
->
	`NewObjeù
Ð
IReque¡”
->
	`REQUESTER_G‘CÏss
(), 
NULL
,

118 
REQ_T™ËText
, "Oricutron Request",

119 
REQ_BodyText
, 
msg
,

120 
REQ_Gadg‘Text
, 
bŠs
,

121 
REQ_Image
, 
imgty³
,

122 
TAG_DONE
 );

124 ifÐ!
»q_obj
 )  
SDL_TRUE
;

126 
»suÉ
 = 
IIÁu™iÚ
->
	`IDoM‘hod
Ð
»q_obj
, 
RM_OPENREQ
, 
NULL
, NULL, NULL );

127 
IIÁu™iÚ
->
	`Di¥o£Objeù
Ð
»q_obj
 );

129 ifÐ
ty³
 =ð
MSGBOX_OK
 )  
SDL_TRUE
;

131  
»suÉ
 ? 
SDL_TRUE
 : 
SDL_FALSE
;

132 
	}
}

	@msgbox_sdl.c

22 
	~<¡dlib.h
>

23 
	~<¡dio.h
>

24 
	~<¡ršg.h
>

25 
	~<uni¡d.h
>

26 
	~<dœ’t.h
>

27 
	~<sys/¡©.h
>

29 
	~"sy¡em.h
"

30 
	~"6502.h
"

31 
	~"vŸ.h
"

32 
	~"8912.h
"

33 
	~"gui.h
"

34 
	~"disk.h
"

35 
	~"mÚ™Ü.h
"

36 
	~"6551.h
"

37 
	~"machše.h
"

38 
	~"msgbox.h
"

40 
	smsgboxbut


42 
	mx
, 
	my
;

43 *
	m¡r
;

46 
SDL_Surçû
 *
sü“n
;

47 
‹xtzÚe
 *
tz
[
NUM_TZ
];

48 
msgboxbut
 *
	gbŠs
;

49 
	gcbŠ
;

51 
msgboxbut
 
	gynbuts
[] = { { 2, 5, " YES " },

53 { -1,-1, 
NULL
 } };

55 
msgboxbut
 
	gocbuts
[] = { { 2, 5, " OK " },

57 { -1,-1, 
NULL
 } };

59 
msgboxbut
 
	gobuts
[] = { { 26, 5, " OK " },

60 { -1,-1, 
NULL
 } };

62 
SDL_boÞ
 
	$š™_msgbox
Ð
machše
 *
Üic
 )

64 ifÐ!
	`®loc_‹xtzÚe
Ð
Üic
, 
TZ_MSGBOX
, 80, 120, 60, 8, "OricuŒÚ Reque¡" ) )  
SDL_FALSE
;

66  
SDL_TRUE
;

67 
	}
}

69 
	$shut_msgbox
Ð
machše
 *
Üic
 )

71 
	`ä“_‹xtzÚe
Ð
Üic
, 
TZ_MSGBOX
 );

72 
	}
}

75 
	$msgbox_»nd”
Ð
machše
 *
Üic
 )

77 
i
;

79  
i
=0; 
bŠs
[i].
x
!=-1; i++ )

81 ifÐ
i
==
cbŠ
 )

83 
tz
[
TZ_MSGBOX
]->
cfc
 = 1;

84 
tz
[
TZ_MSGBOX
]->
cbc
 = 2;

86 
tz
[
TZ_MSGBOX
]->
cfc
 = 2;

87 
tz
[
TZ_MSGBOX
]->
cbc
 = 5;

90 
	`tz¡½os
Ð
tz
[
TZ_MSGBOX
], 
bŠs
[
i
].
x
, bŠs[i].
y
, bŠs[i].
¡r
 );

93 
Üic
->
	`»nd”_begš
( oric );

95 
Üic
->
	`»nd”_video
ÐÜic, 
SDL_TRUE
 );

96 
Üic
->
	`»nd”_‹xtzÚe
ÐÜic, 
TZ_MSGBOX
 );

98 
Üic
->
	`»nd”_’d
( oric );

99 
	}
}

101 
	$msgbox_checkov”
Ð
x
, 
y
 )

103 
i
;

105  
i
=0; 
bŠs
[i].
x
!=-1; i++ )

107 ifÐÐ
y
 =ð
bŠs
[
i
].y ) &&

108 Ð
x
 >ð
bŠs
[
i
].x ) &&

109 Ð
x
 < (
bŠs
[
i
].x+
	`¡¾’
(bŠs[i].
¡r
)) ) )

110  
i
;

113 
	}
}

115 
SDL_boÞ
 
	$msgbox
Ð
machše
 *
Üic
, 
ty³
, *
msg
 )

117 
i
, 
j
, 
k
, 
mx
, 
my
, 
´essÚ
;

118 
lšes
[] = { 2*60, 3*60, 5*60 };

119 *
msg2
;

120 
SDL_Ev’t
 
ev’t
;

121 
SDL_boÞ
 
wasunicode
;

123 
wasunicode
 = 
	`SDL_COMPAT_EÇbËUNICODE
Ð
SDL_TRUE
 );

124 
	`SDL_COMPAT_EÇbËKeyR•—t
Ð
SDL_DEFAULT_REPEAT_DELAY
, 
SDL_DEFAULT_REPEAT_INTERVAL
 );

127  
i
=1; i<59; i++ )

129  
j
=0; j<3; j++ )

131 
tz
[
TZ_MSGBOX
]->
fc
[
lšes
[
j
]+
i
] = 2;

132 
tz
[
TZ_MSGBOX
]->
bc
[
lšes
[
j
]+
i
] = 3;

133 
tz
[
TZ_MSGBOX
]->
tx
[
lšes
[
j
]+
i
] = 32;

137  
i
=0; 
msg
[i]; i++ ) if( (msg[i]=='\r')||(msg[i]=='\n') ) ;

139  
j
=0, 
k
=30-
i
/2; j<i; j++, k++ )

140 
tz
[
TZ_MSGBOX
]->
tx
[
lšes
[0]+
k
] = 
msg
[
j
];

142  (
msg
[
i
]=='\r')||(msg[i]=='\n') ) i++;

143 ifÐ
msg
[
i
] )

145 
msg2
 = &
msg
[
i
];

146 
i
 = 
	`¡¾’
Ð
msg2
 );

147  
j
=0, 
k
=30-
i
/2; j<i; j++, k++ )

148 
tz
[
TZ_MSGBOX
]->
tx
[
lšes
[1]+
k
] = 
msg2
[
j
];

151  
ty³
 )

153 
MSGBOX_YES_NO
:

154 
bŠs
 = 
ynbuts
;

155 
cbŠ
 = 0;

158 
MSGBOX_OK_CANCEL
:

159 
bŠs
 = 
ocbuts
;

160 
cbŠ
 = 1;

163 
MSGBOX_OK
:

164 
bŠs
 = 
obuts
;

165 
cbŠ
 = 0;

169 
	`msgbox_»nd”
Ð
Üic
 );

171 
´essÚ
 = -1;

174 ifÐ!
	`SDL_Wa™Ev’t
Ð&
ev’t
 ) )

176 
	`SDL_COMPAT_EÇbËUNICODE
Ð
wasunicode
 );

177 
	`SDL_COMPAT_EÇbËKeyR•—t
Ð
wasunicode
 ? 
SDL_DEFAULT_REPEAT_DELAY
 : 0, wasunicod? 
SDL_DEFAULT_REPEAT_INTERVAL
 : 0 );

178  
SDL_FALSE
;

181  
ev’t
.
ty³
 )

183 
SDL_COMPAT_ACTIVEEVENT
:

184 if(
	`SDL_COMPAT_IsAµFocu£d
Ð&
ev’t
 ) ) {

185 
	`msgbox_»nd”
Ð
Üic
 );

189 
SDL_MOUSEMOTION
:

190 ifÐ
´essÚ
 != -1 ) ;

191 
mx
 = (
ev’t
.
mÙiÚ
.
x
 - 
tz
[
TZ_MSGBOX
]->x)/8;

192 
my
 = (
ev’t
.
mÙiÚ
.
y
 - 
tz
[
TZ_MSGBOX
]->y)/12;

193 
i
 = 
	`msgbox_checkov”
Ð
mx
, 
my
 );

194 ifÐ
i
 == -1 ) ;

195 ifÐ
i
 !ð
cbŠ
 )

197 
cbŠ
 = 
i
;

198 
	`msgbox_»nd”
Ð
Üic
 );

202 
SDL_MOUSEBUTTONDOWN
:

203 ifÐ
ev’t
.
bu‰Ú
.bu‰Ú =ð
SDL_BUTTON_LEFT
 )

205 
mx
 = (
ev’t
.
mÙiÚ
.
x
 - 
tz
[
TZ_MSGBOX
]->x)/8;

206 
my
 = (
ev’t
.
mÙiÚ
.
y
 - 
tz
[
TZ_MSGBOX
]->y)/12;

207 
i
 = 
	`msgbox_checkov”
Ð
mx
, 
my
 );

208 ifÐ
i
 == -1 ) ;

209 
cbŠ
 = 
i
;

210 
´essÚ
 = 
i
;

211 
	`msgbox_»nd”
Ð
Üic
 );

215 
SDL_MOUSEBUTTONUP
:

216 ifÐ
ev’t
.
bu‰Ú
.bu‰Ú =ð
SDL_BUTTON_LEFT
 )

218 ifÐ
´essÚ
 == -1 ) ;

219 
mx
 = (
ev’t
.
mÙiÚ
.
x
 - 
tz
[
TZ_MSGBOX
]->x)/8;

220 
my
 = (
ev’t
.
mÙiÚ
.
y
 - 
tz
[
TZ_MSGBOX
]->y)/12;

221 
i
 = 
	`msgbox_checkov”
Ð
mx
, 
my
 );

222 ifÐ
i
 =ð
´essÚ
 )

224  
ty³
 )

226 
MSGBOX_YES_NO
:

227 
MSGBOX_OK_CANCEL
:

228 
	`SDL_COMPAT_EÇbËUNICODE
Ð
wasunicode
 );

229 
	`SDL_COMPAT_EÇbËKeyR•—t
Ð
wasunicode
 ? 
SDL_DEFAULT_REPEAT_DELAY
 : 0, wasunicod? 
SDL_DEFAULT_REPEAT_INTERVAL
 : 0 );

230  (
´essÚ
==0);

233 
	`SDL_COMPAT_EÇbËUNICODE
Ð
wasunicode
 );

234 
	`SDL_COMPAT_EÇbËKeyR•—t
Ð
wasunicode
 ? 
SDL_DEFAULT_REPEAT_DELAY
 : 0, wasunicod? 
SDL_DEFAULT_REPEAT_INTERVAL
 : 0 );

235  
SDL_TRUE
;

240 
´essÚ
 = -1;

244 
SDL_KEYDOWN
:

245  
ev’t
.
key
.
keysym
.
sym
 )

247 
SDLK_TAB
:

248 
SDLK_RIGHT
:

249 
cbŠ
 = cbtn+1;

250 ifÐ
bŠs
[
cbŠ
].
x
 == -1 ) cbtn = 0;

251 
	`msgbox_»nd”
Ð
Üic
 );

254 
SDLK_LEFT
:

255 
cbŠ
--;

256 ifÐ
cbŠ
 < 0 )

258  
cbŠ
=0; 
bŠs
[cbŠ].
x
!=-1; cbtn++ ) ;

259 
cbŠ
--;

261 
	`msgbox_»nd”
Ð
Üic
 );

264 
SDLK_RETURN
:

265 
SDLK_KP_ENTER
:

266  
ty³
 )

268 
MSGBOX_YES_NO
:

269 
MSGBOX_OK_CANCEL
:

270 
	`SDL_COMPAT_EÇbËUNICODE
Ð
wasunicode
 );

271 
	`SDL_COMPAT_EÇbËKeyR•—t
Ð
wasunicode
 ? 
SDL_DEFAULT_REPEAT_DELAY
 : 0, wasunicod? 
SDL_DEFAULT_REPEAT_INTERVAL
 : 0 );

272  (
cbŠ
==0);

275 
	`SDL_COMPAT_EÇbËUNICODE
Ð
wasunicode
 );

276 
	`SDL_COMPAT_EÇbËKeyR•—t
Ð
wasunicode
 ? 
SDL_DEFAULT_REPEAT_DELAY
 : 0, wasunicod? 
SDL_DEFAULT_REPEAT_INTERVAL
 : 0 );

277  
SDL_TRUE
;

288 
	`SDL_COMPAT_EÇbËUNICODE
Ð
wasunicode
 );

289 
	`SDL_COMPAT_EÇbËKeyR•—t
Ð
wasunicode
 ? 
SDL_DEFAULT_REPEAT_DELAY
 : 0, wasunicod? 
SDL_DEFAULT_REPEAT_INTERVAL
 : 0 );

290  
SDL_FALSE
;

291 
	}
}

	@msgbox_win32.c

22 
	~<¡dlib.h
>

23 
	~<¡dio.h
>

24 
	~<¡ršg.h
>

25 
	~<sys/¡©.h
>

26 
	~<wšdows.h
>

28 
	#WANT_WMINFO


	)

30 
	~"sy¡em.h
"

31 
	~"6502.h
"

32 
	~"vŸ.h
"

33 
	~"8912.h
"

34 
	~"gui.h
"

35 
	~"disk.h
"

36 
	~"mÚ™Ü.h
"

37 
	~"6551.h
"

38 
	~"machše.h
"

39 
	~"msgbox.h
"

41 
SDL_boÞ
 
	$š™_msgbox
Ð
machše
 *
Üic
 )

43  
SDL_TRUE
;

44 
	}
}

46 
	$shut_msgbox
Ð
machše
 *
Üic
 )

48 
	}
}

50 
SDL_boÞ
 
	$msgbox
Ð
machše
 *
Üic
, 
ty³
, *
msg
 )

52 
SDL_SysWMšfo
 
wmi
;

53 
HWND
 
hwnd
;

55 
hwnd
 = 
NULL
;

56 
	`SDL_VERSION
(&
wmi
.
v”siÚ
);

57 if(
	`SDL_COMPAT_G‘WMInfo
Ð&
wmi
 ) )

58 #ià
SDL_MAJOR_VERSION
 == 1

59 
hwnd
 = (
HWND
)
wmi
.
wšdow
;

61 
hwnd
 = (
HWND
)
wmi
.
šfo
.
wš
.
wšdow
;

63  
ty³
 )

65 
MSGBOX_YES_NO
:

66  (
	`Mes§geBoxA
Ð
hwnd
, 
msg
, "OricuŒÚ Reque¡", 
MB_YESNO
 ) =ð
IDYES
);

68 
MSGBOX_OK_CANCEL
:

69  (
	`Mes§geBoxA
Ð
hwnd
, 
msg
, "OricuŒÚ Reque¡", 
MB_OKCANCEL
 ) =ð
IDOK
);

71 
MSGBOX_OK
:

72 
	`Mes§geBoxA
Ð
hwnd
, 
msg
, "OricuŒÚ Reque¡", 
MB_OK
 );

75  
SDL_TRUE
;

76 
	}
}

	@msvc/strcasecmp.h

1 #ifdeà
_MSC_VER


2 #ifdeà
__SPECIFY_SDL_DIR__


3 
	~<SDL2/SDL.h
>

5 
	~<SDL.h
>

7 
	#¡rÿ£cmp
 
SDL_¡rÿ£cmp


	)

8 
	#¡ºÿ£cmp
 
SDL_¡ºÿ£cmp


	)

	@msvc/unistd.h

1 #ifdeà
_MSC_VER


3 
	~<io.h
>

4 
	~<´oûss.h
>

8 
	~<dœeù.h
>

9 
	#g‘cwd
 
_g‘cwd


	)

12 
	~"¡rÿ£cmp.h
"

	@plugins/ch376/ch376.c

27 #ià
defšed
(
__MORPHOS__
è|| defšed (
__AMIGA__
è|| defšed (
__AROS__
)

29 
	#__NOLIBBASE__


	)

31 
	~<´Ùo/exec.h
>

32 
	~<´Ùo/dos.h
>

33 
	~<¡ršg.h
>

35 
Lib¿ry
 *
SysBa£
;

37 #–ià
defšed
(
WIN32
)

39 
	~<wšdows.h
>

40 
	~<¡dio.h
>

41 
	~<¡r§ã.h
>

42 
	~<sys/¡©.h
>

45 #–ià
defšed
(
__unix__
è|| defšed(
__APPLE__
è|| defšed(
__HAIKU__
è|| defšed(
__MINT__
)

47 
	~<¡dlib.h
>

48 
	~<¡dšt.h
>

49 
	~<¡dboÞ.h
>

50 
	~<¡dio.h
>

51 
	~<dœ’t.h
>

52 
	~<uni¡d.h
>

53 
	~<¡ršg.h
>

54 
	~<sys/¡©vfs.h
>

55 
	~<sys/¡©.h
>

61 
	~"ch376.h
"

68 
	#CH376_DATA_IC_VER
 3

	)

71 
	#CH376_CMD_NONE
 0x00

	)

72 
	#CH376_CMD_GET_IC_VER
 0x01

	)

73 
	#CH376_CMD_CHECK_EXIST
 0x06

	)

74 
	#CH376_CMD_GET_FILE_SIZE
 0x0c

	)

75 
	#CH376_CMD_SET_USB_MODE
 0x15

	)

76 
	#CH376_CMD_GET_STATUS
 0x22

	)

77 
	#CH376_CMD_RD_USB_DATA0
 0x27

	)

78 
	#CH376_CMD_WR_REQ_DATA
 0x2d

	)

79 
	#CH376_CMD_SET_FILE_NAME
 0x2f

	)

80 
	#CH376_CMD_DISK_MOUNT
 0x31

	)

81 
	#CH376_CMD_FILE_OPEN
 0x32

	)

82 
	#CH376_CMD_FILE_ENUM_GO
 0x33

	)

83 
	#CH376_CMD_FILE_CREATE
 0x34

	)

84 
	#CH376_CMD_FILE_ERASE
 0x35

	)

85 
	#CH376_CMD_FILE_CLOSE
 0x36

	)

86 
	#CH376_CMD_BYTE_LOCATE
 0x39

	)

87 
	#CH376_CMD_BYTE_READ
 0x3a

	)

88 
	#CH376_CMD_BYTE_RD_GO
 0x3b

	)

89 
	#CH376_CMD_BYTE_WRITE
 0x3c

	)

90 
	#CH376_CMD_BYTE_WR_GO
 0x3d

	)

91 
	#CH376_CMD_DISK_CAPACITY
 0x3e

	)

92 
	#CH376_CMD_DISK_QUERY
 0x3f

	)

93 
	#CH376_CMD_DIR_CREATE
 0x40

	)

94 
	#CH376_CMD_DISK_RD_GO
 0x55

	)

96 
	#CH376_ARG_SET_USB_MODE_INVALID
 0x00

	)

97 
	#CH376_ARG_SET_USB_MODE_SD_HOST
 0x03

	)

98 
	#CH376_ARG_SET_USB_MODE_USB_HOST
 0x06

	)

101 
	#CH376_ERR_OPEN_DIR
 0x41

	)

102 
	#CH376_ERR_MISS_FILE
 0x42

	)

103 
	#CH376_ERR_FOUND_NAME
 0x43

	)

105 
	#CH376_RET_SUCCESS
 0x51

	)

106 
	#CH376_RET_ABORT
 0x5f

	)

108 
	#CH376_INT_SUCCESS
 0x14

	)

109 
	#CH376_INT_DISK_READ
 0x1d

	)

110 
	#CH376_INT_DISK_WRITE
 0x1e

	)

116 
	#CMD_DATA_REQ_SIZE
 0xff

	)

119 
	#DIR_ATTR_READ_ONLY
 0x01

	)

120 
	#DIR_ATTR_HIDDEN
 0x02

	)

121 
	#DIR_ATTR_SYSTEM
 0x04

	)

122 
	#DIR_ATTR_VOLUME_ID
 0x08

	)

123 
	#DIR_ATTR_DIRECTORY
 0x10

	)

124 
	#DIR_ATTR_ARCHIVE
 0x20

	)

126 
	#DIR_MAKE_FILE_TIME
(
h
, 
m
, 
s
è((h<<11è+ (m<<5è+ (s>>1))

	)

128 
	#DIR_MAKE_FILE_DATE
(
y
, 
m
, 
d
è(((y-1980)<<9è+ (m<<5è+ d)

	)

130 #´agm¨
·ck
(1)

133 
	sF©DœInfo


135 
	mDIR_Name
[11];

136 
CH376_U8
 
	mDIR_A‰r
;

137 
CH376_U8
 
	mDIR_NTRes
;

138 
CH376_U8
 
	mDIR_C¹TimeT’th
;

139 
CH376_U8
 
	mDIR_C¹Time
[2];

140 
CH376_U8
 
	mDIR_C¹D©e
[2];

141 
CH376_U8
 
	mDIR_L¡AccD©e
[2];

142 
CH376_U8
 
	mDIR_F¡ClusHI
[2];

143 
CH376_U8
 
	mDIR_W¹Time
[2];

144 
CH376_U8
 
	mDIR_W¹D©e
[2];

145 
CH376_U8
 
	mDIR_F¡ClusLO
[2];

146 
CH376_U8
 
	mDIR_FžeSize
[4];

149 
	sMouÁInfo


151 
CH376_U8
 
	mMOUNT_DeviûTy³
;

152 
CH376_U8
 
	mMOUNT_RemovabËMedŸ
;

153 
CH376_U8
 
	mMOUNT_V”siÚs
;

154 
CH376_U8
 
	mMOUNT_D©aFÜm©AndEtc
;

155 
CH376_U8
 
	mMOUNT_Add™iÚ®L’gth
;

156 
CH376_U8
 
	mMOUNT_Re£rved1
;

157 
CH376_U8
 
	mMOUNT_Re£rved2
;

158 
CH376_U8
 
	mMOUNT_MiscFÏg
;

159 
	mMOUNT_V’dÜIdSŒ
[8];

160 
	mMOUNT_ProduùIdSŒ
[16];

161 
	mMOUNT_ProduùRevSŒ
[4];

164 
	sDiskQu”y


166 
CH376_U8
 
	mDISK_TÙ®SeùÜ
[4];

167 
CH376_U8
 
	mDISK_F»eSeùÜ
[4];

168 
CH376_U8
 
	mDISK_DiskF©
;

171 
	uCommªdD©a


173 
	mCMD_FžeName
[14];

174 
MouÁInfo
 
	mCMD_MouÁInfo
;

175 
F©DœInfo
 
	mCMD_F©DœInfo
;

176 
DiskQu”y
 
	mCMD_DiskQu”y
;

177 
CH376_U8
 
	mCMD_FžeS“k
[4];

178 
CH376_U8
 
	mCMD_FžeR—dWr™e
[2];

179 
CH376_U8
 
	mCMD_IOBufãr
[255];

180 
CH376_U8
 
	mCMD_CheckBy‹
;

181 
CH376_U8
 
	mCMD_FžeSize
[4];

184 #´agm¨
·ck
()

190 
	sch376


192 
CH376_CONTEXT
 
	mcÚ‹xt
;

194 
CH376_U8
 
	mcommªd
;

195 
CH376_U8
 
	mcommªd_¡©us
;

197 
CH376_U8
 
	mš‹rçû_¡©us
;

198 
CH376_U8
 
	musb_mode
;

200 
CommªdD©a
 
	mcmd_d©a
;

201 
CH376_U8
 
	mnb_by‹s_š_cmd_d©a
;

202 
CH376_U8
 
	mpos_rw_š_cmd_d©a
;

204 
CH376_U16
 
	mby‹s_to_»ad_wr™e
;

206 
CH376_LOCK
 
	mroÙ_dœ_lock
;

207 
CH376_LOCK
 
	mcu¼’t_dœ_lock
;

208 
CH376_FILE
 
	mcu¼’t_fže
;

209 
CH376_DIR
 
	mcu¼’t_dœeùÜy_browsšg
;

211 
CH376_BOOL
 
	mcu¼’t_fže_is_dœeùÜy
;

212 
	mdœ_·‰”n
[14];

214 *
	msdÿrd_drive_·th
;

215 *
	musb_drive_·th
;

222 *
þÚe_¡ršg
(cÚ¡ *
¡ršg
);

223 
þ—r_¡ruùu»
(
ch376
 *ch376);

224 
ÿnûl_®l_io
(
ch376
 *ch376);

225 
nÜm®ize_ch¬
(
c
);

226 cÚ¡ * 
nÜm®ize_fže_Çme
(cÚ¡ *
fže_Çme
, *
nÜm®ized_fže_Çme
);

227 cÚ¡ * 
Œim_fže_Çme
(cÚ¡ *
fže_Çme
, *
Œimmed_fže_Çme
);

228 
fže_»ad_chunk
(
ch376
 *ch376);

229 
fže_wr™e_chunk
(
ch376
 *ch376);

230 
CH376_BOOL
 
·‰”n_m©ch
(cÚ¡ *
·‰”n
, cÚ¡ *
¡r
);

231 cÚ¡ * 
nÜm®ize_·‰”n
(cÚ¡ *
·‰”n
, *
nÜm®ized_·‰”n
);

238 * 
sy¡em_®loc_mem
(
size
);

242 
sy¡em_ä“_mem
(*
±r
);

246 
CH376_BOOL
 
sy¡em_š™_cÚ‹xt
(
CH376_CONTEXT
 *
cÚ‹xt
, 
UNUSED
 *
u£r_d©a
);

249 
sy¡em_þ—n_cÚ‹xt
(
CH376_CONTEXT
 *
cÚ‹xt
);

252 
CH376_BOOL
 
sy¡em_g‘_disk_šfo
(
CH376_CONTEXT
 *
cÚ‹xt
, 
CH376_LOCK
 
roÙ_lock
, 
DiskQu”y
 *
disk_šfo
);

256 
CH376_LOCK
 
sy¡em_obš_dœeùÜy_lock
(
CH376_CONTEXT
 *
cÚ‹xt
, cÚ¡ *
dœ_·th
, CH376_LOCK 
roÙ_lock
);

260 
sy¡em_»Ëa£_dœeùÜy_lock
(
CH376_CONTEXT
 *
cÚ‹xt
, 
CH376_LOCK
 
dœ_lock
);

263 
CH376_LOCK
 
sy¡em_þÚe_dœeùÜy_lock
(
CH376_CONTEXT
 *
cÚ‹xt
, CH376_LOCK 
dœ_lock
);

266 
CH376_LOCK
 
sy¡em_ü—‹_dœeùÜy
(
CH376_CONTEXT
 *
cÚ‹xt
, cÚ¡ *
dœ_·th
, CH376_LOCK 
roÙ_lock
);

270 
CH376_FILE
 
sy¡em_fže_Ý’_exi¡šg
(
CH376_CONTEXT
 *
cÚ‹xt
, cÚ¡ *
fže_Çme
, 
CH376_LOCK
 
roÙ_lock
);

274 
CH376_FILE
 
sy¡em_fže_Ý’_Ãw
(
CH376_CONTEXT
 *
cÚ‹xt
, cÚ¡ *
fže_Çme
, 
CH376_LOCK
 
roÙ_lock
);

277 
sy¡em_fže_þo£
(
CH376_CONTEXT
 *
cÚ‹xt
, 
CH376_FILE
 
fže
);

280 
CH376_S32
 
sy¡em_fže_£ek
(
CH376_CONTEXT
 *
cÚ‹xt
, 
CH376_FILE
 
fže
, 
pos
);

283 
CH376_S32
 
sy¡em_fže_»ad
(
CH376_CONTEXT
 *
cÚ‹xt
, 
CH376_FILE
 
fže
, *
bufãr
, CH376_S32 
size
);

286 
CH376_S32
 
sy¡em_fže_wr™e
(
CH376_CONTEXT
 *
cÚ‹xt
, 
CH376_FILE
 
fže
, *
bufãr
, CH376_S32 
size
);

289 
CH376_BOOL
 
sy¡em_fže_d–‘e
(
CH376_CONTEXT
 *
cÚ‹xt
, cÚ¡ *
fže_Çme
, 
CH376_LOCK
 
roÙ_lock
);

292 
CH376_BOOL
 
sy¡em_dœeùÜy_d–‘e
(
CH376_CONTEXT
 *
cÚ‹xt
, 
CH376_LOCK
 
roÙ_lock
);

296 
CH376_DIR
 
sy¡em_¡¬t_examše_dœeùÜy
(
CH376_CONTEXT
 *
cÚ‹xt
, 
CH376_LOCK
 
dœ_lock
);

299 
CH376_BOOL
 
sy¡em_go_examše_dœeùÜy
(
CH376_CONTEXT
 *
cÚ‹xt
, 
CH376_LOCK
 
dœ_lock
, 
CH376_DIR
 
fib
, 
F©DœInfo
 *
dœ_šfo
, *
·‰”n
);

302 
sy¡em_fšish_examše_dœeùÜy
(
CH376_CONTEXT
 *
cÚ‹xt
, 
CH376_DIR
 
fib
);

305 
CH376_S32
 
sy¡em_g‘_fže_size
(
CH376_CONTEXT
 *
cÚ‹xt
, 
CH376_FILE
 
fže
);

309 #ià
defšed
(
__MORPHOS__
è|| defšed (
__AMIGA__
è|| defšed (
__AROS__
)

313 #ifdeà
DEBUG_CH376


314 
	~<þib/debug_´Ùos.h
>

315 
	#dbg_´štf
 
k´štf


	)

317 
	#dbg_´štf
(...)

	)

320 * 
	$sy¡em_®loc_mem
(
size
)

322  
	`AÎocVec
(
size
, 
MEMF_ANY
);

323 
	}
}

325 
	$sy¡em_ä“_mem
(*
±r
)

327 
	`F»eVec
(
±r
);

328 
	}
}

330 
CH376_BOOL
 
	$sy¡em_š™_cÚ‹xt
(
CH376_CONTEXT
 *
cÚ‹xt
, 
UNUSED
 *
u£r_d©a
)

332 
cÚ‹xt
->
DOSBa£
 = 
	`O³nLib¿ry
(
DOSNAME
, 0L);

333  (
cÚ‹xt
->
DOSBa£
 !ð
NULL
);

334 
	}
}

336 
	$sy¡em_þ—n_cÚ‹xt
(
CH376_CONTEXT
 *
cÚ‹xt
)

338 if(
cÚ‹xt
->
DOSBa£
 !ð
NULL
)

339 
	`Clo£Lib¿ry
(
cÚ‹xt
->
DOSBa£
);

340 
	}
}

342 
CH376_BOOL
 
	$sy¡em_g‘_disk_šfo
(
CH376_CONTEXT
 *
cÚ‹xt
, 
CH376_LOCK
 
roÙ_lock
, 
DiskQu”y
 *
disk_šfo
)

344 
Lib¿ry
 *
DOSBa£
 = 
cÚ‹xt
->DOSBase;

345 
BOOL
 
gÙ_šfo
 = 
CH376_FALSE
;

347 if(
disk_šfo
)

349 
InfoD©a
 *
šfo
 = 
	`sy¡em_®loc_mem
((InfoData));

351 if(
šfo
)

353 if(
	`Info
(
roÙ_lock
, 
šfo
è=ð
DOSTRUE
)

355 
QUAD
 
tÙ®_£ùÜ
 = (
šfo
->
id_NumBlocks
 * info->
id_By‹sP”Block
) / 512;

356 
QUAD
 
ä“_£ùÜ
 = ((
šfo
->
id_NumBlocks
 - info->
id_NumBlocksU£d
è* info->
id_By‹sP”Block
) / 512;

358 
disk_šfo
->
DISK_TÙ®SeùÜ
[0] = (
tÙ®_£ùÜ
 & 0x000000ff) >> 0;

359 
disk_šfo
->
DISK_TÙ®SeùÜ
[1] = (
tÙ®_£ùÜ
 & 0x0000ff00) >> 8;

360 
disk_šfo
->
DISK_TÙ®SeùÜ
[2] = (
tÙ®_£ùÜ
 & 0x00ff0000) >> 16;

361 
disk_šfo
->
DISK_TÙ®SeùÜ
[3] = (
tÙ®_£ùÜ
 & 0xff000000) >> 24;

363 
disk_šfo
->
DISK_F»eSeùÜ
[0] = (
ä“_£ùÜ
 & 0x000000ff) >> 0;

364 
disk_šfo
->
DISK_F»eSeùÜ
[1] = (
ä“_£ùÜ
 & 0x0000ff00) >> 8;

365 
disk_šfo
->
DISK_F»eSeùÜ
[2] = (
ä“_£ùÜ
 & 0x00ff0000) >> 16;

366 
disk_šfo
->
DISK_F»eSeùÜ
[3] = (
ä“_£ùÜ
 & 0xff000000) >> 24;

368 
disk_šfo
->
DISK_DiskF©
 = 0x0c;

370 
gÙ_šfo
 = 
TRUE
;

372 
	`sy¡em_ä“_mem
(
šfo
);

376  
gÙ_šfo
;

377 
	}
}

379 
CH376_LOCK
 
	$sy¡em_obš_dœeùÜy_lock
(
CH376_CONTEXT
 *
cÚ‹xt
, cÚ¡ *
dœ_·th
, 
CH376_LOCK
 
roÙ_lock
)

381 
Lib¿ry
 *
DOSBa£
 = 
cÚ‹xt
->DOSBase;

382 
BPTR
 
lock
;

383 
BPTR
 
Þd_lock
 = (BPTR)0;

385 
	`dbg_´štf
("sy¡em_obš_dœeùÜy_lock: %s\n", 
dœ_·th
);

387 if(
roÙ_lock
)

389 
Þd_lock
 = 
	`Cu¼’tDœ
(
roÙ_lock
);

392 
lock
 = 
	`Lock
(
dœ_·th
, 
SHARED_LOCK
);

394 if(
lock
 !ð(
BPTR
)0)

396 
FžeInfoBlock
 *
fib
 = 
	`AÎocDosObjeù
(
DOS_FIB
, 
NULL
);

398 if(
fib
)

400 if(
	`Examše
(
lock
, 
fib
è=ð
DOSFALSE
 || fib->
fib_DœEÁryTy³
 < 0)

402 
	`UnLock
(
lock
);

403 
lock
 = (
BPTR
)0;

405 
	`F»eDosObjeù
(
DOS_FIB
, 
fib
);

409 if(
Þd_lock
)

411 
	`Cu¼’tDœ
(
Þd_lock
);

414  
lock
;

415 
	}
}

417 
	$sy¡em_»Ëa£_dœeùÜy_lock
(
CH376_CONTEXT
 *
cÚ‹xt
, 
CH376_LOCK
 
dœ_lock
)

419 
Lib¿ry
 *
DOSBa£
 = 
cÚ‹xt
->DOSBase;

420 
	`UnLock
(
dœ_lock
);

421 
	}
}

423 
CH376_LOCK
 
	$sy¡em_þÚe_dœeùÜy_lock
(
CH376_CONTEXT
 *
cÚ‹xt
, 
CH376_LOCK
 
dœ_lock
)

425 
Lib¿ry
 *
DOSBa£
 = 
cÚ‹xt
->DOSBase;

426  
	`DupLock
(
dœ_lock
);

427 
	}
}

429 
CH376_LOCK
 
	$sy¡em_ü—‹_dœeùÜy
(
CH376_CONTEXT
 *
cÚ‹xt
, cÚ¡ *
dœ_·th
, 
CH376_LOCK
 
roÙ_lock
)

431 
Lib¿ry
 *
DOSBa£
 = 
cÚ‹xt
->DOSBase;

432 
BPTR
 
lock
;

433 
BPTR
 
Þd_lock
 = (BPTR)0;

435 
	`dbg_´štf
("sy¡em_ü—‹_dœeùÜy: %s\n", 
dœ_·th
);

437 if(
roÙ_lock
)

439 
Þd_lock
 = 
	`Cu¼’tDœ
(
roÙ_lock
);

442 
lock
 = 
	`C»©eDœ
(
dœ_·th
);

444 if(
Þd_lock
)

446 
	`Cu¼’tDœ
(
Þd_lock
);

449  
lock
;

450 
	}
}

452 
BPTR
 
	$fže_Ý’
(
CH376_CONTEXT
 *
cÚ‹xt
, 
CONST_STRPTR
 
fže_Çme
, 
BPTR
 
roÙ_lock
, 
LONG
 
mode
)

454 
Lib¿ry
 *
DOSBa£
 = 
cÚ‹xt
->DOSBase;

455 
BPTR
 
Þd_lock
 = (BPTR)0;

456 
BPTR
 
fže
;

458 if(
roÙ_lock
)

460 
Þd_lock
 = 
	`Cu¼’tDœ
(
roÙ_lock
);

463 
fže
 = 
	`O³n
(
fže_Çme
, 
mode
);

465 if(
Þd_lock
)

467 
	`Cu¼’tDœ
(
Þd_lock
);

470  
fže
;

471 
	}
}

473 
CH376_FILE
 
	$sy¡em_fže_Ý’_exi¡šg
(
CH376_CONTEXT
 *
cÚ‹xt
, cÚ¡ *
fže_Çme
, 
CH376_LOCK
 
roÙ_lock
)

475  
	`fže_Ý’
(
cÚ‹xt
, 
fže_Çme
, 
roÙ_lock
, 
MODE_OLDFILE
);

476 
	}
}

478 
CH376_FILE
 
	$sy¡em_fže_Ý’_Ãw
(
CH376_CONTEXT
 *
cÚ‹xt
, cÚ¡ *
fže_Çme
, 
CH376_LOCK
 
roÙ_lock
)

480  
	`fže_Ý’
(
cÚ‹xt
, 
fže_Çme
, 
roÙ_lock
, 
MODE_NEWFILE
);

481 
	}
}

483 
	$sy¡em_fže_þo£
(
CH376_CONTEXT
 *
cÚ‹xt
, 
CH376_FILE
 
fže
)

485 
Lib¿ry
 *
DOSBa£
 = 
cÚ‹xt
->DOSBase;

486 
	`Clo£
(
fže
);

487 
	}
}

489 
CH376_S32
 
	$sy¡em_fže_£ek
(
CH376_CONTEXT
 *
cÚ‹xt
, 
CH376_FILE
 
fže
, 
pos
)

491 
Lib¿ry
 *
DOSBa£
 = 
cÚ‹xt
->DOSBase;

493 
	`dbg_´štf
("sy¡em_fže_£ekryšgØ£ekØpos™iÚ %d\n", 
pos
);

495 if(
fže
)

496  
	`S“k
(
fže
, 
pos
, 
OFFSET_BEGINNING
);

499 
	}
}

501 
CH376_S32
 
	$sy¡em_fže_»ad
(
CH376_CONTEXT
 *
cÚ‹xt
, 
CH376_FILE
 
fže
, *
bufãr
, 
CH376_S32
 
size
)

503 
Lib¿ry
 *
DOSBa£
 = 
cÚ‹xt
->DOSBase;

505 
	`dbg_´štf
("sy¡em_fže_»adryšgØ»ad %d by‹s\n", 
size
);

507 if(
fže
)

508  
	`R—d
(
fže
, 
bufãr
, 
size
);

511 
	}
}

513 
CH376_S32
 
	$sy¡em_fže_wr™e
(
CH376_CONTEXT
 *
cÚ‹xt
, 
CH376_FILE
 
fže
, *
bufãr
, 
CH376_S32
 
size
)

515 
Lib¿ry
 *
DOSBa£
 = 
cÚ‹xt
->DOSBase;

517 
	`dbg_´štf
("sy¡em_fže_wr™ŒyšgØwr™%d by‹s\n", 
size
);

519 if(
fže
)

520  
	`Wr™e
(
fže
, 
bufãr
, 
size
);

523 
	}
}

525 
CH376_BOOL
 
	$sy¡em_fže_d–‘e
(
CH376_CONTEXT
 *
cÚ‹xt
, cÚ¡ *
fže_Çme
, 
CH376_LOCK
 
roÙ_lock
)

527 
Lib¿ry
 *
DOSBa£
 = 
cÚ‹xt
->DOSBase;

528 
BPTR
 
Þd_lock
 = (BPTR)0;

529 
LONG
 
”r
;

531 if(
roÙ_lock
)

533 
Þd_lock
 = 
	`Cu¼’tDœ
(
roÙ_lock
);

536 
”r
 = 
	`D–‘eFže
(
fže_Çme
);

538 if(
Þd_lock
)

540 
	`Cu¼’tDœ
(
Þd_lock
);

543  (
”r
 != 0);

544 
	}
}

546 
CH376_BOOL
 
	$sy¡em_dœeùÜy_d–‘e
(
CH376_CONTEXT
 *
cÚ‹xt
, 
CH376_LOCK
 
roÙ_lock
)

549 
Lib¿ry
 *
DOSBa£
 = 
cÚ‹xt
->DOSBase;

551 
	`dbg_´štf
("sy¡em_dœeùÜy_d–‘e: %s\n", 
roÙ_lock
);

553 if(
roÙ_lock
)

554  (
	`D–‘eFže
(
roÙ_lock
) != 0);

556  
CH376_FALSE
;

557 
	}
}

559 
CH376_DIR
 
	$sy¡em_¡¬t_examše_dœeùÜy
(
CH376_CONTEXT
 *
cÚ‹xt
, 
CH376_LOCK
 
dœ_lock
)

561 
Lib¿ry
 *
DOSBa£
 = 
cÚ‹xt
->DOSBase;

562 
FžeInfoBlock
 *
fib
 = 
	`AÎocDosObjeù
(
DOS_FIB
, 
NULL
);

564 if(
fib
)

566 if(
	`Examše
(
dœ_lock
, 
fib
è=ð
DOSFALSE
)

568 
	`F»eDosObjeù
(
DOS_FIB
, 
fib
);

569 
fib
 = 
NULL
;

573  
fib
;

574 
	}
}

576 
CH376_BOOL
 
	$sy¡em_go_examše_dœeùÜy
(
CH376_CONTEXT
 *
cÚ‹xt
, 
CH376_LOCK
 
dœ_lock
, 
CH376_DIR
 
fib
, 
F©DœInfo
 *
dœ_šfo
, *
·‰”n
)

578 
Lib¿ry
 *
DOSBa£
 = 
cÚ‹xt
->DOSBase;

579 
BOOL
 
is_dÚe
 = 
FALSE
;

581 if(
fib
è!
is_dÚe
 && 
	`ExNext
(
dœ_lock
, fibè=ð
DOSTRUE
)

583 if(
	`nÜm®ize_fže_Çme
(
fib
->
fib_FžeName
, 
dœ_šfo
->
DIR_Name
è&& 
	`·‰”n_m©ch
(
·‰”n
, dir_info->DIR_Name))

585 
dœ_šfo
->
DIR_A‰r
 = 0;

587 if(
fib
->
fib_DœEÁryTy³
 > 0)

588 
dœ_šfo
->
DIR_A‰r
 |ð
DIR_ATTR_DIRECTORY
;

589 if((
fib
->
fib_PrÙeùiÚ
 & 
FIBF_WRITE
) != 0)

590 
dœ_šfo
->
DIR_A‰r
 |ð
DIR_ATTR_READ_ONLY
;

591 if((
fib
->
fib_PrÙeùiÚ
 & 
FIBF_ARCHIVE
) == 0)

592 
dœ_šfo
->
DIR_A‰r
 |ð
DIR_ATTR_ARCHIVE
;

598 
	`dbg_´štf
("sy¡em_go_examše_dœeùÜy defšed fž©Œibu‹s: %d\n", 
dœ_šfo
->
DIR_A‰r
);

600 
dœ_šfo
->
DIR_NTRes
 = 0;

601 
dœ_šfo
->
DIR_C¹TimeT’th
 = 0;

602 
dœ_šfo
->
DIR_C¹Time
[0] = 0;

603 
dœ_šfo
->
DIR_C¹Time
[1] = 0;

604 
dœ_šfo
->
DIR_C¹D©e
[0] = 0;

605 
dœ_šfo
->
DIR_C¹D©e
[1] = 0;

606 
dœ_šfo
->
DIR_L¡AccD©e
[0] = 0;

607 
dœ_šfo
->
DIR_L¡AccD©e
[1] = 0;

608 
dœ_šfo
->
DIR_F¡ClusHI
[0] = 0;

609 
dœ_šfo
->
DIR_F¡ClusHI
[1] = 0;

610 
dœ_šfo
->
DIR_W¹Time
[0] = 0;

611 
dœ_šfo
->
DIR_W¹Time
[1] = 0;

612 
dœ_šfo
->
DIR_W¹D©e
[0] = 0;

613 
dœ_šfo
->
DIR_W¹D©e
[1] = 0;

614 
dœ_šfo
->
DIR_F¡ClusLO
[0] = 0;

615 
dœ_šfo
->
DIR_F¡ClusLO
[1] = 0;

616 
dœ_šfo
->
DIR_FžeSize
[0] = (
fib
->
fib_Size
 & 0x000000ff) >> 0;

617 
dœ_šfo
->
DIR_FžeSize
[1] = (
fib
->
fib_Size
 & 0x0000ff00) >> 8;

618 
dœ_šfo
->
DIR_FžeSize
[2] = (
fib
->
fib_Size
 & 0x00ff0000) >> 16;

619 
dœ_šfo
->
DIR_FžeSize
[3] = (
fib
->
fib_Size
 & 0xff000000) >> 24;

621 
is_dÚe
 = 
TRUE
;

625  
is_dÚe
;

626 
	}
}

628 
	$sy¡em_fšish_examše_dœeùÜy
(
CH376_CONTEXT
 *
cÚ‹xt
, 
CH376_DIR
 
fib
)

630 
Lib¿ry
 *
DOSBa£
 = 
cÚ‹xt
->DOSBase;

632 if(
fib
)

634 
	`F»eDosObjeù
(
DOS_FIB
, 
fib
);

636 
	}
}

638 
CH376_S32
 
	$sy¡em_g‘_fže_size
(
CH376_CONTEXT
 *
cÚ‹xt
, 
CH376_FILE
 
fže
)

640 
Lib¿ry
 *
DOSBa£
 = 
cÚ‹xt
->DOSBase;

641 
FžeInfoBlock
 *
fib
 = 
	`AÎocDosObjeù
(
DOS_FIB
, 
NULL
);

642 
CH376_S32
 
fže_size
 = 0xffffffff;

644 ià(
fib
)

646 ià(
fže
)

648 iàÐ
	`ExamšeFH
(
fže
, &
fib
) )

650 
fže_size
 = 
fib
->
fib_Size
;

654 
	`dbg_´štf
("system_get_file_size:ƒrror\n");

659 
	`dbg_´štf
("system_get_file_size:‚o file handle\n");

662 
	`F»eDosObjeù
(
DOS_FIB
, 
fib
);

665  
fže_size
;

666 
	}
}

670 #–ià
defšed
(
WIN32
)

674 #ifdeà
DEBUG_CH376


675 
	$dbg_´štf
(
LPCTSTR
 
¡r
, ...)

677 
TCHAR
 
bufãr
[256];

679 
va_li¡
 
¬gs
;

680 
	`va_¡¬t
(
¬gs
, 
¡r
);

681 
	`_v¢´štf_s
(
bufãr
, (bufãrè- 1, (bufãrè- 1, 
¡r
, 
¬gs
);

682 
	`OuutDebugSŒšg
(
bufãr
);

683 
	`va_’d
(
¬gs
);

684 
	}
}

686 
	#dbg_´štf
(...)

	)

689 * 
	$sy¡em_®loc_mem
(
size
)

691  
	`Glob®AÎoc
(
GMEM_FIXED
, 
size
);

692 
	}
}

694 
	$sy¡em_ä“_mem
(*
±r
)

696 
	`Glob®F»e
(
±r
);

697 
	}
}

699 
CH376_BOOL
 
	$sy¡em_š™_cÚ‹xt
(
CH376_CONTEXT
 *
cÚ‹xt
, 
UNUSED
 *
u£r_d©a
)

702  
CH376_TRUE
;

703 
	}
};

705 
	$sy¡em_þ—n_cÚ‹xt
(
CH376_CONTEXT
 *
cÚ‹xt
)

708 
	}
}

710 
CH376_BOOL
 
	$sy¡em_g‘_disk_šfo
(
CH376_CONTEXT
 *
cÚ‹xt
, 
CH376_LOCK
 
roÙ_lock
, 
DiskQu”y
 *
disk_šfo
)

712 
BOOL
 
gÙ_šfo
 = 
FALSE
;

713 
vÞume
[4];

714 
DWORD
 
£ùÜs_³r_þu¡”
;

715 
DWORD
 
by‹s_³r_£ùÜ
;

716 
DWORD
 
numb”_of_ä“_þu¡”s
;

717 
DWORD
 
tÙ®_numb”_of_þu¡”s
;

720 
vÞume
[0] = ((*)
roÙ_lock
->
·th
)[0] & 0xdf;

721 
vÞume
[1] = ':';

722 
vÞume
[2] = '\\';

723 
vÞume
[3] = '\0';

725 if(
	`G‘DiskF»eS·û
(
vÞume
, &
£ùÜs_³r_þu¡”
, &
by‹s_³r_£ùÜ
, &
numb”_of_ä“_þu¡”s
, &
tÙ®_numb”_of_þu¡”s
))

727 
INT64
 
tÙ®_£ùÜ
 = (
tÙ®_numb”_of_þu¡”s
 * 
£ùÜs_³r_þu¡”
 * 
by‹s_³r_£ùÜ
) / 512;

728 
INT64
 
ä“_£ùÜ
 = (
numb”_of_ä“_þu¡”s
 * 
£ùÜs_³r_þu¡”
 * 
by‹s_³r_£ùÜ
) / 512;

730 
disk_šfo
->
DISK_TÙ®SeùÜ
[0] = (
INT8
)((
tÙ®_£ùÜ
 & 0x000000ff) >> 0);

731 
disk_šfo
->
DISK_TÙ®SeùÜ
[1] = (
INT8
)((
tÙ®_£ùÜ
 & 0x0000ff00) >> 8);

732 
disk_šfo
->
DISK_TÙ®SeùÜ
[2] = (
INT8
)((
tÙ®_£ùÜ
 & 0x00ff0000) >> 16);

733 
disk_šfo
->
DISK_TÙ®SeùÜ
[3] = (
INT8
)((
tÙ®_£ùÜ
 & 0xff000000) >> 24);

735 
disk_šfo
->
DISK_F»eSeùÜ
[0] = (
INT8
)((
ä“_£ùÜ
 & 0x000000ff) >> 0);

736 
disk_šfo
->
DISK_F»eSeùÜ
[1] = (
INT8
)((
ä“_£ùÜ
 & 0x0000ff00) >> 8);

737 
disk_šfo
->
DISK_F»eSeùÜ
[2] = (
INT8
)((
ä“_£ùÜ
 & 0x00ff0000) >> 16);

738 
disk_šfo
->
DISK_F»eSeùÜ
[3] = (
INT8
)((
ä“_£ùÜ
 & 0xff000000) >> 24);

740 
disk_šfo
->
DISK_DiskF©
 = 0x0c;

742 
gÙ_šfo
 = 
TRUE
;

744  
gÙ_šfo
;

745 
	}
}

747 
CH376_LOCK
 
	$sy¡em_obš_dœeùÜy_lock
(
CH376_CONTEXT
 *
cÚ‹xt
, cÚ¡ *
dœ_·th
, 
CH376_LOCK
 
roÙ_lock
)

749 
CH376_LOCK
 
lock
 = 
NULL
;

750 
TCHAR
 
Þd_dœ
[
MAX_PATH
];

751 
¡©
 
s
;

753 if(
roÙ_lock
)

755 
	`G‘Cu¼’tDœeùÜy
((
Þd_dœ
), old_dir);

756 
	`S‘Cu¼’tDœeùÜy
(
roÙ_lock
->
·th
);

760 if(
	`¡©
(
dœ_·th
,&
s
è=ð0 && s.
¡_mode
 & 
S_IFDIR
)

762 
lock
 = (
CH376_LOCK
)
	`sy¡em_®loc_mem
((
_CH376_LOCK
 ));

763 
	`G‘FuÎP©hName
(
dœ_·th
, 
MAX_PATH
, 
lock
->
·th
, 
NULL
);

764 
lock
->
hªdË
 = 
INVALID_HANDLE_VALUE
;

767 if(
roÙ_lock
)

769 
	`S‘Cu¼’tDœeùÜy
(
Þd_dœ
);

772  
lock
;

773 
	}
}

775 
	$sy¡em_»Ëa£_dœeùÜy_lock
(
CH376_CONTEXT
 *
cÚ‹xt
, 
CH376_LOCK
 
dœ_lock
)

777 if(
dœ_lock
 !ð(
CH376_LOCK
)0)

779 
	`sy¡em_ä“_mem
(
dœ_lock
);

781 
	}
}

783 
CH376_LOCK
 
	$sy¡em_þÚe_dœeùÜy_lock
(
CH376_CONTEXT
 *
cÚ‹xt
, 
CH376_LOCK
 
dœ_lock
)

785 
CH376_LOCK
 
dup_lock
 = (CH376_LOCK)
	`sy¡em_®loc_mem
((
_CH376_LOCK
));

787 
	`CÝyMemÜy
(
dup_lock
, 
dœ_lock
, (
_CH376_LOCK
));

789  
dup_lock
;

790 
	}
}

792 
HANDLE
 
	$fže_Ý’
(
CH376_CONTEXT
 *
cÚ‹xt
, cÚ¡ *
fže_Çme
, 
PCHAR
 
roÙ_·th
, 
DWORD
 
ü—tiÚ_di¥os™iÚ
)

794 
TCHAR
 
Þd_dœ
[
MAX_PATH
];

795 
HANDLE
 
fže
;

797 if(
roÙ_·th
)

799 
	`G‘Cu¼’tDœeùÜy
((
Þd_dœ
), old_dir);

800 
	`S‘Cu¼’tDœeùÜy
(
roÙ_·th
);

803 
fže
 = 
	`C»©eFže
(
fže_Çme
, 
GENERIC_READ
 | 
GENERIC_WRITE
, 0, 
NULL
, 
ü—tiÚ_di¥os™iÚ
, 
FILE_ATTRIBUTE_NORMAL
, NULL);

805 if(
roÙ_·th
)

807 
	`S‘Cu¼’tDœeùÜy
(
Þd_dœ
);

810 if(
fže
 !ð
INVALID_HANDLE_VALUE
)

811  
fže
;

813  
NULL
;

814 
	}
}

816 
CH376_BOOL
 
	$sy¡em_fže_d–‘e
(
CH376_CONTEXT
 *
cÚ‹xt
, cÚ¡ *
fže_Çme
, 
CH376_LOCK
 
roÙ_lock
)

818 
LONG
 
”r
;

819 
TCHAR
 
Þd_dœ
[
MAX_PATH
];

821 ià(
roÙ_lock
)

823 
	`G‘Cu¼’tDœeùÜy
((
Þd_dœ
), old_dir);

824 
	`S‘Cu¼’tDœeùÜy
(
roÙ_lock
->
·th
);

827 
	`dbg_´štf
("sy¡em_fže_d–‘e: %s\n", 
fže_Çme
);

829 
”r
 = 
	`D–‘eFže
(
fže_Çme
);

831 ià(
roÙ_lock
)

833 
	`S‘Cu¼’tDœeùÜy
(
Þd_dœ
);

837  (
”r
 != 0);

838 
	}
}

840 
CH376_BOOL
 
	$sy¡em_dœeùÜy_d–‘e
(
CH376_CONTEXT
 *
cÚ‹xt
, 
CH376_LOCK
 
roÙ_lock
)

842 
	`dbg_´štf
("sy¡em_dœeùÜy_d–‘e: %s\n", 
roÙ_lock
);

844 ià(
roÙ_lock
)

845  (
	`RemoveDœeùÜy
((
LPCSTR
)
roÙ_lock
) != 0);

847  
CH376_FALSE
;

848 
	}
}

850 
CH376_LOCK
 
	$sy¡em_ü—‹_dœeùÜy
(
CH376_CONTEXT
 *
cÚ‹xt
, cÚ¡ *
dœ_·th
, 
CH376_LOCK
 
roÙ_lock
)

852 
TCHAR
 
Þd_dœ
[
MAX_PATH
];

853 
CH376_LOCK
 
lock
 = 
NULL
;

855 ià(
roÙ_lock
)

857 
	`G‘Cu¼’tDœeùÜy
((
Þd_dœ
), old_dir);

858 
	`S‘Cu¼’tDœeùÜy
(
roÙ_lock
->
·th
);

861 
	`dbg_´štf
("sy¡em_ü—‹_dœeùÜy: %s\n", 
dœ_·th
);

863 ià(
	`C»©eDœeùÜy
(
dœ_·th
, 
NULL
))

865 
lock
 = (
CH376_LOCK
)
	`sy¡em_®loc_mem
((
_CH376_LOCK
 ));

866 
	`S‘Cu¼’tDœeùÜy
(
dœ_·th
);

867 
	`G‘Cu¼’tDœeùÜy
((
lock
->
·th
),†ock->path);

868 
lock
->
hªdË
 = 
INVALID_HANDLE_VALUE
;

871 ià(
roÙ_lock
)

873 
	`S‘Cu¼’tDœeùÜy
(
Þd_dœ
);

876  
lock
;

878 
	}
}

882 
CH376_FILE
 
	$sy¡em_fže_Ý’_exi¡šg
(
CH376_CONTEXT
 *
cÚ‹xt
, cÚ¡ *
fže_Çme
, 
CH376_LOCK
 
roÙ_lock
)

884  
	`fže_Ý’
(
cÚ‹xt
, 
fže_Çme
, 
roÙ_lock
->
·th
, 
OPEN_EXISTING
);

885 
	}
}

887 
CH376_FILE
 
	$sy¡em_fže_Ý’_Ãw
(
CH376_CONTEXT
 *
cÚ‹xt
, cÚ¡ *
fže_Çme
, 
CH376_LOCK
 
roÙ_lock
)

889  
	`fže_Ý’
(
cÚ‹xt
, 
fže_Çme
, 
roÙ_lock
->
·th
, 
CREATE_ALWAYS
);

890 
	}
}

892 
	$sy¡em_fže_þo£
(
CH376_CONTEXT
 *
cÚ‹xt
, 
CH376_FILE
 
fže
)

894 if(
fže
è
	`Clo£HªdË
(file);

895 
	}
}

897 
CH376_S32
 
	$sy¡em_fže_£ek
(
CH376_CONTEXT
 *
cÚ‹xt
, 
CH376_FILE
 
fže
, 
pos
)

899 if(
fže
 !ð
NULL
)

900  
	`S‘FžePoš‹r
(
fže
, 
pos
, 
NULL
, 
FILE_BEGIN
);

903 
	}
}

905 
CH376_S32
 
	$sy¡em_fže_»ad
(
CH376_CONTEXT
 *
cÚ‹xt
, 
CH376_FILE
 
fže
, *
bufãr
, 
CH376_S32
 
size
)

907 
DWORD
 
»ad_by‹s
;

909 if(
	`R—dFže
(
fže
, 
bufãr
, 
size
, &
»ad_by‹s
, 
NULL
))

910  
»ad_by‹s
;

913 
	}
}

915 
CH376_S32
 
	$sy¡em_fže_wr™e
(
CH376_CONTEXT
 *
cÚ‹xt
, 
CH376_FILE
 
fže
, *
bufãr
, 
CH376_S32
 
size
)

917 
DWORD
 
wr™‹n_by‹s
;

919 if(
	`Wr™eFže
(
fže
, 
bufãr
, 
size
, &
wr™‹n_by‹s
, 
NULL
))

920  
wr™‹n_by‹s
;

923 
	}
}

925 
CH376_DIR
 
	$sy¡em_¡¬t_examše_dœeùÜy
(
CH376_CONTEXT
 *
cÚ‹xt
, 
CH376_LOCK
 
dœ_lock
)

927 
LPWIN32_FIND_DATA
 
fšd_fže_d©a
 = (LPWIN32_FIND_DATA)
	`sy¡em_®loc_mem
((
WIN32_FIND_DATA
));

928 
TCHAR
 
szDœ
[
MAX_PATH
];

929 
	`SŒšgCchCÝy
(
szDœ
, 
MAX_PATH
, 
dœ_lock
->
·th
);

930 
	`SŒšgCchC©
(
szDœ
, 
MAX_PATH
, 
	`TEXT
("\\*"));

932 
dœ_lock
->
hªdË
 = 
	`FšdFœ¡Fže
(
szDœ
, 
fšd_fže_d©a
);

934 if(
dœ_lock
->
hªdË
 =ð
INVALID_HANDLE_VALUE
)

936 
	`sy¡em_ä“_mem
(
fšd_fže_d©a
);

937 
fšd_fže_d©a
 = 
NULL
;

940  
fšd_fže_d©a
;

941 
	}
}

943 
CH376_BOOL
 
	$sy¡em_go_examše_dœeùÜy
(
CH376_CONTEXT
 *
cÚ‹xt
, 
CH376_LOCK
 
dœ_lock
, 
CH376_DIR
 
fib
, 
F©DœInfo
 *
dœ_šfo
, *
·‰”n
)

945 
BOOL
 
is_dÚe
 = 
FALSE
;

947 if(
dœ_lock
->
hªdË
 !ð
INVALID_HANDLE_VALUE
)

949 !
is_dÚe
 && 
	`FšdNextFže
(
dœ_lock
->
hªdË
, 
fib
))

951 if(
	`nÜm®ize_fže_Çme
(
fib
->
cFžeName
, 
dœ_šfo
->
DIR_Name
è&& 
	`·‰”n_m©ch
(
·‰”n
, dir_info->DIR_Name))

954 
dœ_šfo
->
DIR_A‰r
 = (
UINT8
)
fib
->
dwFžeA‰ribu‹s
;

956 
	`dbg_´štf
("sy¡em_go_examše_dœeùÜy defšed fž©Œibu‹s: %d\n", 
dœ_šfo
->
DIR_A‰r
);

958 
dœ_šfo
->
DIR_NTRes
 = 0;

959 
dœ_šfo
->
DIR_C¹TimeT’th
 = 0;

960 
dœ_šfo
->
DIR_C¹Time
[0] = 0;

961 
dœ_šfo
->
DIR_C¹Time
[1] = 0;

962 
dœ_šfo
->
DIR_C¹D©e
[0] = 0;

963 
dœ_šfo
->
DIR_C¹D©e
[1] = 0;

964 
dœ_šfo
->
DIR_L¡AccD©e
[0] = 0;

965 
dœ_šfo
->
DIR_L¡AccD©e
[1] = 0;

966 
dœ_šfo
->
DIR_F¡ClusHI
[0] = 0;

967 
dœ_šfo
->
DIR_F¡ClusHI
[1] = 0;

968 
dœ_šfo
->
DIR_W¹Time
[0] = 0;

969 
dœ_šfo
->
DIR_W¹Time
[1] = 0;

970 
dœ_šfo
->
DIR_W¹D©e
[0] = 0;

971 
dœ_šfo
->
DIR_W¹D©e
[1] = 0;

972 
dœ_šfo
->
DIR_F¡ClusLO
[0] = 0;

973 
dœ_šfo
->
DIR_F¡ClusLO
[1] = 0;

974 
dœ_šfo
->
DIR_FžeSize
[0] = (
UINT8
)((
fib
->
nFžeSizeLow
 & 0x000000ff) >> 0);

975 
dœ_šfo
->
DIR_FžeSize
[1] = (
UINT8
)((
fib
->
nFžeSizeLow
 & 0x0000ff00) >> 8);

976 
dœ_šfo
->
DIR_FžeSize
[2] = (
UINT8
)((
fib
->
nFžeSizeLow
 & 0x00ff0000) >> 16);

977 
dœ_šfo
->
DIR_FžeSize
[3] = (
UINT8
)((
fib
->
nFžeSizeLow
 & 0xff000000) >> 24);

979 
is_dÚe
 = 
TRUE
;

984  
is_dÚe
;

985 
	}
}

987 
	$sy¡em_fšish_examše_dœeùÜy
(
CH376_CONTEXT
 *
cÚ‹xt
, 
CH376_DIR
 
fib
)

989 if(
fib
)

991 
	`FšdClo£
(
fib
);

992 
	`sy¡em_ä“_mem
(
fib
);

994 
	}
}

996 
CH376_S32
 
	$sy¡em_g‘_fže_size
(
CH376_CONTEXT
 *
cÚ‹xt
, 
CH376_FILE
 
fže
)

998 
CH376_S32
 
fže_size
 = 0xffffffff;

999 
BY_HANDLE_FILE_INFORMATION
 
fže_¡©
;

1001 ià(
fže
)

1003 iàÐ
	`G‘FžeInfÜm©iÚByHªdË
(
fže
, &
fže_¡©
) )

1006 
fže_size
 = 
fže_¡©
.
nFžeSizeLow
;

1010 
	`dbg_´štf
("system_get_file_size:ƒrror\n");

1014 
	`dbg_´štf
("system_get_file_size:‚o file handle\n");

1016  
fže_size
;

1017 
	}
}

1021 #–ià
defšed
(
__unix__
è|| defšed(
__APPLE__
è|| defšed(
__HAIKU__
)

1025 #ifdeà
DEBUG_CH376


1026 
	#dbg_´štf
(...è
	`årštf
(
¡d”r
, 
__VA_ARGS__
)

	)

1028 
	#dbg_´štf
(...)

	)

1031 * 
	$sy¡em_®loc_mem
(
size
)

1033  
	`m®loc
(
size
);

1034 
	}
}

1036 
	$sy¡em_ä“_mem
(*
±r
)

1038 ià(
±r
)

1039 
	`ä“
(
±r
);

1040 
	}
}

1042 
CH376_BOOL
 
	$sy¡em_š™_cÚ‹xt
(
CH376_CONTEXT
 *
cÚ‹xt
, 
UNUSED
 *
u£r_d©a
)

1045  
CH376_TRUE
;

1046 
	}
}

1048 
	$sy¡em_þ—n_cÚ‹xt
(
CH376_CONTEXT
 *
cÚ‹xt
)

1051 
	}
}

1053 
CH376_BOOL
 
	$sy¡em_g‘_disk_šfo
(
CH376_CONTEXT
 *
cÚ‹xt
, 
CH376_LOCK
 
roÙ_lock
, 
DiskQu”y
 *
disk_šfo
)

1055 
CH376_BOOL
 
gÙ_šfo
 = 
CH376_FALSE
;

1057 if(
disk_šfo
)

1059 
¡©vfs
 
¡©s
;

1061 if(
	`¡©vfs
(
roÙ_lock
, &
¡©s
) == 0)

1063 
št64_t
 
tÙ®_£ùÜ
 = (
¡©s
.
f_blocks
 * sts.
f_bsize
) / 512;

1064 
št64_t
 
ä“_£ùÜ
 = (
¡©s
.
f_bä“
 * sts.
f_bsize
) / 512;

1066 
disk_šfo
->
DISK_TÙ®SeùÜ
[0] = (
tÙ®_£ùÜ
 & 0x000000ff) >> 0;

1067 
disk_šfo
->
DISK_TÙ®SeùÜ
[1] = (
tÙ®_£ùÜ
 & 0x0000ff00) >> 8;

1068 
disk_šfo
->
DISK_TÙ®SeùÜ
[2] = (
tÙ®_£ùÜ
 & 0x00ff0000) >> 16;

1069 
disk_šfo
->
DISK_TÙ®SeùÜ
[3] = (
tÙ®_£ùÜ
 & 0xff000000) >> 24;

1071 
disk_šfo
->
DISK_F»eSeùÜ
[0] = (
ä“_£ùÜ
 & 0x000000ff) >> 0;

1072 
disk_šfo
->
DISK_F»eSeùÜ
[1] = (
ä“_£ùÜ
 & 0x0000ff00) >> 8;

1073 
disk_šfo
->
DISK_F»eSeùÜ
[2] = (
ä“_£ùÜ
 & 0x00ff0000) >> 16;

1074 
disk_šfo
->
DISK_F»eSeùÜ
[3] = (
ä“_£ùÜ
 & 0xff000000) >> 24;

1076 
disk_šfo
->
DISK_DiskF©
 = 0x0c;

1078 
gÙ_šfo
 = 
CH376_TRUE
;

1082  
gÙ_šfo
;

1083 
	}
}

1085 
CH376_LOCK
 
	$sy¡em_obš_dœeùÜy_lock
(
CH376_CONTEXT
 *
cÚ‹xt
, cÚ¡ *
dœ_·th
, 
CH376_LOCK
 
roÙ_lock
)

1087 
CH376_LOCK
 
lock
 = 
NULL
;

1088 *
Þd_dœ
 = 
NULL
;

1089 
¡©
 
·th_¡©
;

1091 
	`dbg_´štf
("sy¡em_obš_dœeùÜy_lock: %s\n", 
dœ_·th
);

1093 if(
roÙ_lock
)

1095 if((
Þd_dœ
 = 
	`g‘cwd
(
NULL
, 0)) != NULL)

1096 
	`chdœ
(
roÙ_lock
);

1099 
	`¡©
(
dœ_·th
, &
·th_¡©
);

1100 if(
	`S_ISDIR
(
·th_¡©
.
¡_mode
))

1102 
lock
 = 
	`»®·th
(
dœ_·th
, 
NULL
);

1105 if(
Þd_dœ
)

1107 if(
Þd_dœ
 !ð
NULL
)

1109 
	`chdœ
(
Þd_dœ
);

1110 
	`sy¡em_ä“_mem
(
Þd_dœ
);

1114  
lock
;

1115 
	}
}

1117 
	$sy¡em_»Ëa£_dœeùÜy_lock
(
CH376_CONTEXT
 *
cÚ‹xt
, 
CH376_LOCK
 
dœ_lock
)

1119 if(
dœ_lock
 !ð(
CH376_LOCK
)0)

1121 
	`sy¡em_ä“_mem
(
dœ_lock
);

1123 
	}
}

1125 
CH376_LOCK
 
	$sy¡em_þÚe_dœeùÜy_lock
(
CH376_CONTEXT
 *
cÚ‹xt
, 
CH376_LOCK
 
dœ_lock
)

1127  
	`¡rdup
(
dœ_lock
);

1128 
	}
}

1130 
FILE
 * 
	$fže_Ý’
(cÚ¡ *
fže_Çme
, 
CH376_LOCK
 
roÙ_lock
, cÚ¡ *
mode
)

1132 
FILE
 *
fže
;

1133 *
Þd_dœ
 = 
NULL
;

1137 if(
roÙ_lock
)

1139 if((
Þd_dœ
 = 
	`g‘cwd
(
NULL
, 0)) != NULL)

1140 
	`chdœ
(
roÙ_lock
);

1143 
fže
 = 
	`fÝ’
(
fže_Çme
, 
mode
);

1145 if(
Þd_dœ
)

1147 
	`chdœ
(
Þd_dœ
);

1148 
	`sy¡em_ä“_mem
(
Þd_dœ
);

1151  
fže
;

1152 
	}
}

1154 
CH376_BOOL
 
	$sy¡em_fže_d–‘e
(
CH376_CONTEXT
 *
cÚ‹xt
, cÚ¡ *
fže_Çme
, 
CH376_LOCK
 
roÙ_lock
)

1156 
”r
;

1157 *
Þd_dœ
 = 
NULL
;

1159 if(
roÙ_lock
)

1161 if((
Þd_dœ
 = 
	`g‘cwd
(
NULL
, 0)) != NULL)

1162 
	`chdœ
(
roÙ_lock
);

1165 
”r
 = 
	`»move
(
fže_Çme
);

1167 
	`dbg_´štf
("sy¡em_fže_d–‘e: %s\n", 
fže_Çme
);

1169 if(
Þd_dœ
)

1171 if(
Þd_dœ
 !ð
NULL
)

1173 
	`chdœ
(
Þd_dœ
);

1174 
	`sy¡em_ä“_mem
(
Þd_dœ
);

1178  (
”r
 == 0);

1179 
	}
}

1181 
CH376_BOOL
 
	$sy¡em_dœeùÜy_d–‘e
(
CH376_CONTEXT
 *
cÚ‹xt
, 
CH376_LOCK
 
roÙ_lock
)

1183 
	`dbg_´štf
("sy¡em_dœeùÜy_d–‘e: %s\n", 
roÙ_lock
);

1185 ià(
roÙ_lock
)

1186  (
	`rmdœ
(
roÙ_lock
) == 0);

1188  
CH376_FALSE
;

1189 
	}
}

1191 
CH376_LOCK
 
	$sy¡em_ü—‹_dœeùÜy
(
CH376_CONTEXT
 *
cÚ‹xt
, cÚ¡ *
dœ_·th
, 
CH376_LOCK
 
roÙ_lock
)

1193 
CH376_LOCK
 
lock
 = 
NULL
;

1194 *
Þd_dœ
 = 
NULL
;

1196 if(
roÙ_lock
)

1198 if((
Þd_dœ
 = 
	`g‘cwd
(
NULL
, 0)) != NULL)

1199 
	`chdœ
(
roÙ_lock
);

1202 
	`dbg_´štf
("sy¡em_ü—‹_dœeùÜy: %s\n", 
dœ_·th
);

1204 ià(!
	`mkdœ
(
dœ_·th
, 
S_IRWXU
 | 
S_IRWXG
 | 
S_IROTH
 | 
S_IXOTH
))

1205 
lock
 = 
	`»®·th
(
dœ_·th
, 
NULL
);

1207 if(
Þd_dœ
)

1209 
	`chdœ
(
Þd_dœ
);

1210 
	`sy¡em_ä“_mem
(
Þd_dœ
);

1213  
lock
;

1214 
	}
}

1216 
CH376_FILE
 
	$sy¡em_fže_Ý’_exi¡šg
(
CH376_CONTEXT
 *
cÚ‹xt
, cÚ¡ *
fže_Çme
, 
CH376_LOCK
 
roÙ_lock
)

1218 
FILE
 *
å
;

1220 
å
 = 
	`fže_Ý’
(
fže_Çme
, 
roÙ_lock
, "rb+");

1222  
å
;

1223 
	}
}

1225 
CH376_FILE
 
	$sy¡em_fže_Ý’_Ãw
(
CH376_CONTEXT
 *
cÚ‹xt
, cÚ¡ *
fže_Çme
, 
CH376_LOCK
 
roÙ_lock
)

1227  
	`fže_Ý’
(
fže_Çme
, 
roÙ_lock
, "wb+");

1228 
	}
}

1230 
	$sy¡em_fže_þo£
(
CH376_CONTEXT
 *
cÚ‹xt
, 
CH376_FILE
 
fže
)

1232 ià(
fže
è
	`fþo£
(file);

1233 
	}
}

1235 
CH376_S32
 
	$sy¡em_fže_£ek
(
CH376_CONTEXT
 *
cÚ‹xt
, 
CH376_FILE
 
fže
, 
pos
)

1237 
	`dbg_´štf
("sy¡em_fže_£ekryšgØ£ekØpos™iÚ %d\n", 
pos
);

1239 if(
fže
)

1240 ià(!
	`f£ek
(
fže
, 
pos
, 
SEEK_SET
))

1241  
	`á–l
(
fže
);

1244 
	}
}

1246 
CH376_S32
 
	$sy¡em_fže_»ad
(
CH376_CONTEXT
 *
cÚ‹xt
, 
CH376_FILE
 
fže
, *
bufãr
, 
CH376_S32
 
size
)

1248 
	`dbg_´štf
("sy¡em_fže_»adryšgØ»ad %d by‹s\n", 
size
);

1250 if(
fže
)

1251  
	`ä—d
(
bufãr
, 1, 
size
, 
fže
);

1254 
	}
}

1256 
CH376_S32
 
	$sy¡em_fže_wr™e
(
CH376_CONTEXT
 *
cÚ‹xt
, 
CH376_FILE
 
fže
, *
bufãr
, 
CH376_S32
 
size
)

1258 
	`dbg_´štf
("sy¡em_fže_wr™ŒyšgØwr™%d by‹s\n", 
size
);

1260 if(
fže
)

1261  
	`fwr™e
(
bufãr
, 1, 
size
, 
fže
);

1264 
	}
}

1266 
CH376_DIR
 
	$sy¡em_¡¬t_examše_dœeùÜy
(
CH376_CONTEXT
 *
cÚ‹xt
, 
CH376_LOCK
 
dœ_lock
)

1268 
CH376_DIR
 
fib
 = 
	`sy¡em_®loc_mem
((
_CH376_DIR
));

1270 if(
fib
)

1272 
fib
->
hªdË
 = 
	`Ý’dœ
(
dœ_lock
);

1273 
fib
->
’Œy
 = 
NULL
;

1276  
fib
;

1277 
	}
}

1279 
CH376_BOOL
 
	$sy¡em_go_examše_dœeùÜy
(
CH376_CONTEXT
 *
cÚ‹xt
, 
CH376_LOCK
 
dœ_lock
, 
CH376_DIR
 
fib
, 
F©DœInfo
 *
dœ_šfo
, *
·‰”n
)

1281 
CH376_BOOL
 
is_dÚe
 = 
CH376_FALSE
;

1282 
¡©
 
fže_¡©
;

1283 *
Þd_dœ
 = 
NULL
;

1285 if(
dœ_lock
)

1287 if((
Þd_dœ
 = 
	`g‘cwd
(
NULL
, 0)) != NULL)

1288 
	`chdœ
(
dœ_lock
);

1291 if(
fib
è!
is_dÚe
 && (fib->
’Œy
 = 
	`»addœ
(fib->
hªdË
)))

1293 if(
	`nÜm®ize_fže_Çme
(
fib
->
’Œy
->
d_Çme
, 
dœ_šfo
->
DIR_Name
è&& 
	`·‰”n_m©ch
(
·‰”n
, dir_info->DIR_Name))

1295 
	`¡©
(
fib
->
’Œy
->
d_Çme
, &
fže_¡©
);

1297 
dœ_šfo
->
DIR_A‰r
 = 0;

1299 if(
	`S_ISDIR
(
fže_¡©
.
¡_mode
))

1300 
dœ_šfo
->
DIR_A‰r
 |ð
DIR_ATTR_DIRECTORY
;

1301 if((
fže_¡©
.
¡_mode
 & 
S_IRUSR
) == 0)

1302 
dœ_šfo
->
DIR_A‰r
 |ð
DIR_ATTR_READ_ONLY
;

1304 
	`dbg_´štf
("sy¡em_go_examše_dœeùÜy defšed fž©Œibu‹s: %d\n", 
dœ_šfo
->
DIR_A‰r
);

1306 
dœ_šfo
->
DIR_NTRes
 = 0;

1307 
dœ_šfo
->
DIR_C¹TimeT’th
 = 0;

1308 
dœ_šfo
->
DIR_C¹Time
[0] = 0;

1309 
dœ_šfo
->
DIR_C¹Time
[1] = 0;

1310 
dœ_šfo
->
DIR_C¹D©e
[0] = 0;

1311 
dœ_šfo
->
DIR_C¹D©e
[1] = 0;

1312 
dœ_šfo
->
DIR_L¡AccD©e
[0] = 0;

1313 
dœ_šfo
->
DIR_L¡AccD©e
[1] = 0;

1314 
dœ_šfo
->
DIR_F¡ClusHI
[0] = 0;

1315 
dœ_šfo
->
DIR_F¡ClusHI
[1] = 0;

1316 
dœ_šfo
->
DIR_W¹Time
[0] = 0;

1317 
dœ_šfo
->
DIR_W¹Time
[1] = 0;

1318 
dœ_šfo
->
DIR_W¹D©e
[0] = 0;

1319 
dœ_šfo
->
DIR_W¹D©e
[1] = 0;

1320 
dœ_šfo
->
DIR_F¡ClusLO
[0] = 0;

1321 
dœ_šfo
->
DIR_F¡ClusLO
[1] = 0;

1322 
dœ_šfo
->
DIR_FžeSize
[0] = (
fže_¡©
.
¡_size
 & 0x000000ff) >> 0;

1323 
dœ_šfo
->
DIR_FžeSize
[1] = (
fže_¡©
.
¡_size
 & 0x0000ff00) >> 8;

1324 
dœ_šfo
->
DIR_FžeSize
[2] = (
fže_¡©
.
¡_size
 & 0x00ff0000) >> 16;

1325 
dœ_šfo
->
DIR_FžeSize
[3] = (
fže_¡©
.
¡_size
 & 0xff000000) >> 24;

1327 
is_dÚe
 = 
CH376_TRUE
;

1331 if(
Þd_dœ
)

1333 
	`chdœ
(
Þd_dœ
);

1334 
	`sy¡em_ä“_mem
(
Þd_dœ
);

1337  
is_dÚe
;

1338 
	}
}

1340 
	$sy¡em_fšish_examše_dœeùÜy
(
CH376_CONTEXT
 *
cÚ‹xt
, 
CH376_DIR
 
fib
)

1342 ià(
fib
)

1344 
	`þo£dœ
(
fib
->
hªdË
);

1345 
	`sy¡em_ä“_mem
(
fib
);

1347 
	}
}

1349 
CH376_S32
 
	$sy¡em_g‘_fže_size
(
CH376_CONTEXT
 *
cÚ‹xt
, 
CH376_FILE
 
fže
)

1351 
CH376_S32
 
fže_size
 = 0xffffffff;

1352 
¡©
 
fže_¡©
;

1354 ià(
fže
)

1356 iàÐ!
	`f¡©
(
	`fž’o
(
fže
), &
fže_¡©
) )

1358 
fže_size
 = 
fže_¡©
.
¡_size
;

1362 
	`dbg_´štf
("system_get_file_size:ƒrror\n");

1366 
	`dbg_´štf
("system_get_file_size:‚o file handle\n");

1368  
fže_size
;

1369 
	}
}

1379 *
	$þÚe_¡ršg
(cÚ¡ *
¡ršg
)

1381 
l
;

1382 *
s
;

1384 
l
=0; 
¡ršg
[l]!='\0';†++);

1386 
s
 = 
	`sy¡em_®loc_mem
(
l
);

1388 
l
=0; 
¡ršg
[l]!='\0';†++)

1389 
s
[
l
] = 
¡ršg
[l];

1391 
s
[
l
] = '\0';

1393  
s
;

1394 
	}
}

1396 
	$þ—r_¡ruùu»
(
ch376
 *ch376)

1398 
ch376
->
commªd
 = 
CH376_CMD_NONE
;

1399 
ch376
->
commªd_¡©us
 = 0;

1400 
ch376
->
š‹rçû_¡©us
 = 0;

1401 
ch376
->
nb_by‹s_š_cmd_d©a
 = 0;

1402 
ch376
->
pos_rw_š_cmd_d©a
 = 0;

1403 
ch376
->
usb_mode
 = 
CH376_ARG_SET_USB_MODE_INVALID
;

1404 
ch376
->
by‹s_to_»ad_wr™e
 = 0;

1405 
ch376
->
roÙ_dœ_lock
 = (
CH376_LOCK
)0;

1406 
ch376
->
cu¼’t_dœ_lock
 = (
CH376_LOCK
)0;

1407 
ch376
->
cu¼’t_fže
 = (
CH376_FILE
)0;

1408 
ch376
->
cu¼’t_dœeùÜy_browsšg
 = (
CH376_DIR
)0;

1409 
	}
}

1411 
	$ÿnûl_®l_io
(
ch376
 *ch376)

1414 
ch376
->
by‹s_to_»ad_wr™e
 = 0;

1417 
	`sy¡em_fšish_examše_dœeùÜy
(&
ch376
->
cÚ‹xt
, ch376->
cu¼’t_dœeùÜy_browsšg
);

1418 
ch376
->
cu¼’t_dœeùÜy_browsšg
 = (
CH376_DIR
)0;

1419 
	`sy¡em_fže_þo£
(&
ch376
->
cÚ‹xt
, ch376->
cu¼’t_fže
);

1420 
ch376
->
cu¼’t_fže
 = (
CH376_FILE
)0;

1423 
	`sy¡em_»Ëa£_dœeùÜy_lock
(&
ch376
->
cÚ‹xt
, ch376->
roÙ_dœ_lock
);

1424 
ch376
->
roÙ_dœ_lock
 = (
CH376_LOCK
)0;

1425 
	`sy¡em_»Ëa£_dœeùÜy_lock
(&
ch376
->
cÚ‹xt
, ch376->
cu¼’t_dœ_lock
);

1426 
ch376
->
cu¼’t_dœ_lock
 = (
CH376_LOCK
)0;

1427 
	}
}

1431 
	$nÜm®ize_ch¬
(
c
)

1433 if(
c
 > 127)

1436 if(
c
 >='a' && c <='z')

1437  
c
 - ('a' - 'A');

1439  
c
;

1440 
	}
}

1444 cÚ¡ * 
	$nÜm®ize_fže_Çme
(cÚ¡ *
fže_Çme
, *
nÜm®ized_fže_Çme
)

1446 
i
 = 0;

1447 
j
 = 0;

1448 
c
;

1450 
	`dbg_´štf
("nÜm®ize_fže_Çme: %s\n", 
fže_Çme
);

1452 
fže_Çme
[
i
] !ð'\0' && fže_Çme[i] !ð'.' && 
j
 < 8)

1454 
c
 = 
	`nÜm®ize_ch¬
(
fže_Çme
[
i
++]);

1456 if(
c
 == -1)

1457  
NULL
;

1459 
nÜm®ized_fže_Çme
[
j
++] = ()
c
;

1462 if(
fže_Çme
[
i
] == '\0')

1464 ; 
j
<8; j++)

1466 
nÜm®ized_fže_Çme
[
j
] = ' ';

1469 if(
fže_Çme
[
i
] == '.')

1471 
i
++;

1472 ; 
j
<8; j++)

1474 
nÜm®ized_fže_Çme
[
j
] = ' ';

1479 
	`dbg_´štf
("nÜm®ize_fže_ÇmimpossibË: % (%d=%c,%d=%c)\n", 
fže_Çme
, 
i
, fže_Çme[i], 
j
, 
nÜm®ized_fže_Çme
[j]);

1480  
NULL
;

1483 
fže_Çme
[
i
] !ð'\0' && fže_Çme[i] !ð'.' && 
j
 < 11)

1485 
c
 = 
	`nÜm®ize_ch¬
(
fže_Çme
[
i
++]);

1487 if(
c
 == -1)

1488  
NULL
;

1490 
nÜm®ized_fže_Çme
[
j
++] = ()
c
;

1493 if(
fže_Çme
[
i
] != '\0')

1495 
	`dbg_´štf
("nÜm®ize_fže_ÇmimpossibË: % (%d=%c,%d=%c)\n", 
fže_Çme
, 
i
, fže_Çme[i], 
j
, 
nÜm®ized_fže_Çme
[j]);

1496  
NULL
;

1499 
	`dbg_´štf
("nÜm®ize_fže_ÇmdÚe: % (%d=&%02x,%d=&%02x)\n", 
fže_Çme
, 
i
, fže_Çme[i], 
j
, 
nÜm®ized_fže_Çme
[j]);

1501 ; 
j
<11; j++)

1503 
nÜm®ized_fže_Çme
[
j
] = ' ';

1506 
nÜm®ized_fže_Çme
[
j
] = '\0';

1508  
nÜm®ized_fže_Çme
;

1509 
	}
}

1513 cÚ¡ * 
	$Œim_fže_Çme
(cÚ¡ *
fže_Çme
, *
Œimmed_fže_Çme
)

1515 
i
 = 0;

1516 
j
 = 0;

1518 
fže_Çme
[
i
] != ' ' && file_name[i] != '\0')

1519 
Œimmed_fže_Çme
[
j
++] = 
fže_Çme
[
i
++];

1521 
fže_Çme
[
i
] == ' ')

1522 
i
++;

1524 
fže_Çme
[
i
] != ' ' && file_name[i] != '\0')

1525 
Œimmed_fže_Çme
[
j
++] = 
fže_Çme
[
i
++];

1527 if(
j
 > 0 && 
Œimmed_fže_Çme
[j-1] == '.')

1528 
j
--;

1530 
Œimmed_fže_Çme
[
j
] = '\0';

1532 
	`dbg_´štf
("Œim_fže_Çmäom \"%s\"Ø\"%s\"\n", 
fže_Çme
, 
Œimmed_fže_Çme
);

1534  
Œimmed_fže_Çme
;

1535 
	}
}

1537 
	$fže_»ad_chunk
(
ch376
 *ch376)

1539 
CH376_S32
 
by‹s_to_»ad_now
;

1540 
CH376_S32
 
by‹s_aùu®ly_»ad
;

1542 if(
ch376
->
by‹s_to_»ad_wr™e
 > (ch376->
cmd_d©a
.
CMD_IOBufãr
))

1543 
by‹s_to_»ad_now
 = (
ch376
->
cmd_d©a
.
CMD_IOBufãr
);

1545 
by‹s_to_»ad_now
 = 
ch376
->
by‹s_to_»ad_wr™e
;

1547 
by‹s_aùu®ly_»ad
 = 
	`sy¡em_fže_»ad
(&
ch376
->
cÚ‹xt
, ch376->
cu¼’t_fže
, &ch376->
cmd_d©a
.
CMD_IOBufãr
, 
by‹s_to_»ad_now
);

1549 if(
by‹s_aùu®ly_»ad
 >= 0)

1551 
ch376
->
by‹s_to_»ad_wr™e
 -ð(
CH376_U16
)
by‹s_aùu®ly_»ad
;

1553 
ch376
->
nb_by‹s_š_cmd_d©a
 = (
CH376_U8
)
by‹s_aùu®ly_»ad
;

1554 
ch376
->
š‹rçû_¡©us
 = 127;

1562 if(
by‹s_to_»ad_now
 =ð0 || 
by‹s_aùu®ly_»ad
 == 0)

1564 
	`dbg_´štf
("[WRITE][DATA][CH376_CMD_BYTE_READ]‡ll done:„ead operated with success (no more data)\n");

1565 
ch376
->
commªd_¡©us
 = 
CH376_INT_SUCCESS
;

1569 
	`dbg_´štf
("[WRITE][DATA][CH376_CMD_BYTE_READ]‡Î dÚe:„—d o³¿‹d w™h sucûs (wa™šg d©¨»ad fÜ %d by‹ ouˆoà%d)\n", 
ch376
->
nb_by‹s_š_cmd_d©a
, ch376->
by‹s_to_»ad_wr™e
);

1570 
ch376
->
commªd_¡©us
 = 
CH376_INT_DISK_READ
;

1575 
	`dbg_´štf
("[WRITE][DATA][CH376_CMD_BYTE_READ]‡borted:„ead failure\n");

1577 
ch376
->
nb_by‹s_š_cmd_d©a
 = 0;

1578 
ch376
->
š‹rçû_¡©us
 = 0;

1579 
ch376
->
commªd_¡©us
 = 
CH376_RET_ABORT
;

1581 
	}
}

1583 
	$fže_wr™e_chunk
(
ch376
 *ch376)

1585 
CH376_S32
 
by‹s_to_wr™e_now
;

1586 
CH376_S32
 
by‹s_aùu®ly_wr™‹n
;

1588 
by‹s_to_wr™e_now
 = 
ch376
->
nb_by‹s_š_cmd_d©a
;

1590 
by‹s_aùu®ly_wr™‹n
 = 
	`sy¡em_fže_wr™e
(&
ch376
->
cÚ‹xt
, ch376->
cu¼’t_fže
, &ch376->
cmd_d©a
.
CMD_IOBufãr
, 
by‹s_to_wr™e_now
);

1592 if(
by‹s_aùu®ly_wr™‹n
 =ð
by‹s_to_wr™e_now
)

1594 
ch376
->
by‹s_to_»ad_wr™e
 -ð(
CH376_U16
)
by‹s_aùu®ly_wr™‹n
;

1596 
ch376
->
nb_by‹s_š_cmd_d©a
 = 0;

1597 
ch376
->
š‹rçû_¡©us
 = 127;

1598 if(
ch376
->
by‹s_to_»ad_wr™e
 == 0)

1600 
	`dbg_´štf
("[WRITE][DATA][CH376_CMD_BYTE_WRITE]‡ll done: write operated with success (no more data)\n");

1601 
ch376
->
commªd_¡©us
 = 
CH376_INT_SUCCESS
;

1605 if(
ch376
->
by‹s_to_»ad_wr™e
 > (ch376->
cmd_d©a
.
CMD_IOBufãr
))

1606 
ch376
->
nb_by‹s_š_cmd_d©a
 = (ch376->
cmd_d©a
.
CMD_IOBufãr
);

1608 
ch376
->
nb_by‹s_š_cmd_d©a
 = (
CH376_U8
)ch376->
by‹s_to_»ad_wr™e
;

1610 
	`dbg_´štf
("[WRITE][DATA][CH376_CMD_BYTE_WRITE]‡Î dÚe: wr™Ý”©ed w™h sucûs (wa™šg d©¨wr™fÜ %d by‹ ouˆoà%d)\n", 
ch376
->
nb_by‹s_š_cmd_d©a
, ch376->
by‹s_to_»ad_wr™e
);

1611 
ch376
->
commªd_¡©us
 = 
CH376_INT_DISK_WRITE
;

1616 
	`dbg_´štf
("[WRITE][DATA][CH376_CMD_BYTE_WRITE]‡borted: write failure\n");

1618 
ch376
->
nb_by‹s_š_cmd_d©a
 = 0;

1619 
ch376
->
š‹rçû_¡©us
 = 0;

1620 
ch376
->
commªd_¡©us
 = 
CH376_RET_ABORT
;

1622 
	}
}

1625 cÚ¡ * 
	$nÜm®ize_·‰”n
(cÚ¡ *
·‰”n
, *
nÜm®ized_·‰”n
)

1627 
i
 = -1;

1629 
	`dbg_´štf
("nÜm®ize_·‰”n: '%s'\n", 
nÜm®ized_·‰”n
);

1631 ià(!
	`¡rcmp
(
·‰”n
, "*"))

1633 
	`dbg_´štf
("normalize_pattern: * -> *.*\n");

1634 
	`nÜm®ize_fže_Çme
("*.*", 
nÜm®ized_·‰”n
);

1636 ià(!
	`nÜm®ize_fže_Çme
(
·‰”n
, 
nÜm®ized_·‰”n
))

1638 
	`dbg_´štf
("normalize_pattern:ƒrror\n");

1639 
nÜm®ized_·‰”n
[0] = '\0';

1640  
NULL
;

1643 
i
<11)

1645 
i
++;

1646 ià(
nÜm®ized_·‰”n
[
i
] == '*')

1650 
i
 < 11)

1651 
nÜm®ized_·‰”n
[
i
++]='*';

1655 
	`dbg_´štf
("nÜm®ize_·‰”n: '%s' (i=%d)\n", 
nÜm®ized_·‰”n
, 
i
);

1657  
nÜm®ized_·‰”n
;

1658 
	}
}

1662 
CH376_BOOL
 
	$·‰”n_m©ch
(cÚ¡ *
·‰”n
, cÚ¡ * 
fže_Çme
)

1664 
CH376_BOOL
 
found
 = 
CH376_FALSE
;

1665 
i
=0;

1667 
	`dbg_´štf
("·‰”n_m©ch('%s', '%s'è=> ", 
·‰”n
, 
fže_Çme
);

1671 ià(
·‰”n
[
i
] != '*')

1673 ià(
·‰”n
[
i
] !ð
fže_Çme
[i])

1675 
found
 = 
CH376_FALSE
;

1678 ià(
·‰”n
[
i
] == '\0')

1680 
found
 = 
CH376_TRUE
;

1686 ià(
fže_Çme
[
i
] == '\0')

1688 
found
 = 
CH376_TRUE
;

1692 
i
++;

1695 
	`dbg_´štf
("i=%d, found=%d\n", 
i
, 
found
);

1696  
found
;

1697 
	}
}

1703 
CH376_U8
 
	$ch376_»ad_commªd_pÜt
(
ch376
 *ch376)

1705 
	`dbg_´štf
("[READ][COMMAND] duršg commªd &%02x stu &%02x\n", 
ch376
->
commªd
, ch376->
commªd_¡©us
);

1706  
ch376
->
š‹rçû_¡©us
;

1707 
	}
}

1713 
CH376_U8
 
	$ch376_»ad_d©a_pÜt
(
ch376
 *ch376)

1715 
CH376_U8
 
d©a_out
 = 0xff;

1717 
	`dbg_´štf
(">> [READ][DATA] fÜ duršg commªd &%02x stu &%02x\n", 
ch376
->
commªd
, ch376->
commªd_¡©us
);

1719 
ch376
->
commªd
)

1721 
CH376_CMD_CHECK_EXIST
:

1722 
d©a_out
 = 
ch376
->
cmd_d©a
.
CMD_CheckBy‹
;

1723 
	`dbg_´štf
("[READ][DATA][CH376_CMD_CHECK_EXIST] s‘tšg d©¨pÜˆtØ&%02x\n", 
d©a_out
);

1726 
CH376_CMD_GET_FILE_SIZE
:

1727 if(
ch376
->
nb_by‹s_š_cmd_d©a
)

1729 if(
ch376
->
nb_by‹s_š_cmd_d©a
 !ðch376->
pos_rw_š_cmd_d©a
)

1731 
d©a_out
 = 
ch376
->
cmd_d©a
.
CMD_FžeSize
[ch376->
pos_rw_š_cmd_d©a
];

1733 
	`dbg_´štf
("[READ][DATA][CH376_CMD_GET_FILE_SIZE]„—d &%02x from i/Øbufã¸©…os™iÚ &%02x\n", 
d©a_out
, 
ch376
->
pos_rw_š_cmd_d©a
);

1735 if(++
ch376
->
pos_rw_š_cmd_d©a
 =ðch376->
nb_by‹s_š_cmd_d©a
)

1736 
ch376
->
nb_by‹s_š_cmd_d©a
 = 0;

1741 
d©a_out
 = 0;

1742 
	`dbg_´štf
("[READ][DATA][CH376_CMD_GET_FILE_SIZE]‚othingo„ead from i/o buffer\n");

1747 
CH376_CMD_GET_IC_VER
:

1748 
d©a_out
 = (0x40 | 
CH376_DATA_IC_VER
) & 0x7f;

1749 
	`dbg_´štf
("[READ][DATA][CH376_CMD_GET_IC_VER] s‘tšg d©¨pÜˆtØ&%02x\n", 
d©a_out
);

1752 
CH376_CMD_SET_USB_MODE
:

1753 if(
ch376
->
usb_mode
 =ð
CH376_ARG_SET_USB_MODE_INVALID
)

1755 
d©a_out
 = 
CH376_RET_ABORT
;

1756 
	`dbg_´štf
("[READ][DATA][CH376_SET_USB_MODE]‡borted!\n");

1760 
d©a_out
 = 
CH376_RET_SUCCESS
;

1761 
	`dbg_´štf
("[READ][DATA][CH376_SET_USB_MODE] completed!\n");

1765 
CH376_CMD_GET_STATUS
:

1766 
d©a_out
 = 
ch376
->
commªd_¡©us
;

1767 
	`dbg_´štf
("[READ][DATA][CH376_CMD_GET_STATUS] s‘tšg d©¨pÜˆtØ&%02x\n", 
d©a_out
);

1770 
CH376_CMD_RD_USB_DATA0
:

1771 if(
ch376
->
nb_by‹s_š_cmd_d©a
)

1773 if(
ch376
->
pos_rw_š_cmd_d©a
 =ð
CMD_DATA_REQ_SIZE
)

1775 
d©a_out
 = 
ch376
->
nb_by‹s_š_cmd_d©a
;

1776 
ch376
->
pos_rw_š_cmd_d©a
 = 0;

1777 
	`dbg_´štf
("[READ][DATA][CH376_CMD_RD_USB_DATA0]„—d i/Øbufã¸size: &%02x\n", 
d©a_out
);

1779 if(
ch376
->
nb_by‹s_š_cmd_d©a
 !ðch376->
pos_rw_š_cmd_d©a
)

1781 
d©a_out
 = 
ch376
->
cmd_d©a
.
CMD_IOBufãr
[ch376->
pos_rw_š_cmd_d©a
];

1783 
	`dbg_´štf
("[READ][DATA][CH376_CMD_RD_USB_DATA0]„—d \"%c\" (&%02xèäom i/Øbufã¸©…os™iÚ &%02x\n", 
d©a_out
, d©a_out, 
ch376
->
pos_rw_š_cmd_d©a
);

1785 if(++
ch376
->
pos_rw_š_cmd_d©a
 =ðch376->
nb_by‹s_š_cmd_d©a
)

1786 
ch376
->
nb_by‹s_š_cmd_d©a
 = 0;

1791 
d©a_out
 = 0;

1792 
	`dbg_´štf
("[READ][DATA][CH376_CMD_RD_USB_DATA0]‚othingo„ead from i/o buffer\n");

1796 
CH376_CMD_WR_REQ_DATA
:

1797 if(
ch376
->
nb_by‹s_š_cmd_d©a
)

1799 if(
ch376
->
pos_rw_š_cmd_d©a
 =ð
CMD_DATA_REQ_SIZE
)

1801 
d©a_out
 = 
ch376
->
nb_by‹s_š_cmd_d©a
;

1802 
ch376
->
pos_rw_š_cmd_d©a
 = 0;

1803 
	`dbg_´štf
("[READ][DATA][CH376_CMD_WR_REQ_DATA]„—d i/Øbufã¸size: &%02x\n", 
d©a_out
);

1808 
d©a_out
 = 0;

1809 
	`dbg_´štf
("[READ][DATA][CH376_CMD_WR_REQ_DATA]‚othingo„ead from i/o buffer\n");

1816 
d©a_out
 = 
ch376
->
cmd_d©a
.
CMD_IOBufãr
[0];

1820 
	`dbg_´štf
("<< [READ][DATA] fÜ duršg commªd &%02x stu &%02x\n", 
ch376
->
commªd
, ch376->
commªd_¡©us
);

1823  
d©a_out
;

1824 
	}
}

1830 
	$ch376_wr™e_commªd_pÜt
(
ch376
 *ch376, 
CH376_U8
 
commªd
)

1832 
	`dbg_´štf
(">> [WRITE][COMMAND] Wr™commªd &%02x stu &%02x\n", 
commªd
, 
ch376
->
commªd_¡©us
);

1834 
ch376
->
š‹rçû_¡©us
 = 0;

1838 if(
ch376
->
commªd
 =ð
CH376_CMD_CHECK_EXIST
)

1840 
ch376
->
cmd_d©a
.
CMD_CheckBy‹
 = ~
commªd
;

1841 
	`dbg_´štf
("[WRITE][COMMAND][CH376_CMD_CHECK_EXIST] gÙ check by‹ &%02x from commªd…Üt!\n", 
commªd
);

1844 
commªd
)

1846 
CH376_CMD_CHECK_EXIST
:

1847 
ch376
->
commªd
 = 
CH376_CMD_CHECK_EXIST
;

1848 
	`dbg_´štf
("[WRITE][COMMAND][CH376_CMD_CHECK_EXIST] waiting for check byte\n");

1851 
CH376_CMD_GET_FILE_SIZE
:

1852 
ch376
->
commªd
 = 
CH376_CMD_GET_FILE_SIZE
;

1853 
	`dbg_´štf
("[WRITE][COMMAND][CH376_CMD_GET_FILE_SIZE] wait for &68 byte\n");

1856 
CH376_CMD_GET_IC_VER
:

1857 
ch376
->
commªd
 = 
CH376_CMD_GET_IC_VER
;

1858 
	`dbg_´štf
("[WRITE][COMMAND][CH376_CMD_GET_IC_VER]\n");

1861 
CH376_CMD_SET_USB_MODE
:

1862 
ch376
->
commªd
 = 
CH376_CMD_SET_USB_MODE
;

1863 
	`dbg_´štf
("[WRITE][COMMAND][CH376_CMD_SET_USB_MODE] waiting for usb mode data\n");

1866 
CH376_CMD_DISK_MOUNT
:

1867 
ch376
->
commªd
 = 
CH376_CMD_DISK_MOUNT
;

1868 
	`ÿnûl_®l_io
(
ch376
);

1870 if(
ch376
->
usb_mode
 =ð
CH376_ARG_SET_USB_MODE_SD_HOST
)

1871 
ch376
->
roÙ_dœ_lock
 = 
	`sy¡em_obš_dœeùÜy_lock
(&ch376->
cÚ‹xt
, ch376->
sdÿrd_drive_·th
, 
NULL
);

1872 if(
ch376
->
usb_mode
 =ð
CH376_ARG_SET_USB_MODE_USB_HOST
)

1873 
ch376
->
roÙ_dœ_lock
 = 
	`sy¡em_obš_dœeùÜy_lock
(&ch376->
cÚ‹xt
, ch376->
usb_drive_·th
, 
NULL
);

1875 if(
ch376
->
roÙ_dœ_lock
)

1877 
ch376
->
cmd_d©a
.
CMD_MouÁInfo
.
MOUNT_DeviûTy³
 = 0;

1878 
ch376
->
cmd_d©a
.
CMD_MouÁInfo
.
MOUNT_RemovabËMedŸ
 = 0;

1879 
ch376
->
cmd_d©a
.
CMD_MouÁInfo
.
MOUNT_V”siÚs
 = 0;

1880 
ch376
->
cmd_d©a
.
CMD_MouÁInfo
.
MOUNT_D©aFÜm©AndEtc
 = 0;

1881 
ch376
->
cmd_d©a
.
CMD_MouÁInfo
.
MOUNT_Add™iÚ®L’gth
 = 0;

1882 
ch376
->
cmd_d©a
.
CMD_MouÁInfo
.
MOUNT_Re£rved1
 = 0;

1883 
ch376
->
cmd_d©a
.
CMD_MouÁInfo
.
MOUNT_Re£rved2
 = 0;

1884 
ch376
->
cmd_d©a
.
CMD_MouÁInfo
.
MOUNT_MiscFÏg
 = 0;

1885 
ch376
->
cmd_d©a
.
CMD_MouÁInfo
.
MOUNT_V’dÜIdSŒ
[0] = 'J';

1886 
ch376
->
cmd_d©a
.
CMD_MouÁInfo
.
MOUNT_V’dÜIdSŒ
[1] = 'E';

1887 
ch376
->
cmd_d©a
.
CMD_MouÁInfo
.
MOUNT_V’dÜIdSŒ
[2] = 'D';

1888 
ch376
->
cmd_d©a
.
CMD_MouÁInfo
.
MOUNT_V’dÜIdSŒ
[3] = 'E';

1889 
ch376
->
cmd_d©a
.
CMD_MouÁInfo
.
MOUNT_V’dÜIdSŒ
[4] = '+';

1890 
ch376
->
cmd_d©a
.
CMD_MouÁInfo
.
MOUNT_V’dÜIdSŒ
[5] = 'O';

1891 
ch376
->
cmd_d©a
.
CMD_MouÁInfo
.
MOUNT_V’dÜIdSŒ
[6] = 'F';

1892 
ch376
->
cmd_d©a
.
CMD_MouÁInfo
.
MOUNT_V’dÜIdSŒ
[7] = 'T';

1893 
ch376
->
cmd_d©a
.
CMD_MouÁInfo
.
MOUNT_ProduùIdSŒ
[ 0] = 'C';

1894 
ch376
->
cmd_d©a
.
CMD_MouÁInfo
.
MOUNT_ProduùIdSŒ
[ 1] = 'H';

1895 
ch376
->
cmd_d©a
.
CMD_MouÁInfo
.
MOUNT_ProduùIdSŒ
[ 2] = '3';

1896 
ch376
->
cmd_d©a
.
CMD_MouÁInfo
.
MOUNT_ProduùIdSŒ
[ 3] = '7';

1897 
ch376
->
cmd_d©a
.
CMD_MouÁInfo
.
MOUNT_ProduùIdSŒ
[ 4] = '6';

1898 
ch376
->
cmd_d©a
.
CMD_MouÁInfo
.
MOUNT_ProduùIdSŒ
[ 5] = ' ';

1899 
ch376
->
cmd_d©a
.
CMD_MouÁInfo
.
MOUNT_ProduùIdSŒ
[ 6] = 'E';

1900 
ch376
->
cmd_d©a
.
CMD_MouÁInfo
.
MOUNT_ProduùIdSŒ
[ 7] = 'M';

1901 
ch376
->
cmd_d©a
.
CMD_MouÁInfo
.
MOUNT_ProduùIdSŒ
[ 8] = 'U';

1902 
ch376
->
cmd_d©a
.
CMD_MouÁInfo
.
MOUNT_ProduùIdSŒ
[ 9] = 'L';

1903 
ch376
->
cmd_d©a
.
CMD_MouÁInfo
.
MOUNT_ProduùIdSŒ
[10] = 'A';

1904 
ch376
->
cmd_d©a
.
CMD_MouÁInfo
.
MOUNT_ProduùIdSŒ
[11] = 'T';

1905 
ch376
->
cmd_d©a
.
CMD_MouÁInfo
.
MOUNT_ProduùIdSŒ
[12] = 'O';

1906 
ch376
->
cmd_d©a
.
CMD_MouÁInfo
.
MOUNT_ProduùIdSŒ
[13] = 'R';

1907 
ch376
->
cmd_d©a
.
CMD_MouÁInfo
.
MOUNT_ProduùIdSŒ
[14] = ' ';

1908 
ch376
->
cmd_d©a
.
CMD_MouÁInfo
.
MOUNT_ProduùIdSŒ
[15] = ' ';

1909 
ch376
->
cmd_d©a
.
CMD_MouÁInfo
.
MOUNT_ProduùRevSŒ
[0] = 'F';

1910 
ch376
->
cmd_d©a
.
CMD_MouÁInfo
.
MOUNT_ProduùRevSŒ
[1] = 'A';

1911 
ch376
->
cmd_d©a
.
CMD_MouÁInfo
.
MOUNT_ProduùRevSŒ
[2] = 'M';

1912 
ch376
->
cmd_d©a
.
CMD_MouÁInfo
.
MOUNT_ProduùRevSŒ
[3] = 'E';

1914 
	`dbg_´štf
("[WRITE][COMMAND][CH376_CMD_DISK_MOUNT] drive directory is found (mounted :);‡dditional data‡vailable\n");

1916 
ch376
->
nb_by‹s_š_cmd_d©a
 = (ch376->
cmd_d©a
.
CMD_MouÁInfo
);

1917 
ch376
->
š‹rçû_¡©us
 = 127;

1918 
ch376
->
commªd_¡©us
 = 
CH376_INT_SUCCESS
;

1922 
	`dbg_´štf
("[WRITE][COMMAND][CH376_CMD_DISK_MOUNT] drive directory‚ot found\n");

1923 
ch376
->
commªd_¡©us
 = 0x1f;

1927 
CH376_CMD_GET_STATUS
:

1928 
ch376
->
commªd
 = 
CH376_CMD_GET_STATUS
;

1929 
	`dbg_´štf
("[WRITE][COMMAND][CH376_CMD_GET_STATUS] waiting for status„eading\n");

1932 
CH376_CMD_SET_FILE_NAME
:

1933 
ch376
->
commªd
 = 
CH376_CMD_SET_FILE_NAME
;

1934 
ch376
->
pos_rw_š_cmd_d©a
 = 0;

1935 
	`dbg_´štf
("[WRITE][COMMAND][CH376_CMD_SET_FILE_NAME] waiting for file‚ame\n");

1938 
CH376_CMD_FILE_OPEN
:

1939 
ch376
->
commªd
 = 
CH376_CMD_FILE_OPEN
;

1941 if(
ch376
->
roÙ_dœ_lock
)

1943 
i
 = 0;

1946 if(
ch376
->
cmd_d©a
.
CMD_FžeName
[
i
] == '/')

1948 
	`dbg_´štf
("[WRITE][COMMAND][CH376_CMD_FILE_OPEN] opening„oot directory\n");

1949 
	`sy¡em_»Ëa£_dœeùÜy_lock
(&
ch376
->
cÚ‹xt
, ch376->
cu¼’t_dœ_lock
);

1950 
ch376
->
cu¼’t_dœ_lock
 = 
	`sy¡em_þÚe_dœeùÜy_lock
(&ch376->
cÚ‹xt
, ch376->
roÙ_dœ_lock
);

1951 
i
++;

1954 if(
ch376
->
cmd_d©a
.
CMD_FžeName
[
i
] == '\0')

1957 
ch376
->
š‹rçû_¡©us
 = 127;

1958 
ch376
->
commªd_¡©us
 = 
CH376_ERR_OPEN_DIR
;

1959 
ch376
->
cu¼’t_fže_is_dœeùÜy
 = 
CH376_TRUE
;

1964 if(
	`¡rchr
(
ch376
->
cmd_d©a
.
CMD_FžeName
,'*') || strchr(ch376->cmd_data.CMD_FileName,'?'))

1966 
	`dbg_´štf
("[WRITE][COMMAND][CH376_CMD_FILE_OPEN]ƒxamining directory contents\n");

1969 
	`sy¡em_fšish_examše_dœeùÜy
(&
ch376
->
cÚ‹xt
, ch376->
cu¼’t_dœeùÜy_browsšg
);

1970 
ch376
->
cu¼’t_dœeùÜy_browsšg
 = 
	`sy¡em_¡¬t_examše_dœeùÜy
(&ch376->
cÚ‹xt
, ch376->
cu¼’t_dœ_lock
);

1971 
	`nÜm®ize_·‰”n
(
ch376
->
cmd_d©a
.
CMD_FžeName
, ch376->
dœ_·‰”n
);

1973 
fže_’um_go
;

1977 
fixed_fže_Çme
[13];

1978 
CH376_LOCK
 
cu¼’t_dœ_lock
;

1979 
	`Œim_fže_Çme
(&
ch376
->
cmd_d©a
.
CMD_FžeName
[
i
], 
fixed_fže_Çme
);

1981 
cu¼’t_dœ_lock
 = 
	`sy¡em_obš_dœeùÜy_lock
(&
ch376
->
cÚ‹xt
, 
fixed_fže_Çme
, ch376->current_dir_lock);

1984 if(
cu¼’t_dœ_lock
)

1986 
	`dbg_´štf
("[WRITE][COMMAND][CH376_CMD_FILE_OPEN]ƒÁ”šg dœeùÜy: %s\n", &
ch376
->
cmd_d©a
.
CMD_FžeName
[
i
]);

1988 
	`sy¡em_»Ëa£_dœeùÜy_lock
(&
ch376
->
cÚ‹xt
, ch376->
cu¼’t_dœ_lock
);

1989 
ch376
->
cu¼’t_dœ_lock
 = current_dir_lock;

1990 
ch376
->
cu¼’t_fže_is_dœeùÜy
 = 
CH376_TRUE
;

1992 
ch376
->
š‹rçû_¡©us
 = 127;

1993 
ch376
->
commªd_¡©us
 = 
CH376_ERR_OPEN_DIR
;

1998 
	`sy¡em_fže_þo£
(&
ch376
->
cÚ‹xt
, ch376->
cu¼’t_fže
);

1999 
ch376
->
cu¼’t_fže
 = 
	`sy¡em_fže_Ý’_exi¡šg
(&ch376->
cÚ‹xt
, 
fixed_fže_Çme
, ch376->
cu¼’t_dœ_lock
);

2001 
	`dbg_´štf
("[WRITE][COMMAND][CH376_CMD_FILE_OPEN] o³nšghfže: %s\n", &
ch376
->
cmd_d©a
.
CMD_FžeName
[
i
]);

2003 if(
ch376
->
cu¼’t_fže
)

2005 
ch376
->
š‹rçû_¡©us
 = 127;

2006 
ch376
->
commªd_¡©us
 = 
CH376_INT_SUCCESS
;

2007 
ch376
->
cu¼’t_fže_is_dœeùÜy
 = 
CH376_FALSE
;

2011 
ch376
->
š‹rçû_¡©us
 = 0;

2012 
ch376
->
commªd_¡©us
 = 
CH376_ERR_MISS_FILE
;

2020 
	`dbg_´štf
("[WRITE][COMMAND][CH376_CMD_FILE_OPEN]‚o operation…ossible (device‚ot mounted)\n");

2022 
ch376
->
š‹rçû_¡©us
 = 0;

2023 
ch376
->
commªd_¡©us
 = 
CH376_RET_ABORT
;

2027 
CH376_CMD_FILE_CREATE
:

2028 
ch376
->
commªd
 = 
CH376_CMD_FILE_CREATE
;

2030 if(
ch376
->
roÙ_dœ_lock
)

2032 
i
 = 0;

2035 if(
ch376
->
cmd_d©a
.
CMD_FžeName
[
i
] == '/')

2037 
	`dbg_´štf
("[WRITE][COMMAND][CH376_CMD_FILE_CREATE] opening„oot directory\n");

2038 
	`sy¡em_»Ëa£_dœeùÜy_lock
(&
ch376
->
cÚ‹xt
, ch376->
cu¼’t_dœ_lock
);

2039 
ch376
->
cu¼’t_dœ_lock
 = 
	`sy¡em_þÚe_dœeùÜy_lock
(&ch376->
cÚ‹xt
, ch376->
roÙ_dœ_lock
);

2040 
i
++;

2043 if(
ch376
->
cmd_d©a
.
CMD_FžeName
[
i
] == '\0')

2046 
ch376
->
š‹rçû_¡©us
 = 127;

2047 
ch376
->
commªd_¡©us
 = 
CH376_INT_SUCCESS
;

2051 
fixed_fže_Çme
[13];

2052 
	`Œim_fže_Çme
(&
ch376
->
cmd_d©a
.
CMD_FžeName
[
i
], 
fixed_fže_Çme
);

2055 
	`sy¡em_fže_þo£
(&
ch376
->
cÚ‹xt
, ch376->
cu¼’t_fže
);

2056 
ch376
->
cu¼’t_fže
 = 
	`sy¡em_fže_Ý’_Ãw
(&ch376->
cÚ‹xt
, 
fixed_fže_Çme
, ch376->
cu¼’t_dœ_lock
);

2058 
	`dbg_´štf
("[WRITE][COMMAND][CH376_CMD_FILE_CREATE] c»©šghfže: %s\n", &
ch376
->
cmd_d©a
.
CMD_FžeName
[
i
]);

2060 if(
ch376
->
cu¼’t_fže
)

2062 
ch376
->
š‹rçû_¡©us
 = 127;

2063 
ch376
->
commªd_¡©us
 = 
CH376_INT_SUCCESS
;

2067 
ch376
->
š‹rçû_¡©us
 = 0;

2068 
ch376
->
commªd_¡©us
 = 
CH376_ERR_MISS_FILE
;

2074 
	`dbg_´štf
("[WRITE][COMMAND][CH376_CMD_FILE_CREATE]‚o operation…ossible (device‚ot mounted)\n");

2076 
ch376
->
š‹rçû_¡©us
 = 0;

2077 
ch376
->
commªd_¡©us
 = 
CH376_RET_ABORT
;

2081 
CH376_CMD_DIR_CREATE
:

2082 
ch376
->
commªd
 = 
CH376_CMD_DIR_CREATE
;

2084 if(
ch376
->
roÙ_dœ_lock
)

2086 
fixed_fže_Çme
[13];

2087 
CH376_FILE
 
exi¡šg_fže
;

2088 
i
 = 0;

2091 if(
ch376
->
cmd_d©a
.
CMD_FžeName
[
i
] == '/')

2093 
	`dbg_´štf
("[WRITE][COMMAND][CH376_CMD_DIR_CREATE] opening„oot directory\n");

2094 
	`sy¡em_»Ëa£_dœeùÜy_lock
(&
ch376
->
cÚ‹xt
, ch376->
cu¼’t_dœ_lock
);

2095 
ch376
->
cu¼’t_dœ_lock
 = 
	`sy¡em_þÚe_dœeùÜy_lock
(&ch376->
cÚ‹xt
, ch376->
roÙ_dœ_lock
);

2096 
i
++;

2099 
	`Œim_fže_Çme
(&
ch376
->
cmd_d©a
.
CMD_FžeName
[
i
], 
fixed_fže_Çme
);

2101 
exi¡šg_fže
 = 
	`sy¡em_fže_Ý’_exi¡šg
(&
ch376
->
cÚ‹xt
, 
fixed_fže_Çme
, ch376->
cu¼’t_dœ_lock
);

2103 if(
exi¡šg_fže
)

2105 
	`sy¡em_fže_þo£
(&
ch376
->
cÚ‹xt
, 
exi¡šg_fže
);

2106 
ch376
->
š‹rçû_¡©us
 = 0;

2107 
ch376
->
commªd_¡©us
 = 
CH376_ERR_FOUND_NAME
;

2111 
CH376_LOCK
 
ü—‹d_dœ_lock
;

2114 
ü—‹d_dœ_lock
 = 
	`sy¡em_obš_dœeùÜy_lock
(&
ch376
->
cÚ‹xt
, 
fixed_fže_Çme
, ch376->
cu¼’t_dœ_lock
);

2116 ià(!
ü—‹d_dœ_lock
)

2117 
ü—‹d_dœ_lock
 = 
	`sy¡em_ü—‹_dœeùÜy
(&
ch376
->
cÚ‹xt
, 
fixed_fže_Çme
, ch376->
cu¼’t_dœ_lock
);

2120 if(
ü—‹d_dœ_lock
)

2122 
	`dbg_´štf
("[WRITE][COMMAND][CH376_CMD_DIR_CREATE]ƒÁ”šg c»©ed dœeùÜy: %s\n", &
ch376
->
cmd_d©a
.
CMD_FžeName
[
i
]);

2124 
	`sy¡em_»Ëa£_dœeùÜy_lock
(&
ch376
->
cÚ‹xt
, ch376->
cu¼’t_dœ_lock
);

2125 
ch376
->
cu¼’t_dœ_lock
 = 
ü—‹d_dœ_lock
;

2127 
ch376
->
š‹rçû_¡©us
 = 127;

2128 
ch376
->
commªd_¡©us
 = 
CH376_INT_SUCCESS
;

2132 
	`dbg_´štf
("[WRITE][COMMAND][CH376_CMD_DIR_CREATE] dœeùÜy could‚Ù bü—‹d: %s\n", &
ch376
->
cmd_d©a
.
CMD_FžeName
[
i
]);

2134 
ch376
->
š‹rçû_¡©us
 = 0;

2135 
ch376
->
commªd_¡©us
 = 
CH376_ERR_MISS_FILE
;

2141 
	`dbg_´štf
("[WRITE][COMMAND][CH376_CMD_DIR_CREATE]‚o operation…ossible (device‚ot mounted)\n");

2143 
ch376
->
š‹rçû_¡©us
 = 0;

2144 
ch376
->
commªd_¡©us
 = 
CH376_RET_ABORT
;

2148 
CH376_CMD_FILE_ERASE
:

2149 
ch376
->
commªd
 = 
CH376_CMD_FILE_ERASE
;

2151 if(
ch376
->
roÙ_dœ_lock
)

2153 
fixed_fže_Çme
[13];

2154 
i
 = 0;

2155 
CH376_BOOL
 
fže_”a£d
 = 
CH376_FALSE
;

2158 if(
ch376
->
cmd_d©a
.
CMD_FžeName
[
i
] == '/')

2160 
	`dbg_´štf
("[WRITE][COMMAND][CH376_CMD_FILE_ERASE] opening„oot directory\n");

2161 
	`sy¡em_»Ëa£_dœeùÜy_lock
(&
ch376
->
cÚ‹xt
, ch376->
cu¼’t_dœ_lock
);

2162 
ch376
->
cu¼’t_dœ_lock
 = 
	`sy¡em_þÚe_dœeùÜy_lock
(&ch376->
cÚ‹xt
, ch376->
roÙ_dœ_lock
);

2163 
i
++;

2166 ià(
ch376
->
cmd_d©a
.
CMD_FžeName
[
i
] != 0)

2168 
	`Œim_fže_Çme
(&
ch376
->
cmd_d©a
.
CMD_FžeName
[
i
], 
fixed_fže_Çme
);

2170 if(
ch376
->
cu¼’t_fže
)

2172 
	`sy¡em_fže_þo£
(&
ch376
->
cÚ‹xt
, ch376->
cu¼’t_fže
);

2173 
ch376
->
cu¼’t_fže
 = (
CH376_FILE
)0;

2176 ià(
ch376
->
cu¼’t_fže_is_dœeùÜy
)

2177 
fže_”a£d
 = 
	`sy¡em_dœeùÜy_d–‘e
(&
ch376
->
cÚ‹xt
, ch376->
cu¼’t_dœ_lock
);

2179 
fže_”a£d
 = 
	`sy¡em_fže_d–‘e
(&
ch376
->
cÚ‹xt
, 
fixed_fže_Çme
, ch376->
cu¼’t_dœ_lock
);

2182 ià(
fže_”a£d
)

2184 
	`dbg_´štf
("[WRITE][COMMAND][CH376_CMD_FILE_ERASE] fžÜ dœeùÜy d–‘ed: %s\n", &
ch376
->
cmd_d©a
.
CMD_FžeName
[
i
]);

2186 
ch376
->
š‹rçû_¡©us
 = 127;

2187 
ch376
->
commªd_¡©us
 = 
CH376_INT_SUCCESS
;

2191 
	`dbg_´štf
("[WRITE][COMMAND][CH376_CMD_FILE_ERASE] fžÜ dœeùÜy could‚Ù bd–‘ed: %s\n", &
ch376
->
cmd_d©a
.
CMD_FžeName
[
i
]);

2193 
ch376
->
š‹rçû_¡©us
 = 0;

2194 
ch376
->
commªd_¡©us
 = 
CH376_ERR_MISS_FILE
;

2199 
	`dbg_´štf
("[WRITE][COMMAND][CH376_CMD_FILE_ERASE]‚o operation…ossible (device‚ot mounted)\n");

2201 
ch376
->
š‹rçû_¡©us
 = 0;

2202 
ch376
->
commªd_¡©us
 = 
CH376_RET_ABORT
;

2206 
CH376_CMD_RD_USB_DATA0
:

2207 
ch376
->
commªd
 = 
CH376_CMD_RD_USB_DATA0
;

2208 
ch376
->
pos_rw_š_cmd_d©a
 = 
CMD_DATA_REQ_SIZE
;

2209 
	`dbg_´štf
("[WRITE][COMMAND][CH376_CMD_RD_USB_DATA0] waiting for i/o buffer„ead\n");

2212 
CH376_CMD_WR_REQ_DATA
:

2213 
ch376
->
commªd
 = 
CH376_CMD_WR_REQ_DATA
;

2214 
ch376
->
pos_rw_š_cmd_d©a
 = 
CMD_DATA_REQ_SIZE
;

2215 
	`dbg_´štf
("[WRITE][COMMAND][CH376_CMD_WR_REQ_DATA] waiting for i/o buffer write\n");

2218 
CH376_CMD_FILE_ENUM_GO
:

2219 
ch376
->
commªd
 = 
CH376_CMD_FILE_ENUM_GO
;

2220 
fže_’um_go
:

2221 if(
	`sy¡em_go_examše_dœeùÜy
(&
ch376
->
cÚ‹xt
, ch376->
cu¼’t_dœ_lock
, ch376->
cu¼’t_dœeùÜy_browsšg
, &ch376->
cmd_d©a
.
CMD_F©DœInfo
, ch376->
dœ_·‰”n
))

2223 
	`dbg_´štf
("[WRITE][COMMAND][CH376_CMD_FILE_ENUM_GO]‚ext directoryƒntry in buffer\n");

2224 
ch376
->
nb_by‹s_š_cmd_d©a
 = (ch376->
cmd_d©a
.
CMD_F©DœInfo
);

2225 
ch376
->
š‹rçû_¡©us
 = 127;

2226 
ch376
->
commªd_¡©us
 = 
CH376_INT_DISK_READ
;

2230 
	`dbg_´štf
("[WRITE][COMMAND][CH376_CMD_FILE_ENUM_GO] directory browing finished\n");

2232 
	`sy¡em_fšish_examše_dœeùÜy
(&
ch376
->
cÚ‹xt
, ch376->
cu¼’t_dœeùÜy_browsšg
);

2233 
ch376
->
cu¼’t_dœeùÜy_browsšg
 = (
CH376_DIR
)0;

2235 
ch376
->
š‹rçû_¡©us
 = 0;

2236 
ch376
->
commªd_¡©us
 = 
CH376_ERR_OPEN_DIR
;

2240 
CH376_CMD_DISK_CAPACITY
:

2241 
ch376
->
commªd
 = 
CH376_CMD_DISK_CAPACITY
;

2243 if(
	`sy¡em_g‘_disk_šfo
(&
ch376
->
cÚ‹xt
, ch376->
roÙ_dœ_lock
, &ch376->
cmd_d©a
.
CMD_DiskQu”y
))

2245 
	`dbg_´štf
("[WRITE][COMMAND][CH376_CMD_DISK_CAPACITY] sector capacity in buffer\n");

2247 
ch376
->
nb_by‹s_š_cmd_d©a
 = 4;

2248 
ch376
->
š‹rçû_¡©us
 = 127;

2249 
ch376
->
commªd_¡©us
 = 
CH376_INT_SUCCESS
;

2253 
	`dbg_´štf
("[WRITE][COMMAND][CH376_CMD_DISK_CAPACITY]‚o operation…ossible (device‚ot mounted)\n");

2254 
ch376
->
š‹rçû_¡©us
 = 0;

2255 
ch376
->
commªd_¡©us
 = 
CH376_RET_ABORT
;

2259 
CH376_CMD_DISK_QUERY
:

2260 
ch376
->
commªd
 = 
CH376_CMD_DISK_QUERY
;

2262 if(
	`sy¡em_g‘_disk_šfo
(&
ch376
->
cÚ‹xt
, ch376->
roÙ_dœ_lock
, &ch376->
cmd_d©a
.
CMD_DiskQu”y
))

2264 
	`dbg_´štf
("[WRITE][COMMAND][CH376_CMD_DISK_QUERY] sector capacity in buffer\n");

2265 
ch376
->
nb_by‹s_š_cmd_d©a
 = (ch376->
cmd_d©a
.
CMD_DiskQu”y
);

2266 
ch376
->
š‹rçû_¡©us
 = 127;

2267 
ch376
->
commªd_¡©us
 = 
CH376_INT_SUCCESS
;

2271 
	`dbg_´štf
("[WRITE][COMMAND][CH376_CMD_DISK_QUERY]‚o operation…ossible (device‚ot mounted)\n");

2272 
ch376
->
š‹rçû_¡©us
 = 0;

2273 
ch376
->
commªd_¡©us
 = 
CH376_RET_ABORT
;

2277 
CH376_CMD_BYTE_LOCATE
:

2278 
ch376
->
commªd
 = 
CH376_CMD_BYTE_LOCATE
;

2279 
	`dbg_´štf
("[WRITE][COMMAND][CH376_CMD_BYTE_LOCATE] waiting for seek…osition\n");

2280 
ch376
->
pos_rw_š_cmd_d©a
 = 0;

2283 
CH376_CMD_BYTE_READ
:

2284 
ch376
->
commªd
 = 
CH376_CMD_BYTE_READ
;

2285 
	`dbg_´štf
("[WRITE][COMMAND][CH376_CMD_BYTE_READ] waiting for„ead size\n");

2286 
ch376
->
pos_rw_š_cmd_d©a
 = 0;

2289 
CH376_CMD_BYTE_RD_GO
:

2290 
ch376
->
commªd
 = 
CH376_CMD_BYTE_RD_GO
;

2291 
	`dbg_´štf
("[WRITE][COMMAND][CH376_CMD_BYTE_RD_GO] waiting for‚ext chunko„ead\n");

2292 
	`fže_»ad_chunk
(
ch376
);

2295 
CH376_CMD_BYTE_WRITE
:

2296 
ch376
->
commªd
 = 
CH376_CMD_BYTE_WRITE
;

2297 
	`dbg_´štf
("[WRITE][COMMAND][CH376_CMD_BYTE_WRITE] waiting for write size\n");

2298 
ch376
->
pos_rw_š_cmd_d©a
 = 0;

2301 
CH376_CMD_BYTE_WR_GO
:

2302 
ch376
->
commªd
 = 
CH376_CMD_BYTE_WR_GO
;

2303 
	`dbg_´štf
("[WRITE][COMMAND][CH376_CMD_BYTE_WR_GO] waiting for‚ext chunko write\n");

2304 
	`fže_wr™e_chunk
(
ch376
);

2307 
CH376_CMD_FILE_CLOSE
:

2308 
ch376
->
commªd
 = 
CH376_CMD_FILE_CLOSE
;

2309 
	`dbg_´štf
("[WRITE][COMMAND][CH376_CMD_FILE_CLOSE] waiting for close mode\n");

2313 
	`dbg_´štf
("[WRITE][COMMAND][UnsuµÜ‹d] commªd &%02x‚Ù im¶em’‹d\n", 
ch376
->
commªd
);

2314 
ch376
->
š‹rçû_¡©us
 = 0;

2315 
ch376
->
commªd_¡©us
 = 
CH376_RET_ABORT
;

2319 
	`dbg_´štf
("<< [WRITE][COMMAND] Wr™commªd &%02x stu &%02x\n", 
ch376
->
commªd
, ch376->
commªd_¡©us
);

2320 
	}
}

2326 
	$ch376_wr™e_d©a_pÜt
(
ch376
 *ch376, 
CH376_U8
 
d©a
)

2328 
	`dbg_´štf
(">> [WRITE][DATA] Wr™d©¨&%02x stu &%02x\n", 
d©a
, 
ch376
->
commªd_¡©us
);

2330 
ch376
->
commªd
)

2332 
CH376_CMD_CHECK_EXIST
:

2333 
ch376
->
cmd_d©a
.
CMD_CheckBy‹
 = ~
d©a
;

2334 
	`dbg_´štf
("[WRITE][DATA][CH376_CMD_CHECK_EXIST] gÙ check by‹ &%02x\n", 
d©a
);

2337 
CH376_CMD_GET_FILE_SIZE
:

2339 ià(
d©a
 == 0x68)

2341 
CH376_S32
 
fže_size
 = 
	`sy¡em_g‘_fže_size
(&
ch376
->
cÚ‹xt
, ch376->
cu¼’t_fže
);

2343 
ch376
->
cmd_d©a
.
CMD_FžeSize
[0] = (
CH376_U8
)((
fže_size
 & 0x000000ff) >> 0);

2344 
ch376
->
cmd_d©a
.
CMD_FžeSize
[1] = (
CH376_U8
)((
fže_size
 & 0x0000ff00) >> 8);

2345 
ch376
->
cmd_d©a
.
CMD_FžeSize
[2] = (
CH376_U8
)((
fže_size
 & 0x00ff0000) >> 16);

2346 
ch376
->
cmd_d©a
.
CMD_FžeSize
[3] = (
CH376_U8
)((
fže_size
 & 0xff000000) >> 24);

2348 
ch376
->
nb_by‹s_š_cmd_d©a
 = (ch376->
cmd_d©a
.
CMD_FžeSize
);

2349 
ch376
->
pos_rw_š_cmd_d©a
 = 0;

2351 
	`dbg_´štf
("[WRITE][DATA][CH376_CMD_GET_FILE_SIZE] dÚe, fžsizi %d, wa™šg fÜ d©¨»ad\n", 
fže_size
);

2354 
ch376
->
š‹rçû_¡©us
 = 127;

2355 
ch376
->
commªd_¡©us
 = 
CH376_INT_SUCCESS
;

2359 
	`dbg_´štf
("[WRITE][DATA][CH376_CMD_GET_FILE_SIZE] wrÚg commªd by‹:†ookšg fÜ &68, gÙ &%02x\n", 
d©a
);

2361 
ch376
->
š‹rçû_¡©us
 = 0;

2362 
ch376
->
commªd_¡©us
 = 
CH376_RET_ABORT
;

2366 
CH376_CMD_SET_USB_MODE
:

2367 
	`ÿnûl_®l_io
(
ch376
);

2368 
d©a
)

2370 
CH376_ARG_SET_USB_MODE_USB_HOST
:

2371 
ch376
->
usb_mode
 = 
CH376_ARG_SET_USB_MODE_USB_HOST
;

2372 
	`dbg_´štf
("[WRITE][DATA][CH376_SET_USB_MODE] USB host set\n");

2374 
CH376_ARG_SET_USB_MODE_SD_HOST
:

2375 
ch376
->
usb_mode
 = 
CH376_ARG_SET_USB_MODE_SD_HOST
;

2376 
	`dbg_´štf
("[WRITE][DATA][CH376_SET_USB_MODE] SD card set\n");

2379 
ch376
->
usb_mode
 = 
CH376_ARG_SET_USB_MODE_INVALID
;

2380 
	`dbg_´štf
("[WRITE][DATA][CH376_SET_USB_MODE_CODE_INVALID] set\n");

2385 
CH376_CMD_SET_FILE_NAME
:

2386 
	`dbg_´štf
("[WRITE][DATA][CH376_CMD_SET_FILE_NAME] gÙ fžÇmch¬aù” \"%c\" (&%02xèfÜ…os™iÚ %d\n", 
d©a
, d©a, 
ch376
->
pos_rw_š_cmd_d©a
);

2388 if(
ch376
->
pos_rw_š_cmd_d©a
 < (ch376->
cmd_d©a
.
CMD_FžeName
))

2391 
ch376
->
cmd_d©a
.
CMD_FžeName
[ch376->
pos_rw_š_cmd_d©a
++] = 
d©a
;

2392 
ch376
->
cmd_d©a
.
CMD_FžeName
[ch376->
pos_rw_š_cmd_d©a
] = '\0';

2397 
CH376_CMD_BYTE_LOCATE
:

2398 if(
ch376
->
pos_rw_š_cmd_d©a
 < (ch376->
cmd_d©a
.
CMD_FžeS“k
))

2400 
	`dbg_´štf
("[WRITE][DATA][CH376_CMD_BYTE_LOCATE] gÙ by‹ #%d w™h v®u&%02x\n", 
ch376
->
pos_rw_š_cmd_d©a
, 
d©a
);

2401 
ch376
->
cmd_d©a
.
CMD_FžeS“k
[ch376->
pos_rw_š_cmd_d©a
] = 
d©a
;

2403 if(++
ch376
->
pos_rw_š_cmd_d©a
 =ð(ch376->
cmd_d©a
.
CMD_FžeS“k
))

2405 
CH376_S32
 
fže_£ek_pos
 = (
ch376
->
cmd_d©a
.
CMD_FžeS“k
[0] << 0)

2406 | (
ch376
->
cmd_d©a
.
CMD_FžeS“k
[1] << 8)

2407 | (
ch376
->
cmd_d©a
.
CMD_FžeS“k
[2] << 16)

2408 | (
ch376
->
cmd_d©a
.
CMD_FžeS“k
[3] << 24);

2410 
fže_£ek_pos
 = 
	`sy¡em_fže_£ek
(&
ch376
->
cÚ‹xt
, ch376->
cu¼’t_fže
, file_seek_pos);

2412 if(
fže_£ek_pos
 >= 0)

2414 
	`dbg_´štf
("[WRITE][DATA][CH376_CMD_BYTE_LOCATE]‡ll done: seek operated with success (waiting for data„ead)\n");

2416 
ch376
->
cmd_d©a
.
CMD_FžeS“k
[0] = (
CH376_U8
)((
fže_£ek_pos
 & 0x000000ff) >> 0);

2417 
ch376
->
cmd_d©a
.
CMD_FžeS“k
[1] = (
CH376_U8
)((
fže_£ek_pos
 & 0x0000ff00) >> 8);

2418 
ch376
->
cmd_d©a
.
CMD_FžeS“k
[2] = (
CH376_U8
)((
fže_£ek_pos
 & 0x00ff0000) >> 16);

2419 
ch376
->
cmd_d©a
.
CMD_FžeS“k
[3] = (
CH376_U8
)((
fže_£ek_pos
 & 0xff000000) >> 24);

2421 
ch376
->
nb_by‹s_š_cmd_d©a
 = (ch376->
cmd_d©a
.
CMD_FžeS“k
);

2422 
ch376
->
š‹rçû_¡©us
 = 127;

2423 
ch376
->
commªd_¡©us
 = 
CH376_INT_SUCCESS
;

2427 
	`dbg_´štf
("[WRITE][DATA][CH376_CMD_BYTE_LOCATE]‡ll done: seek failure\n");

2429 
ch376
->
š‹rçû_¡©us
 = 0;

2430 
ch376
->
commªd_¡©us
 = 
CH376_RET_ABORT
;

2436 
CH376_CMD_WR_REQ_DATA
:

2437 if(
ch376
->
nb_by‹s_š_cmd_d©a


2438 && 
ch376
->
pos_rw_š_cmd_d©a
 !ð
CMD_DATA_REQ_SIZE
)

2440 
CH376_U8
 *
¿w
 = (CH376_U8 *)&
ch376
->
cmd_d©a
;

2442 if(
ch376
->
nb_by‹s_š_cmd_d©a
 !ðch376->
pos_rw_š_cmd_d©a
)

2444 
¿w
[
ch376
->
pos_rw_š_cmd_d©a
] = 
d©a
;

2446 
	`dbg_´štf
("[WRITE][DATA][CH376_CMD_WR_REQ_DATA] wr™\"%c\" (&%02xètØi/Øbufã¸©…os™iÚ &%02x\n", 
d©a
, d©a, 
ch376
->
pos_rw_š_cmd_d©a
);

2448 if(++
ch376
->
pos_rw_š_cmd_d©a
 =ðch376->
nb_by‹s_š_cmd_d©a
)

2450 
ch376
->
š‹rçû_¡©us
 = 0;

2451 
ch376
->
commªd_¡©us
 = 
CH376_RET_SUCCESS
;

2457 
	`dbg_´štf
("[WRITE][DATA][CH376_CMD_WR_REQ_DATA]‚othingo writeo i/o buffer\n");

2459 
ch376
->
š‹rçû_¡©us
 = 0;

2460 
ch376
->
commªd_¡©us
 = 
CH376_RET_ABORT
;

2464 
CH376_CMD_BYTE_READ
:

2465 if(
ch376
->
pos_rw_š_cmd_d©a
 < (ch376->
cmd_d©a
.
CMD_FžeR—dWr™e
))

2467 
	`dbg_´štf
("[WRITE][DATA][CH376_CMD_BYTE_READ] gÙ by‹ #%d w™h v®u&%02x\n", 
ch376
->
pos_rw_š_cmd_d©a
, 
d©a
);

2468 
ch376
->
cmd_d©a
.
CMD_FžeR—dWr™e
[ch376->
pos_rw_š_cmd_d©a
] = 
d©a
;

2470 if(++
ch376
->
pos_rw_š_cmd_d©a
 =ð(ch376->
cmd_d©a
.
CMD_FžeR—dWr™e
))

2472 
ch376
->
by‹s_to_»ad_wr™e
 = (ch376->
cmd_d©a
.
CMD_FžeR—dWr™e
[0] << 0)

2473 | (
ch376
->
cmd_d©a
.
CMD_FžeR—dWr™e
[1] << 8);

2474 
	`fže_»ad_chunk
(
ch376
);

2479 
CH376_CMD_BYTE_WRITE
:

2480 if(
ch376
->
pos_rw_š_cmd_d©a
 < (ch376->
cmd_d©a
.
CMD_FžeR—dWr™e
))

2482 
	`dbg_´štf
("[WRITE][DATA][CH376_CMD_BYTE_WRITE] gÙ by‹ #%d w™h v®u&%02x\n", 
ch376
->
pos_rw_š_cmd_d©a
, 
d©a
);

2483 
ch376
->
cmd_d©a
.
CMD_FžeR—dWr™e
[ch376->
pos_rw_š_cmd_d©a
] = 
d©a
;

2485 if(++
ch376
->
pos_rw_š_cmd_d©a
 =ð(ch376->
cmd_d©a
.
CMD_FžeR—dWr™e
))

2487 
ch376
->
by‹s_to_»ad_wr™e
 = (ch376->
cmd_d©a
.
CMD_FžeR—dWr™e
[0] << 0)

2488 | (
ch376
->
cmd_d©a
.
CMD_FžeR—dWr™e
[1] << 8);

2490 if(
ch376
->
by‹s_to_»ad_wr™e
 > (ch376->
cmd_d©a
.
CMD_IOBufãr
))

2491 
ch376
->
nb_by‹s_š_cmd_d©a
 = (ch376->
cmd_d©a
.
CMD_IOBufãr
);

2493 
ch376
->
nb_by‹s_š_cmd_d©a
 = (
CH376_U8
)ch376->
by‹s_to_»ad_wr™e
;

2495 
ch376
->
š‹rçû_¡©us
 = 127;

2496 
ch376
->
commªd_¡©us
 = 
CH376_INT_SUCCESS
;

2501 
CH376_CMD_FILE_CLOSE
:

2503 
	`dbg_´štf
("[WRITE][DATA][CH376_CMD_FILE_CLOSE] upd©size: %s\n", 
ch376
->
pos_rw_š_cmd_d©a
 == 0 ? "no" : "yes");

2504 if(
ch376
->
cu¼’t_fže
)

2506 
	`sy¡em_fže_þo£
(&
ch376
->
cÚ‹xt
, ch376->
cu¼’t_fže
);

2507 
ch376
->
cu¼’t_fže
 = (
CH376_FILE
)0;

2509 
ch376
->
š‹rçû_¡©us
 = 127;

2510 
ch376
->
commªd_¡©us
 = 
CH376_INT_SUCCESS
;

2514 
	`dbg_´štf
("[WRITE][DATA][CH376_CMD_FILE_CLOSE] failure:‚ot file opened\n");

2516 
ch376
->
š‹rçû_¡©us
 = 0;

2517 
ch376
->
commªd_¡©us
 = 
CH376_RET_ABORT
;

2522 
	`dbg_´štf
("<< [WRITE][DATA] Wr™d©¨&%02x stu &%02x\n", 
d©a
, 
ch376
->
commªd_¡©us
);

2524 
	}
}

2530 
ch376
 * 
	$ch376_ü—‹
(*
u£r_d©a
)

2532 
ch376
 *ch376 = 
	`sy¡em_®loc_mem
((ch376));

2534 if(
ch376
)

2536 if(
	`sy¡em_š™_cÚ‹xt
(&
ch376
->
cÚ‹xt
, 
u£r_d©a
))

2538 
ch376
->
sdÿrd_drive_·th
 = 
	`þÚe_¡ršg
("ch376_sdcard_drive/");

2539 
ch376
->
usb_drive_·th
 = 
	`þÚe_¡ršg
("ch376_usb_drive/");

2540 
	`þ—r_¡ruùu»
(
ch376
);

2544 
	`sy¡em_ä“_mem
(
ch376
);

2545 
ch376
 = 
NULL
;

2548  
ch376
;

2549 
	}
}

2551 
	$ch376_de¡roy
(
ch376
 *ch376)

2553 
	`ÿnûl_®l_io
(
ch376
);

2554 
	`sy¡em_ä“_mem
(
ch376
->
sdÿrd_drive_·th
);

2555 
	`sy¡em_ä“_mem
(
ch376
->
usb_drive_·th
);

2556 
	`sy¡em_þ—n_cÚ‹xt
(&
ch376
->
cÚ‹xt
);

2557 
	`sy¡em_ä“_mem
(
ch376
);

2558 
	}
}

2560 
	$ch376_»£t
(
ch376
 *ch376)

2562 
	`ÿnûl_®l_io
(
ch376
);

2563 
	`þ—r_¡ruùu»
(
ch376
);

2564 
	}
}

2570 
	$ch376_£t_sdÿrd_drive_·th
(
ch376
 *ch376, cÚ¡ *
·th
)

2572 
	`dbg_´štf
("ch376_£t_sdÿrd_drive_·th: %s\n", 
·th
);

2573 
	`ÿnûl_®l_io
(
ch376
);

2574 
	`sy¡em_ä“_mem
(
ch376
->
sdÿrd_drive_·th
);

2575 
ch376
->
sdÿrd_drive_·th
 = 
	`þÚe_¡ršg
(
·th
);

2576 
	}
}

2578 
	$ch376_£t_usb_drive_·th
(
ch376
 *ch376, cÚ¡ *
·th
)

2580 
	`dbg_´štf
("ch376_£t_usb_drive_·th: %s\n", 
·th
);

2581 
	`ÿnûl_®l_io
(
ch376
);

2582 
	`sy¡em_ä“_mem
(
ch376
->
usb_drive_·th
);

2583 
ch376
->
usb_drive_·th
 = 
	`þÚe_¡ršg
(
·th
);

2584 
	}
}

2586 cÚ¡ * 
	$ch376_g‘_sdÿrd_drive_·th
(
ch376
 *ch376)

2588  
ch376
->
sdÿrd_drive_·th
;

2589 
	}
}

2591 cÚ¡ * 
	$ch376_g‘_usb_drive_·th
(
ch376
 *ch376)

2593  
ch376
->
usb_drive_·th
;

2594 
	}
}

	@plugins/ch376/ch376.h

12 #iâdeà
LOCAL_CH376_H


13 
	#LOCAL_CH376_H


	)

19 #ià
defšed
(
__MORPHOS__
è|| defšed (
__AMIGA__
è|| defšed (
__AROS__
)

21 #iâdeà
EXEC_TYPES_H


22 
	~<exec/ty³s.h
>

24 #iâdeà
DOS_DOS_H


25 
	~<dos/dos.h
>

28 
UBYTE
 
	tCH376_U8
;

29 
BYTE
 
	tCH376_S8
;

30 
UWORD
 
	tCH376_U16
;

31 
WORD
 
	tCH376_S16
;

32 
ULONG
 
	tCH376_U32
;

33 
LONG
 
	tCH376_S32
;

34 
UQUAD
 
	tCH376_U64
;

35 
QUAD
 
	tCH376_S64
;

36 
BOOL
 
	tCH376_BOOL
;

37 
BPTR
 
	tCH376_FILE
;

38 
BPTR
 
	tCH376_LOCK
;

39 
FžeInfoBlock
 * 
	tCH376_DIR
;

40 ¡ruù { 
Lib¿ry
 *
	mDOSBa£
; } 
	tCH376_CONTEXT
;

42 
	#CH376_TRUE
 
TRUE


	)

43 
	#CH376_FALSE
 
FALSE


	)

45 #iâdeà
UNUSED


46 
	#UNUSED
 
	`__©Œibu‹__
((
unu£d
))

	)

49 #–ià
defšed
(
WIN32
)

51 
	~<wšdows.h
>

53 
UINT8
 
	tCH376_U8
;

54 
INT8
 
	tCH376_S8
;

55 
UINT16
 
	tCH376_U16
;

56 
INT16
 
	tCH376_S16
;

57 
UINT32
 
	tCH376_U32
;

58 
INT32
 
	tCH376_S32
;

59 
UINT64
 
	tCH376_U64
;

60 
INT64
 
	tCH376_S64
;

61 
BOOL
 
	tCH376_BOOL
;

62 
HANDLE
 
	tCH376_FILE
;

63 
	s_CH376_LOCK
 { 
TCHAR
 
	m·th
[
MAX_PATH
]; 
HANDLE
 
	mhªdË
; } * 
	tCH376_LOCK
;

64 
WIN32_FIND_DATA
 * 
	tCH376_DIR
;

66 ¡ruù { *
	mdummy
; } 
	tCH376_CONTEXT
;

68 
	#CH376_TRUE
 
TRUE


	)

69 
	#CH376_FALSE
 
FALSE


	)

71 
	#UNUSED


	)

73 #–ià
defšed
(
__unix__
è|| defšed(
__APPLE__
è|| defšed(
__HAIKU__
è|| defšed(
__MINT__
)

75 
	~<¡dšt.h
>

76 
	~<¡dboÞ.h
>

77 
	~<¡dio.h
>

78 
	~<dœ’t.h
>

80 
ušt8_t
 
	tCH376_U8
;

81 
št8_t
 
	tCH376_S8
;

82 
ušt16_t
 
	tCH376_U16
;

83 
št16_t
 
	tCH376_S16
;

84 
ušt32_t
 
	tCH376_U32
;

85 
št32_t
 
	tCH376_S32
;

86 
ušt64_t
 
	tCH376_U64
;

87 
št64_t
 
	tCH376_S64
;

88 
boÞ
 
	tCH376_BOOL
;

89 
FILE
 * 
	tCH376_FILE
;

90 * 
	tCH376_LOCK
;

91 
	s_CH376_DIR
 { 
DIR
 *
	mhªdË
; 
dœ’t
 *
	m’Œy
; } * 
	tCH376_DIR
;

92 ¡ruù { *
	mdummy
; } 
	tCH376_CONTEXT
;

94 
	#CH376_TRUE
 
Œue


	)

95 
	#CH376_FALSE
 
çl£


	)

97 #iâdeà
UNUSED


98 
	#UNUSED
 
	`__©Œibu‹__
((
unu£d
))

	)

109 
	gch376
;

112 
ch376
 * 
ch376_ü—‹
(*
u£r_d©a
);

113 
ch376_de¡roy
(
ch376
 *ch376);

114 
ch376_»£t
(
ch376
 *ch376);

117 
ch376_£t_sdÿrd_drive_·th
(
ch376
 *ch376, cÚ¡ *
·th
);

118 
ch376_£t_usb_drive_·th
(
ch376
 *ch376, cÚ¡ *
·th
);

119 cÚ¡ * 
ch376_g‘_sdÿrd_drive_·th
(
ch376
 *ch376);

120 cÚ¡ * 
ch376_g‘_usb_drive_·th
(
ch376
 *ch376);

123 
ch376_wr™e_commªd_pÜt
(
ch376
 *ch376, 
CH376_U8
 
commªd
);

124 
ch376_wr™e_d©a_pÜt
(
ch376
 *ch376, 
CH376_U8
 
d©a
);

125 
CH376_U8
 
ch376_»ad_commªd_pÜt
(
ch376
 *ch376);

126 
CH376_U8
 
ch376_»ad_d©a_pÜt
(
ch376
 *ch376);

	@plugins/ch376/oric_ch376_plugin.c

1 #ià
SDL_MAJOR_VERSION
 == 1

2 #ifdeà
__SPECIFY_SDL_DIR__


3 
	~<SDL/SDL.h
>

5 
	~<SDL.h
>

8 #ifdeà
__SPECIFY_SDL_DIR__


9 
	~<SDL2/SDL.h
>

11 
	~<SDL.h
>

15 
	~"ch376.h
"

16 
	~"¡dio.h
"

18 
dbg_´štf
(*
fmt
, ...);

20 
	#CH376_ORIC_EXTENSION_DATA_PORT
 0x340

	)

21 
	#CH376_ORIC_EXTENSION_COMMAND_PORT
 0x341

	)

24 
ch376
 * 
	$ch376_Üic_š™
()

26  
	`ch376_ü—‹
(
NULL
);

27 
	}
}

29 
	$ch376_Üic_»£t
(
ch376
 *ch376)

31 
	`ch376_»£t
(
ch376
);

32 
	}
}

35 
	$ch376_Üic_de¡roy
(
ch376
 *ch376)

37 
	`ch376_de¡roy
(
ch376
);

38 
	}
}

40 
	$ch376_Üic_cÚfig
(
ch376
 *ch376)

42 
	`ch376_£t_sdÿrd_drive_·th
(
ch376
, "sdcard/");

43 
	`ch376_£t_usb_drive_·th
(
ch376
, "usbdrive/");

44 
	}
}

46 
	$ch376_Üic_wr™e
(
ch376
 *ch376, 
Ušt16
 
addr
, 
Ušt8
 
d©a
)

48 ià(
addr
 =ð
CH376_ORIC_EXTENSION_DATA_PORT
)

50 
	`ch376_wr™e_d©a_pÜt
(
ch376
, 
d©a
);

53 ià(
addr
 =ð
CH376_ORIC_EXTENSION_COMMAND_PORT
)

55 
	`ch376_wr™e_commªd_pÜt
(
ch376
, 
d©a
);

57 
	}
}

60 
	$ch376_Üic_»ad
(
ch376
 *ch376, 
Ušt16
 
addr
)

62 
‹mp
;

63 ià(
addr
 =ð
CH376_ORIC_EXTENSION_DATA_PORT
)

65 
‹mp
=
	`ch376_»ad_d©a_pÜt
(
ch376
);

66  
‹mp
;

69 ià(
addr
 =ð
CH376_ORIC_EXTENSION_COMMAND_PORT
)

71 
‹mp
=
	`ch376_»ad_commªd_pÜt
(
ch376
);

72  
‹mp
;

75 
	}
}

	@plugins/ch376/oric_ch376_plugin.h

1 
ch376
 * 
ch376_Üic_š™
();

2 
ch376_Üic_»£t
(
ch376
 *ch376);

3 
ch376_Üic_wr™e
(
ch376
 *ch376, 
Ušt16
 
addr
, 
Ušt8
 
d©a
);

4 
ch376_Üic_»ad
(
ch376
 *ch376, 
Ušt16
 
addr
);

5 
ch376_Üic_cÚfig
(
ch376
 *ch376);

6 
ch376_Üic_de¡roy
(
ch376
 *ch376);

7 
ch376_Üic_»£t
(
ch376
 *ch376);

	@render_gl.c

22 #ifdeà
__OPENGL_AVAILABLE__


24 
	~<¡dlib.h
>

25 
	~<¡dio.h
>

26 
	~<¡ršg.h
>

28 
	~"sy¡em.h
"

30 #ifdeà
WIN32


31 
	~<wšdows.h
>

34 #iâdeà
__APPLE__


36 
	~<GL/gl.h
>

38 
	~<O³nGL/gl.h
>

41 #ià
SDL_MAJOR_VERSION
 == 1

42 #ifdeà
__SPECIFY_SDL_DIR__


43 
	~<SDL/SDL_’dŸn.h
>

45 
	~<SDL_’dŸn.h
>

48 #ifdeà
__SPECIFY_SDL_DIR__


49 
	~<SDL2/SDL_’dŸn.h
>

51 
	~<SDL_’dŸn.h
>

55 
	~"6502.h
"

56 
	~"vŸ.h
"

57 
	~"8912.h
"

58 
	~"disk.h
"

59 
	~"gui.h
"

60 
	~"mÚ™Ü.h
"

61 
	~"6551.h
"

62 
	~"machše.h
"

63 
	~"»nd”_gl.h
"

64 
	~"uÏ.h
"

66 
	#TEX_VIDEO
 (0)

	)

67 
	#TEX_SCANLINES
 (1)

	)

68 
	#TEX_STATUS
 (2)

	)

69 
	#TEX_POPUP
 (3)

	)

71 
	#TEX_TZ
 (
TEX_POPUP
+1)

	)

72 
	#TEX_TZ_LAST
 ((
NUM_TZ
+
TEX_TZ
)-1)

	)

74 
	#TEX_GIMG
 (
TEX_TZ_LAST
+1)

	)

75 
	#TEX_GIMG_LAST
 ((
NUM_GIMG
+
TEX_GIMG
)-1)

	)

77 
	#NUM_TEXTURES
 (
TEX_GIMG_LAST
+1)

	)

79 
SDL_boÞ
 
»äesh¡©us
;

81 
	s‹xtu»


83 
	mw
, 
	mh
;

84 
	mtw
, 
	mth
;

85 
Ušt8
 *
	mbuf
;

88 
SDL_boÞ
 
	gdod–‹x
 = 
SDL_FALSE
;

89 
GLušt
 
	g‹x
[
NUM_TEXTURES
];

90 
‹xtu»
 
	gtx
[
NUM_TEXTURES
];

92 
SDL_Surçû
 *
	gsü“n
;

93 
Ušt32
 
	gg·l
[
NUM_GUI_COLS
];

95 
	gþrcÞ
[3];

97 
sg·l
[];

98 
SDL_boÞ
 
fuÎsü“n
;

99 
‹xtzÚe
 *
tz
[
NUM_TZ
];

100 
Ušt8
 
Üiý®‘‹
[];

101 
guiimg
 
gimgs
[
NUM_GIMG
];

104 
thefÚt
[];

113 
	$´štch¬
Ð
i
, 
x
, 
y
, 
ch
, 
Ušt32
 
fcÞ
, Ušt32 
bcÞ
, 
SDL_boÞ
 
sÞidfÚt
 )

115 
px
, 
py
, 
c
;

116 *
åŒ
;

117 
‹xtu»
 *
±x
 = &
tx
[
i
];

118 
Ušt32
 *
±r
;

120 ifÐ
ch
 > 127 ) ;

122 
±r
 = (
Ušt32
 *)&
±x
->
buf
[(
y
*±x->
w
+
x
)*4];

124 
åŒ
 = &
thefÚt
[
ch
*12];

126  
py
=0;…y<12;…y++ )

128  
c
=0x80, 
px
=0;…x<8;…x++, c>>=1 )

130 ifÐ(*
åŒ
)&
c
 )

132 *(
±r
++èð
fcÞ
;

134 ifÐ
sÞidfÚt
 )

135 *(
±r
++èð
bcÞ
;

137 
±r
++;

141 
±r
 +ð
±x
->
w
-8;

142 
åŒ
++;

144 
	}
}

146 
	$upd©e_‹xtzÚe_‹xtu»
Ð
machše
 *
Üic
, 
i
 )

148 
x
, 
y
, 
px
, 
py
, 
o
;

150 ifÐ!
tz
[
i
] ) ;

151 ifÐ!
tz
[
i
]->
modif›d
 ) ;

152 ifÐ!
tx
[
i
+
TEX_TZ
].
buf
 ) ;

154 
o
 = 0;

156  
y
=0, 
py
=0; y<
tz
[
i
]->
h
; y++,…y+=12 )

158  
x
=0, 
px
=0; x<
tz
[
i
]->
w
; x++, 
o
++,…x+=8 )

159 
	`´štch¬
Ð
i
+
TEX_TZ
, 
px
, 
py
, 
tz
[i]->
tx
[
o
], 
g·l
[tz[i]->
fc
[o]], g·l[tz[i]->
bc
[o]], 
SDL_TRUE
 );

162 
	`glBšdTextu»
Ð
GL_TEXTURE_2D
, 
‹x
[
i
+
TEX_TZ
] );

163 
	`glTexImage2D
Ð
GL_TEXTURE_2D
, 0, 
GL_RGBA
, 
tx
[
i
+
TEX_TZ
].
w
,x[i+TEX_TZ].
h
, 0, GL_RGBA, 
GL_UNSIGNED_BYTE
,x[i+TEX_TZ].
buf
 );

165 
tz
[
i
]->
modif›d
 = 
SDL_FALSE
;

166 
	}
}

168 
	$upd©e_video_‹xtu»
Ð
machše
 *
Üic
 )

170 
x
, 
y
, 
o
, 
c
;

171 
Ušt8
 *
¥Œ
;

173 
o
 = 0;

174 
¥Œ
 = 
Üic
->
sü
;

176  
y
=0; y<224; y++ )

178 ià(!
Üic
->
vid_dœty
[
y
])

180 
¥Œ
 += 240;

181 
o
 +ð
tx
[
TEX_VIDEO
].
w
*4;

185  
x
=0; x<240; x++ )

187 
c
 = *(
¥Œ
++) * 3;

188 
tx
[
TEX_VIDEO
].
buf
[
o
++] = 
Üiý®‘‹
[
c
++];

189 
tx
[
TEX_VIDEO
].
buf
[
o
++] = 
Üiý®‘‹
[
c
++];

190 
tx
[
TEX_VIDEO
].
buf
[
o
++] = 
Üiý®‘‹
[
c
++];

191 
tx
[
TEX_VIDEO
].
buf
[
o
++] = 0xff;

196 
tx
[
TEX_VIDEO
].
buf
[
o
++] = 
Üiý®‘‹
[
c
-3];

197 
tx
[
TEX_VIDEO
].
buf
[
o
++] = 
Üiý®‘‹
[
c
-2];

198 
tx
[
TEX_VIDEO
].
buf
[
o
++] = 
Üiý®‘‹
[
c
-1];

199 
tx
[
TEX_VIDEO
].
buf
[
o
++] = 0xff;

201 
o
 +ð(
tx
[
TEX_VIDEO
].
w
-241) * 4;

202 
Üic
->
vid_dœty
[
y
] = 
SDL_FALSE
;

205 
¥Œ
 -= 240;

206  
x
=0; x<240; x++ )

208 
c
 = *(
¥Œ
++) * 3;

209 
tx
[
TEX_VIDEO
].
buf
[
o
++] = 
Üiý®‘‹
[
c
++];

210 
tx
[
TEX_VIDEO
].
buf
[
o
++] = 
Üiý®‘‹
[
c
++];

211 
tx
[
TEX_VIDEO
].
buf
[
o
++] = 
Üiý®‘‹
[
c
++];

212 
tx
[
TEX_VIDEO
].
buf
[
o
++] = 0xff;

217 
tx
[
TEX_VIDEO
].
buf
[
o
++] = 
Üiý®‘‹
[
c
-3];

218 
tx
[
TEX_VIDEO
].
buf
[
o
++] = 
Üiý®‘‹
[
c
-2];

219 
tx
[
TEX_VIDEO
].
buf
[
o
++] = 
Üiý®‘‹
[
c
-1];

220 
tx
[
TEX_VIDEO
].
buf
[
o
++] = 0xff;

222 
	`glBšdTextu»
Ð
GL_TEXTURE_2D
, 
‹x
[
TEX_VIDEO
] );

223 
	`glTexImage2D
Ð
GL_TEXTURE_2D
, 0, 
GL_RGBA
, 
tx
[
TEX_VIDEO
].
w
,x[TEX_VIDEO].
h
, 0, GL_RGBA, 
GL_UNSIGNED_BYTE
,x[TEX_VIDEO].
buf
 );

224 
	}
}

226 
	$»nd”_begš_gl
Ð
machše
 *
Üic
 )

228 
i
;

229 
»äesh¡©us
 = 
SDL_TRUE
;

231 
	`upd©e_video_‹xtu»
Ð
Üic
 );

232  
i
=0; i<
NUM_TZ
; i++ )

233 
	`upd©e_‹xtzÚe_‹xtu»
Ð
Üic
, 
i
 );

235 ifÐ
Üic
->
ÃwpÝup¡r
 )

237 
	`mem£t
Ð
tx
[
TEX_POPUP
].
buf
, 0,x[TEX_POPUP].
w
*tx[TEX_POPUP].
h
*4 );

238  
i
=0; 
Üic
->
pÝup¡r
[i]; i++ )

239 
	`´štch¬
Ð
TEX_POPUP
, 
i
*8, 0, 
Üic
->
pÝup¡r
[i], 
g·l
[1], g·l[0], 
SDL_TRUE
 );

240 
	`glBšdTextu»
Ð
GL_TEXTURE_2D
, 
‹x
[
TEX_POPUP
] );

241 
	`glTexImage2D
Ð
GL_TEXTURE_2D
, 0, 
GL_RGBA
, 
tx
[
TEX_POPUP
].
w
,x[TEX_POPUP].
h
, 0, GL_RGBA, 
GL_UNSIGNED_BYTE
,x[TEX_POPUP].
buf
 );

242 
Üic
->
ÃwpÝup¡r
 = 
SDL_FALSE
;

245 ifÐ
Üic
->
Ãw¡©us¡r
 )

247 
	`mem£t
Ð
tx
[
TEX_STATUS
].
buf
, 0,x[TEX_STATUS].
w
*tx[TEX_STATUS].
h
*4 );

248  
i
=0; 
Üic
->
¡©us¡r
[i]; i++ )

249 
	`´štch¬
Ð
TEX_STATUS
, 
i
*8, 0, 
Üic
->
¡©us¡r
[i], 
g·l
[1], g·l[0], 
SDL_FALSE
 );

250 
	`glBšdTextu»
Ð
GL_TEXTURE_2D
, 
‹x
[
TEX_STATUS
] );

251 
	`glTexImage2D
Ð
GL_TEXTURE_2D
, 0, 
GL_RGBA
, 
tx
[
TEX_STATUS
].
w
,x[TEX_STATUS].
h
, 0, GL_RGBA, 
GL_UNSIGNED_BYTE
,x[TEX_STATUS].
buf
 );

254 
	`glCË¬CÞÜ
(
þrcÞ
[0], clrcol[1], clrcol[2], 1.0f);

255 
	`glCË¬
Ð
GL_COLOR_BUFFER_BIT
 | 
GL_DEPTH_BUFFER_BIT
 );

256 
	}
}

258 
	$»nd”_’d_gl
Ð
machše
 *
Üic
 )

260 ifÐ
Üic
->
emu_mode
 =ð
EM_RUNNING
 )

262 ifÐ
Üic
->
pÝup¡r
[0] )

264 
	`glBšdTextu»
Ð
GL_TEXTURE_2D
, 
‹x
[
TEX_POPUP
] );

265 
	`glBegš
Ð
GL_QUADS
 );

266 
	`glTexCoÜd2f
Ð0.0f, 0.0à); 
	`glV”‹x3f
( 320.0f, 0.0f, 0.0f );

267 
	`glTexCoÜd2f
Ð320.0f/512.0f, 0.0à); 
	`glV”‹x3f
( 640.0f, 0.0f, 0.0f );

268 
	`glTexCoÜd2f
Ð320.0f/512.0f, 12.0f/32.0à); 
	`glV”‹x3f
( 640.0f, 12.0f, 0.0f );

269 
	`glTexCoÜd2f
Ð0.0f, 12.0f/32.0à); 
	`glV”‹x3f
( 320.0f, 12.0f, 0.0f );

270 
	`glEnd
();

273 ifÐ
Üic
->
¡©us¡r
[0] )

275 
	`glBšdTextu»
Ð
GL_TEXTURE_2D
, 
‹x
[
TEX_STATUS
] );

276 
	`glBegš
Ð
GL_QUADS
 );

277 
	`glTexCoÜd2f
Ð0.0f, 0.0à); 
	`glV”‹x3f
( 0.0f, 466.0f, 0.0f );

278 
	`glTexCoÜd2f
Ð320.0f/512.0f, 0.0à); 
	`glV”‹x3f
( 320.0f, 466.0f, 0.0f );

279 
	`glTexCoÜd2f
Ð320.0f/512.0f, 12.0f/32.0à); 
	`glV”‹x3f
( 320.0f, 478.0f, 0.0f );

280 
	`glTexCoÜd2f
Ð0.0f, 12.0f/32.0à); 
	`glV”‹x3f
( 0.0f, 478.0f, 0.0f );

281 
	`glEnd
();

285 
	`SDL_COMPAT_GL_Sw­Bufãrs
();

286 
	}
}

288 
	$rounduµow2
Ð
x
 )

290 
x
--;

291 
x
 |= x >> 1;

292 
x
 |= x >> 2;

293 
x
 |= x >> 4;

294 
x
 |= x >> 8;

295 
x
 |= x >> 16;

296 
x
++;

298  
x
;

299 
	}
}

301 
	$»nd”_‹xtzÚe_®loc_gl
Ð
machše
 *
Üic
, 
i
 )

303 
	`»nd”_‹xtzÚe_ä“_gl
Ð
Üic
, 
i
 );

305 ifÐ!
tz
[
i
] ) ;

307 #ifdeà
__amigaos4__


312 
tx
[
i
+
TEX_TZ
].
w
 = 512;

313 
tx
[
i
+
TEX_TZ
].
h
 = 512;

315 
tx
[
i
+
TEX_TZ
].
w
 = 
	`rounduµow2
Ð
tz
[i]->w * 8 );

316 
tx
[
i
+
TEX_TZ
].
h
 = 
	`rounduµow2
Ð
tz
[i]->h * 12 );

318 
tx
[
i
+
TEX_TZ
].
buf
 = 
	`m®loc
Ðtx[i+TEX_TZ].
w
*tx[i+TEX_TZ].
h
*4 );

319 ifÐ!
tx
[
i
+
TEX_TZ
].
buf
 )

321 
tx
[
i
+
TEX_TZ
].
w
 = 0;

322 
tx
[
i
+
TEX_TZ
].
h
 = 0;

326 
tx
[
i
+
TEX_TZ
].
tw
 = (()(
tz
[i]->
w
*8)) / (()tx[i+TEX_TZ].w);

327 
tx
[
i
+
TEX_TZ
].
th
 = (()(
tz
[i]->
h
*12)) / (()tx[i+TEX_TZ].h);

329 
	`glBšdTextu»
Ð
GL_TEXTURE_2D
, 
‹x
[
i
+
TEX_TZ
] );

330 
	`glTexP¬am‘”i
Ð
GL_TEXTURE_2D
, 
GL_TEXTURE_WRAP_S
, 
GL_REPEAT
 );

331 
	`glTexP¬am‘”i
Ð
GL_TEXTURE_2D
, 
GL_TEXTURE_WRAP_T
, 
GL_REPEAT
 );

332 
	`glTexP¬am‘”i
Ð
GL_TEXTURE_2D
, 
GL_TEXTURE_MAG_FILTER
, 
GL_LINEAR
 );

333 
	`glTexP¬am‘”i
Ð
GL_TEXTURE_2D
, 
GL_TEXTURE_MIN_FILTER
, 
GL_LINEAR
 );

334 
	`glTexImage2D
Ð
GL_TEXTURE_2D
, 0, 
GL_RGBA
, 
tx
[
i
+
TEX_TZ
].
w
,x[i+TEX_TZ].
h
, 0, GL_RGBA, 
GL_UNSIGNED_BYTE
,x[i+TEX_TZ].
buf
 );

336 
tz
[
i
]->
modif›d
 = 
SDL_TRUE
;

337 
	}
}

339 
	$»nd”_‹xtzÚe_ä“_gl
Ð
machše
 *
Üic
, 
i
 )

341 ifÐ
tx
[
i
+
TEX_TZ
].
buf
 )

343 
	`ä“
Ð
tx
[
i
+
TEX_TZ
].
buf
 );

344 
tx
[
i
+
TEX_TZ
].
buf
 = 
NULL
;

347 
tx
[
i
+
TEX_TZ
].
w
 = 0;

348 
tx
[
i
+
TEX_TZ
].
h
 = 0;

349 
	}
}

351 
	$»nd”_‹xtzÚe_gl
Ð
machše
 *
Üic
, 
i
 )

353 ifÐ!
tz
[
i
] ) ;

354 ifÐ!
tx
[
i
+
TEX_TZ
].
buf
 ) ;

356 
	`glBšdTextu»
Ð
GL_TEXTURE_2D
, 
‹x
[
i
+
TEX_TZ
] );

357 
	`glBegš
Ð
GL_QUADS
 );

358 
	`glTexCoÜd2f
Ð0.0f, 0.0à); 
	`glV”‹x3f
Ð
tz
[
i
]->
x
,z[i]->
y
, 0.0f );

359 
	`glTexCoÜd2f
Ð
tx
[
i
+
TEX_TZ
].
tw
, 0.0à); 
	`glV”‹x3f
Ð
tz
[i]->
x
+tz[i]->
w
*8,z[i]->
y
, 0.0f );

360 
	`glTexCoÜd2f
Ð
tx
[
i
+
TEX_TZ
].
tw
,x[i+TEX_TZ].
th
 ); 
	`glV”‹x3f
Ð
tz
[i]->
x
+tz[i]->
w
*8,z[i]->
y
+tz[i]->
h
*12, 0.0f );

361 
	`glTexCoÜd2f
Ð0.0f, 
tx
[
i
+
TEX_TZ
].
th
 ); 
	`glV”‹x3f
Ð
tz
[i]->
x
,z[i]->
y
+tz[i]->
h
*12, 0.0f );

362 
	`glEnd
();

363 
	}
}

365 
	$»nd”_þ—r_¬—_gl
Ð
x
, 
y
, 
w
, 
h
 )

367 
	}
}

369 
	$»nd”_gimg_gl
Ð
i
, 
Sšt32
 
xp
, Sšt32 
yp
 )

371 
	`glBšdTextu»
Ð
GL_TEXTURE_2D
, 
‹x
[
i
+
TEX_GIMG
] );

372 
	`glBegš
Ð
GL_QUADS
 );

373 
	`glTexCoÜd2f
Ð0.0f, 0.0à); 
	`glV”‹x3f
Ð
xp
, 
yp
, 0.0f );

374 
	`glTexCoÜd2f
Ð
tx
[
i
+
TEX_GIMG
].
tw
, 0.0à); 
	`glV”‹x3f
Ð
xp
+
gimgs
[i].
w
, 
yp
, 0.0f );

375 
	`glTexCoÜd2f
Ð
tx
[
i
+
TEX_GIMG
].
tw
,x[i+TEX_GIMG].
th
 ); 
	`glV”‹x3f
Ð
xp
+
gimgs
[i].
w
, 
yp
+gimgs[i].
h
, 0.0f );

376 
	`glTexCoÜd2f
Ð0.0f, 
tx
[
i
+
TEX_GIMG
].
th
 ); 
	`glV”‹x3f
Ð
xp
, 
yp
+
gimgs
[i].
h
, 0.0f );

377 
	`glEnd
();

378 
	}
}

380 
	$»nd”_gimg·¹_gl
Ð
i
, 
Sšt32
 
xp
, Sšt32 
yp
, Sšt32 
ox
, Sšt32 
oy
, Sšt32 
w
, Sšt32 
h
 )

382 
‹xl
, 
‹xt
, 
‹xr
, 
‹xb
;

384 
‹xl
 = (()
ox
)/(()
tx
[
i
+
TEX_GIMG
].
w
);

385 
‹xt
 = (()
oy
)/(()
tx
[
i
+
TEX_GIMG
].
h
);

386 
‹xr
 = (()
ox
+
w
)/(()
tx
[
i
+
TEX_GIMG
].w);

387 
‹xb
 = (()
oy
+
h
)/(()
tx
[
i
+
TEX_GIMG
].h);

389 
	`glBšdTextu»
Ð
GL_TEXTURE_2D
, 
‹x
[
i
+
TEX_GIMG
] );

390 
	`glBegš
Ð
GL_QUADS
 );

391 
	`glTexCoÜd2f
Ð
‹xl
, 
‹xt
 ); 
	`glV”‹x3f
Ð
xp
, 
yp
, 0.0f );

392 
	`glTexCoÜd2f
Ð
‹xr
, 
‹xt
 ); 
	`glV”‹x3f
Ð
xp
+
w
, 
yp
, 0.0f );

393 
	`glTexCoÜd2f
Ð
‹xr
, 
‹xb
 ); 
	`glV”‹x3f
Ð
xp
+
w
, 
yp
+
h
, 0.0f );

394 
	`glTexCoÜd2f
Ð
‹xl
, 
‹xb
 ); 
	`glV”‹x3f
Ð
xp
, 
yp
+
h
, 0.0f );

395 
	`glEnd
();

396 
	}
}

398 
	$»nd”_video_gl
Ð
machše
 *
Üic
, 
SDL_boÞ
 
doubËsize
 )

400 
l
, 
r
, 
t
, 
b
;

401 
y
;

403 
	`glBšdTextu»
Ð
GL_TEXTURE_2D
, 
‹x
[
TEX_VIDEO
] );

405 ifÐ
doubËsize
 )

407 ifÐ
Üic
->
h¡»tch
 )

409 
l
 = 0.0f;

410 
r
 = 640.f;

411 
t
 = 14.0f;

412 
b
 = 462.0f;

414 
l
 = 320.0f-240.0f;

415 
r
 = 320.0f+240.0f;

416 ifÐ
Üic
->
¬©io
 && oric->
vid_äeq
 )

418 
t
 = 14.0f + (448.0f-448.0f*(260.0f/308.0f))/2;

419 
b
 = 462.0f - (448.0f-448.0f*(260.0f/308.0f))/2;

423 
t
 = 14.0f;

424 
b
 = 462.0f;

428 
	`glBegš
Ð
GL_QUADS
 );

429 
	`glTexCoÜd2f
Ð0.0f, 0.0à); 
	`glV”‹x3f
Ð
l
, 
t
, 0.0f );

430 
	`glTexCoÜd2f
Ð240.0f/256.0f, 0.0à); 
	`glV”‹x3f
Ð
r
, 
t
, 0.0f );

431 
	`glTexCoÜd2f
Ð240.0f/256.0f, 224.0f/256.0à); 
	`glV”‹x3f
Ð
r
, 
b
, 0.0f );

432 
	`glTexCoÜd2f
Ð0.0f, 224.0f/256.0à); 
	`glV”‹x3f
Ð
l
, 
b
, 0.0f );

433 
	`glEnd
();

435 ifÐ
Üic
->
·lgho¡
 )

437 
offs
 = (
Üic
->
h¡»tch
) ? 3.2f : 2.2f;

438 
	`glCÞÜ4ub
( 255, 255, 255, 64 );

439 
	`glBegš
Ð
GL_QUADS
 );

440 
	`glTexCoÜd2f
Ð0.0f, 0.0à); 
	`glV”‹x3f
Ð
l
+
offs
, 
t
, 0.0f );

441 
	`glTexCoÜd2f
Ð240.0f/256.0f, 0.0à); 
	`glV”‹x3f
Ð
r
+
offs
, 
t
, 0.0f );

442 
	`glTexCoÜd2f
Ð240.0f/256.0f, 224.0f/256.0à); 
	`glV”‹x3f
Ð
r
+
offs
, 
b
, 0.0f );

443 
	`glTexCoÜd2f
Ð0.0f, 224.0f/256.0à); 
	`glV”‹x3f
Ð
l
+
offs
, 
b
, 0.0f );

444 
	`glEnd
();

445 
	`glCÞÜ4ub
( 255, 255, 255, 255 );

448 ifÐ!
Üic
->
sÿÆšes
 ) ;

450 
	`glBšdTextu»
Ð
GL_TEXTURE_2D
, 
‹x
[
TEX_SCANLINES
] );

451 
	`glBegš
Ð
GL_QUADS
 );

452  
y
=14; y<224*2+14; y+=32 )

454 
	`glTexCoÜd2f
Ð0.0f, 0.0à); 
	`glV”‹x3f
Ð
l
, 
y
, 0.0f );

455 
	`glTexCoÜd2f
Ð1.0f, 0.0à); 
	`glV”‹x3f
Ð
r
, 
y
, 0.0f );

456 
	`glTexCoÜd2f
Ð1.0f, 1.0à); 
	`glV”‹x3f
Ð
r
, 
y
+32, 0.0f );

457 
	`glTexCoÜd2f
Ð0.0f, 1.0à); 
	`glV”‹x3f
Ð
l
, 
y
+32, 0.0f );

459 
	`glEnd
();

463 
	`glBegš
Ð
GL_QUADS
 );

464 
	`glTexCoÜd2f
Ð0.0f, 0.0à); 
	`glV”‹x3f
( 0.0f, 4.0f, 0.0f );

465 
	`glTexCoÜd2f
Ð240.0f/256.0f, 0.0à); 
	`glV”‹x3f
( 240.0f, 4.0f, 0.0f );

466 
	`glTexCoÜd2f
Ð240.0f/256.0f, 224.0f/256.0à); 
	`glV”‹x3f
( 240.0f, 228.0f, 0.0f );

467 
	`glTexCoÜd2f
Ð0.0f, 224.0f/256.0à); 
	`glV”‹x3f
( 0.0f, 228.0f, 0.0f );

468 
	`glEnd
();

469 
	}
}

471 
	$´eš™_»nd”_gl
Ð
machše
 *
Üic
 )

473 
Sšt32
 
i
;

475 
sü“n
 = 
NULL
;

476 
dod–‹x
 = 
SDL_FALSE
;

478  
i
=0; i<
NUM_TEXTURES
; i++ )

480 
tx
[
i
].
w
 = 0;

481 
tx
[
i
].
h
 = 0;

482 
tx
[
i
].
buf
 = 
NULL
;

484 
	}
}

486 
SDL_boÞ
 
	$»nd”_toggËfuÎsü“n_gl
Ð
machše
 *
Üic
 )

488 #ià
	`defšed
(
__amigaos4__
è|| defšed(
__lšux__
)

490 ifÐ
	`SDL_COMPAT_WM_ToggËFuÎSü“n
Ð
sü“n
 ) )

492 
fuÎsü“n
 = !fullscreen;

493  
SDL_TRUE
;

496  
SDL_FALSE
;

498 
Üic
->
	`shut_»nd”
( oric );

499 
fuÎsü“n
 = !fullscreen;

500 ifÐ
Üic
->
	`š™_»nd”
ÐÜiøèè 
SDL_TRUE
;

501 
	`£t_»nd”_mode
Ð
Üic
, 
RENDERMODE_NULL
 );

502 
Üic
->
emu_mode
 = 
EM_PLEASEQUIT
;

503  
SDL_FALSE
;

505 
	}
}

507 
SDL_boÞ
 
	$go_go_gadg‘_‹xtu»
Ð
i
, 
w
, 
h
, 
bËndty³
, 
SDL_boÞ
 
ÿÎ‹ximg2d
 )

509 
tx
[
i
].
w
 = w;

510 
tx
[
i
].
h
 = h;

511 
tx
[
i
].
buf
 = 
	`m®loc
Ð
w
*
h
*4 );

512 ifÐ!
tx
[
i
].
buf
 )  
SDL_FALSE
;

514 
	`mem£t
Ð
tx
[
i
].
buf
, 0, 
w
*
h
*4 );

516 
	`glBšdTextu»
Ð
GL_TEXTURE_2D
, 
‹x
[
i
] );

517 
	`glTexP¬am‘”i
Ð
GL_TEXTURE_2D
, 
GL_TEXTURE_WRAP_S
, 
GL_CLAMP
 );

518 
	`glTexP¬am‘”i
Ð
GL_TEXTURE_2D
, 
GL_TEXTURE_WRAP_T
, 
GL_CLAMP
 );

519 
	`glTexP¬am‘”i
Ð
GL_TEXTURE_2D
, 
GL_TEXTURE_MAG_FILTER
, 
bËndty³
 );

520 
	`glTexP¬am‘”i
Ð
GL_TEXTURE_2D
, 
GL_TEXTURE_MIN_FILTER
, 
bËndty³
 );

521 ifÐ
ÿÎ‹ximg2d
 )
	`glTexImage2D
Ð
GL_TEXTURE_2D
, 0, 
GL_RGBA
, 
w
, 
h
, 0, GL_RGBA, 
GL_UNSIGNED_BYTE
, 
tx
[
i
].
buf
 );

523  
SDL_TRUE
;

524 
	}
}

526 
SDL_boÞ
 
	$š™_»nd”_gl
Ð
machše
 *
Üic
 )

528 
d•th
, 
i
, 
x
, 
y
;

529 
B™sP”Pix–
 = 
	`SDL_COMPAT_G‘B™sP”Pix–
();

531 
d•th
 = 32;

532 ifÐ
B™sP”Pix–
 )

533 
d•th
 = 
B™sP”Pix–
;

535 ià(
Üic
->
show_keybßrd
) {

536 
sü“n
 = 
	`SDL_COMPAT_S‘VideoMode
Ð640, 480+240, 
d•th
, 
fuÎsü“n
 ? 
SDL_COMPAT_OPENGL
|
SDL_COMPAT_FULLSCREEN
 : SDL_COMPAT_OPENGL );

538 
sü“n
 = 
	`SDL_COMPAT_S‘VideoMode
Ð640, 480, 
d•th
, 
fuÎsü“n
 ? 
SDL_COMPAT_OPENGL
|
SDL_COMPAT_FULLSCREEN
 : SDL_COMPAT_OPENGL );

541 ifÐ!
sü“n
 )

543 
	`´štf
( "SDL video failed\n" );

544  
SDL_FALSE
;

547 
	`glM©rixMode
Ð
GL_PROJECTION
 );

548 ià(
Üic
->
show_keybßrd
) {

549 
	`glO¹ho
( 0.0f, 640.0f, 480.0f+240.0f, 0.0f, 0.0f, 1.0f );

551 
	`glO¹ho
( 0.0f, 640.0f, 480.0f, 0.0f, 0.0f, 1.0f );

553 
	`glM©rixMode
Ð
GL_MODELVIEW
 );

554 
	`glLßdId’t™y
();

555 
	`glDi§bË
Ð
GL_DEPTH_TEST
 );

556 
	`glCÞÜ4ub
( 255, 255, 255, 255 );

558 
	`glG’Textu»s
Ð
NUM_TEXTURES
, 
‹x
 );

559 
dod–‹x
 = 
SDL_TRUE
;

561 
	`glBËndFunc
Ð
GL_SRC_ALPHA
, 
GL_ONE_MINUS_SRC_ALPHA
 );

562 
	`glEÇbË
Ð
GL_TEXTURE_2D
 );

563 
	`glEÇbË
Ð
GL_BLEND
 );

566 ifÐ!
	`go_go_gadg‘_‹xtu»
Ð
TEX_VIDEO
, 256, 256, 
GL_LINEAR
, 
SDL_TRUE
 ) )  
SDL_FALSE
;

567 ifÐ!
	`go_go_gadg‘_‹xtu»
Ð
TEX_SCANLINES
, 32, 32, 
GL_NEAREST
, 
SDL_FALSE
 ) )  SDL_FALSE;

568 ifÐ!
	`go_go_gadg‘_‹xtu»
Ð
TEX_STATUS
, 512, 32, 
GL_NEAREST
, 
SDL_TRUE
 ) )  
SDL_FALSE
;

569 ifÐ!
	`go_go_gadg‘_‹xtu»
Ð
TEX_POPUP
, 512, 32, 
GL_NEAREST
, 
SDL_TRUE
 ) )  
SDL_FALSE
;

571  
y
=0; y<32; y++ )

573  
x
=0; x<32*4; )

575 
tx
[
TEX_SCANLINES
].
buf
[
y
*32*4+
x
++] = 0x00;

576 
tx
[
TEX_SCANLINES
].
buf
[
y
*32*4+
x
++] = 0x00;

577 
tx
[
TEX_SCANLINES
].
buf
[
y
*32*4+
x
++] = 0x00;

578 
tx
[
TEX_SCANLINES
].
buf
[
y
*32*4+
x
++] = (y&1) ? 0x30 : 0x00;

581 
	`glBšdTextu»
Ð
GL_TEXTURE_2D
, 
‹x
[
TEX_SCANLINES
] );

582 
	`glTexImage2D
Ð
GL_TEXTURE_2D
, 0, 
GL_RGBA
, 
tx
[
TEX_SCANLINES
].
w
,x[TEX_SCANLINES].
h
, 0, GL_RGBA, 
GL_UNSIGNED_BYTE
,x[TEX_SCANLINES].
buf
 );

584  
i
=0; i<
NUM_GIMG
; i++ )

586 ifÐ!
	`go_go_gadg‘_‹xtu»
Ð
i
+
TEX_GIMG
, 
	`rounduµow2
Ð
gimgs
[i].
w
 ),„ounduµow2Ðgimgs[i].
h
 ), 
GL_NEAREST
, 
SDL_FALSE
 ) )  SDL_FALSE;

588 
tx
[
i
+
TEX_GIMG
].
tw
 = (()
gimgs
[i].
w
) / (()tx[i+TEX_GIMG].w);

589 
tx
[
i
+
TEX_GIMG
].
th
 = (()
gimgs
[i].
h
) / (()tx[i+TEX_GIMG].h);

591  
y
=0; y<
gimgs
[
i
].
h
; y++ )

593  
x
=0; x<
gimgs
[
i
].
w
; x++ )

595 
tx
[
i
+
TEX_GIMG
].
buf
[(
y
*tx[i+TEX_GIMG].
w
+
x
)*4 ] = 
gimgs
[i].buf[(y*gimgs[i].w+x)*3];

596 
tx
[
i
+
TEX_GIMG
].
buf
[(
y
*tx[i+TEX_GIMG].
w
+
x
)*4+1] = 
gimgs
[i].buf[(y*gimgs[i].w+x)*3+1];

597 
tx
[
i
+
TEX_GIMG
].
buf
[(
y
*tx[i+TEX_GIMG].
w
+
x
)*4+2] = 
gimgs
[i].buf[(y*gimgs[i].w+x)*3+2];

598 
tx
[
i
+
TEX_GIMG
].
buf
[(
y
*tx[i+TEX_GIMG].
w
+
x
)*4+3] = 0xff;

601 
	`glTexImage2D
Ð
GL_TEXTURE_2D
, 0, 
GL_RGBA
, 
tx
[
i
+
TEX_GIMG
].
w
,x[i+TEX_GIMG].
h
, 0, GL_RGBA, 
GL_UNSIGNED_BYTE
,x[i+TEX_GIMG].
buf
 );

605  
i
=0; i<
NUM_GUI_COLS
; i++ )

607 
g·l
[
i
] = (
sg·l
[i*3]<<24)|(sgpal[i*3+1]<<16)|(sgpal[i*3+2]<<8)|0xff;

608 
g·l
[
i
] = 
	`_BE32
( gpal[i] );

611  
i
=0; i<
NUM_TZ
; i++ )

612 
	`»nd”_‹xtzÚe_®loc_gl
Ð
Üic
, 
i
 );

614 
	`SDL_COMPAT_WM_S‘C­tiÚ
Ð
APP_NAME_FULL
, APP_NAME_FULL );

616 
þrcÞ
[0] = (()
sg·l
[0*3+0])/255.0f;

617 
þrcÞ
[1] = (()
sg·l
[0*3+1])/255.0f;

618 
þrcÞ
[2] = (()
sg·l
[0*3+2])/255.0f;

620 
	`uÏ_£t_dœty
Ð
Üic
 );

622  
SDL_TRUE
;

623 
	}
}

625 
	$shut_»nd”_gl
Ð
machše
 *
Üic
 )

627 
i
;

629 ifÐ
dod–‹x
 )

631 
	`glD–‘eTextu»s
Ð
NUM_TEXTURES
, 
‹x
 );

632 
dod–‹x
 = 
SDL_FALSE
;

635  
i
=0; i<
NUM_TEXTURES
; i++ )

637 ifÐ
tx
[
i
].
buf
 ) 
	`ä“
(x[i].buf );

638 
tx
[
i
].
buf
 = 
NULL
;

639 
tx
[
i
].
w
 = 0;

640 
tx
[
i
].
h
 = 0;

642 
	}
}

	@render_gl.h

22 #ifdeà
__OPENGL_AVAILABLE__


24 
»nd”_begš_gl
Ð
machše
 *
Üic
 );

25 
»nd”_’d_gl
Ð
machše
 *
Üic
 );

26 
»nd”_‹xtzÚe_®loc_gl
Ð
machše
 *
Üic
, 
i
 );

27 
»nd”_‹xtzÚe_ä“_gl
Ð
machše
 *
Üic
, 
i
 );

28 
»nd”_‹xtzÚe_gl
Ð
machše
 *
Üic
, 
i
 );

29 
»nd”_þ—r_¬—_gl
Ð
x
, 
y
, 
w
, 
h
 );

30 
»nd”_gimg_gl
Ð
i
, 
Sšt32
 
xp
, Sšt32 
yp
 );

31 
»nd”_gimg·¹_gl
Ð
i
, 
Sšt32
 
xp
, Sšt32 
yp
, Sšt32 
ox
, Sšt32 
oy
, Sšt32 
w
, Sšt32 
h
 );

32 
»nd”_video_gl
Ð
machše
 *
Üic
, 
SDL_boÞ
 
doubËsize
 );

33 
´eš™_»nd”_gl
Ð
machše
 *
Üic
 );

34 
SDL_boÞ
 
š™_»nd”_gl
Ð
machše
 *
Üic
 );

35 
SDL_boÞ
 
»nd”_toggËfuÎsü“n_gl
Ð
machše
 *
Üic
 );

36 
shut_»nd”_gl
Ð
machše
 *
Üic
 );

	@render_null.c

22 
	~"sy¡em.h
"

23 
	~"6502.h
"

24 
	~"vŸ.h
"

25 
	~"8912.h
"

26 
	~"disk.h
"

27 
	~"gui.h
"

28 
	~"mÚ™Ü.h
"

29 
	~"6551.h
"

30 
	~"machše.h
"

31 
	~"»nd”_nuÎ.h
"

33 
	$»nd”_begš_nuÎ
Ð
machše
 *
Üic
 )

35 
	}
}

37 
	$»nd”_’d_nuÎ
Ð
machše
 *
Üic
 )

39 
	}
}

41 
	$»nd”_‹xtzÚe_®loc_nuÎ
Ð
machše
 *
Üic
, 
i
 )

43 
	}
}

45 
	$»nd”_‹xtzÚe_ä“_nuÎ
Ð
machše
 *
Üic
, 
i
 )

47 
	}
}

49 
	$»nd”_‹xtzÚe_nuÎ
Ð
machše
 *
Üic
, 
i
 )

51 
	}
}

53 
	$»nd”_þ—r_¬—_nuÎ
Ð
x
, 
y
, 
w
, 
h
 )

55 
	}
}

57 
	$»nd”_gimg_nuÎ
Ð
i
, 
Sšt32
 
xp
, Sšt32 
yp
 )

59 
	}
}

61 
	$»nd”_gimg·¹_nuÎ
Ð
i
, 
Sšt32
 
xp
, Sšt32 
yp
, Sšt32 
ox
, Sšt32 
oy
, Sšt32 
w
, Sšt32 
h
 )

63 
	}
}

65 
	$»nd”_video_nuÎ
Ð
machše
 *
Üic
, 
SDL_boÞ
 
doubËsize
 )

67 
	}
}

69 
SDL_boÞ
 
	$»nd”_toggËfuÎsü“n_nuÎ
Ð
machše
 *
Üic
 )

71  
SDL_TRUE
;

72 
	}
}

74 
SDL_boÞ
 
	$š™_»nd”_nuÎ
Ð
machše
 *
Üic
 )

76  
SDL_TRUE
;

77 
	}
}

79 
	$shut_»nd”_nuÎ
Ð
machše
 *
Üic
 )

81 
	}
}

	@render_null.h

22 
»nd”_begš_nuÎ
Ð
machše
 *
Üic
 );

23 
»nd”_’d_nuÎ
Ð
machše
 *
Üic
 );

24 
»nd”_‹xtzÚe_®loc_nuÎ
Ð
machše
 *
Üic
, 
i
 );

25 
»nd”_‹xtzÚe_ä“_nuÎ
Ð
machše
 *
Üic
, 
i
 );

26 
»nd”_‹xtzÚe_nuÎ
Ð
machše
 *
Üic
, 
i
 );

27 
»nd”_þ—r_¬—_nuÎ
Ð
x
, 
y
, 
w
, 
h
 );

28 
»nd”_gimg_nuÎ
Ð
i
, 
Sšt32
 
xp
, Sšt32 
yp
 );

29 
»nd”_gimg·¹_nuÎ
Ð
i
, 
Sšt32
 
xp
, Sšt32 
yp
, Sšt32 
ox
, Sšt32 
oy
, Sšt32 
w
, Sšt32 
h
 );

30 
»nd”_video_nuÎ
Ð
machše
 *
Üic
, 
SDL_boÞ
 
doubËsize
 );

31 
SDL_boÞ
 
»nd”_toggËfuÎsü“n_nuÎ
Ð
machše
 *
Üic
 );

32 
´eš™_»nd”_nuÎ
Ð
machše
 *
Üic
 );

33 
SDL_boÞ
 
š™_»nd”_nuÎ
Ð
machše
 *
Üic
 );

34 
shut_»nd”_nuÎ
Ð
machše
 *
Üic
 );

	@render_sw.c

22 
	~<¡dlib.h
>

23 
	~<¡ršg.h
>

25 
	~"sy¡em.h
"

26 
	~"6502.h
"

27 
	~"vŸ.h
"

28 
	~"8912.h
"

29 
	~"disk.h
"

30 
	~"gui.h
"

31 
	~"mÚ™Ü.h
"

32 
	~"6551.h
"

33 
	~"machše.h
"

34 
	~"»nd”_sw.h
"

35 
	~"uÏ.h
"

37 
SDL_Surçû
 *
	gsü“n
;

38 
Ušt32
 
	gg·l
[
NUM_GUI_COLS
];

40 
Ušt32
 
	gpix–_size
, 
	goff£t_tÝ
;

41 
Ušt32
 
	g·l
[8*2];

42 
Ušt32
 
	gd·l
[8*2];

43 
Ušt8
 *
	gmgimg
[
NUM_GIMG
];

45 
SDL_boÞ
 
fuÎsü“n
, 
hwsurçû
;

46 
SDL_boÞ
 
	gÃedþr
;

47 
‹xtzÚe
 *
tz
[
NUM_TZ
];

48 
sg·l
[];

49 
Ušt8
 
Üiý®‘‹
[];

50 
guiimg
 
gimgs
[
NUM_GIMG
];

51 
SDL_boÞ
 
»äesh¡©us
;

54 
thefÚt
[];

57 (*
´štch¬
)Ð
Ušt8
*, , 
Ušt32
, Ušt32, 
SDL_boÞ
 );

60 
	$SDL_boÞ
 (*
guiimg_to_img
)(
Ušt8
** 
d¡
, cÚ¡ 
guiimg
* 
¤c
);

70 
	#DEFINE_´štch¬_X_bµ
(
BIT_DEPTH
) \

71 
´štch¬_
 ## 
BIT_DEPTH
 ## 
bµ
 \

72 Ð
Ušt8
* 
±r
, 
ch
, 
Ušt32
 
fcÞ
, Ušt32 
bcÞ
, 
SDL_boÞ
 
sÞidfÚt
 ) \

74 
x
, 
y
, 
mask
; \

75 cÚ¡ 
Ušt8
 *
¤c_by‹
; \

76 
Ušt
 ## 
BIT_DEPTH
 *
d¡_pix–
; \

77 
Ušt8
* 
d¡_sÿÆše
; \

79 ifÐ
ch
 > 127 ) ; \

81 
¤c_by‹
 = &
thefÚt
[
ch
*12]; \

83 
d¡_sÿÆše
 = 
±r
; \

85  
y
=12; y!=0; --y, ++
¤c_by‹
, 
d¡_sÿÆše
+=
sü“n
->
p™ch
 ) \

87 
d¡_pix–
 = (
Ušt
 ## 
BIT_DEPTH
 *)
d¡_sÿÆše
; \

89  
mask
=0x80, 
x
=8; x!=0; --x, ++
d¡_pix–
, mask>>=1 ) \

91 ifÐ(*
¤c_by‹
)&
mask
 ) \

92 *
d¡_pix–
 = (
Ušt
 ## 
BIT_DEPTH
)
fcÞ
; \

93 ifÐ
sÞidfÚt
 ) \

94 *
d¡_pix–
 = (
Ušt
 ## 
BIT_DEPTH
)
bcÞ
; \

97 
	}

	)
}

99 
	$DEFINE_´štch¬_X_bµ
(16)

100 
	$DEFINE_´štch¬_X_bµ
(32)

104 
	$»nd”_begš_sw
Ð
machše
 *
Üic
 )

106 
x
, 
y
;

107 
Ušt8
 *
d¡_sÿÆše
;

109 ifÐ
	`SDL_MUSTLOCK
Ð
sü“n
 ) )

110 
	`SDL_LockSurçû
Ð
sü“n
 );

112 ifÐ
Üic
->
ÃwpÝup¡r
 )

114 
d¡_sÿÆše
 = (
Ušt8
*)
sü“n
->
pix–s
;

115 
d¡_sÿÆše
 +ð320 * 
pix–_size
;

117 ifÐ
Üic
->
sw_d•th
 == 16 )

119 
Ušt16
 *
d¡_pix–
;

120  
y
=12; y!=0; --y, 
d¡_sÿÆše
 +ð
sü“n
->
p™ch
)

122 
d¡_pix–
 = (
Ušt16
 *)
d¡_sÿÆše
;

123  
x
=320; x<640; x++, 
d¡_pix–
++ )

124 *
d¡_pix–
 = 
g·l
[0];

127 
Ušt32
 *
d¡_pix–
;

128  
y
=12; y!=0; --y, 
d¡_sÿÆše
 +ð
sü“n
->
p™ch
)

130 
d¡_pix–
 = (
Ušt32
 *)
d¡_sÿÆše
;

131  
x
=320; x<640; x++, 
d¡_pix–
++ )

132 *
d¡_pix–
 = 
g·l
[0];

135 
Üic
->
ÃwpÝup¡r
 = 
SDL_FALSE
;

138 ifÐ
Üic
->
Ãw¡©us¡r
 )

140 
»äesh¡©us
 = 
SDL_TRUE
;

141 
Üic
->
Ãw¡©us¡r
 = 
SDL_FALSE
;

143 
	}
}

145 
	$»nd”_’d_sw
Ð
machše
 *
Üic
 )

147 
i
;

148 
Ušt32
 
ch¬_p™ch
;

149 
Ušt8
 *
d¡_pix–
;

151 
ch¬_p™ch
 = 8 * 
pix–_size
;

153 ifÐ
Üic
->
emu_mode
 =ð
EM_RUNNING
 )

155 ifÐ
Üic
->
pÝup¡r
[0] )

157 
d¡_pix–
 = (
Ušt8
*)
sü“n
->
pix–s
;

158 
d¡_pix–
 +ð320 * 
pix–_size
;

160  
i
=0; 
Üic
->
pÝup¡r
[i]; i++, 
d¡_pix–
 +ð
ch¬_p™ch
 )

161 
	`´štch¬
Ð
d¡_pix–
, 
Üic
->
pÝup¡r
[
i
], 
g·l
[1], g·l[0], 
SDL_TRUE
 );

164 ifÐ
Üic
->
¡©us¡r
[0] )

166 
d¡_pix–
 = (
Ušt8
*)
sü“n
->
pix–s
;

167 
d¡_pix–
 +ð466 * 
sü“n
->
p™ch
;

169  
i
=0; 
Üic
->
¡©us¡r
[i]; i++, 
d¡_pix–
 +ð
ch¬_p™ch
 )

170 
	`´štch¬
Ð
d¡_pix–
, 
Üic
->
¡©us¡r
[
i
], 
g·l
[1], 0, 
SDL_FALSE
 );

174 ifÐ
	`SDL_MUSTLOCK
Ð
sü“n
 ) )

175 
	`SDL_UÆockSurçû
Ð
sü“n
 );

177 
	`SDL_COMPAT_Fl
Ð
sü“n
 );

178 
	}
}

180 
	$»nd”_‹xtzÚe_®loc_sw
Ð
machše
 *
Üic
, 
i
 )

182 
	}
}

184 
	$»nd”_‹xtzÚe_ä“_sw
Ð
machše
 *
Üic
, 
i
 )

186 
	}
}

188 
	$»nd”_‹xtzÚe_sw
Ð
machše
 *
Üic
, 
i
 )

190 
x
, 
y
, 
o
;

191 
Ušt32
 
ch¬_p™ch
;

192 
‹xtzÚe
 *
±z
 = 
tz
[
i
];

193 
Ušt8
 *
d¡_sÿÆše
, *
d¡_pix–
;

195 
ch¬_p™ch
 = 8 * 
pix–_size
;

197 
d¡_sÿÆše
 = (
Ušt8
 *)
sü“n
->
pix–s
;

198 
d¡_sÿÆše
 +ð
sü“n
->
p™ch
 * 
±z
->
y
 + 
pix–_size
 *…tz->
x
;

200 
o
 = 0;

201  
y
=
±z
->
h
; y!=0; --y, 
d¡_sÿÆše
+=12*
sü“n
->
p™ch
 )

203 
d¡_pix–
 = 
d¡_sÿÆše
;

205  
x
=
±z
->
w
; x!=0; --x, ++
o
, 
d¡_pix–
+=
ch¬_p™ch
 )

206 
	`´štch¬
Ð
d¡_pix–
, 
±z
->
tx
[
o
], 
g·l
[±z->
fc
[o]], g·l[±z->
bc
[o]], 
SDL_TRUE
 );

209 
	}
}

212 
	$»nd”_þ—r_¬—_sw
Ð
x
, 
y
, 
w
, 
h
 )

214 
Ušt8
 *
d¡_sÿÆše
;

215 
Sšt32
 
i
;

217 
d¡_sÿÆše
 = (
Ušt8
 *)
sü“n
->
pix–s
;

218 
d¡_sÿÆše
 +ð
sü“n
->
p™ch
 * 
y
 + 
pix–_size
 * 
x
;

220  
i
=0; i<
h
; i++, 
d¡_sÿÆše
+=
sü“n
->
p™ch
 )

221 
	`mem£t
Ð
d¡_sÿÆše
, 0, 
pix–_size
*
w
 );

222 
	}
}

225 
	$»nd”_gimg_sw
Ð
img_id
, 
Sšt32
 
xp
, Sšt32 
yp
 )

227 
guiimg
 *
gi
 = &
gimgs
[
img_id
];

228 
Ušt8
 *
¤c_sÿÆše
, *
d¡_sÿÆše
;

229 
Sšt32
 
i
;

231 
¤c_sÿÆše
 = 
mgimg
[
img_id
];

233 
d¡_sÿÆše
 = (
Ušt8
 *)
sü“n
->
pix–s
;

234 
d¡_sÿÆše
 +ð
sü“n
->
p™ch
 * 
yp
 + 
pix–_size
 * 
xp
;

236  
i
=
gi
->
h
; i!=0; --i, 
¤c_sÿÆše
+=
pix–_size
*gi->
w
, 
d¡_sÿÆše
+=
sü“n
->
p™ch
 )

237 
	`memýy
Ð
d¡_sÿÆše
, 
¤c_sÿÆše
, 
pix–_size
*
gi
->
w
 );

238 
	}
}

241 
	$»nd”_gimg·¹_sw
Ð
img_id
, 
Sšt32
 
xp
, Sšt32 
yp
, Sšt32 
ox
, Sšt32 
oy
, Sšt32 
w
, Sšt32 
h
 )

243 
guiimg
 *
gi
 = &
gimgs
[
img_id
];

244 
Ušt8
 *
¤c_sÿÆše
, *
d¡_sÿÆše
;

245 
Sšt32
 
i
;

247 
¤c_sÿÆše
 = 
mgimg
[
img_id
];

248 
¤c_sÿÆše
 +ð
pix–_size
*(
gi
->
w
 * 
oy
 + 
ox
);

250 
d¡_sÿÆše
 = (
Ušt8
 *)
sü“n
->
pix–s
;

251 
d¡_sÿÆše
 +ð
sü“n
->
p™ch
 * 
yp
 + 
pix–_size
 * 
xp
;

253  
i
=
h
; i!=0; --i, 
¤c_sÿÆše
+=
pix–_size
*
gi
->
w
, 
d¡_sÿÆše
+=
sü“n
->
p™ch
 )

254 
	`memýy
Ð
d¡_sÿÆše
, 
¤c_sÿÆše
, 
pix–_size
*
w
 );

255 
	}
}

258 
	$»nd”_video_sw_16bµ
Ð
machše
 *
Üic
, 
SDL_boÞ
 
doubËsize
 )

260 
x
, 
y
;

261 
Ušt8
 *
¤c_pix–
;

262 
Sšt32
 
d¡_p™ch_x2
;

263 
Ušt32
 
c
;

264 
Ušt8
 *
d¡_sÿÆše
, *
d¡_ev’_sÿÆše
, *
d¡_odd_sÿÆše
;

265 
Ušt16
 *
d¡_pix–
;

266 
Ušt32
 *
d¡_ev’_pix–
, *
d¡_odd_pix–
;

268 ifÐ!
Üic
->
sü
 )

271 ifÐ
doubËsize
 )

273 ifÐ
Ãedþr
 )

275 
	`SDL_FžlReù
(
sü“n
, 
NULL
, 
g·l
[0]);

276 
Ãedþr
 = 
SDL_FALSE
;

279 
¤c_pix–
 = 
Üic
->
sü
;

281 
d¡_p™ch_x2
 = 2 * 
sü“n
->
p™ch
;

283 
d¡_ev’_sÿÆše
 = ((
Ušt8
*)
sü“n
->
pix–s
è+ 
off£t_tÝ
;

285 
d¡_odd_sÿÆše
 = 
d¡_ev’_sÿÆše
;

286 
d¡_odd_sÿÆše
 +ð
sü“n
->
p™ch
;

288 ifÐ
Üic
->
sÿÆšes
 )

290  
y
=0; y<224; y++, 
d¡_ev’_sÿÆše
+=
d¡_p™ch_x2
, 
d¡_odd_sÿÆše
+=dst_pitch_x2 )

292 ià(!
Üic
->
vid_dœty
[
y
])

294 
¤c_pix–
 += 240;

297 
d¡_ev’_pix–
 = (
Ušt32
*)
d¡_ev’_sÿÆše
;

298 
d¡_odd_pix–
 = (
Ušt32
*)
d¡_odd_sÿÆše
;

300  
x
=240; x!=0; --x )

302 
c
 = *(
¤c_pix–
++);

303 *(
d¡_ev’_pix–
++èð
d·l
[
c
];

304 *(
d¡_odd_pix–
++èð
d·l
[
c
+8];

306 
Üic
->
vid_dœty
[
y
] = 
SDL_FALSE
;

310  
y
=0; y<224; y++, 
d¡_ev’_sÿÆše
+=
d¡_p™ch_x2
, 
d¡_odd_sÿÆše
+=dst_pitch_x2 )

312 ià(!
Üic
->
vid_dœty
[
y
])

314 
¤c_pix–
 += 240;

317 
d¡_ev’_pix–
 = (
Ušt32
*)
d¡_ev’_sÿÆše
;

318 
d¡_odd_pix–
 = (
Ušt32
*)
d¡_odd_sÿÆše
;

320  
x
=240; x!=0; --x )

322 
c
 = 
d·l
[*(
¤c_pix–
++)];

323 *(
d¡_ev’_pix–
++èð
c
;

324 *(
d¡_odd_pix–
++èð
c
;

326 
Üic
->
vid_dœty
[
y
] = 
SDL_FALSE
;

332 
Ãedþr
 = 
SDL_TRUE
;

334 
¤c_pix–
 = 
Üic
->
sü
;

335 
d¡_sÿÆše
 = (
Ušt8
*)
sü“n
->
pix–s
;

337  
y
=0; y<4; y++ )

339 
	`mem£t
Ð
d¡_sÿÆše
, 0, 240*
pix–_size
 );

340 
d¡_sÿÆše
 +ð
sü“n
->
p™ch
;

342  ; 
y
<228; y++, 
d¡_sÿÆše
+=
sü“n
->
p™ch
 )

344 
d¡_pix–
 = (
Ušt16
*)
d¡_sÿÆše
;

346  
x
=240; x!=0; --x )

347 *(
d¡_pix–
++èð(
Ušt16
)
·l
[*(
¤c_pix–
++)];

349 
	}
}

352 
	$»nd”_video_sw_32bµ
Ð
machše
 *
Üic
, 
SDL_boÞ
 
doubËsize
 )

354 
x
, 
y
;

355 
Ušt8
 *
¤c_pix–
;

356 
Sšt32
 
d¡_p™ch_x2
;

357 
Ušt32
 
c
, 
c2
;

358 
Ušt8
 *
d¡_sÿÆše
, *
d¡_ev’_sÿÆše
, *
d¡_odd_sÿÆše
;

359 
Ušt32
 *
d¡_pix–
, *
d¡_ev’_pix–
, *
d¡_odd_pix–
;

361 ifÐ!
Üic
->
sü
 )

364 ifÐ
doubËsize
 )

366 ifÐ
Ãedþr
 )

368 
	`SDL_FžlReù
(
sü“n
, 
NULL
, 
g·l
[0]);

369 
Ãedþr
 = 
SDL_FALSE
;

372 
¤c_pix–
 = 
Üic
->
sü
;

374 
d¡_p™ch_x2
 = 2 * 
sü“n
->
p™ch
;

376 
d¡_ev’_sÿÆše
 = ((
Ušt8
*)
sü“n
->
pix–s
è+ 
off£t_tÝ
;

378 
d¡_odd_sÿÆše
 = 
d¡_ev’_sÿÆše
;

379 
d¡_odd_sÿÆše
 +ð
sü“n
->
p™ch
;

381 ifÐ
Üic
->
sÿÆšes
 )

383  
y
=0; y<224; y++, 
d¡_ev’_sÿÆše
+=
d¡_p™ch_x2
, 
d¡_odd_sÿÆše
+=dst_pitch_x2 )

385 ià(!
Üic
->
vid_dœty
[
y
])

387 
¤c_pix–
 += 240;

390 
d¡_ev’_pix–
 = (
Ušt32
*)
d¡_ev’_sÿÆše
;

391 
d¡_odd_pix–
 = (
Ušt32
*)
d¡_odd_sÿÆše
;

393  
x
=240; x!=0; --x )

395 
c2
 = 
·l
[(*
¤c_pix–
)+8];

396 
c
 = 
·l
[*(
¤c_pix–
++)];

398 *(
d¡_ev’_pix–
++èð
c
;

399 *(
d¡_ev’_pix–
++èð
c
;

400 *(
d¡_odd_pix–
++èð
c2
;

401 *(
d¡_odd_pix–
++èð
c2
;

404 
Üic
->
vid_dœty
[
y
] = 
SDL_FALSE
;

408  
y
=0; y<224; y++, 
d¡_ev’_sÿÆše
+=
d¡_p™ch_x2
, 
d¡_odd_sÿÆše
+=dst_pitch_x2 )

410 ià(!
Üic
->
vid_dœty
[
y
])

412 
¤c_pix–
 += 240;

415 
d¡_ev’_pix–
 = (
Ušt32
*)
d¡_ev’_sÿÆše
;

416 
d¡_odd_pix–
 = (
Ušt32
*)
d¡_odd_sÿÆše
;

418  
x
=240; x!=0; --x )

420 
c
 = 
·l
[*(
¤c_pix–
++)];

422 *(
d¡_ev’_pix–
++èð
c
;

423 *(
d¡_ev’_pix–
++èð
c
;

424 *(
d¡_odd_pix–
++èð
c
;

425 *(
d¡_odd_pix–
++èð
c
;

427 
Üic
->
vid_dœty
[
y
] = 
SDL_FALSE
;

433 
Ãedþr
 = 
SDL_TRUE
;

435 
¤c_pix–
 = 
Üic
->
sü
;

436 
d¡_sÿÆše
 = (
Ušt8
*)
sü“n
->
pix–s
;

438  
y
=0; y<4; y++ )

440 
	`mem£t
Ð
d¡_sÿÆše
, 0, 240*
pix–_size
 );

441 
d¡_sÿÆše
 +ð
sü“n
->
p™ch
;

444  ; 
y
<228; y++, 
d¡_sÿÆše
+=
sü“n
->
p™ch
 )

446 
d¡_pix–
 = (
Ušt32
*)
d¡_sÿÆše
;

448  
x
=240; x!=0; --x )

449 *(
d¡_pix–
++èð
·l
[*(
¤c_pix–
++)];

451 
	}
}

453 
	$»nd”_sw_d‘eùvideo
Ð
machše
 *
Üic
 )

455 
B™sP”Pix–
 = 
	`SDL_COMPAT_G‘B™sP”Pix–
();

458 
Üic
->
sw_d•th
 = 16;

460  
B™sP”Pix–
 )

467 
Üic
->
sw_d•th
 = 
B™sP”Pix–
;

473 
	}
}

475 
	$´eš™_»nd”_sw
Ð
machše
 *
Üic
 )

477 
Sšt32
 
i
;

480 
sü“n
 = 
NULL
;

483  
i
=0; i<
NUM_GIMG
; i++ )

484 
mgimg
[
i
] = 
NULL
;

485 
	}
}

487 
SDL_boÞ
 
	$»nd”_toggËfuÎsü“n_sw
Ð
machše
 *
Üic
 )

489 #ià
	`defšed
(
__amigaos4__
è|| defšed(
__lšux__
è|| defšed(
__MORPHOS__
)

491 ifÐ
	`SDL_COMPAT_WM_ToggËFuÎSü“n
Ð
sü“n
 ) )

493 
fuÎsü“n
 = !fullscreen;

494  
SDL_TRUE
;

497  
SDL_FALSE
;

499 
Üic
->
	`shut_»nd”
( oric );

500 
fuÎsü“n
 = !fullscreen;

501 ifÐ
Üic
->
	`š™_»nd”
ÐÜiøèè 
SDL_TRUE
;

502 
	`£t_»nd”_mode
Ð
Üic
, 
RENDERMODE_NULL
 );

503 
Üic
->
emu_mode
 = 
EM_PLEASEQUIT
;

504  
SDL_FALSE
;

506 
	}
}

510 
	#DEFINE_guiimg_to_img_X_bµ
(
BIT_DEPTH
) \

511 
SDL_boÞ
 
guiimg_to_img_
 ## 
BIT_DEPTH
 ## 
bµ
 \

512 (
Ušt8
** 
d¡
, cÚ¡ 
guiimg
* 
¤c
) \

514 
size_t
 
i
; \

515 cÚ¡ 
Ušt8
 *
¤c_pix–
; \

516 
Ušt
 ## 
BIT_DEPTH
 *
d¡_pix–
; \

518 (*
d¡
èð(
Ušt8
 *)
	`m®loc
Ð
¤c
->
w
*¤c->
h
*(
Ušt
 ## 
BIT_DEPTH
) ); \

519 ià((*
d¡
è=ð
NULL
) \

520  
SDL_FALSE
; \

522 
¤c_pix–
 = 
¤c
->
buf
; \

523 
d¡_pix–
 = (
Ušt
 ## 
BIT_DEPTH
 *)(*
d¡
); \

525  
i
=
¤c
->
w
*¤c->
h
; i!=0; --i, 
¤c_pix–
 +ð3, ++
d¡_pix–
 ) \

526 (*
d¡_pix–
) = \

527 (
Ušt
 ## 
BIT_DEPTH
)
	`SDL_M­RGB
Ð
sü“n
->
fÜm©
, \

528 
¤c_pix–
[0], \

529 
¤c_pix–
[1], \

530 
¤c_pix–
[2] ); \

532  
SDL_TRUE
; \

533 }

	)

535 
	$DEFINE_guiimg_to_img_X_bµ
(16)

536 
	$DEFINE_guiimg_to_img_X_bµ
(32)

540 
SDL_boÞ
 
	$š™_»nd”_sw
Ð
machše
 *
Üic
 )

542 
i
;

543 * 
·l_™
;

544 
Sšt32
 
surçûmode
;

546 
pix–_size
 = 
Üic
->
sw_d•th
 / 8;

548 
surçûmode
 = 
fuÎsü“n
 ? 
SDL_COMPAT_FULLSCREEN
 : 
SDL_SWSURFACE
;

549 ifÐ
hwsurçû
 ) { 
surçûmode
 &ð~
SDL_SWSURFACE
; surçûmod|ð
SDL_COMPAT_HWSURFACE
; }

552 ià(
Üic
->
show_keybßrd
) {

553 
sü“n
 = 
	`SDL_COMPAT_S‘VideoMode
Ð640, 480+240, 
Üic
->
sw_d•th
, 
surçûmode
 );

555 
sü“n
 = 
	`SDL_COMPAT_S‘VideoMode
Ð640, 480, 
Üic
->
sw_d•th
, 
surçûmode
 );

558 ifÐ!
sü“n
 )

560 
	`´štf
( "SDL video failed\n" );

561  
SDL_FALSE
;

564 
	`SDL_COMPAT_WM_S‘C­tiÚ
Ð
APP_NAME_FULL
, APP_NAME_FULL );

567 ià(
Üic
->
sw_d•th
 == 16) {

568 
´štch¬
 = 
´štch¬_16bµ
;

569 
guiimg_to_img
 = 
guiimg_to_img_16bµ
;

572 ià(
Üic
->
sw_d•th
 == 32) {

573 
´štch¬
 = 
´štch¬_32bµ
;

574 
guiimg_to_img
 = 
guiimg_to_img_32bµ
;

579 
·l_™
 = 
sg·l
;

580  
i
=0; i<
NUM_GUI_COLS
; i++, 
·l_™
+=3 )

581 
g·l
[
i
] = 
	`SDL_M­RGB
Ð
sü“n
->
fÜm©
, 
·l_™
[0],…al_it[1],…al_it[2] );

584 
·l_™
 = 
Üiý®‘‹
;

585  
i
=0; i<8; i++, 
·l_™
+=3 )

587 
·l
[
i
 ] = 
	`SDL_M­RGB
Ð
sü“n
->
fÜm©
, 
·l_™
[0],…al_it[1],…al_it[2] );

588 
·l
[
i
+8] = 
	`SDL_M­RGB
Ð
sü“n
->
fÜm©
, 
·l_™
[0]/2,…al_it[1]/2,…al_it[2]/2 );

592  
i
=0; i<
NUM_GIMG
; i++ )

593 ià(!
	`guiimg_to_img
(
mgimg
 + 
i
, 
gimgs
 + i))

594  
SDL_FALSE
;

597  
i
=0; i<8*2; i++ )

598 
d·l
[
i
] = (
·l
[i]<<16)|pal[i];

601 
Ãedþr
 = 
SDL_TRUE
;

602 
»äesh¡©us
 = 
SDL_TRUE
;

605 
off£t_tÝ
 = (240 - 226è* 
sü“n
->
p™ch
;

606 
off£t_tÝ
 +ð
pix–_size
 * 80;

608 
	`uÏ_£t_dœty
Ð
Üic
 );

611  
SDL_TRUE
;

612 
	}
}

614 
	$shut_»nd”_sw
Ð
machše
 *
Üic
 )

616 
Sšt32
 
i
;

618  
i
=0; i<
NUM_GIMG
; i++ )

620 ifÐ
mgimg
[
i
] ) 
	`ä“
( mgimg[i] );

621 
mgimg
[
i
] = 
NULL
;

625 
	}
}

	@render_sw.h

22 
»nd”_begš_sw
Ð
machše
 *
Üic
 );

23 
»nd”_’d_sw
Ð
machše
 *
Üic
 );

24 
»nd”_‹xtzÚe_®loc_sw
Ð
machše
 *
Üic
, 
i
 );

25 
»nd”_‹xtzÚe_ä“_sw
Ð
machše
 *
Üic
, 
i
 );

26 
»nd”_‹xtzÚe_sw
Ð
machše
 *
Üic
, 
i
 );

27 
»nd”_gimg_sw
Ð
i
, 
Sšt32
 
xp
, Sšt32 
yp
 );

28 
»nd”_gimg·¹_sw
Ð
i
, 
Sšt32
 
xp
, Sšt32 
yp
, Sšt32 
ox
, Sšt32 
oy
, Sšt32 
w
, Sšt32 
h
 );

29 
»nd”_video_sw_16bµ
Ð
machše
 *
Üic
, 
SDL_boÞ
 
doubËsize
 );

30 
»nd”_video_sw_32bµ
Ð
machše
 *
Üic
, 
SDL_boÞ
 
doubËsize
 );

31 
»nd”_þ—r_¬—_sw
Ð
x
, 
y
, 
w
, 
h
 );

32 
SDL_boÞ
 
»nd”_toggËfuÎsü“n_sw
Ð
machše
 *
Üic
 );

33 
´eš™_»nd”_sw
Ð
machše
 *
Üic
 );

34 
SDL_boÞ
 
š™_»nd”_sw
Ð
machše
 *
Üic
 );

35 
shut_»nd”_sw
Ð
machše
 *
Üic
 );

37 
»nd”_sw_d‘eùvideo
Ð
machše
 *
Üic
 );

	@render_sw8.c

22 
	~<¡dlib.h
>

23 
	~<¡ršg.h
>

25 
	~"sy¡em.h
"

26 
	~"6502.h
"

27 
	~"vŸ.h
"

28 
	~"8912.h
"

29 
	~"disk.h
"

30 
	~"gui.h
"

31 
	~"mÚ™Ü.h
"

32 
	~"6551.h
"

33 
	~"machše.h
"

34 
	~"»nd”_sw8.h
"

35 
	~"uÏ.h
"

39 
	#GPAL_FIRSTPEN
 20

	)

41 
SDL_Surçû
 *
	gsü“n
;

43 
Ušt32
 
	goff£t_tÝ
;

44 
Ušt32
 
	gq³n
[16*256];

46 
SDL_boÞ
 
fuÎsü“n
, 
hwsurçû
;

47 
SDL_boÞ
 
	gÃedþr
;

48 
‹xtzÚe
 *
tz
[
NUM_TZ
];

49 
sg·l
[];

50 
Ušt8
 
Üiý®‘‹
[];

51 
guiimg
 
gimgs
[
NUM_GIMG
];

52 
SDL_boÞ
 
»äesh¡©us
;

53 
Ušt8
 *
	gmgimg
[
NUM_GIMG
];

54 
	gÃxt_gimgcÞ
;

55 
SDL_CÞÜ
 
	gcÞours
[256];

58 
thefÚt
[];

68 
	$´štch¬
Ð
Ušt8
* 
±r
, 
ch
, Ušt8 
fcÞ
, Ušt8 
bcÞ
, 
SDL_boÞ
 
sÞidfÚt
 )

70 
x
, 
y
, 
mask
;

71 cÚ¡ 
Ušt8
 *
¤c_by‹
;

72 
Ušt8
 *
d¡_pix–
;

73 
Ušt8
 *
d¡_sÿÆše
;

75 ifÐ
ch
 > 127 ) ;

77 
¤c_by‹
 = &
thefÚt
[
ch
*12];

78 
d¡_sÿÆše
 = 
±r
;

80  
y
=12; y!=0; --y, ++
¤c_by‹
, 
d¡_sÿÆše
+=
sü“n
->
p™ch
 )

82 
d¡_pix–
 = 
d¡_sÿÆše
;

84  
mask
=0x80, 
x
=8; x!=0; --x, ++
d¡_pix–
, mask>>=1 )

86 ifÐ(*
¤c_by‹
)&
mask
 )

87 *
d¡_pix–
 = 
fcÞ
;

88 ifÐ
sÞidfÚt
 )

89 *
d¡_pix–
 = 
bcÞ
;

92 
	}
}

95 
	$»nd”_begš_sw8
Ð
machše
 *
Üic
 )

97 
y
;

98 
Ušt8
 *
d¡_sÿÆše
;

100 ifÐ
	`SDL_MUSTLOCK
Ð
sü“n
 ) )

101 
	`SDL_LockSurçû
Ð
sü“n
 );

103 ifÐ
Üic
->
ÃwpÝup¡r
 )

105 
d¡_sÿÆše
 = (
Ušt8
*)
sü“n
->
pix–s
;

106 
d¡_sÿÆše
 += 320;

108  
y
=12; y!=0; --y, 
d¡_sÿÆše
 +ð
sü“n
->
p™ch
)

109 
	`mem£t
(
d¡_sÿÆše
, 
GPAL_FIRSTPEN
, 320);

110 
Üic
->
ÃwpÝup¡r
 = 
SDL_FALSE
;

113 ifÐ
Üic
->
Ãw¡©us¡r
 )

115 
»äesh¡©us
 = 
SDL_TRUE
;

116 
Üic
->
Ãw¡©us¡r
 = 
SDL_FALSE
;

118 
	}
}

120 
	$»nd”_’d_sw8
Ð
machše
 *
Üic
 )

122 
i
;

123 
Ušt32
 
ch¬_p™ch
;

124 
Ušt8
 *
d¡_pix–
;

126 
ch¬_p™ch
 = 8;

128 ifÐ
Üic
->
emu_mode
 =ð
EM_RUNNING
 )

130 ifÐ
Üic
->
pÝup¡r
[0] )

132 
d¡_pix–
 = (
Ušt8
*)
sü“n
->
pix–s
;

133 
d¡_pix–
 += 320;

135  
i
=0; 
Üic
->
pÝup¡r
[i]; i++, 
d¡_pix–
 +ð
ch¬_p™ch
 )

136 
	`´štch¬
Ð
d¡_pix–
, 
Üic
->
pÝup¡r
[
i
], 
GPAL_FIRSTPEN
+1, GPAL_FIRSTPEN, 
SDL_TRUE
 );

139 ifÐ
Üic
->
¡©us¡r
[0] )

141 
d¡_pix–
 = (
Ušt8
*)
sü“n
->
pix–s
;

142 
d¡_pix–
 +ð466 * 
sü“n
->
p™ch
;

144  
i
=0; 
Üic
->
¡©us¡r
[i]; i++, 
d¡_pix–
 +ð
ch¬_p™ch
 )

145 
	`´štch¬
Ð
d¡_pix–
, 
Üic
->
¡©us¡r
[
i
], 
GPAL_FIRSTPEN
+1, 0, 
SDL_FALSE
 );

149 ifÐ
	`SDL_MUSTLOCK
Ð
sü“n
 ) )

150 
	`SDL_UÆockSurçû
Ð
sü“n
 );

152 
	`SDL_COMPAT_Fl
Ð
sü“n
 );

153 
	}
}

155 
	$»nd”_‹xtzÚe_®loc_sw8
Ð
machše
 *
Üic
, 
i
 )

157 
	}
}

159 
	$»nd”_‹xtzÚe_ä“_sw8
Ð
machše
 *
Üic
, 
i
 )

161 
	}
}

163 
	$»nd”_‹xtzÚe_sw8
Ð
machše
 *
Üic
, 
i
 )

165 
x
, 
y
, 
o
;

166 
‹xtzÚe
 *
±z
 = 
tz
[
i
];

167 
Ušt8
 *
d¡_sÿÆše
, *
d¡_pix–
;

169 
d¡_sÿÆše
 = (
Ušt8
 *)
sü“n
->
pix–s
;

170 
d¡_sÿÆše
 +ð
sü“n
->
p™ch
 * 
±z
->
y
 +…tz->
x
;

172 
o
 = 0;

173  
y
=
±z
->
h
; y!=0; --y, 
d¡_sÿÆše
+=12*
sü“n
->
p™ch
 )

175 
d¡_pix–
 = 
d¡_sÿÆše
;

177  
x
=
±z
->
w
; x!=0; --x, ++
o
, 
d¡_pix–
+=8 )

178 
	`´štch¬
Ð
d¡_pix–
, 
±z
->
tx
[
o
], 
GPAL_FIRSTPEN
+±z->
fc
[o], GPAL_FIRSTPEN+±z->
bc
[o], 
SDL_TRUE
 );

180 
	}
}

183 
	$»nd”_þ—r_¬—_sw8
Ð
x
, 
y
, 
w
, 
h
 )

185 
Ušt8
 *
d¡_sÿÆše
;

186 
Sšt32
 
i
;

188 
d¡_sÿÆše
 = (
Ušt8
 *)
sü“n
->
pix–s
;

189 
d¡_sÿÆše
 +ð
sü“n
->
p™ch
 * 
y
 + 
x
;

191  
i
=0; i<
h
; i++, 
d¡_sÿÆše
+=
sü“n
->
p™ch
 )

192 
	`mem£t
Ð
d¡_sÿÆše
, 0, 
w
 );

193 
	}
}

196 
	$»nd”_gimg_sw8
Ð
img_id
, 
Sšt32
 
xp
, Sšt32 
yp
 )

198 
guiimg
 *
gi
 = &
gimgs
[
img_id
];

199 
Ušt8
 *
¤c_sÿÆše
, *
d¡_sÿÆše
;

200 
Sšt32
 
i
;

202 
¤c_sÿÆše
 = 
mgimg
[
img_id
];

204 
d¡_sÿÆše
 = (
Ušt8
 *)
sü“n
->
pix–s
;

205 
d¡_sÿÆše
 +ð
sü“n
->
p™ch
 * 
yp
 + 
xp
;

207  
i
=
gi
->
h
; i!=0; --i, 
¤c_sÿÆše
+=gi->
w
, 
d¡_sÿÆše
+=
sü“n
->
p™ch
 )

208 
	`memýy
Ð
d¡_sÿÆše
, 
¤c_sÿÆše
, 
gi
->
w
 );

209 
	}
}

212 
	$»nd”_gimg·¹_sw8
Ð
img_id
, 
Sšt32
 
xp
, Sšt32 
yp
, Sšt32 
ox
, Sšt32 
oy
, Sšt32 
w
, Sšt32 
h
 )

214 
guiimg
 *
gi
 = &
gimgs
[
img_id
];

215 
Ušt8
 *
¤c_sÿÆše
, *
d¡_sÿÆše
;

216 
Sšt32
 
i
;

218 
¤c_sÿÆše
 = 
mgimg
[
img_id
];

219 
¤c_sÿÆše
 +ð
gi
->
w
 * 
oy
 + 
ox
;

221 
d¡_sÿÆše
 = (
Ušt8
 *)
sü“n
->
pix–s
;

222 
d¡_sÿÆše
 +ð
sü“n
->
p™ch
 * 
yp
 + 
xp
;

224  
i
=
h
; i!=0; --i, 
¤c_sÿÆše
+=
gi
->
w
, 
d¡_sÿÆše
+=
sü“n
->
p™ch
 )

225 
	`memýy
Ð
d¡_sÿÆše
, 
¤c_sÿÆše
, 
w
 );

226 
	}
}

229 
	$»nd”_video_sw8
Ð
machše
 *
Üic
, 
SDL_boÞ
 
doubËsize
 )

231 
x
, 
y
;

232 
Ušt16
 *
¤c_pix–
;

233 
Sšt32
 
d¡_p™ch_x2
;

234 
Ušt32
 
c
;

235 
Ušt8
 *
d¡_sÿÆše
, *
d¡_ev’_sÿÆše
, *
d¡_odd_sÿÆše
;

236 
Ušt32
 *
d¡_ev’_pix–
, *
d¡_odd_pix–
;

238 ifÐ!
Üic
->
sü
 )

241 ifÐ
doubËsize
 )

243 ifÐ
Ãedþr
 )

245 
	`SDL_FžlReù
(
sü“n
, 
NULL
, 
GPAL_FIRSTPEN
);

246 
Ãedþr
 = 
SDL_FALSE
;

249 
¤c_pix–
 = (
Ušt16
 *)
Üic
->
sü
;

251 
d¡_p™ch_x2
 = 2 * 
sü“n
->
p™ch
;

253 
d¡_ev’_sÿÆše
 = ((
Ušt8
*)
sü“n
->
pix–s
è+ 
off£t_tÝ
;

255 
d¡_odd_sÿÆše
 = 
d¡_ev’_sÿÆše
;

256 
d¡_odd_sÿÆše
 +ð
sü“n
->
p™ch
;

258 ifÐ
Üic
->
sÿÆšes
 )

260  
y
=0; y<224; y++, 
d¡_ev’_sÿÆše
+=
d¡_p™ch_x2
, 
d¡_odd_sÿÆše
+=dst_pitch_x2 )

262 ià(!
Üic
->
vid_dœty
[
y
])

264 
¤c_pix–
 += 120;

267 
d¡_ev’_pix–
 = (
Ušt32
*)
d¡_ev’_sÿÆše
;

268 
d¡_odd_pix–
 = (
Ušt32
*)
d¡_odd_sÿÆše
;

270  
x
=0; x<120; x++ )

272 
c
 = *(
¤c_pix–
++);

273 *(
d¡_ev’_pix–
++èð
q³n
[
c
];

274 *(
d¡_odd_pix–
++èð
q³n
[
c
+8*257];

276 
Üic
->
vid_dœty
[
y
] = 
SDL_FALSE
;

280  
y
=0; y<224; y++, 
d¡_ev’_sÿÆše
+=
d¡_p™ch_x2
, 
d¡_odd_sÿÆše
+=dst_pitch_x2 )

282 ià(!
Üic
->
vid_dœty
[
y
])

284 
¤c_pix–
 += 120;

287 
d¡_ev’_pix–
 = (
Ušt32
*)
d¡_ev’_sÿÆše
;

288 
d¡_odd_pix–
 = (
Ušt32
*)
d¡_odd_sÿÆše
;

290  
x
=0; x<120; x++ )

292 
c
 = 
q³n
[*(
¤c_pix–
++)];

293 *(
d¡_ev’_pix–
++èð
c
;

294 *(
d¡_odd_pix–
++èð
c
;

296 
Üic
->
vid_dœty
[
y
] = 
SDL_FALSE
;

302 
Ãedþr
 = 
SDL_TRUE
;

304 
¤c_pix–
 = (
Ušt16
 *)
Üic
->
sü
;

305 
d¡_sÿÆše
 = (
Ušt8
*)
sü“n
->
pix–s
;

307  
y
=0; y<4; y++ )

309 
	`mem£t
Ð
d¡_sÿÆše
, 0, 240 );

310 
d¡_sÿÆše
 +ð
sü“n
->
p™ch
;

312  ; 
y
<228; y++, 
d¡_sÿÆše
+=
sü“n
->
p™ch
 )

314 
	`memýy
(
d¡_sÿÆše
, 
¤c_pix–
, 240);

315 
¤c_pix–
 += 240;

317 
	}
}

319 
	$´eš™_»nd”_sw8
Ð
machše
 *
Üic
 )

322 
sü“n
 = 
NULL
;

323 
	}
}

325 
SDL_boÞ
 
	$»nd”_toggËfuÎsü“n_sw8
Ð
machše
 *
Üic
 )

327 #ià
	`defšed
(
__amigaos4__
è|| defšed(
__lšux__
)

329 ifÐ
	`SDL_COMPAT_WM_ToggËFuÎSü“n
Ð
sü“n
 ) )

331 
fuÎsü“n
 = !fullscreen;

332  
SDL_TRUE
;

335  
SDL_FALSE
;

337 
Üic
->
	`shut_»nd”
( oric );

338 
fuÎsü“n
 = !fullscreen;

339 ifÐ
Üic
->
	`š™_»nd”
ÐÜiøèè 
SDL_TRUE
;

340 
	`£t_»nd”_mode
Ð
Üic
, 
RENDERMODE_NULL
 );

341 
Üic
->
emu_mode
 = 
EM_PLEASEQUIT
;

342  
SDL_FALSE
;

344 
	}
}

346 
	$simž¬_cÞour
(
i
, 
r
, 
g
, 
b
)

348  
	`abs
(
r
-()
cÞours
[
i
].r)+abs(
g
-()cÞours[i].g)+abs(
b
-()colours[i].b);

349 
	}
}

351 
	$fšd_be¡_³n
(
Ušt8
 
r
, 
g
, 
b
)

353 
i
;

354 
þo£¡_³n
=-1, 
þo£¡_di¡ªû
=8000;

357  
i
=0; i<
Ãxt_gimgcÞ
; i++ )

359 ifÐ(
cÞours
[
i
].
r
 ==„) &&

360 (
cÞours
[
i
].
g
 == g) &&

361 (
cÞours
[
i
].
b
 == b) )

362  
i
;

364 ià(
	`simž¬_cÞour
(
i
, 
r
, 
g
, 
b
è< 
þo£¡_di¡ªû
)

366 
þo£¡_³n
 = 
i
;

367 
þo£¡_di¡ªû
 = 
	`simž¬_cÞour
(
i
, 
r
, 
g
, 
b
);

372 ià(
þo£¡_di¡ªû
 < 3)

373  
þo£¡_³n
;

376 ià(
Ãxt_gimgcÞ
 >= 256)

377  
þo£¡_³n
;

379 
cÞours
[
Ãxt_gimgcÞ
].
r
 =„;

380 
cÞours
[
Ãxt_gimgcÞ
].
g
 = g;

381 
cÞours
[
Ãxt_gimgcÞ
].
b
 = b;

383  
Ãxt_gimgcÞ
++;

384 
	}
}

386 
SDL_boÞ
 
	$guiimg_to_img
(
Ušt8
** 
d¡
, cÚ¡ 
guiimg
* 
¤c
)

388 
size_t
 
i
;

389 cÚ¡ 
Ušt8
 *
¤c_pix–
;

390 
Ušt8
 *
d¡_pix–
;

392 (*
d¡
èð(
Ušt8
 *)
	`m®loc
Ð
¤c
->
w
*¤c->
h
 );

393 ià((*
d¡
è=ð
NULL
)

394  
SDL_FALSE
;

396 
¤c_pix–
 = 
¤c
->
buf
;

397 
d¡_pix–
 = *
d¡
;

399  
i
=
¤c
->
w
*¤c->
h
; i!=0; --i, 
¤c_pix–
 +ð3, ++
d¡_pix–
 )

400 (*
d¡_pix–
èð
	`fšd_be¡_³n
(
¤c_pix–
[0], src_pixel[1], src_pixel[2]);

402  
SDL_TRUE
;

403 
	}
}

405 
SDL_boÞ
 
	$š™_»nd”_sw8
Ð
machše
 *
Üic
 )

407 
i
, 
j
;

408 
Sšt32
 
surçûmode
;

410 
surçûmode
 = 
SDL_COMPAT_HWPALETTE
;

411 ifÐ
fuÎsü“n
 ) 
surçûmode
 |ð
SDL_COMPAT_FULLSCREEN
;

412 ifÐ
hwsurçû
 ) 
surçûmode
 |ð
SDL_COMPAT_HWSURFACE
;

415 
sü“n
 = 
	`SDL_COMPAT_S‘VideoMode
Ð640, 480, 8, 
surçûmode
 );

416 ià(
Üic
->
show_keybßrd
) {

417 
sü“n
 = 
	`SDL_COMPAT_S‘VideoMode
Ð640, 480+240, 8, 
surçûmode
 );

419 
sü“n
 = 
	`SDL_COMPAT_S‘VideoMode
Ð640, 480, 8, 
surçûmode
 );

422 ifÐ!
sü“n
 )

424 
	`´štf
( "SDL video failed\n" );

425  
SDL_FALSE
;

428 
	`SDL_COMPAT_WM_S‘C­tiÚ
Ð
APP_NAME_FULL
, APP_NAME_FULL );

430  
i
=0; i<8; i++ )

432 
cÞours
[
i
].
r
 = 
Üiý®‘‹
[i*3 ];

433 
cÞours
[
i
+8].
r
 = 
Üiý®‘‹
[i*3 ]/2;

434 
cÞours
[
i
].
g
 = 
Üiý®‘‹
[i*3+1];

435 
cÞours
[
i
+8].
g
 = 
Üiý®‘‹
[i*3+1]/2;

436 
cÞours
[
i
].
b
 = 
Üiý®‘‹
[i*3+2];

437 
cÞours
[
i
+8].
b
 = 
Üiý®‘‹
[i*3+2]/2;

440  
i
=0; i<
NUM_GUI_COLS
; i++ )

442 
cÞours
[
i
+
GPAL_FIRSTPEN
].
r
 = 
sg·l
[i*3 ];

443 
cÞours
[
i
+
GPAL_FIRSTPEN
].
g
 = 
sg·l
[i*3+1];

444 
cÞours
[
i
+
GPAL_FIRSTPEN
].
b
 = 
sg·l
[i*3+2];

447 
Ãxt_gimgcÞ
 = 
GPAL_FIRSTPEN
+
NUM_GUI_COLS
;

450  
i
=0; i<
NUM_GIMG
; i++ )

451 ià(!
	`guiimg_to_img
(
mgimg
 + 
i
, 
gimgs
 + i))

452  
SDL_FALSE
;

454 
	`SDL_COMPAT_S‘P®‘‹
Ð
sü“n
, 
SDL_COMPAT_LOGPAL
|
SDL_COMPAT_PHYSPAL
, 
cÞours
, 0, 
Ãxt_gimgcÞ
);

457  
i
=0; i<8*2; i++ )

458  
j
=0; j<8*2; j++ )

459 
q³n
[(
j
<<8)|
i
] = (j<<24)|(j<<16)|(i<<8)|i;

462 
Ãedþr
 = 
SDL_TRUE
;

463 
»äesh¡©us
 = 
SDL_TRUE
;

466 
off£t_tÝ
 = (240 - 226è* 
sü“n
->
p™ch
 + 80;

468 
	`uÏ_£t_dœty
Ð
Üic
 );

471  
SDL_TRUE
;

472 
	}
}

474 
	$shut_»nd”_sw8
Ð
machše
 *
Üic
 )

477 
	}
}

	@render_sw8.h

22 
»nd”_begš_sw8
Ð
machše
 *
Üic
 );

23 
»nd”_’d_sw8
Ð
machše
 *
Üic
 );

24 
»nd”_‹xtzÚe_®loc_sw8
Ð
machše
 *
Üic
, 
i
 );

25 
»nd”_‹xtzÚe_ä“_sw8
Ð
machše
 *
Üic
, 
i
 );

26 
»nd”_‹xtzÚe_sw8
Ð
machše
 *
Üic
, 
i
 );

27 
»nd”_gimg_sw8
Ð
i
, 
Sšt32
 
xp
, Sšt32 
yp
 );

28 
»nd”_gimg·¹_sw8
Ð
i
, 
Sšt32
 
xp
, Sšt32 
yp
, Sšt32 
ox
, Sšt32 
oy
, Sšt32 
w
, Sšt32 
h
 );

29 
»nd”_video_sw8
Ð
machše
 *
Üic
, 
SDL_boÞ
 
doubËsize
 );

30 
»nd”_þ—r_¬—_sw8
Ð
x
, 
y
, 
w
, 
h
 );

31 
SDL_boÞ
 
»nd”_toggËfuÎsü“n_sw8
Ð
machše
 *
Üic
 );

32 
´eš™_»nd”_sw8
Ð
machše
 *
Üic
 );

33 
SDL_boÞ
 
š™_»nd”_sw8
Ð
machše
 *
Üic
 );

34 
shut_»nd”_sw8
Ð
machše
 *
Üic
 );

	@snapshot.c

23 
	~<¡dlib.h
>

24 
	~<¡dio.h
>

25 
	~<¡ršg.h
>

27 
	~"sy¡em.h
"

28 
	~"6502.h
"

29 
	~"vŸ.h
"

30 
	~"8912.h
"

31 
	~"gui.h
"

32 
	~"disk.h
"

33 
	~"mÚ™Ü.h
"

34 
	~"6551.h
"

35 
	~"machše.h
"

36 
	~"avi.h
"

37 
	~"fž”eq.h
"

38 
	~"maš.h
"

39 
	~"uÏ.h
"

40 
	~"joy¡ick.h
"

41 
	~"³.h
"

42 
	~"msgbox.h
"

44 
disk·th
[];

46 
	#MAX_BLOCK
 (262144)

	)

47 *
	gbuf
;

48 
	goffs
 = 0;

50 
	#PUTU32
(
v®
è
ok
=
	`putu32
(ok, (
Ušt32
)v®)

	)

51 
SDL_boÞ
 
	$putu32
(
SDL_boÞ
 
¡žlok
, 
Ušt32
 
v®
)

53 ià(!
¡žlok
è 
SDL_FALSE
;

54 ià((
offs
+4è> 
MAX_BLOCK
è 
SDL_FALSE
;

55 
buf
[
offs
++] = (
v®
>>24)&0xff;

56 
buf
[
offs
++] = (
v®
>>16)&0xff;

57 
buf
[
offs
++] = (
v®
>>8)&0xff;

58 
buf
[
offs
++] = 
v®
&0xff;

59  
SDL_TRUE
;

60 
	}
}

62 
	#PUTU16
(
v®
è
ok
=
	`putu16
(ok, (
Ušt16
)v®)

	)

63 
SDL_boÞ
 
	$putu16
(
SDL_boÞ
 
¡žlok
, 
Ušt16
 
v®
)

65 ià(!
¡žlok
è 
SDL_FALSE
;

66 ià((
offs
+2è> 
MAX_BLOCK
è 
SDL_FALSE
;

67 
buf
[
offs
++] = (
v®
>>8)&0xff;

68 
buf
[
offs
++] = 
v®
&0xff;

69  
SDL_TRUE
;

70 
	}
}

72 
	#PUTU8
(
v®
è
ok
=
	`putu8
(ok, (
Ušt8
)v®)

	)

73 
SDL_boÞ
 
	$putu8
(
SDL_boÞ
 
¡žlok
, 
Ušt8
 
v®
)

75 ià(!
¡žlok
è 
SDL_FALSE
;

76 ià(
offs
 >ð
MAX_BLOCK
è 
SDL_FALSE
;

77 
buf
[
offs
++] = 
v®
&0xff;

78  
SDL_TRUE
;

79 
	}
}

81 
	#PUTDATA
(
d©a
, 
size
è
ok
=
	`putd©a
(ok, d©a, size)

	)

82 
SDL_boÞ
 
	$putd©a
(
SDL_boÞ
 
¡žlok
, *
d©a
, 
Ušt32
 
size
)

84 ià(!
¡žlok
è 
SDL_FALSE
;

85 ià((
offs
+
size
è> 
MAX_BLOCK
è 
SDL_FALSE
;

86 
	`memýy
Ð&
buf
[
offs
], 
d©a
, 
size
 );

87 
offs
 +ð
size
;

88  
SDL_TRUE
;

89 
	}
}

91 
	#PUTSTR
(
¡r
è
ok
=
	`put¡r
(ok, sŒ)

	)

92 
SDL_boÞ
 
	$put¡r
(
SDL_boÞ
 
¡žlok
, *
¡r
)

94 ià(!
¡žlok
è 
SDL_FALSE
;

95 
¡žlok
 = 
	`putu32
(¡žlok, ()
	`¡¾’
(
¡r
)+1);

96  
	`putd©a
(
¡žlok
, (*)
¡r
, ()
	`¡¾’
(str)+1);

97 
	}
}

99 
	#WRITEBLOCK
(è
ok
=
	`wr™eblock
(ok, 
f
)

	)

100 
SDL_boÞ
 
	$wr™eblock
(
SDL_boÞ
 
¡žlok
, 
FILE
 *
f
)

102 ià(!
¡žlok
è 
SDL_FALSE
;

103 ià(
offs
 <ð8è 
SDL_TRUE
;

105 
buf
[4] = ((
offs
-8)>>24)&0xff;

106 
buf
[5] = ((
offs
-8)>>16)&0xff;

107 
buf
[6] = ((
offs
-8)>>8)&0xff;

108 
buf
[7] = (
offs
-8)&0xff;

110 
¡žlok
 = (
	`fwr™e
(
buf
, 
offs
, 1, 
f
) == 1);

111 
offs
 = 0;

112  
¡žlok
;

113 
	}
}

116 
	#NEWBLOCK
(
id
è
ok
=
	`Ãwblock
(ok, id, 
f
)

	)

117 
SDL_boÞ
 
	$Ãwblock
(
SDL_boÞ
 
¡žlok
, *
id
, 
FILE
 *
f
)

119 ià(!
¡žlok
è 
SDL_FALSE
;

121 ià(!
	`wr™eblock
(
¡žlok
, 
f
)è 
SDL_FALSE
;

124 
	`memýy
(
buf
, 
id
, 4);

125 
offs
 = 8;

126  
SDL_TRUE
;

127 
	}
}

129 
	#DATABLOCK
(
d©a
, 
Ën
è
ok
 = 
	`d©ablock
(ok, d©a,†’, 
f
)

	)

130 
SDL_boÞ
 
	$d©ablock
(
SDL_boÞ
 
¡žlok
, *
d©a
, 
Ušt32
 
Ën
, 
FILE
 *
f
)

132 
Ušt32
 
Ënbe
 = 
	`_BE32
(
Ën
);

133 ià(!
¡žlok
è 
SDL_FALSE
;

135 ià(
Ën
 =ð0è 
SDL_TRUE
;

137 ià(!
	`wr™eblock
(
¡žlok
, 
f
)è 
SDL_FALSE
;

139 
¡žlok
 = (
	`fwr™e
("DATA", 4, 1, 
f
) == 1);

140 
¡žlok
 &ð(
	`fwr™e
(&
Ënbe
, 4, 1, 
f
) == 1);

141 
¡žlok
 &ð(
	`fwr™e
(
d©a
, 
Ën
, 1, 
f
) == 1);

143 
offs
 = 0;

144  
¡žlok
;

145 
	}
}

147 
SDL_boÞ
 
	$§ve_¢­shÙ
(
machše
 *
Üic
, *
fž’ame
)

149 
SDL_boÞ
 
ok
 = 
SDL_TRUE
;

150 
m6502
 *
ýu
 = &
Üic
->cpu;

151 
SDL_boÞ
 
do_wd17xx
 = 
SDL_FALSE
;

152 
i
, 
j
;

153 
FILE
 *
f
 = 
NULL
;

155 
buf
 = 
	`m®loc
(
MAX_BLOCK
);

156 ià(!
buf
)

158 
	`msgbox
(
Üic
, 
MSGBOX_OK
, "Snapshot failed: out of memory (1)\n");

159  
SDL_FALSE
;

162 
f
 = 
	`fÝ’
(
fž’ame
, "wb");

163 ià(!
f
)

165 
	`msgbox
(
Üic
, 
MSGBOX_OK
, "Unableo create snapshot file (2)");

166 
	`ä“
(
buf
);

167  
SDL_FALSE
;

170 
	`NEWBLOCK
("OSN\x00");

171 
	`PUTU8
(
Üic
->
ty³
);

172 
	`PUTU32
(
Üic
->
ov”þockmuÉ
);

173 
	`PUTU32
(
Üic
->
ov”þockshiá
);

174 
	`PUTU16
(
Üic
->
vsync
);

175 
	`PUTU8
(
Üic
->
romdis
);

176 
	`PUTU8
(
Üic
->
romÚ
);

177 
	`PUTU8
(
Üic
->
vsynchack
);

178 
	`PUTU8
(
Üic
->
driv‘y³
);

179 
	`PUTU8
(
Üic
->
³turbo
);

180 
	`PUTU8
(
Üic
->
vid_mode
);

181 
	`PUTU32
(
Üic
->
keym­
);

182 
	`DATABLOCK
(
Üic
->
mem
, oric->
memsize
);

184 
	`NEWBLOCK
("TAP\x00");

185 
	`PUTU8
(
Üic
->
³b™
);

186 
	`PUTU8
(
Üic
->
³out
);

187 
	`PUTU8
(
Üic
->
³·r™y
);

188 
	`PUTU32
(
Üic
->
³Ën
);

189 
	`PUTU32
(
Üic
->
³offs
);

190 
	`PUTU32
(
Üic
->
³couÁ
);

191 
	`PUTU32
(
Üic
->
³time
);

192 
	`PUTU32
(
Üic
->
³dupby‹s
);

193 
	`PUTU32
(
Üic
->
³hd»nd
);

194 
	`PUTU32
(
Üic
->
³d–ay
);

195 
	`PUTU8
(
Üic
->
³mÙÜ
);

196 
	`PUTU8
(
Üic
->
³turbo_fÜûoff
);

197 
	`PUTU8
(
Üic
->
¿w³
);

198 
	`PUTU32
(
Üic
->
nÚ¿w’d
);

199 
	`PUTU32
(
Üic
->
³h™’d
);

200 
	`PUTU32
(
Üic
->
³turbo_sync¡ack
);

201 
	`DATABLOCK
(
Üic
->
³buf
, oric->
³Ën
);

204 
	`NEWBLOCK
("PCH\0x00");

205 
	`PUTU32
(
Üic
->
pch_fd_þßd_g‘Çme_pc
);

206 
	`PUTU32
(
Üic
->
pch_fd_c§ve_g‘Çme_pc
);

207 
	`PUTU32
(
Üic
->
pch_fd_¡Üe_g‘Çme_pc
);

208 
	`PUTU32
(
Üic
->
pch_fd_»ÿÎ_g‘Çme_pc
);

209 
	`PUTU32
(
Üic
->
pch_fd_g‘Çme_addr
);

210 
	`PUTU8
(
Üic
->
pch_fd_avažabË
);

211 
	`PUTU32
(
Üic
->
pch_‰_g‘sync_pc
);

212 
	`PUTU32
(
Üic
->
pch_‰_g‘sync_’d_pc
);

213 
	`PUTU32
(
Üic
->
pch_‰_g‘sync_loÝ_pc
);

214 
	`PUTU32
(
Üic
->
pch_‰_»adby‹_pc
);

215 
	`PUTU32
(
Üic
->
pch_‰_»adby‹_’d_pc
);

216 
	`PUTU32
(
Üic
->
pch_‰_»adby‹_¡Üeby‹_addr
);

217 
	`PUTU32
(
Üic
->
pch_‰_»adby‹_¡Üez”o_addr
);

218 
	`PUTU32
(
Üic
->
pch_‰_putby‹_pc
);

219 
	`PUTU32
(
Üic
->
pch_‰_putby‹_’d_pc
);

220 
	`PUTU32
(
Üic
->
pch_‰_c§ve_’d_pc
);

221 
	`PUTU32
(
Üic
->
pch_‰_¡Üe_’d_pc
);

222 
	`PUTU32
(
Üic
->
pch_‰_wr™–—d”_pc
);

223 
	`PUTU32
(
Üic
->
pch_‰_wr™–—d”_’d_pc
);

225 
	`PUTU8
(
Üic
->
pch_‰_»adby‹_£tÿ¼y
);

226 
	`PUTU8
(
Üic
->
pch_‰_avažabË
);

227 
	`PUTU8
(
Üic
->
pch_‰_§ve_avažabË
);

230 
	`NEWBLOCK
("CPU\x00");

231 
	`PUTU32
(
ýu
->
cyþes
);

232 
	`PUTU16
(
ýu
->
pc
);

233 
	`PUTU16
(
ýu
->
Ï¡pc
);

234 
	`PUTU16
(
ýu
->
ÿlýc
);

235 
	`PUTU16
(
ýu
->
ÿlcšt
);

236 
	`PUTU8
(
ýu
->
nmi
);

237 
	`PUTU8
(
ýu
->
a
);

238 
	`PUTU8
(
ýu
->
x
);

239 
	`PUTU8
(
ýu
->
y
);

240 
	`PUTU8
(
ýu
->
¥
);

241 
	`PUTU8
(
MAKEFLAGS
);

242 
	`PUTU8
(
ýu
->
œq
);

243 
	`PUTU8
(
ýu
->
nmicouÁ
);

244 
	`PUTU8
(
ýu
->
ÿlcÝ
);

247 
	`NEWBLOCK
("AY\x00\x00");

248 
	`PUTU8
(
Üic
->
ay
.
bmode
);

249 
	`PUTU8
(
Üic
->
ay
.
üeg
);

250 
	`PUTDATA
(&
Üic
->
ay
.
”egs
[0], 
NUM_AY_REGS
);

251 
i
=0; i<8; i++)

252 
	`PUTU8
(
Üic
->
ay
.
key¡©es
[
i
]);

253 
i
=0; i<3; i++)

254 
	`PUTU32
(
Üic
->
ay
.
tÚ•”
[
i
]);

255 
	`PUTU32
(
Üic
->
ay
.
noi£³r
);

256 
	`PUTU32
(
Üic
->
ay
.
’v³r
);

257 
i
=0; i<3; i++)

259 
	`PUTU16
(
Üic
->
ay
.
tÚeb™
[
i
]);

260 
	`PUTU16
(
Üic
->
ay
.
noi£b™
[
i
]);

261 
	`PUTU16
(
Üic
->
ay
.
vÞ
[
i
]);

263 
	`PUTU16
(
Üic
->
ay
.
Ãwout
);

264 
i
=0; i<3; i++)

265 
	`PUTU32
(
Üic
->
ay
.
ù
[
i
]);

266 
	`PUTU32
(
Üic
->
ay
.
ùn
);

267 
	`PUTU32
(
Üic
->
ay
.
ùe
);

268 
i
=0; i<3; i++)

270 
	`PUTU32
(
Üic
->
ay
.
tÚ•os
[
i
]);

271 
	`PUTU32
(
Üic
->
ay
.
tÚe¡•
[
i
]);

272 
	`PUTU32
(
Üic
->
ay
.
sign
[
i
]);

273 
	`PUTU32
(
Üic
->
ay
.
out
[
i
]);

275 
	`PUTU32
(
Üic
->
ay
.
’vpos
);

276 
	`PUTU32
(
Üic
->
ay
.
cu¼noi£
);

277 
	`PUTU32
(
Üic
->
ay
.
ºd¿ck
);

278 
	`PUTU32
(
Üic
->
ay
.
keyb™d–ay
);

279 
	`PUTU32
(
Üic
->
ay
.
cu¼keyoffs
);

282 
	`NEWBLOCK
("VIA\x00");

283 
	`PUTU8
(
Üic
->
vŸ
.
iä
);

284 
	`PUTU8
(
Üic
->
vŸ
.
œb
);

285 
	`PUTU8
(
Üic
->
vŸ
.
Üb
);

286 
	`PUTU8
(
Üic
->
vŸ
.
œbl
);

287 
	`PUTU8
(
Üic
->
vŸ
.
œa
);

288 
	`PUTU8
(
Üic
->
vŸ
.
Üa
);

289 
	`PUTU8
(
Üic
->
vŸ
.
œ®
);

290 
	`PUTU8
(
Üic
->
vŸ
.
dd¿
);

291 
	`PUTU8
(
Üic
->
vŸ
.
ddrb
);

292 
	`PUTU8
(
Üic
->
vŸ
.
t1l_l
);

293 
	`PUTU8
(
Üic
->
vŸ
.
t1l_h
);

294 
	`PUTU16
(
Üic
->
vŸ
.
t1c
);

295 
	`PUTU8
(
Üic
->
vŸ
.
t2l_l
);

296 
	`PUTU8
(
Üic
->
vŸ
.
t2l_h
);

297 
	`PUTU16
(
Üic
->
vŸ
.
t2c
);

298 
	`PUTU8
(
Üic
->
vŸ
.
¤
);

299 
	`PUTU8
(
Üic
->
vŸ
.
aü
);

300 
	`PUTU8
(
Üic
->
vŸ
.
pü
);

301 
	`PUTU8
(
Üic
->
vŸ
.
›r
);

302 
	`PUTU8
(
Üic
->
vŸ
.
ÿ1
);

303 
	`PUTU8
(
Üic
->
vŸ
.
ÿ2
);

304 
	`PUTU8
(
Üic
->
vŸ
.
cb1
);

305 
	`PUTU8
(
Üic
->
vŸ
.
cb2
);

306 
	`PUTU8
(
Üic
->
vŸ
.
¤couÁ
);

307 
	`PUTU8
(
Üic
->
vŸ
.
t1»lßd
);

308 
	`PUTU8
(
Üic
->
vŸ
.
t2»lßd
);

309 
	`PUTU16
(
Üic
->
vŸ
.
¤time
);

310 
	`PUTU8
(
Üic
->
vŸ
.
t1run
);

311 
	`PUTU8
(
Üic
->
vŸ
.
t2run
);

312 
	`PUTU8
(
Üic
->
vŸ
.
ÿ2pul£
);

313 
	`PUTU8
(
Üic
->
vŸ
.
cb2pul£
);

314 
	`PUTU8
(
Üic
->
vŸ
.
¤Œigg”
);

315 
	`PUTU32
(
Üic
->
vŸ
.
œqb™
);

318 
Üic
->
driv‘y³
)

320 
DRV_JASMIN
:

321 
	`NEWBLOCK
("JSM\x00");

322 
	`PUTU8
(
Üic
->
jasmš
.
Þay
);

323 
	`PUTU8
(
Üic
->
jasmš
.
romdis
);

324 
do_wd17xx
 = 
SDL_TRUE
;

327 
DRV_MICRODISC
:

328 
	`NEWBLOCK
("MDC\x00");

329 
	`PUTU8
(
Üic
->
md
.
¡©us
);

330 
	`PUTU8
(
Üic
->
md
.
šŒq
);

331 
	`PUTU8
(
Üic
->
md
.
drq
);

332 
	`PUTU8
(
Üic
->
md
.
diskrom
);

333 
do_wd17xx
 = 
SDL_TRUE
;

336 
DRV_PRAVETZ
:

338 
Ušt8
 
tmp
[
PRAV_TRACKS_PER_DISK
*
PRAV_RAW_TRACK_SIZE
*2];

339 
	`NEWBLOCK
("PRV\x00");

340 
	`PUTU8
(
Üic
->
´av‘z
.
Þay
);

341 
	`PUTU8
(
Üic
->
´av‘z
.
romdis
);

342 
	`PUTU16
(
Üic
->
´av‘z
.
ex‹nsiÚ
);

343 
	`PUTU8
(
Üic
->
wddisk
.
c_drive
);

344 
	`PUTU32
(
Üic
->
wddisk
.
cu¼’tÝ
);

346 
i
=0; i<2; i++)

348 
	`PUTU8
(
Üic
->
´av‘z
.
drv
[
i
].
vÞume
);

349 
	`PUTU8
(
Üic
->
´av‘z
.
drv
[
i
].
£Ëù
);

350 
	`PUTU8
(
Üic
->
´av‘z
.
drv
[
i
].
mÙÜ_Ú
);

351 
	`PUTU8
(
Üic
->
´av‘z
.
drv
[
i
].
wr™e_»ady
);

352 
	`PUTU16
(
Üic
->
´av‘z
.
drv
[
i
].
by‹
);

353 
	`PUTU16
(
Üic
->
´av‘z
.
drv
[
i
].
h®f_Œack
);

354 
	`PUTU8
(
Üic
->
´av‘z
.
drv
[
i
].
dœty
);

355 
	`PUTU8
(
Üic
->
´av‘z
.
drv
[
i
].
´Ù
);

360 
	`memýy
(
tmp
, &
Üic
->
´av‘z
.
drv
[0].
image
[0][0], 
PRAV_TRACKS_PER_DISK
*
PRAV_RAW_TRACK_SIZE
);

361 
	`memýy
(&
tmp
[
PRAV_TRACKS_PER_DISK
*
PRAV_RAW_TRACK_SIZE
], &
Üic
->
´av‘z
.
drv
[1].
image
[0][0], PRAV_TRACKS_PER_DISK*PRAV_RAW_TRACK_SIZE);

362 
	`DATABLOCK
(
tmp
, 
PRAV_TRACKS_PER_DISK
*
PRAV_RAW_TRACK_SIZE
*2);

364 
i
=0; i<2; i++)

366 ià((
Üic
->
´av‘z
.
drv
[
i
].
pimg
 =ð
NULL
) ||

367 (
Üic
->
´av‘z
.
drv
[
i
].
pimg
->
¿wimage
 =ð
NULL
))

370 
	`NEWBLOCK
("PVD\x00");

371 
	`PUTU16
(
i
);

372 
	`PUTU32
(
Üic
->
wddisk
.
disk
[
i
]->
¿wimag–’
);

374 ià((
Üic
->
´av‘z
.
drv
[
i
].
£ùÜ_±r
 =ð
NULL
) ||

375 (
Üic
->
´av‘z
.
drv
[
i
].
pimg
 =ð
NULL
) ||

376 (
Üic
->
´av‘z
.
drv
[
i
].
pimg
->
¿wimage
 =ð
NULL
))

377 
	`PUTU32
(0xffffffff);

379 
	`PUTU32
((
Ušt32
)(
Üic
->
´av‘z
.
drv
[
i
].
£ùÜ_±r
 - oric->´av‘z.drv[i].
pimg
->
¿wimage
));

380 
	`DATABLOCK
(
Üic
->
wddisk
.
disk
[
i
]->
¿wimage
, oric->wddisk.disk[i]->
¿wimag–’
);

385 ifÐ
do_wd17xx
 )

387 
	`NEWBLOCK
("WDD\x00");

388 
	`PUTU8
(
Üic
->
wddisk
.
r_¡©us
);

389 
	`PUTU8
(
Üic
->
wddisk
.
r_Œack
);

390 
	`PUTU8
(
Üic
->
wddisk
.
r_£ùÜ
);

391 
	`PUTU8
(
Üic
->
wddisk
.
r_d©a
);

392 
	`PUTU8
(
Üic
->
wddisk
.
c_drive
);

393 
	`PUTU8
(
Üic
->
wddisk
.
c_side
);

394 
	`PUTU8
(
Üic
->
wddisk
.
c_Œack
);

395 
	`PUTU8
(
Üic
->
wddisk
.
c_£ùÜ
);

396 
	`PUTU8
(
Üic
->
wddisk
.
£ùy³
);

397 
	`PUTU8
(
Üic
->
wddisk
.
Ï¡_¡•_š
);

398 
	`PUTU32
(
Üic
->
wddisk
.
cu¼’tÝ
);

399 
	`PUTU32
(
Üic
->
wddisk
.
cu¼offs
);

400 
	`PUTU32
(
Üic
->
wddisk
.
d–ayedšt
);

401 
	`PUTU32
(
Üic
->
wddisk
.
d–ayeddrq
);

402 
	`PUTU32
(
Üic
->
wddisk
.
di¡©us
);

403 
	`PUTU32
(
Üic
->
wddisk
.
dd¡©us
);

404 
	`PUTU32
(
Üic
->
wddisk
.
üc
);

406 
i
=0; i<4; i++)

408 ifÐ
Üic
->
wddisk
.
disk
[
i
] )

410 
	`NEWBLOCK
("DSK\x00");

411 
	`PUTU16
(
Üic
->
wddisk
.
disk
[
i
]->
driv’um
);

412 
	`PUTU16
(
Üic
->
wddisk
.
disk
[
i
]->
numŒacks
);

413 
	`PUTU16
(
Üic
->
wddisk
.
disk
[
i
]->
numsides
);

414 
	`PUTU16
(
Üic
->
wddisk
.
disk
[
i
]->
geom‘ry
);

415 
	`PUTU16
(
Üic
->
wddisk
.
disk
[
i
]->
ÿchedŒack
);

416 
	`PUTU16
(
Üic
->
wddisk
.
disk
[
i
]->
ÿchedside
);

417 
	`PUTU32
(
Üic
->
wddisk
.
disk
[
i
]->
¿wimag–’
);

418 
	`DATABLOCK
(
Üic
->
wddisk
.
disk
[
i
]->
¿wimage
, oric->wddisk.disk[i]->
¿wimag–’
);

423 ià(
Üic
->
ty³
 =ð
MACH_TELESTRAT
)

426 
	`NEWBLOCK
("BNK\x00");

427 
i
=0; i<8; i++)

428 
	`PUTU8
(
Üic
->
‹Ë_bªk
[
i
].
ty³
);

429 
	`PUTU8
(
Üic
->
‹Ë_cu¼bªk
);

432 
	`NEWBLOCK
("ACI\x00");

433 
	`PUTDATA
(&
Üic
->
‹Ë_acŸ
.
»gs
[0], 
ACIA_LAST
);

436 
	`NEWBLOCK
("TVA\x00");

437 
	`PUTU8
(
Üic
->
‹Ë_vŸ
.
iä
);

438 
	`PUTU8
(
Üic
->
‹Ë_vŸ
.
œb
);

439 
	`PUTU8
(
Üic
->
‹Ë_vŸ
.
Üb
);

440 
	`PUTU8
(
Üic
->
‹Ë_vŸ
.
œbl
);

441 
	`PUTU8
(
Üic
->
‹Ë_vŸ
.
œa
);

442 
	`PUTU8
(
Üic
->
‹Ë_vŸ
.
Üa
);

443 
	`PUTU8
(
Üic
->
‹Ë_vŸ
.
œ®
);

444 
	`PUTU8
(
Üic
->
‹Ë_vŸ
.
dd¿
);

445 
	`PUTU8
(
Üic
->
‹Ë_vŸ
.
ddrb
);

446 
	`PUTU8
(
Üic
->
‹Ë_vŸ
.
t1l_l
);

447 
	`PUTU8
(
Üic
->
‹Ë_vŸ
.
t1l_h
);

448 
	`PUTU16
(
Üic
->
‹Ë_vŸ
.
t1c
);

449 
	`PUTU8
(
Üic
->
‹Ë_vŸ
.
t2l_l
);

450 
	`PUTU8
(
Üic
->
‹Ë_vŸ
.
t2l_h
);

451 
	`PUTU16
(
Üic
->
‹Ë_vŸ
.
t2c
);

452 
	`PUTU8
(
Üic
->
‹Ë_vŸ
.
¤
);

453 
	`PUTU8
(
Üic
->
‹Ë_vŸ
.
aü
);

454 
	`PUTU8
(
Üic
->
‹Ë_vŸ
.
pü
);

455 
	`PUTU8
(
Üic
->
‹Ë_vŸ
.
›r
);

456 
	`PUTU8
(
Üic
->
‹Ë_vŸ
.
ÿ1
);

457 
	`PUTU8
(
Üic
->
‹Ë_vŸ
.
ÿ2
);

458 
	`PUTU8
(
Üic
->
‹Ë_vŸ
.
cb1
);

459 
	`PUTU8
(
Üic
->
‹Ë_vŸ
.
cb2
);

460 
	`PUTU8
(
Üic
->
‹Ë_vŸ
.
¤couÁ
);

461 
	`PUTU8
(
Üic
->
‹Ë_vŸ
.
t1»lßd
);

462 
	`PUTU8
(
Üic
->
‹Ë_vŸ
.
t2»lßd
);

463 
	`PUTU16
(
Üic
->
‹Ë_vŸ
.
¤time
);

464 
	`PUTU8
(
Üic
->
‹Ë_vŸ
.
t1run
);

465 
	`PUTU8
(
Üic
->
‹Ë_vŸ
.
t2run
);

466 
	`PUTU8
(
Üic
->
‹Ë_vŸ
.
ÿ2pul£
);

467 
	`PUTU8
(
Üic
->
‹Ë_vŸ
.
cb2pul£
);

468 
	`PUTU8
(
Üic
->
‹Ë_vŸ
.
¤Œigg”
);

469 
	`PUTU32
(
Üic
->
‹Ë_vŸ
.
œqb™
);

473 ià(
Üic
->
romsyms
.
numsyms
)

475 
	`NEWBLOCK
("SYR\x00");

476 
i
=0; i<
Üic
->
romsyms
.
numsyms
; i++)

478 
	`PUTSTR
(
Üic
->
romsyms
.
syms
[
i
].
Çme
);

479 
	`PUTU16
(
Üic
->
romsyms
.
syms
[
i
].
addr
);

480 
	`PUTU16
(
Üic
->
romsyms
.
syms
[
i
].
æags
);

484 ià(
Üic
->
u£rsyms
.
numsyms
)

486 
	`NEWBLOCK
("SYU\x00");

487 
i
=0; i<
Üic
->
u£rsyms
.
numsyms
; i++)

489 
	`PUTSTR
(
Üic
->
u£rsyms
.
syms
[
i
].
Çme
);

490 
	`PUTU16
(
Üic
->
u£rsyms
.
syms
[
i
].
addr
);

491 
	`PUTU16
(
Üic
->
u£rsyms
.
syms
[
i
].
æags
);

495 ià(
Üic
->
ty³
 =ð
MACH_TELESTRAT
)

497 
j
=0; j<8; j++)

499 ià(
Üic
->
‹Ë_bªksyms
[
j
].
numsyms
)

501 
Çme
[8];

502 
	`¥rštf
(
Çme
, "SY%d%c", 
j
, 0);

503 
	`NEWBLOCK
(
Çme
);

504 
i
=0; i<
Üic
->
‹Ë_bªksyms
[
j
].
numsyms
; i++)

506 
	`PUTSTR
(
Üic
->
‹Ë_bªksyms
[
j
].
syms
[
i
].
Çme
);

507 
	`PUTU16
(
Üic
->
romsyms
.
syms
[
i
].
addr
);

508 
	`PUTU16
(
Üic
->
romsyms
.
syms
[
i
].
æags
);

515 ià((
ýu
->
ªybp
è|| (ýu->
ªymbp
))

517 
	`NEWBLOCK
("BKP\x00");

518 
i
=0; i<16; i++)

519 
	`PUTU32
(
ýu
->
b»akpošts
[
i
]);

520 
i
=0; i<16; i++)

522 
	`PUTU8
(
ýu
->
memb»akpošts
[
i
].
æags
);

523 
	`PUTU8
(
ýu
->
memb»akpošts
[
i
].
Ï¡v®
);

524 
	`PUTU16
(
ýu
->
memb»akpošts
[
i
].
addr
);

528 
	`WRITEBLOCK
();

529 
	`fþo£
(
f
);

530 
	`ä“
(
buf
);

532 ià(!
ok
)

533 
	`msgbox
(
Üic
, 
MSGBOX_OK
, "Snapshot failed! (3)");

535  
ok
;

536 
	}
}

540 
	sblockh—d”


542 
	mid
[4];

543 
	moff£t
;

544 
	msize
;

545 *
	mbuf
;

546 
blockh—d”
 *
	md©ablock
;

547 
	moffs
;

550 
	gnumhdrs
 = 0;

551 
blockh—d”
 *
	gbkh
 = 
NULL
;

553 
SDL_boÞ
 
	$g‘h—d”s
(
machše
 *
Üic
, 
FILE
 *
f
)

555 
i
;

556 
size
, 
off£t
, 
fžesize
;

557 
hdr
[8];

559 
	`f£ek
(
f
, 0, 
SEEK_END
);

560 
fžesize
 = ()
	`á–l
(
f
);

561 
	`f£ek
(
f
, 0, 
SEEK_SET
);

565 
off£t
 = 0;

566 
numhdrs
 = 0;

567 
off£t
 < 
fžesize
)

569 ià(
	`ä—d
(
hdr
, 8, 1, 
f
) != 1)

571 
	`msgbox
(
Üic
, 
MSGBOX_OK
, "Snapshot†oad failed: Readƒrror (4)");

572 
numhdrs
 = 0;

573  
SDL_FALSE
;

576 
size
 = (
hdr
[4]<<24)|(hdr[5]<<16)|(hdr[6]<<8)|hdr[7];

577 ià((
size
 =ð0è|| ((
off£t
+sizeè> 
fžesize
))

579 
	`msgbox
(
Üic
, 
MSGBOX_OK
, "Snapshot†oad failed: Invalid file structure (5)");

580 
numhdrs
 = 0;

581  
SDL_FALSE
;

584 
numhdrs
++;

585 
	`f£ek
(
f
, 
size
, 
SEEK_CUR
);

586 
off£t
 +ð
size
+8;

590 
bkh
 = (
blockh—d”
 *)
	`m®loc
(
numhdrs
*(blockheader));

591 ià(!
bkh
)

593 
	`msgbox
(
Üic
, 
MSGBOX_OK
, "Snapshot†oad failed: Out of memory (6)");

594 
numhdrs
 = 0;

595  
SDL_FALSE
;

597 
	`mem£t
(
bkh
, 0, 
numhdrs
*(
blockh—d”
));

600 
	`f£ek
(
f
, 0, 
SEEK_SET
);

601 
off£t
 = 0;

602 
i
 = 0;

603 
off£t
 < 
fžesize
)

605 ià(
	`ä—d
(
hdr
, 8, 1, 
f
) != 1)

607 
	`msgbox
(
Üic
, 
MSGBOX_OK
, "Snapshot†oad failed: Readƒrror (7)");

608 
	`ä“
(
bkh
);

609 
bkh
 = 
NULL
;

610 
numhdrs
 = 0;

611  
SDL_FALSE
;

614 
size
 = (
hdr
[4]<<24)|(hdr[5]<<16)|(hdr[6]<<8)|hdr[7];

615 ià((
size
 =ð0è|| ((
off£t
+sizeè> 
fžesize
))

617 
	`msgbox
(
Üic
, 
MSGBOX_OK
, "Snapshot†oad failed: Invalid file structure (8)");

618 
	`ä“
(
bkh
);

619 
bkh
 = 
NULL
;

620 
numhdrs
 = 0;

621  
SDL_FALSE
;

623 
off£t
+=8;

625 
	`memýy
(
bkh
[
i
].
id
, 
hdr
, 4);

626 
bkh
[
i
].
off£t
 = offset;

627 
bkh
[
i
].
size
 = size;

630 ià((
i
>0è&& (
	`memcmp
(
bkh
[i].
id
, "DATA", 4)==0))

632 
bkh
[
i
-1].
d©ablock
 = &bkh[i];

635 
	`f£ek
(
f
, 
size
, 
SEEK_CUR
);

636 
off£t
 +ð
size
;

637 
i
++;

640  
SDL_TRUE
;

641 
	}
}

643 
	$ä“_block
(
blockh—d”
 *
blk
)

645 ià((!
blk
)||(!blk->
buf
)) ;

646 
	`ä“
(
blk
->
buf
);

647 
blk
->
buf
 = 
NULL
;

648 
	}
}

650 
	$ä“_blockh—d”s
()

652 
i
;

654 ià(!
bkh
) ;

656 
i
=0; i<
numhdrs
; i++)

658 ià(
bkh
[
i
].
buf
è
	`ä“
(bkh[i].buf);

660 
	`ä“
(
bkh
);

661 
	}
}

663 
blockh—d”
 *
	$lßd_block
(
machše
 *
Üic
, *
id
, 
FILE
 *
f
, 
SDL_boÞ
 
»quœed
, 
ex³ùedsize
, SDL_boÞ 
d©¬equœed
)

665 
i
;

667 
i
=0; i<
numhdrs
; i++)

669 ià(
	`memcmp
(
bkh
[
i
].
id
, id, 4) == 0)

673 ià(
i
==
numhdrs
)

676 ià(
»quœed
è
	`msgbox
(
Üic
, 
MSGBOX_OK
, "Snapshot†oad failed: Invalid file (9)");

677  
NULL
;

680 ià((
d©¬equœed
è&& (
bkh
[
i
].
d©ablock
 =ð
NULL
))

682 ià(
»quœed
è
	`msgbox
(
Üic
, 
MSGBOX_OK
, "Snapshot†oad failed: Invalid file (10)");

683  
NULL
;

686 ià((
ex³ùedsize
 !ð-1è&& (
bkh
[
i
].
size
 !=ƒxpectedsize))

689 ià(
»quœed
è
	`msgbox
(
Üic
, 
MSGBOX_OK
, "Snapshot†oad failed: Invalid file (11)");

690  
NULL
;

694 ià(
bkh
[
i
].
buf
)

696 
bkh
[
i
].
offs
 = 0;

697  &
bkh
[
i
];

700 
bkh
[
i
].
buf
 = 
	`m®loc
(bkh[i].
size
);

701 ià(!
bkh
[
i
].
buf
)

703 ià(
»quœed
è
	`msgbox
(
Üic
, 
MSGBOX_OK
, "Snapshot†oad failed: Out of memory (12)");

704  
NULL
;

707 
	`f£ek
(
f
, 
bkh
[
i
].
off£t
, 
SEEK_SET
);

708 ià(
	`ä—d
(
bkh
[
i
].
buf
, bkh[i].
size
, 1, 
f
) != 1)

710 ià(
»quœed
è
	`msgbox
(
Üic
, 
MSGBOX_OK
, "Snapshot†oad failed: Readƒrror (13)");

711  
NULL
;

714 
bkh
[
i
].
offs
 = 0;

715  &
bkh
[
i
];

716 
	}
}

718 
SDL_boÞ
 
	$»ad_block
(
machše
 *
Üic
, 
blockh—d”
 *
blk
, 
FILE
 *
f
, 
SDL_boÞ
 
»quœed
, *
de¡buf
)

720 ià(!
blk
)

722 ià(
»quœed
è
	`msgbox
(
Üic
, 
MSGBOX_OK
, "Snapshot†oad failed: Internalƒrror (14)");

723  
SDL_FALSE
;

726 ià(
blk
->
buf
)

728 
	`memýy
(
de¡buf
, 
blk
->
buf
, blk->
size
);

729  
SDL_TRUE
;

732 
	`f£ek
(
f
, 
blk
->
off£t
, 
SEEK_SET
);

733 ià(
	`ä—d
(
de¡buf
, 
blk
->
size
, 1, 
f
) != 1)

735 ià(
»quœed
è
	`msgbox
(
Üic
, 
MSGBOX_OK
, "Snapshot†oad failed: Readƒrror (15)");

736  
SDL_FALSE
;

739  
SDL_TRUE
;

740 
	}
}

742 
Ušt32
 
	$g‘u32
(
blockh—d”
 *
blk
)

744 
Ušt32
 
v®
 = (
blk
->
buf
[blk->
offs
]<<24)|(blk->buf[blk->offs+1]<<16)|(blk->buf[blk->offs+2]<<8)|blk->buf[blk->offs+3];

745 
blk
->
offs
+=4;

746  
v®
;

747 
	}
}

749 
Sšt32
 
	$g‘s32
(
blockh—d”
 *
blk
)

751 
Sšt32
 
v®
 = (
blk
->
buf
[blk->
offs
]<<24)|(blk->buf[blk->offs+1]<<16)|(blk->buf[blk->offs+2]<<8)|blk->buf[blk->offs+3];

752 
blk
->
offs
+=4;

753  
v®
;

754 
	}
}

756 
Ušt16
 
	$g‘u16
(
blockh—d”
 *
blk
)

758 
Ušt16
 
v®
 = (
blk
->
buf
[blk->
offs
]<<8)|blk->buf[blk->offs+1];

759 
blk
->
offs
+=2;

760  
v®
;

761 
	}
}

763 
Sšt16
 
	$g‘s16
(
blockh—d”
 *
blk
)

765 
Sšt16
 
v®
 = (
blk
->
buf
[blk->
offs
]<<8)|blk->buf[blk->offs+1];

766 
blk
->
offs
+=2;

767  
v®
;

768 
	}
}

770 
Ušt8
 
	$g‘u8
(
blockh—d”
 *
blk
)

772  
blk
->
buf
[blk->
offs
++];

773 
	}
}

775 
	$g‘d©a
(
blockh—d”
 *
blk
, *
de¡
, 
size
)

777 
	`memýy
(
de¡
, &
blk
->
buf
[blk->
offs
], 
size
);

778 
blk
->
offs
 +ð
size
;

779 
	}
}

781 
SDL_boÞ
 
	$lßd_¢­shÙ
(
machše
 *
Üic
, *
fž’ame
)

783 
m6502
 *
ýu
 = &
Üic
->cpu;

784 
i
;

785 
SDL_boÞ
 
do_wd17xx
 = 
SDL_FALSE
, 
back2mÚ
 = 
Üic
->
emu_mode
 =ð
EM_DEBUG
;

786 
ty³
, 
driv‘y³
;

787 
FILE
 *
f
 = 
NULL
;

788 
blockh—d”
 *
blk
 = 
NULL
;

790 
f
 = 
	`fÝ’
(
fž’ame
, "rb");

791 ià(!
f
)

793 
	`msgbox
(
Üic
, 
MSGBOX_OK
, "Unableo open snapshot file (16)");

794  
SDL_FALSE
;

797 if(!
	`g‘h—d”s
(
Üic
, 
f
))

799 
	`fþo£
(
f
);

800  
SDL_FALSE
;

804 
blk
 = 
	`lßd_block
(
Üic
, "OSN\x00", 
f
, 
SDL_TRUE
, 21, SDL_TRUE);

805 ià(!
blk
)

807 
	`ä“_blockh—d”s
();

808 
	`fþo£
(
f
);

809  
SDL_FALSE
;

813 
ty³
 = 
blk
->
buf
[0];

814 
driv‘y³
 = 
blk
->
buf
[14];

816 ià(
ty³
 >ð
MACH_LAST
)

818 
	`msgbox
(
Üic
, 
MSGBOX_OK
, "Snapshot†oad failed: Invalid file (17)");

819 
	`ä“_blockh—d”s
();

820 
	`fþo£
(
f
);

821  
SDL_FALSE
;

824 
	`sw­mach
(
Üic
, 
NULL
, (
driv‘y³
<<16)|
ty³
);

827 if((
Üic
->
driv‘y³
 != drivetype) ||

828 (
Üic
->
memsize
 !ð
blk
->
d©ablock
->
size
))

830 
	`msgbox
(
Üic
, 
MSGBOX_OK
, "Snapshot†oad failed: Invalid file (18)");

831 
	`ä“_blockh—d”s
();

832 
	`fþo£
(
f
);

833 ià(
back2mÚ
è
	`£‹mumode
(
Üic
, 
NULL
, 
EM_DEBUG
);

834  
SDL_FALSE
;

838 ià(!
	`»ad_block
(
Üic
, 
blk
->
d©ablock
, 
f
, 
SDL_TRUE
, oric->
mem
))

840 
	`ä“_blockh—d”s
();

841 
	`fþo£
(
f
);

842 ià(
back2mÚ
è
	`£‹mumode
(
Üic
, 
NULL
, 
EM_DEBUG
);

843  
SDL_FALSE
;

847 
	`þ—r_·tches
Ð
Üic
 );

848 ià(
Üic
->
³buf
)

850 
	`ä“
(
Üic
->
³buf
);

851 
Üic
->
³buf
 = 
NULL
;

852 
Üic
->
³Ën
 = 0;

855 
blk
->
offs
 = 1;

856 
Üic
->
ov”þockmuÉ
 = 
	`g‘u32
(
blk
);

857 
Üic
->
ov”þockshiá
 = 
	`g‘u32
(
blk
);

858 
Üic
->
vsync
 = 
	`g‘u16
(
blk
);

859 
Üic
->
romdis
 = 
	`g‘u8
 (
blk
);

860 
Üic
->
romÚ
 = 
	`g‘u8
 (
blk
);

861 
Üic
->
vsynchack
 = 
	`g‘u8
 (
blk
);

862 
blk
->
offs
++;

863 
Üic
->
³turbo
 = 
	`g‘u8
 (
blk
);

864 
Üic
->
vid_mode
 = 
	`g‘u8
 (
blk
);

865 
Üic
->
keym­
 = 
	`g‘u32
(
blk
);

868 
	`ä“_block
(
blk
);

870 
Üic
->
vid_äeq
 = oric->
vid_mode
&2;

871 ifÐ
Üic
->
vid_mode
 & 4 )

873 
Üic
->
vid_addr
 = oric->
vidba£s
[0];

874 
Üic
->
vid_ch_ba£
 = &Üic->
mem
[Üic->
vidba£s
[1]];

876 
Üic
->
vid_addr
 = oric->
vidba£s
[2];

877 
Üic
->
vid_ch_ba£
 = &Üic->
mem
[Üic->
vidba£s
[3]];

881 
blk
 = 
	`lßd_block
(
Üic
, "CPU\x00", 
f
, 
SDL_TRUE
, 21, 
SDL_FALSE
);

882 ià(!
blk
)

884 
	`ä“_blockh—d”s
();

885 
	`fþo£
(
f
);

886 
	`£tm’utoggËs
Ð
Üic
 );

887 ià(
back2mÚ
è
	`£‹mumode
(
Üic
, 
NULL
, 
EM_DEBUG
);

888  
SDL_FALSE
;

891 
ýu
->
cyþes
 = 
	`g‘u32
(
blk
);

892 
ýu
->
pc
 = 
	`g‘u16
(
blk
);

893 
ýu
->
Ï¡pc
 = 
	`g‘u16
(
blk
);

894 
ýu
->
ÿlýc
 = 
	`g‘u16
(
blk
);

895 
ýu
->
ÿlcšt
 = 
	`g‘u16
(
blk
);

896 
ýu
->
nmi
 = 
	`g‘u8
 (
blk
);

897 
ýu
->
a
 = 
	`g‘u8
 (
blk
);

898 
ýu
->
x
 = 
	`g‘u8
 (
blk
);

899 
ýu
->
y
 = 
	`g‘u8
 (
blk
);

900 
ýu
->
¥
 = 
	`g‘u8
 (
blk
);

901 
i
 = 
	`g‘u8
 (
blk
);

902 
	`SETFLAGS
(
i
);

903 
ýu
->
œq
 = 
	`g‘u8
 (
blk
);

904 
ýu
->
nmicouÁ
 = 
	`g‘u8
 (
blk
);

905 
ýu
->
ÿlcÝ
 = 
	`g‘u8
 (
blk
);

908 
	`ä“_block
(
blk
);

911 
blk
 = 
	`lßd_block
(
Üic
, "AY\x00\x00", 
f
, 
SDL_TRUE
, 153, 
SDL_FALSE
);

912 ià(!
blk
)

914 
	`ä“_blockh—d”s
();

915 
	`fþo£
(
f
);

916 
	`£tm’utoggËs
Ð
Üic
 );

917 ià(
back2mÚ
è
	`£‹mumode
(
Üic
, 
NULL
, 
EM_DEBUG
);

918  
SDL_FALSE
;

921 
Üic
->
ay
.
bmode
 = 
	`g‘u8
(
blk
);

922 
Üic
->
ay
.
üeg
 = 
	`g‘u8
(
blk
);

923 
	`g‘d©a
(
blk
, &
Üic
->
ay
.
”egs
[0], 
NUM_AY_REGS
);

924 
	`memýy
(&
Üic
->
ay
.
»gs
[0], &Üic->ay.
”egs
[0], 
NUM_AY_REGS
);

925 
i
=0; i<8; i++)

926 
Üic
->
ay
.
key¡©es
[
i
] = 
	`g‘u8
(
blk
);

927 
i
=0; i<3; i++)

928 
Üic
->
ay
.
tÚ•”
[
i
] = 
	`g‘u32
(
blk
);

929 
Üic
->
ay
.
noi£³r
 = 
	`g‘u32
(
blk
);

930 
Üic
->
ay
.
’v³r
 = 
	`g‘u32
(
blk
);

931 
i
=0; i<3; i++)

933 
Üic
->
ay
.
tÚeb™
[
i
] = 
	`g‘u16
(
blk
);

934 
Üic
->
ay
.
noi£b™
[
i
] = 
	`g‘u16
(
blk
);

935 
Üic
->
ay
.
vÞ
[
i
] = 
	`g‘u16
(
blk
);

937 
Üic
->
ay
.
Ãwout
 = 
	`g‘u16
(
blk
);

938 
i
=0; i<3; i++)

939 
Üic
->
ay
.
ù
[
i
] = 
	`g‘u32
(
blk
);

940 
Üic
->
ay
.
ùn
 = 
	`g‘u32
(
blk
);

941 
Üic
->
ay
.
ùe
 = 
	`g‘u32
(
blk
);

942 
i
=0; i<3; i++)

944 
Üic
->
ay
.
tÚ•os
[
i
] = 
	`g‘u32
(
blk
);

945 
Üic
->
ay
.
tÚe¡•
[
i
] = 
	`g‘u32
(
blk
);

946 
Üic
->
ay
.
sign
[
i
] = 
	`g‘u32
(
blk
);

947 
Üic
->
ay
.
out
[
i
] = 
	`g‘u32
(
blk
);

949 
Üic
->
ay
.
’vpos
 = 
	`g‘u32
(
blk
);

950 
Üic
->
ay
.
cu¼noi£
 = 
	`g‘u32
(
blk
);

951 
Üic
->
ay
.
ºd¿ck
 = 
	`g‘u32
(
blk
);

952 
Üic
->
ay
.
keyb™d–ay
 = 
	`g‘u32
(
blk
);

953 
Üic
->
ay
.
cu¼keyoffs
 = 
	`g‘u32
(
blk
);

956 
	`ä“_block
(
blk
);

959 
blk
 = 
	`lßd_block
(
Üic
, "VIA\x00", 
f
, 
SDL_TRUE
, 39, 
SDL_FALSE
);

960 ià(!
blk
)

962 
	`ä“_blockh—d”s
();

963 
	`fþo£
(
f
);

964 
	`£tm’utoggËs
Ð
Üic
 );

965 ià(
back2mÚ
è
	`£‹mumode
(
Üic
, 
NULL
, 
EM_DEBUG
);

966  
SDL_FALSE
;

969 
Üic
->
vŸ
.
iä
 = 
	`g‘u8
 (
blk
);

970 
Üic
->
vŸ
.
œb
 = 
	`g‘u8
 (
blk
);

971 
Üic
->
vŸ
.
Üb
 = 
	`g‘u8
 (
blk
);

972 
Üic
->
vŸ
.
œbl
 = 
	`g‘u8
 (
blk
);

973 
Üic
->
vŸ
.
œa
 = 
	`g‘u8
 (
blk
);

974 
Üic
->
vŸ
.
Üa
 = 
	`g‘u8
 (
blk
);

975 
Üic
->
vŸ
.
œ®
 = 
	`g‘u8
 (
blk
);

976 
Üic
->
vŸ
.
dd¿
 = 
	`g‘u8
 (
blk
);

977 
Üic
->
vŸ
.
ddrb
 = 
	`g‘u8
 (
blk
);

978 
Üic
->
vŸ
.
t1l_l
 = 
	`g‘u8
 (
blk
);

979 
Üic
->
vŸ
.
t1l_h
 = 
	`g‘u8
 (
blk
);

980 
Üic
->
vŸ
.
t1c
 = 
	`g‘u16
(
blk
);

981 
Üic
->
vŸ
.
t2l_l
 = 
	`g‘u8
 (
blk
);

982 
Üic
->
vŸ
.
t2l_h
 = 
	`g‘u8
 (
blk
);

983 
Üic
->
vŸ
.
t2c
 = 
	`g‘u16
(
blk
);

984 
Üic
->
vŸ
.
¤
 = 
	`g‘u8
 (
blk
);

985 
Üic
->
vŸ
.
aü
 = 
	`g‘u8
 (
blk
);

986 
Üic
->
vŸ
.
pü
 = 
	`g‘u8
 (
blk
);

987 
Üic
->
vŸ
.
›r
 = 
	`g‘u8
 (
blk
);

988 
Üic
->
vŸ
.
ÿ1
 = 
	`g‘u8
 (
blk
);

989 
Üic
->
vŸ
.
ÿ2
 = 
	`g‘u8
 (
blk
);

990 
Üic
->
vŸ
.
cb1
 = 
	`g‘u8
 (
blk
);

991 
Üic
->
vŸ
.
cb2
 = 
	`g‘u8
 (
blk
);

992 
Üic
->
vŸ
.
¤couÁ
 = 
	`g‘u8
 (
blk
);

993 
Üic
->
vŸ
.
t1»lßd
 = 
	`g‘u8
 (
blk
);

994 
Üic
->
vŸ
.
t2»lßd
 = 
	`g‘u8
 (
blk
);

995 
Üic
->
vŸ
.
¤time
 = 
	`g‘u16
(
blk
);

996 
Üic
->
vŸ
.
t1run
 = 
	`g‘u8
 (
blk
);

997 
Üic
->
vŸ
.
t2run
 = 
	`g‘u8
 (
blk
);

998 
Üic
->
vŸ
.
ÿ2pul£
 = 
	`g‘u8
 (
blk
);

999 
Üic
->
vŸ
.
cb2pul£
 = 
	`g‘u8
 (
blk
);

1000 
Üic
->
vŸ
.
¤Œigg”
ð
	`g‘u8
 (
blk
);

1001 
Üic
->
vŸ
.
œqb™
 = 
	`g‘u32
(
blk
);

1004 
	`ä“_block
(
blk
);

1007 
blk
 = 
	`lßd_block
(
Üic
, "TAP\x00", 
f
, 
SDL_TRUE
, 46, 
SDL_FALSE
);

1008 ià(!
blk
)

1010 
	`ä“_blockh—d”s
();

1011 
	`fþo£
(
f
);

1012 
	`£tm’utoggËs
Ð
Üic
 );

1013 ià(
back2mÚ
è
	`£‹mumode
(
Üic
, 
NULL
, 
EM_DEBUG
);

1014  
SDL_FALSE
;

1017 
Üic
->
³b™
 = 
	`g‘u8
 (
blk
);

1018 
Üic
->
³out
 = 
	`g‘u8
 (
blk
);

1019 
Üic
->
³·r™y
 = 
	`g‘u8
 (
blk
);

1020 
Üic
->
³Ën
 = 
	`g‘u32
(
blk
);

1021 
Üic
->
³offs
 = 
	`g‘u32
(
blk
);

1022 
Üic
->
³couÁ
 = 
	`g‘u32
(
blk
);

1023 
Üic
->
³time
 = 
	`g‘u32
(
blk
);

1024 
Üic
->
³dupby‹s
ð
	`g‘u32
(
blk
);

1025 
Üic
->
³hd»nd
 = 
	`g‘u32
(
blk
);

1026 
Üic
->
³d–ay
 = 
	`g‘u32
(
blk
);

1027 
Üic
->
³mÙÜ
 = 
	`g‘u8
 (
blk
);

1028 
Üic
->
³turbo_fÜûoff
ð
	`g‘u8
(
blk
);

1029 
Üic
->
¿w³
 = 
	`g‘u8
 (
blk
);

1030 
Üic
->
nÚ¿w’d
 = 
	`g‘u32
(
blk
);

1031 
Üic
->
³h™’d
 = 
	`g‘u32
(
blk
);

1032 
Üic
->
³turbo_sync¡ack
 = 
	`g‘u32
(
blk
);

1034 ià(!
blk
->
d©ablock
)

1036 
Üic
->
³Ën
 = 0;

1037 
Üic
->
³offs
 = 0;

1041 
Üic
->
³buf
 = 
	`m®loc
(
blk
->
d©ablock
->
size
);

1042 ià(!
Üic
->
³buf
)

1044 
	`msgbox
(
Üic
, 
MSGBOX_OK
, "Snapshot†oad failed: Out of memory (19)");

1045 
	`ä“_blockh—d”s
();

1046 
	`fþo£
(
f
);

1047 
	`£tm’utoggËs
Ð
Üic
 );

1048 ià(
back2mÚ
è
	`£‹mumode
(
Üic
, 
NULL
, 
EM_DEBUG
);

1049  
SDL_FALSE
;

1052 ià(!
	`»ad_block
(
Üic
, 
blk
->
d©ablock
, 
f
, 
SDL_TRUE
, oric->
³buf
))

1054 
	`ä“_blockh—d”s
();

1055 
	`fþo£
(
f
);

1056 
	`£tm’utoggËs
Ð
Üic
 );

1057 ià(
back2mÚ
è
	`£‹mumode
(
Üic
, 
NULL
, 
EM_DEBUG
);

1058  
SDL_FALSE
;

1063 
	`ä“_block
(
blk
);

1066 ià((
blk
 = 
	`lßd_block
(
Üic
, "PCH\x00", 
f
, 
SDL_FALSE
, 76, SDL_FALSE)))

1068 
Üic
->
pch_fd_þßd_g‘Çme_pc
 = 
	`g‘u32
(
blk
);

1069 
Üic
->
pch_fd_c§ve_g‘Çme_pc
 = 
	`g‘u32
(
blk
);

1070 
Üic
->
pch_fd_¡Üe_g‘Çme_pc
 = 
	`g‘u32
(
blk
);

1071 
Üic
->
pch_fd_»ÿÎ_g‘Çme_pc
 = 
	`g‘u32
(
blk
);

1072 
Üic
->
pch_fd_g‘Çme_addr
 = 
	`g‘u32
(
blk
);

1073 
Üic
->
pch_fd_avažabË
 = 
	`g‘u8
(
blk
);

1074 
Üic
->
pch_‰_g‘sync_pc
 = 
	`g‘u32
(
blk
);

1075 
Üic
->
pch_‰_g‘sync_’d_pc
 = 
	`g‘u32
(
blk
);

1076 
Üic
->
pch_‰_g‘sync_loÝ_pc
 = 
	`g‘u32
(
blk
);

1077 
Üic
->
pch_‰_»adby‹_pc
 = 
	`g‘u32
(
blk
);

1078 
Üic
->
pch_‰_»adby‹_’d_pc
 = 
	`g‘u32
(
blk
);

1079 
Üic
->
pch_‰_»adby‹_¡Üeby‹_addr
 = 
	`g‘u32
(
blk
);

1080 
Üic
->
pch_‰_»adby‹_¡Üez”o_addr
 = 
	`g‘u32
(
blk
);

1081 
Üic
->
pch_‰_putby‹_pc
 = 
	`g‘u32
(
blk
);

1082 
Üic
->
pch_‰_putby‹_’d_pc
 = 
	`g‘u32
(
blk
);

1083 
Üic
->
pch_‰_c§ve_’d_pc
 = 
	`g‘u32
(
blk
);

1084 
Üic
->
pch_‰_¡Üe_’d_pc
 = 
	`g‘u32
(
blk
);

1085 
Üic
->
pch_‰_wr™–—d”_pc
 = 
	`g‘u32
(
blk
);

1086 
Üic
->
pch_‰_wr™–—d”_’d_pc
 = 
	`g‘u32
(
blk
);

1087 
Üic
->
pch_‰_»adby‹_£tÿ¼y
 = 
	`g‘u8
 (
blk
);

1088 
Üic
->
pch_‰_avažabË
 = 
	`g‘u8
 (
blk
);

1089 
Üic
->
pch_‰_§ve_avažabË
 = 
	`g‘u8
 (
blk
);

1092 
	`ä“_block
(
blk
);

1095 
Üic
->
driv‘y³
)

1097 
DRV_JASMIN
:

1099 
blk
 = 
	`lßd_block
(
Üic
, "JSM\x00", 
f
, 
SDL_TRUE
, 2, 
SDL_FALSE
);

1100 ià(!
blk
)

1102 
	`ä“_blockh—d”s
();

1103 
	`fþo£
(
f
);

1104 
	`£tm’utoggËs
Ð
Üic
 );

1105 ià(
back2mÚ
è
	`£‹mumode
(
Üic
, 
NULL
, 
EM_DEBUG
);

1106  
SDL_FALSE
;

1109 
Üic
->
jasmš
.
Þay
 = 
	`g‘u8
(
blk
);

1110 
Üic
->
jasmš
.
romdis
 = 
	`g‘u8
(
blk
);

1113 
	`ä“_block
(
blk
);

1115 
do_wd17xx
 = 
SDL_TRUE
;

1118 
DRV_MICRODISC
:

1120 
blk
 = 
	`lßd_block
(
Üic
, "MDC\x00", 
f
, 
SDL_TRUE
, 4, 
SDL_FALSE
);

1121 ià(!
blk
)

1123 
	`ä“_blockh—d”s
();

1124 
	`fþo£
(
f
);

1125 
	`£tm’utoggËs
Ð
Üic
 );

1126 ià(
back2mÚ
è
	`£‹mumode
(
Üic
, 
NULL
, 
EM_DEBUG
);

1127  
SDL_FALSE
;

1130 
Üic
->
md
.
¡©us
 = 
	`g‘u8
(
blk
);

1131 
Üic
->
md
.
šŒq
 = 
	`g‘u8
(
blk
);

1132 
Üic
->
md
.
drq
 = 
	`g‘u8
(
blk
);

1133 
Üic
->
md
.
diskrom
 = 
	`g‘u8
(
blk
);

1136 
	`ä“_block
(
blk
);

1138 
do_wd17xx
 = 
SDL_TRUE
;

1141 
DRV_PRAVETZ
:

1143 
Ušt8
 
tmp
[
PRAV_TRACKS_PER_DISK
*
PRAV_RAW_TRACK_SIZE
*2];

1144 
Ušt32
 
offs
;

1147 
blk
 = 
	`lßd_block
(
Üic
, "PRV\x00", 
f
, 
SDL_TRUE
, 9+2*10, SDL_TRUE);

1148 ià(!
blk
)

1150 
	`ä“_blockh—d”s
();

1151 
	`fþo£
(
f
);

1152 
	`£tm’utoggËs
Ð
Üic
 );

1153 ià(
back2mÚ
è
	`£‹mumode
(
Üic
, 
NULL
, 
EM_DEBUG
);

1154  
SDL_FALSE
;

1157 
Üic
->
´av‘z
.
Þay
 = 
	`g‘u8
(
blk
);

1158 
Üic
->
´av‘z
.
romdis
 = 
	`g‘u8
(
blk
);

1159 
Üic
->
´av‘z
.
ex‹nsiÚ
 = 
	`g‘u16
(
blk
);

1160 
Üic
->
wddisk
.
c_drive
 = 
	`g‘u8
(
blk
);

1161 
Üic
->
wddisk
.
cu¼’tÝ
 = 
	`g‘u32
(
blk
);

1163 
i
=0; i<2; i++)

1165 
Üic
->
´av‘z
.
drv
[
i
].
vÞume
 = 
	`g‘u8
(
blk
);

1166 
Üic
->
´av‘z
.
drv
[
i
].
£Ëù
 = 
	`g‘u8
(
blk
);

1167 
Üic
->
´av‘z
.
drv
[
i
].
mÙÜ_Ú
 = 
	`g‘u8
(
blk
);

1168 
Üic
->
´av‘z
.
drv
[
i
].
wr™e_»ady
 = 
	`g‘u8
(
blk
);

1169 
Üic
->
´av‘z
.
drv
[
i
].
by‹
 = 
	`g‘u16
(
blk
);

1170 
Üic
->
´av‘z
.
drv
[
i
].
h®f_Œack
 = 
	`g‘u16
(
blk
);

1171 
Üic
->
´av‘z
.
drv
[
i
].
dœty
 = 
	`g‘u8
(
blk
);

1172 
Üic
->
´av‘z
.
drv
[
i
].
´Ù
 = 
	`g‘u8
(
blk
);

1175 ià(!
	`»ad_block
(
Üic
, 
blk
->
d©ablock
, 
f
, 
SDL_TRUE
, 
tmp
))

1177 
	`ä“_blockh—d”s
();

1178 
	`fþo£
(
f
);

1179 
	`£tm’utoggËs
Ð
Üic
 );

1180 ià(
back2mÚ
è
	`£‹mumode
(
Üic
, 
NULL
, 
EM_DEBUG
);

1181  
SDL_FALSE
;

1184 
	`memýy
(&
Üic
->
´av‘z
.
drv
[0].
image
[0][0], 
tmp
, 
PRAV_TRACKS_PER_DISK
*
PRAV_RAW_TRACK_SIZE
);

1185 
	`memýy
(&
Üic
->
´av‘z
.
drv
[1].
image
[0][0], &
tmp
[
PRAV_TRACKS_PER_DISK
*
PRAV_RAW_TRACK_SIZE
], PRAV_TRACKS_PER_DISK*PRAV_RAW_TRACK_SIZE);

1187 
	`ä“_block
(
blk
);

1190 (
blk
 = 
	`lßd_block
(
Üic
, "PVD\x00", 
f
, 
SDL_FALSE
, -1, SDL_FALSE)))

1193 
i
 = 
	`g‘u16
(
blk
);

1194 ià((
i
<0è|| (i>1è|| (
Üic
->
wddisk
.
disk
[i] !ð
NULL
è|| (!
blk
->
d©ablock
è|| (blk->
size
 != 10))

1196 
	`msgbox
(
Üic
, 
MSGBOX_OK
, "Snapshot†oad failed: Invalid file (PVD1)");

1197 
	`ä“_blockh—d”s
();

1198 
	`fþo£
(
f
);

1199 
	`£tm’utoggËs
Ð
Üic
 );

1200 ià(
back2mÚ
è
	`£‹mumode
(
Üic
, 
NULL
, 
EM_DEBUG
);

1201  
SDL_FALSE
;

1205 
Üic
->
wddisk
.
disk
[
i
] = (
diskimage
 *)
	`m®loc
((diskimage));

1206 ià(!
Üic
->
wddisk
.
disk
[
i
])

1208 
	`msgbox
(
Üic
, 
MSGBOX_OK
, "Snapshot†oad failed: Out of memory (PVD2)");

1209 
	`ä“_blockh—d”s
();

1210 
	`fþo£
(
f
);

1211 
	`£tm’utoggËs
Ð
Üic
 );

1212 ià(
back2mÚ
è
	`£‹mumode
(
Üic
, 
NULL
, 
EM_DEBUG
);

1213  
SDL_FALSE
;

1215 
	`mem£t
(
Üic
->
wddisk
.
disk
[
i
], 0, (
diskimage
));

1218 
Üic
->
wddisk
.
disk
[
i
]->
¿wimage
 = 
	`m®loc
(
blk
->
d©ablock
->
size
);

1219 ià(!
Üic
->
wddisk
.
disk
[
i
])

1221 
	`ä“
(
Üic
->
wddisk
.
disk
[
i
]);

1222 
Üic
->
wddisk
.
disk
[
i
] = 
NULL
;

1223 
	`msgbox
(
Üic
, 
MSGBOX_OK
, "Snapshot†oad failed: Out of memory (PVD3)");

1224 
	`ä“_blockh—d”s
();

1225 
	`fþo£
(
f
);

1226 
	`£tm’utoggËs
Ð
Üic
 );

1227 ià(
back2mÚ
è
	`£‹mumode
(
Üic
, 
NULL
, 
EM_DEBUG
);

1228  
SDL_FALSE
;

1232 ià(!
	`»ad_block
(
Üic
, 
blk
->
d©ablock
, 
f
, 
SDL_TRUE
, oric->
wddisk
.
disk
[
i
]->
¿wimage
))

1234 
	`ä“
(
Üic
->
wddisk
.
disk
[
i
]->
¿wimage
);

1235 
	`ä“
(
Üic
->
wddisk
.
disk
[
i
]);

1236 
Üic
->
wddisk
.
disk
[
i
] = 
NULL
;

1237 
	`ä“_blockh—d”s
();

1238 
	`fþo£
(
f
);

1239 
	`£tm’utoggËs
Ð
Üic
 );

1240 ià(
back2mÚ
è
	`£‹mumode
(
Üic
, 
NULL
, 
EM_DEBUG
);

1241  
SDL_FALSE
;

1244 
Üic
->
wddisk
.
disk
[
i
]->
ÿchedŒack
 = -1;

1245 
Üic
->
wddisk
.
disk
[
i
]->
ÿchedside
 = -1;

1248 
Üic
->
wddisk
.
disk
[
i
]->
driv’um
 = i;

1249 
Üic
->
wddisk
.
disk
[
i
]->
¿wimag–’
 = 
	`g‘u32
(
blk
);

1251 
	`¥rštf
(
Üic
->
wddisk
.
disk
[
i
]->
fž’ame
, "%s%cSNAPDISK%d.DSK", 
disk·th
, 
PATHSEP
, i);

1253 
offs
 = 
	`g‘u32
(
blk
);

1254 
Üic
->
´av‘z
.
drv
[
i
].
pimg
 = oric->
wddisk
.
disk
[i];

1255 ià(
offs
 == 0xffffffff)

1256 
Üic
->
´av‘z
.
drv
[
i
].
£ùÜ_±r
 = 
NULL
;

1258 
Üic
->
´av‘z
.
drv
[
i
].
£ùÜ_±r
 = &Üic->´av‘z.drv[i].
pimg
->
¿wimage
[
offs
];

1260 
blk
->
id
[0] = 0;

1261 
	`ä“_block
(
blk
);

1266 ià(
do_wd17xx
)

1268 
Ušt8
 
disks
[4];

1271 
blk
 = 
	`lßd_block
(
Üic
, "WDD\x00", 
f
, 
SDL_TRUE
, 38, 
SDL_FALSE
);

1272 ià(!
blk
)

1274 
	`ä“_blockh—d”s
();

1275 
	`fþo£
(
f
);

1276 
	`£tm’utoggËs
Ð
Üic
 );

1277 ià(
back2mÚ
è
	`£‹mumode
(
Üic
, 
NULL
, 
EM_DEBUG
);

1278  
SDL_FALSE
;

1281 
Üic
->
wddisk
.
r_¡©us
 = 
	`g‘u8
 (
blk
);

1282 
Üic
->
wddisk
.
r_Œack
 = 
	`g‘u8
 (
blk
);

1283 
Üic
->
wddisk
.
r_£ùÜ
 = 
	`g‘u8
 (
blk
);

1284 
Üic
->
wddisk
.
r_d©a
 = 
	`g‘u8
 (
blk
);

1285 
Üic
->
wddisk
.
c_drive
 = 
	`g‘u8
 (
blk
);

1286 
Üic
->
wddisk
.
c_side
 = 
	`g‘u8
 (
blk
);

1287 
Üic
->
wddisk
.
c_Œack
 = 
	`g‘u8
 (
blk
);

1288 
Üic
->
wddisk
.
c_£ùÜ
 = 
	`g‘u8
 (
blk
);

1289 
Üic
->
wddisk
.
£ùy³
 = 
	`g‘u8
 (
blk
);

1290 
Üic
->
wddisk
.
Ï¡_¡•_š
 = 
	`g‘u8
 (
blk
);

1291 
	`g‘d©a
(
blk
, 
disks
, 4);

1292 
Üic
->
wddisk
.
cu¼’tÝ
 = 
	`g‘u32
(
blk
);

1293 
Üic
->
wddisk
.
cu¼offs
 = 
	`g‘u32
(
blk
);

1294 
Üic
->
wddisk
.
d–ayedšt
 = 
	`g‘u32
(
blk
);

1295 
Üic
->
wddisk
.
d–ayeddrq
 = 
	`g‘u32
(
blk
);

1296 
Üic
->
wddisk
.
di¡©us
 = 
	`g‘u32
(
blk
);

1297 
Üic
->
wddisk
.
dd¡©us
 = 
	`g‘u32
(
blk
);

1298 
Üic
->
wddisk
.
üc
 = 
	`g‘u32
(
blk
);

1301 
	`ä“_block
(
blk
);

1304 (
blk
 = 
	`lßd_block
(
Üic
, "DSK\x00", 
f
, 
SDL_FALSE
, -1, SDL_FALSE)))

1306 
Œack_to_ÿche
=-1, 
side_to_ÿche
=-1;

1309 
i
 = 
	`g‘u16
(
blk
);

1310 ià((
i
<0è|| (i>3è|| (
Üic
->
wddisk
.
disk
[i] !ð
NULL
è|| (!
blk
->
d©ablock
è|| (blk->
size
 != 16))

1312 
	`msgbox
(
Üic
, 
MSGBOX_OK
, "Snapshot†oad failed: Invalid file (20)");

1313 
	`ä“_blockh—d”s
();

1314 
	`fþo£
(
f
);

1315 
	`£tm’utoggËs
Ð
Üic
 );

1316 ià(
back2mÚ
è
	`£‹mumode
(
Üic
, 
NULL
, 
EM_DEBUG
);

1317  
SDL_FALSE
;

1321 
Üic
->
wddisk
.
disk
[
i
] = (
diskimage
 *)
	`m®loc
((diskimage));

1322 ià(!
Üic
->
wddisk
.
disk
[
i
])

1324 
	`msgbox
(
Üic
, 
MSGBOX_OK
, "Snapshot†oad failed: Out of memory (21)");

1325 
	`ä“_blockh—d”s
();

1326 
	`fþo£
(
f
);

1327 
	`£tm’utoggËs
Ð
Üic
 );

1328 ià(
back2mÚ
è
	`£‹mumode
(
Üic
, 
NULL
, 
EM_DEBUG
);

1329  
SDL_FALSE
;

1331 
	`mem£t
(
Üic
->
wddisk
.
disk
[
i
], 0, (
diskimage
));

1334 
Üic
->
wddisk
.
disk
[
i
]->
¿wimage
 = 
	`m®loc
(
blk
->
d©ablock
->
size
);

1335 ià(!
Üic
->
wddisk
.
disk
[
i
])

1337 
	`ä“
(
Üic
->
wddisk
.
disk
[
i
]);

1338 
Üic
->
wddisk
.
disk
[
i
] = 
NULL
;

1339 
	`msgbox
(
Üic
, 
MSGBOX_OK
, "Snapshot†oad failed: Out of memory (22)");

1340 
	`ä“_blockh—d”s
();

1341 
	`fþo£
(
f
);

1342 
	`£tm’utoggËs
Ð
Üic
 );

1343 ià(
back2mÚ
è
	`£‹mumode
(
Üic
, 
NULL
, 
EM_DEBUG
);

1344  
SDL_FALSE
;

1348 ià(!
	`»ad_block
(
Üic
, 
blk
->
d©ablock
, 
f
, 
SDL_TRUE
, oric->
wddisk
.
disk
[
i
]->
¿wimage
))

1350 
	`ä“
(
Üic
->
wddisk
.
disk
[
i
]->
¿wimage
);

1351 
	`ä“
(
Üic
->
wddisk
.
disk
[
i
]);

1352 
Üic
->
wddisk
.
disk
[
i
] = 
NULL
;

1353 
	`ä“_blockh—d”s
();

1354 
	`fþo£
(
f
);

1355 
	`£tm’utoggËs
Ð
Üic
 );

1356 ià(
back2mÚ
è
	`£‹mumode
(
Üic
, 
NULL
, 
EM_DEBUG
);

1357  
SDL_FALSE
;

1360 
Üic
->
wddisk
.
disk
[
i
]->
ÿchedŒack
 = -1;

1361 
Üic
->
wddisk
.
disk
[
i
]->
ÿchedside
 = -1;

1364 
Üic
->
wddisk
.
disk
[
i
]->
driv’um
 = i;

1365 
Üic
->
wddisk
.
disk
[
i
]->
numŒacks
 = 
	`g‘u16
(
blk
);

1366 
Üic
->
wddisk
.
disk
[
i
]->
numsides
 = 
	`g‘u16
(
blk
);

1367 
Üic
->
wddisk
.
disk
[
i
]->
geom‘ry
 = 
	`g‘u16
(
blk
);

1368 
Œack_to_ÿche
 = 
	`g‘s16
(
blk
);

1369 
side_to_ÿche
 = 
	`g‘s16
(
blk
);

1370 
Üic
->
wddisk
.
disk
[
i
]->
¿wimag–’
 = 
	`g‘u32
(
blk
);

1372 ià((
Œack_to_ÿche
 !ð-1è&& (
side_to_ÿche
 != -1))

1373 
	`diskimage_ÿch‘¿ck
(
Üic
->
wddisk
.
disk
[
i
], 
Œack_to_ÿche
, 
side_to_ÿche
);

1375 ià(
Üic
->
wddisk
.
c_drive
 =ð
i
)

1376 
Üic
->
wddisk
.
cu¼£ùÜ
 = 
	`wd17xx_fšd_£ùÜ
(&Üic->wddisk, oric->wddisk.
r_£ùÜ
);

1378 
	`¥rštf
(
Üic
->
wddisk
.
disk
[
i
]->
fž’ame
, "%s%cSNAPDISK%d.DSK", 
disk·th
, 
PATHSEP
, i);

1380 
blk
->
id
[0] = 0;

1381 
	`ä“_block
(
blk
);

1385 ià(
Üic
->
ty³
 =ð
MACH_TELESTRAT
)

1388 
blk
 = 
	`lßd_block
(
Üic
, "BNK\x00", 
f
, 
SDL_TRUE
, 9, 
SDL_FALSE
);

1389 ià(!
blk
)

1391 
	`ä“_blockh—d”s
();

1392 
	`fþo£
(
f
);

1393 
	`£tm’utoggËs
Ð
Üic
 );

1394 ià(
back2mÚ
è
	`£‹mumode
(
Üic
, 
NULL
, 
EM_DEBUG
);

1395  
SDL_FALSE
;

1398 
i
=0; i<8; i++)

1399 
Üic
->
‹Ë_bªk
[
i
].
ty³
 = 
	`g‘u8
(
blk
);

1400 
Üic
->
‹Ë_cu¼bªk
 = 
	`g‘u8
(
blk
);

1403 
	`ä“_block
(
blk
);

1406 
blk
 = 
	`lßd_block
(
Üic
, "ACI\x00", 
f
, 
SDL_TRUE
, 
ACIA_LAST
, 
SDL_FALSE
);

1407 ià(!
blk
)

1409 
	`ä“_blockh—d”s
();

1410 
	`fþo£
(
f
);

1411 
	`£tm’utoggËs
Ð
Üic
 );

1412 ià(
back2mÚ
è
	`£‹mumode
(
Üic
, 
NULL
, 
EM_DEBUG
);

1413  
SDL_FALSE
;

1416 
	`g‘d©a
(
blk
, &
Üic
->
‹Ë_acŸ
.
»gs
[0], 
ACIA_LAST
);

1419 
	`ä“_block
(
blk
);

1422 
blk
 = 
	`lßd_block
(
Üic
, "AUX\x00", 
f
, 
SDL_TRUE
, 
ACIA_LAST
, 
SDL_FALSE
);

1423 ià(!
blk
)

1425 
	`ä“_blockh—d”s
();

1426 
	`fþo£
(
f
);

1427 
	`£tm’utoggËs
Ð
Üic
 );

1428 ià(
back2mÚ
è
	`£‹mumode
(
Üic
, 
NULL
, 
EM_DEBUG
);

1429  
SDL_FALSE
;

1433 
	`ä“_block
(
blk
);

1436 
blk
 = 
	`lßd_block
(
Üic
, "TVA\x00", 
f
, 
SDL_TRUE
, 39, 
SDL_FALSE
);

1437 ià(!
blk
)

1439 
	`ä“_blockh—d”s
();

1440 
	`fþo£
(
f
);

1441 
	`£tm’utoggËs
Ð
Üic
 );

1442 ià(
back2mÚ
è
	`£‹mumode
(
Üic
, 
NULL
, 
EM_DEBUG
);

1443  
SDL_FALSE
;

1446 
Üic
->
‹Ë_vŸ
.
iä
 = 
	`g‘u8
 (
blk
);

1447 
Üic
->
‹Ë_vŸ
.
œb
 = 
	`g‘u8
 (
blk
);

1448 
Üic
->
‹Ë_vŸ
.
Üb
 = 
	`g‘u8
 (
blk
);

1449 
Üic
->
‹Ë_vŸ
.
œbl
 = 
	`g‘u8
 (
blk
);

1450 
Üic
->
‹Ë_vŸ
.
œa
 = 
	`g‘u8
 (
blk
);

1451 
Üic
->
‹Ë_vŸ
.
Üa
 = 
	`g‘u8
 (
blk
);

1452 
Üic
->
‹Ë_vŸ
.
œ®
 = 
	`g‘u8
 (
blk
);

1453 
Üic
->
‹Ë_vŸ
.
dd¿
 = 
	`g‘u8
 (
blk
);

1454 
Üic
->
‹Ë_vŸ
.
ddrb
 = 
	`g‘u8
 (
blk
);

1455 
Üic
->
‹Ë_vŸ
.
t1l_l
 = 
	`g‘u8
 (
blk
);

1456 
Üic
->
‹Ë_vŸ
.
t1l_h
 = 
	`g‘u8
 (
blk
);

1457 
Üic
->
‹Ë_vŸ
.
t1c
 = 
	`g‘u16
(
blk
);

1458 
Üic
->
‹Ë_vŸ
.
t2l_l
 = 
	`g‘u8
 (
blk
);

1459 
Üic
->
‹Ë_vŸ
.
t2l_h
 = 
	`g‘u8
 (
blk
);

1460 
Üic
->
‹Ë_vŸ
.
t2c
 = 
	`g‘u16
(
blk
);

1461 
Üic
->
‹Ë_vŸ
.
¤
 = 
	`g‘u8
 (
blk
);

1462 
Üic
->
‹Ë_vŸ
.
aü
 = 
	`g‘u8
 (
blk
);

1463 
Üic
->
‹Ë_vŸ
.
pü
 = 
	`g‘u8
 (
blk
);

1464 
Üic
->
‹Ë_vŸ
.
›r
 = 
	`g‘u8
 (
blk
);

1465 
Üic
->
‹Ë_vŸ
.
ÿ1
 = 
	`g‘u8
 (
blk
);

1466 
Üic
->
‹Ë_vŸ
.
ÿ2
 = 
	`g‘u8
 (
blk
);

1467 
Üic
->
‹Ë_vŸ
.
cb1
 = 
	`g‘u8
 (
blk
);

1468 
Üic
->
‹Ë_vŸ
.
cb2
 = 
	`g‘u8
 (
blk
);

1469 
Üic
->
‹Ë_vŸ
.
¤couÁ
 = 
	`g‘u8
 (
blk
);

1470 
Üic
->
‹Ë_vŸ
.
t1»lßd
 = 
	`g‘u8
 (
blk
);

1471 
Üic
->
‹Ë_vŸ
.
t2»lßd
 = 
	`g‘u8
 (
blk
);

1472 
Üic
->
‹Ë_vŸ
.
¤time
 = 
	`g‘u16
(
blk
);

1473 
Üic
->
‹Ë_vŸ
.
t1run
 = 
	`g‘u8
 (
blk
);

1474 
Üic
->
‹Ë_vŸ
.
t2run
 = 
	`g‘u8
 (
blk
);

1475 
Üic
->
‹Ë_vŸ
.
ÿ2pul£
 = 
	`g‘u8
 (
blk
);

1476 
Üic
->
‹Ë_vŸ
.
cb2pul£
 = 
	`g‘u8
 (
blk
);

1477 
Üic
->
‹Ë_vŸ
.
¤Œigg”
ð
	`g‘u8
 (
blk
);

1478 
Üic
->
‹Ë_vŸ
.
œqb™
 = 
	`g‘u32
(
blk
);

1481 
	`ä“_block
(
blk
);

1485 ià((
blk
 = 
	`lßd_block
(
Üic
, "SYR\x00", 
f
, 
SDL_FALSE
, -1, SDL_FALSE)))

1487 
	`mÚ_symsäom¢­shÙ
(&
Üic
->
romsyms
, 
blk
->
buf
, blk->
size
);

1488 
	`ä“_block
(
blk
);

1492 ià((
blk
 = 
	`lßd_block
(
Üic
, "SYU\x00", 
f
, 
SDL_FALSE
, -1, SDL_FALSE)))

1494 
	`mÚ_symsäom¢­shÙ
(&
Üic
->
u£rsyms
, 
blk
->
buf
, blk->
size
);

1495 
	`ä“_block
(
blk
);

1498 ià(
Üic
->
ty³
 =ð
MACH_TELESTRAT
)

1500 
i
=0; i<8; i++)

1502 
Çme
[8];

1503 
	`¥rštf
(
Çme
, "SY%d%c", 
i
, 0);

1504 ià((
blk
 = 
	`lßd_block
(
Üic
, 
Çme
, 
f
, 
SDL_FALSE
, -1, SDL_FALSE)))

1506 
	`mÚ_symsäom¢­shÙ
(&
Üic
->
‹Ë_bªksyms
[
i
], 
blk
->
buf
, blk->
size
);

1507 
	`ä“_block
(
blk
);

1513 ià((
blk
 = 
	`lßd_block
(
Üic
, "BKP\x00", 
f
, 
SDL_FALSE
, -1, SDL_FALSE)))

1515 
ýu
->
ªybp
 = 
SDL_FALSE
;

1516 
ýu
->
ªymbp
 = 
SDL_FALSE
;

1518 
i
=0; i<16; i++)

1520 
ýu
->
b»akpošts
[
i
] = 
	`g‘s32
(
blk
);

1521 ià(
ýu
->
b»akpošts
[
i
] !ð-1èýu->
ªybp
 = 
SDL_TRUE
;

1524 
i
=0; i<16; i++)

1526 
ýu
->
memb»akpošts
[
i
].
æags
 = 
	`g‘u8
(
blk
);

1527 
ýu
->
memb»akpošts
[
i
].
Ï¡v®
 = 
	`g‘u8
(
blk
);

1528 
ýu
->
memb»akpošts
[
i
].
addr
 = 
	`g‘u16
(
blk
);

1529 ià(
ýu
->
memb»akpošts
[
i
].
æags
èýu->
ªymbp
 = 
SDL_TRUE
;

1532 
	`ä“_block
(
blk
);

1535 
	`ä“_blockh—d”s
();

1536 
	`fþo£
(
f
);

1537 
	`£tm’utoggËs
Ð
Üic
 );

1538 ià(
back2mÚ
è
	`£‹mumode
(
Üic
, 
NULL
, 
EM_DEBUG
);

1539  
SDL_TRUE
;

1540 
	}
}

	@snapshot.h

23 
SDL_boÞ
 
§ve_¢­shÙ
(
machše
 *
Üic
, *
fž’ame
);

24 
SDL_boÞ
 
lßd_¢­shÙ
(
machše
 *
Üic
, *
fž’ame
);

	@system.h

22 #iâdeà
ORICUTRON_SYSTEM_H


23 
	#ORICUTRON_SYSTEM_H


	)

25 #iâdeà
_MSC_VER


26 
	~<uni¡d.h
>

28 
	#_CRTDBG_MAP_ALLOC


	)

29 
	~<¡dlib.h
>

30 
	~<ütdbg.h
>

31 
	~"msvc/uni¡d.h
"

35 
	#AUDIO_FREQ
 44100

	)

38 #ià
defšed
(
__amigaos4__
)

40 
	#PATHSEP
 '/'

	)

41 
	#PATHSEPSTR
 "/"

	)

42 
	#FILEPREFIX
 "PROGDIR:"

	)

43 
	#ROMPREFIX
 "PROGDIR:roms/"

	)

44 
	#IMAGEPREFIX
 "PROGDIR:images/"

	)

46 #–ià
defšed
(
WIN32
)

48 
	#PATHSEP
 '\\'

	)

49 
	#PATHSEPSTR
 "\\"

	)

50 
	#FILEPREFIX


	)

51 
	#ROMPREFIX
 "roms\\"

	)

52 
	#IMAGEPREFIX
 "images\\"

	)

56 
	#PATHSEP
 '/'

	)

57 
	#PATHSEPSTR
 "/"

	)

58 
	#FILEPREFIX


	)

59 
	#ROMPREFIX
 "roms/"

	)

60 
	#IMAGEPREFIX
 "images/"

	)

65 
	~"sy¡em_sdl.h
"

	@system_sdl.c

23 
	#WANT_WMINFO


	)

33 
	~"sy¡em.h
"

35 #ià
SDL_MAJOR_VERSION
 == 1

36 #ifdeà
__SPECIFY_SDL_DIR__


37 
	~<SDL/SDL_’dŸn.h
>

39 
	~<SDL_’dŸn.h
>

42 #ifdeà
__SPECIFY_SDL_DIR__


43 
	~<SDL2/SDL_’dŸn.h
>

45 
	~<SDL_’dŸn.h
>

49 #ifdeà
__OPENGL_AVAILABLE__


50 #iâdeà
__APPLE__


51 
	~<GL/gl.h
>

53 
	~<O³nGL/gl.h
>

57 #ià
SDL_BYTEORDER
 =ð
SDL_BIG_ENDIAN


58 
	#RMASK
 0xFF000000

	)

59 
	#GMASK
 0x00FF0000

	)

60 
	#BMASK
 0x0000FF00

	)

61 
	#AMASK
 0x000000FF

	)

63 
	#RMASK
 0x000000FF

	)

64 
	#GMASK
 0x0000FF00

	)

65 
	#BMASK
 0x00FF0000

	)

66 
	#AMASK
 0xFF000000

	)

69 #ià
SDL_MAJOR_VERSION
 == 1

72 
SDL_boÞ
 
	gg_fuÎsü“n
 = 
SDL_FALSE
;

73 
SDL_GLCÚ‹xt
 
	gg_glcÚ‹xt
 = 
NULL
;

74 
SDL_R’d””
* 
	gg_»nd””
 = 
NULL
;

75 
SDL_Textu»
 *
	gg_‹xtu»
 = 
NULL
;

76 
SDL_Surçû
* 
	gg_sü“n
 = 
NULL
;

77 
SDL_Wšdow
* 
	gg_wšdow
 = 
NULL
;

78 
SDL_Surçû
* 
	gg_icÚ
 = 
NULL
;

80 
	gg_bµ
 = 0;

81 
	gg_width
 = 0;

82 
	gg_height
 = 0;

84 
	gg_Ï¡x
 = 
SDL_WINDOWPOS_CENTERED
;

85 
	gg_Ï¡y
 = 
SDL_WINDOWPOS_CENTERED
;

87 
	$F»eResourûs
()

89 if(
g_glcÚ‹xt
)

91 
	`SDL_GL_D–‘eCÚ‹xt
(
g_glcÚ‹xt
);

92 
g_glcÚ‹xt
 = 
NULL
;

95 if(
g_»nd””
)

97 
	`SDL_De¡royR’d””
(
g_»nd””
);

98 
g_»nd””
 = 
NULL
;

101 if(
g_‹xtu»
)

103 
	`SDL_De¡royTextu»
(
g_‹xtu»
);

104 
g_‹xtu»
 = 
NULL
;

107 if(
g_sü“n
)

109 
	`SDL_F»eSurçû
(
g_sü“n
);

110 
g_sü“n
 = 
NULL
;

113 if(
g_wšdow
)

115 
	`SDL_G‘WšdowPos™iÚ
(
g_wšdow
, &
g_Ï¡x
, &
g_Ï¡y
);

116 
	`SDL_De¡royWšdow
(
g_wšdow
);

117 
g_wšdow
 = 
NULL
;

120 
	}
}

123 #ià
SDL_MAJOR_VERSION
 == 1

124 
	$SDL_COMPAT_G‘WMInfo
(
SDL_SysWMšfo
 *
šfo
)

128 #ià
	`defšed
(
__MORPHOS__
)

131  
	`SDL_G‘WMInfo
(
šfo
);

133 
	}
}

135 
	$SDL_COMPAT_G‘WMInfo
(
SDL_SysWMšfo
 *
šfo
)

137  
g_wšdow
? 
	`SDL_G‘WšdowWMInfo
(g_wšdow, 
šfo
) : -1;

138 
	}
}

142 #ià
SDL_MAJOR_VERSION
 == 1

143 
	$SDL_COMPAT_WM_S‘IcÚ
(
SDL_Surçû
 *
icÚ
, 
Ušt8
 *
mask
)

145 
	`SDL_WM_S‘IcÚ
(
icÚ
, 
mask
);

146 
	}
}

147 
	$SDL_COMPAT_WM_S‘C­tiÚ
(cÚ¡ *
t™Ë
, cÚ¡ *
icÚ
)

149 
	`SDL_WM_S‘C­tiÚ
(
t™Ë
, 
icÚ
);

150 
	}
}

152 
	$SDL_COMPAT_WM_S‘IcÚ
(
SDL_Surçû
 *
icÚ
, 
Ušt8
 *
mask
)

154 if(
g_icÚ
)

156 
	`SDL_F»eSurçû
(
g_icÚ
);

157 
g_icÚ
 = 
NULL
;

159 if(
icÚ
)

161 
g_icÚ
 = 
icÚ
;

162 
g_icÚ
->
»fcouÁ
++;

164 
	}
}

165 
	$SDL_COMPAT_WM_S‘C­tiÚ
(cÚ¡ *
t™Ë
, cÚ¡ *
icÚ
)

167 if(
g_wšdow
)

168 
	`SDL_S‘WšdowT™Ë
(
g_wšdow
, 
t™Ë
);

169 
	}
}

173 #ià
SDL_MAJOR_VERSION
 == 1

174 
SDL_boÞ
 
	$SDL_COMPAT_IsAµAùive
(
SDL_Ev’t
* 
ev’t
)

176 
SDL_AùiveEv’t
 *
aù_ev
 = (SDL_AùiveEv’t*)
ev’t
;

177  (
aù_ev
->
¡©e
 =ð
SDL_APPACTIVE
 &&‡ù_ev->
gaš
 =ð1)? 
SDL_TRUE
 : 
SDL_FALSE
;

178 
	}
}

179 
SDL_boÞ
 
	$SDL_COMPAT_IsAµFocu£d
(
SDL_Ev’t
* 
ev’t
)

181  
ev’t
->
aùive
.
ty³
 )

183 
SDL_APPINPUTFOCUS
:

184 
SDL_APPACTIVE
:

185  
SDL_TRUE
;

188  
SDL_FALSE
;

189 
	}
}

191 
SDL_boÞ
 
	$SDL_COMPAT_IsAµAùive
(
SDL_Ev’t
* 
ev’t
)

195  
SDL_FALSE
;

196 
	}
}

197 
SDL_boÞ
 
	$SDL_COMPAT_IsAµFocu£d
(
SDL_Ev’t
* 
ev’t
)

207  
SDL_FALSE
;

208 
	}
}

211 #ià
SDL_MAJOR_VERSION
 == 1

212 
	$SDL_COMPAT_EÇbËKeyR•—t
(
d–ay
, 
š‹rv®
)

214  
	`SDL_EÇbËKeyR•—t
(
d–ay
, 
š‹rv®
);

215 
	}
}

217 
	$SDL_COMPAT_EÇbËKeyR•—t
(
d–ay
, 
š‹rv®
)

221 
	}
}

225 #ià
SDL_MAJOR_VERSION
 == 1

226 
	$SDL_COMPAT_EÇbËUNICODE
(
’abË
)

228  
	`SDL_EÇbËUNICODE
(
’abË
);

229 
	}
}

231 
	$SDL_COMPAT_EÇbËUNICODE
(
’abË
)

235 
	}
}

238 #ià
SDL_MAJOR_VERSION
 == 1

239 
SDL_COMPAT_KEY
 
	$SDL_COMPAT_G‘KeysymUnicode
(
SDL_KEYSYM
 
keysym
)

241  
keysym
.
unicode
;

242 
	}
}

243 
SDL_COMPAT_KEY
 
	$SDL_COMPAT_T¿n¦©eUnicode
(
SDL_KEYSYM
 
keysym
)

245  
keysym
.
unicode
;

246 
	}
}

248 
SDL_COMPAT_KEY
 
	$SDL_COMPAT_T¿n¦©eUnicode
(
SDL_KEYSYM
 
keysym
)

250 if(
keysym
.
mod
 & 
KMOD_SHIFT
)

252 
keysym
.
sym
)

297 
keysym
.
sym
 = 
	`touµ”
(keysym.sym);

301  
keysym
.
sym
;

302 
	}
}

303 
SDL_COMPAT_KEY
 
	$SDL_COMPAT_G‘KeysymUnicode
(
SDL_KEYSYM
 
keysym
)

305  
keysym
.
sym
;

306 
	}
}

309 #ià
SDL_MAJOR_VERSION
 == 1

310 
	$SDL_COMPAT_Fl
(
SDL_Surçû
* 
sü“n
)

312  
	`SDL_Fl
(
sü“n
);

313 
	}
}

315 
	$SDL_COMPAT_Fl
(
SDL_Surçû
* 
sü“n
)

317 if(
g_»nd””
)

319 
	`SDL_Upd©eTextu»
(
g_‹xtu»
, 
NULL
, 
g_sü“n
->
pix–s
, g_sü“n->
p™ch
);

320 
	`SDL_R’d”CË¬
(
g_»nd””
);

321 
	`SDL_R’d”CÝy
(
g_»nd””
, 
g_‹xtu»
, 
NULL
, NULL);

322 
	`SDL_R’d”P»£Á
(
g_»nd””
);

325 
	}
}

328 #ià
SDL_MAJOR_VERSION
 == 1

329 
	$SDL_COMPAT_G‘B™sP”Pix–
()

331 cÚ¡ 
SDL_VideoInfo
* 
šfo
 = 
	`SDL_G‘VideoInfo
();

332  (
šfo
)? info->
vfmt
->
B™sP”Pix–
 : 0;

333 
	}
}

335 
	$SDL_COMPAT_G‘B™sP”Pix–
()

337 
bµ
;

338 
SDL_Di¥ÏyMode
 
mode
;

339 
	`SDL_G‘Cu¼’tDi¥ÏyMode
(0, &
mode
);

340 
bµ
 = 
	`SDL_BITSPERPIXEL
(
mode
.
fÜm©
);

341  (
bµ
==24)? 32 : bpp;

342 
	}
}

345 #ià
SDL_MAJOR_VERSION
 == 1

346 
	$SDL_COMPAT_WM_ToggËFuÎSü“n
(
SDL_Surçû
 *
surçû
)

348  
	`SDL_WM_ToggËFuÎSü“n
(
surçû
);

349 
	}
}

351 
	$SDL_COMPAT_WM_ToggËFuÎSü“n
(
SDL_Surçû
 *
surçû
)

353 if(
g_wšdow
)

355 
g_fuÎsü“n
 = (g_fuÎsü“n)? 
SDL_FALSE
 : 
SDL_TRUE
;

357 if(
g_fuÎsü“n
)

358 
	`SDL_S‘WšdowFuÎsü“n
(
g_wšdow
, 
SDL_WINDOW_FULLSCREEN
);

360 
	`SDL_S‘WšdowSize
(
g_wšdow
, 
g_width
, 
g_height
);

364 
	}
}

367 #ià
SDL_MAJOR_VERSION
 == 1

368 
SDL_Surçû
* 
	$SDL_COMPAT_S‘VideoMode
(
width
, 
height
, 
b™¥”pix–
, 
Ušt32
 
æags
)

370  
	`SDL_S‘VideoMode
(
width
, 
height
, 
b™¥”pix–
, 
æags
);

371 
	}
}

373 
SDL_Surçû
* 
	$SDL_COMPAT_S‘VideoMode
(
width
, 
height
, 
b™¥”pix–
, 
Ušt32
 
æags
)

375 
g_width
 = 
width
;

376 
g_height
 = 
height
;

377 
g_bµ
 = 
b™¥”pix–
;

379 
	`F»eResourûs
();

381 
g_wšdow
 = 
	`SDL_C»©eWšdow
("ÜicuŒÚ", 
g_Ï¡x
, 
g_Ï¡y
,

382 
g_width
, 
g_height
, 
æags
);

383 if(
g_icÚ
)

384 
	`SDL_S‘WšdowIcÚ
(
g_wšdow
, 
g_icÚ
);

386 if(
æags
 & 
SDL_WINDOW_OPENGL
)

388 
g_sü“n
 = 
	`SDL_G‘WšdowSurçû
(
g_wšdow
);

389 
g_glcÚ‹xt
 = 
	`SDL_GL_C»©eCÚ‹xt
(
g_wšdow
);

393 
g_sü“n
 = 
	`SDL_C»©eRGBSurçû
(0, 
g_width
, 
g_height
, 
g_bµ
,

394 
RMASK
, 
GMASK
, 
BMASK
, 
AMASK
);

395 
g_»nd””
 = 
	`SDL_C»©eR’d””
(
g_wšdow
, -1, 0);

396 
g_‹xtu»
 = 
	`SDL_C»©eTextu»
(
g_»nd””
,

397 
SDL_PIXELFORMAT_ABGR8888
,

398 
SDL_TEXTUREACCESS_STREAMING
,

399 
g_width
, 
g_height
);

402  
g_sü“n
;

403 
	}
}

406 #ià
SDL_MAJOR_VERSION
 == 1

407 
	$SDL_COMPAT_S‘P®‘‹
(
SDL_Surçû
 *
surçû
, 
æags
, 
SDL_CÞÜ
 *
cÞÜs
, 
fœ¡cÞÜ
, 
ncÞÜs
)

409  
	`SDL_S‘P®‘‹
(
surçû
, 
æags
, 
cÞÜs
, 
fœ¡cÞÜ
, 
ncÞÜs
);

410 
	}
}

412 
	$SDL_COMPAT_S‘P®‘‹
(
SDL_Surçû
 *
surçû
, 
æags
, 
SDL_CÞÜ
 *
cÞÜs
, 
fœ¡cÞÜ
, 
ncÞÜs
)

416 
	}
}

419 #ià
SDL_MAJOR_VERSION
 == 1

420 
	$SDL_COMPAT_S‘Ev’tFž‹r
(
SDL_Ev’tFž‹r
 
fž‹r
)

422 
	`SDL_S‘Ev’tFž‹r
(
fž‹r
);

423 
	}
}

425 
	$SDL_COMPAT_S‘Ev’tFž‹r
(
SDL_Ev’tFž‹r
 
fž‹r
)

427 
	`SDL_S‘Ev’tFž‹r
(
fž‹r
, 
NULL
);

428 
	}
}

431 #ià
SDL_MAJOR_VERSION
 == 1

432 
	$SDL_COMPAT_Qu™
()

434 
	`SDL_Qu™
();

435 
	}
}

437 
	$SDL_COMPAT_Qu™
()

439 
	`F»eResourûs
();

440 
	`SDL_Qu™
();

441 
	}
}

444 #ifdeà
__OPENGL_AVAILABLE__


445 #ià
SDL_MAJOR_VERSION
 == 1

446 
	$SDL_COMPAT_GL_Sw­Bufãrs
()

448 
	`SDL_GL_Sw­Bufãrs
();

449 
	}
}

451 
	$SDL_COMPAT_GL_Sw­Bufãrs
()

453 
	`SDL_GL_Sw­Wšdow
(
g_wšdow
);

454 
	}
}

458 #ifdeà
__OPENGL_AVAILABLE__


459 
SDL_Surçû
 * 
	$æV”t
(
SDL_Surçû
* 
sfc
)

461 
lše
;

462 
SDL_Surçû
* 
»suÉ
 = 
	`SDL_C»©eRGBSurçû
(
sfc
->
æags
, sfc->
w
, sfc->
h
,

463 
sfc
->
fÜm©
->
By‹sP”Pix–
 * 8, sfc->fÜm©->
Rmask
, sfc->fÜm©->
Gmask
,

464 
sfc
->
fÜm©
->
Bmask
, sfc->fÜm©->
Amask
);

466 ià(
»suÉ
)

468 
Ušt8
* 
pix–s
 = (Ušt8*è
sfc
->pixels;

469 
Ušt8
* 
½ix–s
 = (Ušt8*è
»suÉ
->
pix–s
;

471 
Ušt32
 
p™ch
 = 
sfc
->pitch;

472 
Ušt32
 
pxËngth
 = 
p™ch
*
sfc
->
h
;

474 
lše
 = 0;†š< 
sfc
->
h
; ++line)

476 
Ušt32
 
pos
 = 
lše
 * 
p™ch
;

477 
	`memýy
(&
½ix–s
[
pos
], &
pix–s
[(
pxËngth
-pos)-
p™ch
],…itch);

481  
»suÉ
;

482 
	}
}

483 #ià
SDL_MAJOR_VERSION
 == 1

484 
	$SDL_COMPAT_TakeSü“nshÙ
(*
âame
)

486 
SDL_Surçû
 *
g_sü“n
 = 
	`SDL_G‘VideoSurçû
();

488 if(
g_sü“n
->
æags
 & 
SDL_COMPAT_OPENGL
)

491 
g_width
 = 
g_sü“n
->
w
;

492 
g_height
 = 
g_sü“n
->
h
;

493 
SDL_Surçû
 *
æ
;

496 
SDL_Surçû
 *
surf
 = 
	`SDL_C»©eRGBSurçû
(
SDL_SWSURFACE
, 
g_width
, 
g_height
, 24, 
RMASK
, 
GMASK
, 
BMASK
, 0);

497 
	`glR—dPix–s
(0, 0, 
g_width
, 
g_height
, 
GL_RGB
, 
GL_UNSIGNED_BYTE
, 
surf
->
pix–s
);

503 
æ
 = 
	`æV”t
(
surf
);

504 
	`SDL_SaveBMP
(
æ
, 
âame
);

506 
	`SDL_F»eSurçû
(
æ
);

507 
	`SDL_F»eSurçû
(
surf
);

510 
	`SDL_SaveBMP
(
g_sü“n
, 
âame
);

511 
	}
}

513 
	$SDL_COMPAT_TakeSü“nshÙ
(*
âame
)

519 
SDL_Surçû
 *
surf
 = 
	`SDL_C»©eRGBSurçû
(
SDL_SWSURFACE
, 
g_width
, 
g_height
, 
g_bµ
, 
RMASK
, 
GMASK
, 
BMASK
, 
AMASK
);

521 ià(
surf
 =ð
NULL
)

528 
	`glR—dPix–s
(0,0,
g_width
, 
g_height
, 
GL_RGBA
, 
GL_UNSIGNED_BYTE
, 
surf
->
pix–s
);

530 
SDL_Surçû
 *
æ
 = 
	`æV”t
(
surf
);

531 
	`SDL_SaveBMP
(
æ
, 
âame
);

533 
	`SDL_F»eSurçû
(
æ
);

534 
	`SDL_F»eSurçû
(
surf
);

535 
	}
}

538 #ià
SDL_MAJOR_VERSION
 == 1

539 
	$SDL_COMPAT_TakeSü“nshÙ
(*
âame
)

541 
	`SDL_SaveBMP
(
	`SDL_G‘VideoSurçû
(), 
âame
);

542 
	}
}

544 
	$SDL_COMPAT_TakeSü“nshÙ
(*
âame
)

546 
	`SDL_SaveBMP
(
g_sü“n
, 
âame
);

547 
	}
}

	@system_sdl.h

22 #iâdeà
ORICUTRON_SYSTEM_SDL_H


23 
	#ORICUTRON_SYSTEM_SDL_H


	)

25 #ià
SDL_MAJOR_VERSION
 == 1

26 #ifdeà
__SPECIFY_SDL_DIR__


27 
	~<SDL/SDL.h
>

28 
	~<SDL/SDL_v”siÚ.h
>

29 #ifdeà
WANT_WMINFO


30 
	~<SDL/SDL_syswm.h
>

33 
	~<SDL.h
>

34 
	~<SDL_v”siÚ.h
>

35 #ifdeà
WANT_WMINFO


36 
	~<SDL_syswm.h
>

40 #ifdeà
__SPECIFY_SDL_DIR__


41 
	~<SDL2/SDL.h
>

42 
	~<SDL2/SDL_v”siÚ.h
>

43 #ifdeà
WANT_WMINFO


44 
	~<SDL2/SDL_syswm.h
>

47 
	~<SDL.h
>

48 
	~<SDL_v”siÚ.h
>

49 #ifdeà
WANT_WMINFO


50 
	~<SDL_syswm.h
>

55 #ià
SDL_BYTEORDER
 =ð
SDL_LIL_ENDIAN


56 
	#_LE32
(
X
è(X)

	)

57 
	#_LE16
(
X
è(X)

	)

58 
	#_BE32
(
X
è
	`SDL_Sw­32
(X)

	)

59 
	#_BE16
(
X
è
	`SDL_Sw­16
(X)

	)

60 
	#_MAKE_LE32
(
X
)

	)

61 
	#_MAKE_LE16
(
X
)

	)

62 
	#_MAKE_BE32
(
X
èX = 
	`SDL_Sw­32
(X)

	)

63 
	#_MAKE_BE16
(
X
èX = 
	`SDL_Sw­16
(X)

	)

65 
	#_LE32
(
X
è
	`SDL_Sw­32
(X)

	)

66 
	#_LE16
(
X
è
	`SDL_Sw­16
(X)

	)

67 
	#_BE32
(
X
è(X)

	)

68 
	#_BE16
(
X
è(X)

	)

69 
	#_MAKE_LE32
(
X
èX = 
	`SDL_Sw­32
(X)

	)

70 
	#_MAKE_LE16
(
X
èX = 
	`SDL_Sw­16
(X)

	)

71 
	#_MAKE_BE32
(
X
)

	)

72 
	#_MAKE_BE16
(
X
)

	)

76 #ià
SDL_MAJOR_VERSION
 == 1

77 
Ušt16
 
	tSDL_COMPAT_KEY
;

78 
SDL_keysym
 
	tSDL_KEYSYM
;

79 
SDL_VideoInfo
 
	tSDL_COMPAT_VideoInfo
;

81 
	#SDL_COMPAT_HWSURFACE
 
SDL_HWSURFACE


	)

82 
	#SDL_COMPAT_HWPALETTE
 
SDL_HWPALETTE


	)

83 
	#SDL_COMPAT_FULLSCREEN
 
SDL_FULLSCREEN


	)

85 #ifdeà
__OPENGL_AVAILABLE__


86 
	#SDL_COMPAT_OPENGL
 
SDL_OPENGL


	)

89 
	#SDL_COMPAT_LOGPAL
 
SDL_LOGPAL


	)

90 
	#SDL_COMPAT_PHYSPAL
 
SDL_PHYSPAL


	)

92 
	#SDL_COMPAT_ACTIVEEVENT
 
SDL_ACTIVEEVENT


	)

95 
Ušt32
 
	tSDL_COMPAT_KEY
;

96 
SDL_Keysym
 
	tSDL_KEYSYM
;

97 
SDL_R’d””Info
 
	tSDL_COMPAT_VideoInfo
;

99 
	#SDL_COMPAT_HWSURFACE
 0

	)

100 
	#SDL_COMPAT_HWPALETTE
 0

	)

101 
	#SDL_COMPAT_FULLSCREEN
 
SDL_WINDOW_FULLSCREEN


	)

103 #ifdeà
__OPENGL_AVAILABLE__


104 
	#SDL_COMPAT_OPENGL
 
SDL_WINDOW_OPENGL


	)

107 
	#SDL_COMPAT_LOGPAL
 0

	)

108 
	#SDL_COMPAT_PHYSPAL
 0

	)

110 
	#SDL_COMPAT_ACTIVEEVENT
 
SDL_WINDOWEVENT


	)

112 
	#SDL_DEFAULT_REPEAT_DELAY
 0

	)

113 
	#SDL_DEFAULT_REPEAT_INTERVAL
 0

	)

115 
	#SDLK_KP0
 
SDLK_KP_0


	)

116 
	#SDLK_KP1
 
SDLK_KP_1


	)

117 
	#SDLK_KP2
 
SDLK_KP_2


	)

118 
	#SDLK_KP3
 
SDLK_KP_3


	)

119 
	#SDLK_KP4
 
SDLK_KP_4


	)

120 
	#SDLK_KP5
 
SDLK_KP_5


	)

121 
	#SDLK_KP6
 
SDLK_KP_6


	)

122 
	#SDLK_KP7
 
SDLK_KP_7


	)

123 
	#SDLK_KP8
 
SDLK_KP_8


	)

124 
	#SDLK_KP9
 
SDLK_KP_9


	)

126 
	#SDLK_PRINT
 
SDLK_PRINTSCREEN


	)

130 #ifdeà
WANT_WMINFO


131 
SDL_COMPAT_G‘WMInfo
(
SDL_SysWMšfo
 *
šfo
);

134 
SDL_COMPAT_WM_S‘IcÚ
(
SDL_Surçû
 *
icÚ
, 
Ušt8
 *
mask
);

135 
SDL_COMPAT_WM_S‘C­tiÚ
(cÚ¡ *
t™Ë
, cÚ¡ *
icÚ
);

136 
SDL_boÞ
 
SDL_COMPAT_IsAµAùive
(
SDL_Ev’t
* 
ev’t
);

137 
SDL_boÞ
 
SDL_COMPAT_IsAµFocu£d
(
SDL_Ev’t
* 
ev’t
);

138 
SDL_COMPAT_EÇbËKeyR•—t
(
d–ay
, 
š‹rv®
);

139 
SDL_COMPAT_EÇbËUNICODE
(
’abË
);

140 
SDL_COMPAT_KEY
 
SDL_COMPAT_G‘KeysymUnicode
(
SDL_KEYSYM
 
keysym
);

141 
SDL_COMPAT_KEY
 
SDL_COMPAT_T¿n¦©eUnicode
(
SDL_KEYSYM
 
keysym
);

142 
SDL_COMPAT_Fl
(
SDL_Surçû
* 
sü“n
);

143 
SDL_COMPAT_G‘B™sP”Pix–
();

144 
SDL_COMPAT_WM_ToggËFuÎSü“n
(
SDL_Surçû
 *
surçû
);

145 
SDL_Surçû
* 
SDL_COMPAT_S‘VideoMode
(
width
, 
height
, 
b™¥”pix–
, 
Ušt32
 
æags
);

146 
SDL_COMPAT_S‘P®‘‹
(
SDL_Surçû
 *
surçû
, 
æags
, 
SDL_CÞÜ
 *
cÞÜs
, 
fœ¡cÞÜ
, 
ncÞÜs
);

147 
SDL_COMPAT_S‘Ev’tFž‹r
(
SDL_Ev’tFž‹r
 
fž‹r
);

148 
SDL_COMPAT_Qu™
();

149 
SDL_COMPAT_TakeSü“nshÙ
(*
âame
);

151 #ifdeà
__OPENGL_AVAILABLE__


152 
SDL_COMPAT_GL_Sw­Bufãrs
();

155 
”rÜ_´štf
Ð*
fmt
, ... );

	@tape.c

21 
	~<¡dio.h
>

22 
	~<¡dlib.h
>

23 
	~<¡ršg.h
>

25 
	~"sy¡em.h
"

26 
	~"6502.h
"

27 
	~"vŸ.h
"

28 
	~"8912.h
"

29 
	~"gui.h
"

30 
	~"disk.h
"

31 
	~"mÚ™Ü.h
"

32 
	~"6551.h
"

33 
	~"machše.h
"

34 
	~"joy¡ick.h
"

35 
	~"fž”eq.h
"

36 
	~"³.h
"

37 
	~"msgbox.h
"

39 
³fže
[], 
³·th
[];

40 
SDL_boÞ
 
»äesh³
;

41 
	gtm±­’ame
[4096];

42 
fž‘mp
[];

46 
	$³_pÝup
Ð
machše
 *
Üic
 )

48 
tmp
[40];

50 ifÐ!
Üic
->
³Çme
[0] )

53 
	`do_pÝup
Ð
Üic
, "\x0f\x10\x13" );

58 
	`¥rštf
Ð
tmp
, "\x0f\x10""%ø%-16s", 
Üic
->
³mÙÜ
 ? 18 : 17, oric->
³Çme
 );

59 
	`do_pÝup
Ð
Üic
, 
tmp
 );

60 
	}
}

62 
	$toggË³ÿp
Ð
machše
 *
Üic
, 
osdm’u™em
 *
m™em
, 
dummy
 )

64 
Üth—d”
[] = { 'O', 'R', 'T', 0 };

67 ifÐ
Üic
->
³ÿp
 )

69 
	`fþo£
Ð
Üic
->
³ÿp
 );

70 
Üic
->
³ÿp
 = 
NULL
;

71 
m™em
->
Çme
 = "Saveape output...";

72 
»äesh³
 = 
SDL_TRUE
;

77 ifÐ!
	`fž”eque¡”
Ð
Üic
, "C­tu»­ouut", 
³·th
, 
tm±­’ame
, 
FR_TAPESAVEORT
 ) )

82 ifÐ
tm±­’ame
[0] == 0 ) ;

86 ifÐ(
	`¡¾’
(
tm±­’ame
)>3è&& (
	`¡rÿ£cmp
(&tmptapename[strlen(tmptapename)-4], ".tap")==0) )

87 
tm±­’ame
[
	`¡¾’
(tmptapename)-4] = 0;

90 ifÐ(
	`¡¾’
(
tm±­’ame
)<4è|| (
	`¡rÿ£cmp
(&tmptapename[strlen(tmptapename)-4], ".ort")!=0) )

91 
	`¡ºÿt
(
tm±­’ame
, ".ort", 4095);

92 
tm±­’ame
[4095] = 0;

94 
	`još·th
Ð
³·th
, 
tm±­’ame
 );

97 
Üic
->
³ÿp
 = 
	`fÝ’
Ð
fž‘mp
, "wb" );

98 ifÐ!
Üic
->
³ÿp
 )

101 
	`msgbox
Ð
Üic
, 
MSGBOX_OK
, "Unableo create file" );

106 
	`fwr™e
Ð
Üth—d”
, 4, 1, 
Üic
->
³ÿp
);

109 
Üic
->
³ÿpcouÁ
 = -1;

110 
Üic
->
³ÿ¶a¡b™
 = (Üic->
vŸ
.
Üb
&Üic->vŸ.
ddrb
)>>7;

113 
m™em
->
Çme
 = "Stopape„ecording";

114 
»äesh³
 = 
SDL_TRUE
;

115 
	}
}

126 
	$³_£tup_h—d”
Ð
machše
 *
Üic
 )

128 
i
;

130 
Üic
->
³dupby‹s
 = 0;

131 
Üic
->
³hd»nd
 = 0;

133 ifÐ
Üic
->
³buf
[Üic->
³offs
] != 0x16 )

137  
i
=0; 
Üic
->
³buf
[Üic->
³offs
+i]==0x16; i++ )

139 ifÐ(
Üic
->
³offs
+
i
è>ðÜic->
³Ën
 )

142 ifÐÐ
i
 < 3 ) || ( 
Üic
->
³buf
[Üic->
³offs
+i] != 0x24 ) )

144 
i
++;

145 ifÐ(
Üic
->
³offs
+
i
+9è>ðÜic->
³Ën
 )

147 
i
+=9;

148  
Üic
->
³buf
[Üic->
³offs
+
i
] != 0 )

150 ifÐ(
Üic
->
³offs
+
i
è>ðÜic->
³Ën
 )

152 
i
++;

154 
i
++;

156 
Üic
->
³dupby‹s
 = 80;

157 
Üic
->
³hd»nd
 = oric->
³offs
+
i
;

158 
	}
}

161 
	$³_Übchªge
Ð
vŸ
 *via )

163 
machše
 *
Üic
 = 
vŸ
->oric;

164 
bufãr
[4], 
³b™
, 
bufwr™e
;

165 
couÁ
;

168 ifÐ!
Üic
->
³ÿp
 ) ;

171 ifÐ
Üic
->
³ÿp
 =ðÜic->
t§vf
 ) ;

173 
³b™
 = (
vŸ
->
Üb
 & vŸ->
ddrb
) >> 7;

174 ifÐ
³b™
 =ð
Üic
->
³ÿ¶a¡b™
 ) ;

176 
Üic
->
³ÿ¶a¡b™
 = 
³b™
;

179 ifÐ
Üic
->
³ÿpcouÁ
 < 0 )

182 
Üic
->
³ÿpcouÁ
 = 0;

183 
	`åutc
Ð
³b™
, 
Üic
->
³ÿp
 );

187 
couÁ
 = (
Üic
->
³ÿpcouÁ
>>1);

189 ifÐ
couÁ
 < 0xfc )

191 
bufãr
[0] = 
couÁ
;

192 
bufwr™e
 = 1;

194 ifÐ
couÁ
 < 0x100 )

196 
bufãr
[0] = 0xfc;

197 
bufãr
[1] = 
couÁ
;

198 
bufwr™e
 = 2;

200 ifÐ
couÁ
 < 0x10000 )

202 
bufãr
[0] = 0xfd;

203 
bufãr
[1] = (
couÁ
>>8)&0xff;

204 
bufãr
[2] = 
couÁ
&0xff;

205 
bufwr™e
 = 3;

209 
bufãr
[0] = 0xfd;

210 
bufãr
[1] = 0xff;

211 
bufãr
[2] = 0xff;

212 
bufwr™e
 = 3;

215 
	`fwr™e
Ð
bufãr
, 
bufwr™e
, 1, 
Üic
->
³ÿp
 );

216 
Üic
->
³ÿpcouÁ
 = 0;

217 
	}
}

221 
	$³_£tmÙÜ
Ð
machše
 *
Üic
, 
SDL_boÞ
 
mÙÜÚ
 )

223 ifÐ
mÙÜÚ
 =ð
Üic
->
³mÙÜ
 )

227 
»äesh³
 = 
SDL_TRUE
;

230 ifÐÐ!
Üic
->
³turbo
 ) || ( !Üic->
pch_‰_avažabË
 ) )

232 ifÐÐ!
Üic
->
¿w³
 ) || ( oric->
³offs
 < oric->
nÚ¿w’d
 ) )

236 ifÐ!
mÙÜÚ
 )

238 ifÐ
Üic
->
³b™
 > 0 )

239 
Üic
->
³offs
++;

240 
Üic
->
³b™
 = 0;

247 ifÐÐ
mÙÜÚ
 ) &&

248 Ð
Üic
->
³buf
 ) &&

249 Ð
Üic
->
³offs
 < oric->
³Ën
 ) &&

250 Ð
Üic
->
³buf
[Üic->
³offs
] == 0x16 ) )

252 
	`³_£tup_h—d”
(
Üic
);

258 
Üic
->
³mÙÜ
 = 
mÙÜÚ
;

259 ifÐ
Üic
->
³Çme
[0] ) 
	`³_pÝup
( oric );

260 
	}
}

263 
	$³_ejeù
Ð
machše
 *
Üic
 )

265 ifÐ
Üic
->
³buf
 ) 
	`ä“
( oric->tapebuf );

266 
Üic
->
³buf
 = 
NULL
;

267 
Üic
->
³Ën
 = 0;

268 
Üic
->
³Çme
[0] = 0;

269 
	`³_pÝup
Ð
Üic
 );

270 
»äesh³
 = 
SDL_TRUE
;

271 
	}
}

273 
	$³_Ãxt_¿w_couÁ
Ð
machše
 *
Üic
 )

275 
n
;

276 
nÚ¿w’d
;

278 ifÐ
Üic
->
³offs
 >ðÜic->
³Ën
 )

280 ifÐ
Üic
->
nÚ¿w’d
 !ðÜic->
³Ën
 )

281 
Üic
->
³h™’d
 = 3;

285 
n
 = 
Üic
->
³buf
[Üic->
³offs
++];

286 ià(
n
 < 0xfc)

288 
Üic
->
³couÁ
 = 
n
<<1;

292 
n
)

295 ifÐ
Üic
->
³offs
 >ð(Üic->
³Ën
-1) )

297 
Üic
->
³offs
 = oric->
³Ën
;

298 
Üic
->
³h™’d
 = 3;

302 
nÚ¿w’d
 = ((
Üic
->
³buf
[Üic->
³offs
]<<8)|oric->tapebuf[oric->tapeoffs+1]) + oric->tapeoffs+2;

303 ifÐ
nÚ¿w’d
 > 
Üic
->
³Ën
 )

305 
Üic
->
³offs
 = oric->
³Ën
;

306 
Üic
->
³h™’d
 = 3;

310 
Üic
->
nÚ¿w’d
 =‚onrawend;

311 
Üic
->
³offs
 += 2;

312 
Üic
->
³b™
 = 0;

313 
Üic
->
³couÁ
 = 2;

314 
Üic
->
³out
 = 0;

315 
	`³_£tup_h—d”
Ð
Üic
 );

319 ifÐ
Üic
->
³offs
 >ðÜic->
³Ën
 )

321 
Üic
->
³h™’d
 = 3;

325 
Üic
->
³couÁ
 = oric->
³buf
[Üic->
³offs
++] << 1;

329 ifÐ
Üic
->
³offs
 >ð(Üic->
³Ën
-1) )

331 
Üic
->
³offs
 = oric->
³Ën
;

332 
Üic
->
³h™’d
 = 3;

336 
Üic
->
³couÁ
 = (Üic->
³buf
[Üic->
³offs
]<<9)|(oric->tapebuf[oric->tapeoffs+1]<<1);

337 
Üic
->
³offs
 += 2;

342 
Üic
->
³offs
 = oric->
³Ën
;

343 
Üic
->
³h™’d
 = 3;

344 
	}
}

347 
	$³_»wšd
Ð
machše
 *
Üic
 )

349 
Üic
->
nÚ¿w’d
 = 0;

350 ifÐ
Üic
->
¿w³
 )

352 
Üic
->
³out
 = oric->
³buf
[4];

353 
	`vŸ_wr™e_CB1
Ð&
Üic
->
vŸ
, oric->
³out
 );

355 
Üic
->
³offs
 = 5;

356 
	`³_Ãxt_¿w_couÁ
Ð
Üic
 );

360 
Üic
->
³offs
 = 0;

361 
Üic
->
³b™
 = 0;

362 
Üic
->
³couÁ
 = 2;

363 
Üic
->
³out
 = 0;

364 
Üic
->
³dupby‹s
 = 0;

366 ifÐ
Üic
->
³buf
 )

367 
	`³_£tup_h—d”
Ð
Üic
 );

369 
Üic
->
³h™’d
 = 0;

370 
Üic
->
³d–ay
 = 0;

371 
»äesh³
 = 
SDL_TRUE
;

372 
	}
}

377 
	$Ãxt_Üt_v®ue
Ð*
Ütd©a
, *
off£t
, 
’d
, 
SDL_boÞ
 *
ªyp£c
 )

379 
v®
=0, 
sk
;

381 (*
off£t
è< 
’d
)

383 
Ütd©a
[*
off£t
])

386 ià((*
off£t
è>ð(
’d
-1))  0;

387 
v®
 = 
Ütd©a
[(*
off£t
)+1];

388 (*
off£t
) += 2;

389  
v®
;

392 ià((*
off£t
è>ð(
’d
-2))  0;

393 
v®
 = (
Ütd©a
[(*
off£t
)+1]<<8)|ortdata[(*offset)+2];

394 (*
off£t
) += 3;

395  
v®
;

401 ià((*
off£t
è>ð(
’d
-2))  0;

402 
sk
 = (
Ütd©a
[(*
off£t
)+1]<<8)|ortdata[(*offset)+2];

403 (*
off£t
)+=3;

404 ià((*
off£t
è>ð(
’d
-
sk
))  0;

405 (*
off£t
)+=
sk
;

406 (*
ªyp£c
èð
SDL_TRUE
;

410  
Ütd©a
[(*
off£t
)++];

415 
	}
}

419 
	mTAPSEC_STATE_SEARCH
 = 0,

420 
	mTAPSEC_STATE_LEADER
,

421 
	mTAPSEC_STATE_FINDHEADER
,

422 
	mTAPSEC_STATE_HEADER
,

423 
	mTAPSEC_STATE_FILENAME
,

424 
	mTAPSEC_STATE_FINDDATA
,

425 
	mTAPSEC_STATE_DATA


428 
	$v®idby‹
(
accum
)

430 
i
, 
·r™y
 = 0;

431 ià((
accum
&3)!=1)  0;

432 
i
=4; i!=0x800; i<<=1)

433 ià(
accum
&
i
è
·r™y
 ^= 1;

434  
·r™y
;

435 
	}
}

438 
	$p£ùiÚs
Ð*
Ütbuf
, 
Ütbuæ’
, *
sü©ch
, 
SDL_boÞ
 
¦ow
 )

440 
Üt_offs
, 
³b™
, 
Üt_v®
, 
cyccouÁ
;

441 
accum
, 
¡©e
, 
thisb™
, 
Ëad”¡¬t
=0, 
Ëad”couÁ
=0;

442 
Ï¡_off£ts
[20], 
i
, 
b™couÁ
, 
pby‹s
=0;

443 
d©a_by‹s
=0, 
¦ow0s
=0, 
¦ow1s
=0;

444 
SDL_boÞ
 
ªyp£c
 = 
SDL_FALSE
;

446 
Üt_offs
 = 4;

447 
³b™
 = 
Ütbuf
[
Üt_offs
++];

448 
cyccouÁ
 = 0;

449 
¡©e
 = 
TAPSEC_STATE_SEARCH
;

450 
accum
 = 0;

451 
b™couÁ
 = 0;

453 
i
=0; i<20; i++)

454 
Ï¡_off£ts
[
i
] = 5;

457 
Üt_offs
 < 
Ütbuæ’
)

460 
i
=0; i<19; i++)

461 
Ï¡_off£ts
[
i
] =†ast_offsets[i+1];

462 
Ï¡_off£ts
[19] = 
Üt_offs
;

464 
Üt_v®
 = 
	`Ãxt_Üt_v®ue
(
Ütbuf
, &
Üt_offs
, 
Ütbuæ’
, &
ªyp£c
);

466 ià(
Üt_v®
 < 1è 
Ütbuæ’
;

469 
cyccouÁ
 +ð
Üt_v®
;

472 
³b™
 ^= 1;

475 ià(
³b™
)

478 ià(
cyccouÁ
 < 100)

482 
thisb™
 = 
	`TIME_TO_BIT
(
cyccouÁ
);

485 ià(
thisb™
 == -1)

493 
¡©e
 = 
TAPSEC_STATE_SEARCH
;

494 
cyccouÁ
 = 0;

495 
accum
 = 0;

496 
¦ow1s
 = 0;

497 
¦ow0s
 = 0;

502 ià(
¦ow
)

504 ià(
thisb™
==1)

506 
¦ow1s
++;

507 
¦ow0s
=0;

509 ià(
¦ow1s
 != 2)

511 ià(
¦ow1s
 >= 8)

512 
¦ow1s
 = 0;

513 
cyccouÁ
=0;

519 
¦ow0s
++;

520 
¦ow1s
=0;

522 ià(
¦ow0s
 != 2)

524 ià(
¦ow0s
 >= 4)

525 
¦ow0s
 = 0;

526 
cyccouÁ
=0;

533 
accum
 = (accum>>1è| (
thisb™
<<10);

536 
¡©e
)

538 
TAPSEC_STATE_SEARCH
:

540 ià((
accum
&0x7fe) == 0x58)

544 
Ëad”¡¬t
 = 
Ï¡_off£ts
[8];

545 
Ëad”couÁ
 = 1;

546 
¡©e
 = 
TAPSEC_STATE_LEADER
;

547 
b™couÁ
 = 0;

549 ià(
	`v®idby‹
(
accum
))

556 
TAPSEC_STATE_LEADER
:

557 
b™couÁ
 = (bitcount+1)%14;

558 ià((
b™couÁ
==13)&&
	`v®idby‹
(
accum
)) bitcount = 0;

559 ià(!
b™couÁ
)

563 ià((
accum
&0x7fe) != 0x58)

566 
¡©e
 = 
TAPSEC_STATE_SEARCH
;

567 
cyccouÁ
 = 0;

571 
Ëad”couÁ
++;

572 ià(
Ëad”couÁ
==4)

574 
¡©e
 = 
TAPSEC_STATE_FINDHEADER
;

580 
TAPSEC_STATE_FINDHEADER
:

581 
b™couÁ
 = (bitcount+1)%14;

582 ià((
b™couÁ
==13)&&
	`v®idby‹
(
accum
)) bitcount = 0;

583 ià(!
b™couÁ
)

587 ià((
accum
&0x7fe) == 0x490)

591 
sü©ch
[0] = 0x16;

592 
sü©ch
[1] = 0x16;

593 
sü©ch
[2] = 0x16;

594 
sü©ch
[3] = 0x24;

595 
pby‹s
 = 4;

596 
¡©e
 = 
TAPSEC_STATE_HEADER
;

601 
TAPSEC_STATE_HEADER
:

602 
b™couÁ
 = (bitcount+1)%14;

603 ià((
b™couÁ
==13)&&
	`v®idby‹
(
accum
)) bitcount = 0;

604 ià(!
b™couÁ
)

608 
sü©ch
[
pby‹s
++] = (
accum
>>2)&0xff;

609 ià(
pby‹s
 == 13)

611 
lßd_¡¬t
, 
lßd_’d
;

613 
lßd_¡¬t
 = (
sü©ch
[10]<<8)|scratch[11];

614 
lßd_’d
 = (
sü©ch
[ 8]<<8)|scratch[ 9];

619 ià(
lßd_’d
 <ð
lßd_¡¬t
)

621 
¡©e
 = 
TAPSEC_STATE_SEARCH
;

622 
cyccouÁ
 = 0;

626 
d©a_by‹s
 = (
lßd_’d
-
lßd_¡¬t
)+1;

627 
¡©e
 = 
TAPSEC_STATE_FILENAME
;

635 
TAPSEC_STATE_FILENAME
:

636 
b™couÁ
 = (bitcount+1)%14;

637 ià((
b™couÁ
==13)&&
	`v®idby‹
(
accum
)) bitcount = 0;

638 ià(!
b™couÁ
)

642 
sü©ch
[
pby‹s
++] = (
accum
>>2)&0xff;

643 ià(
sü©ch
[
pby‹s
-1] == 0)

645 
¡©e
 = 
TAPSEC_STATE_FINDDATA
;

650 
TAPSEC_STATE_FINDDATA
:

652 ià(
	`v®idby‹
(
accum
))

656 
sü©ch
[
pby‹s
++] = (
accum
>>2)&0xff;

657 
d©a_by‹s
--;

658 
b™couÁ
=0;

659 
¡©e
 = 
TAPSEC_STATE_DATA
;

663 
TAPSEC_STATE_DATA
:

664 
b™couÁ
 = (bitcount+1)%14;

665 ià((
b™couÁ
==13)&&
	`v®idby‹
(
accum
)) bitcount = 0;

666 ià(!
b™couÁ
)

668 
sü©ch
[
pby‹s
++] = (
accum
>>2)&0xff;

669 
d©a_by‹s
--;

674 ià(
d©a_by‹s
 < 0)

676 
¡©e
 = 
TAPSEC_STATE_SEARCH
;

680 ià(
d©a_by‹s
 > 0)

683 ià((!
ªyp£c
è&& (
Ëad”¡¬t
 < 512))

684 
Ëad”¡¬t
 = 5;

687 
Ütbuf
[
Ëad”¡¬t
++] = 0xff;

688 
Ütbuf
[
Ëad”¡¬t
++] = (
pby‹s
>>8)&0xff;

689 
Ütbuf
[
Ëad”¡¬t
++] = (
pby‹s
&0xff);

690 
	`memýy
(&
Ütbuf
[
Ëad”¡¬t
], 
sü©ch
, 
pby‹s
);

691 
Ëad”¡¬t
 +ð
pby‹s
;

692 
	`memmove
(&
Ütbuf
[
Ëad”¡¬t
], &Ütbuf[
Üt_offs
], 
Ütbuæ’
-ort_offs);

693 
Ütbuæ’
 -ð(
Üt_offs
-
Ëad”¡¬t
);

694 
Üt_offs
 = 
Ëad”¡¬t
;

695 
¡©e
 = 
TAPSEC_STATE_SEARCH
;

696 
accum
 = 0;

697 
ªyp£c
 = 
SDL_TRUE
;

706 
cyccouÁ
 = 0;

710  
Ütbuæ’
;

711 
	}
}

717 
šlše
 sigÃd 
	$g‘smp
(*
buf
, 
SDL_boÞ
 
is8b™
)

719  
is8b™
 ? (()*
buf
)-128 : ()((buf[1]<<8)|buf[0]);

720 
	}
}

727 
SDL_boÞ
 
	$wav_cÚv”t
Ð
machše
 *
Üic
 )

730 *
p
=
Üic
->
³buf
, *
d©a
=
NULL
, *
Ütbuf
=NULL;

731 
i
, 
j
, 
k
, 
l
, 
chunkËn
, 
bps
=0, 
äeq
=0, 
smpd–
=0, 
d©®’
=0, 
ÜŽ’
;

732 sigÃd 
smaxl
, 
smšl
, 
smaxr
, 
smšr
, 
dcoffs
=0, 
dcoff§v
;

733 sigÃd *
Ï¡smps
 = 
NULL
;

734 sigÃd 
smp
=0;

736 
ýs
, 
couÁ
, 
pcouÁ
;

737 
SDL_boÞ
 
¡”eo
 = 
SDL_FALSE
, 
fmt£’
 = SDL_FALSE, 
u£right
 = SDL_FALSE;

740 
i
 = 12;

741 (!
fmt£’
è|| (!
d©a
))

744 ià(
i
 >ð(
Üic
->
³Ën
-8)è 
SDL_FALSE
;

747 
chunkËn
 = (
p
[
i
+7]<<24)|(p[i+6]<<16)|(p[i+5]<<8)|p[i+4];

750 ià((
i
+
chunkËn
+8è> 
Üic
->
³Ën
)

751  
SDL_FALSE
;

754 ià(
	`memcmp
(&
p
[
i
], "fmt ", 4) == 0)

757 ià((
chunkËn
 !ð16è|| (((
p
[
i
+9]<<8)|p[i+8])!=1))

758  
SDL_FALSE
;

761 (
p
[
i
+11]<<8)|(p[i+10]))

763 1: 
¡”eo
 = 
SDL_FALSE
; ;

764 2: 
¡”eo
 = 
SDL_TRUE
; ;

765 :  
SDL_FALSE
; ;

769 
äeq
 = (
p
[
i
+15]<<24)|(p[i+14]<<16)|(p[i+13]<<8)|p[i+12];

770 ifÐ!
äeq
 )  
SDL_FALSE
;

773 
smpd–
 = (
p
[
i
+21]<<16)|p[i+20];

776 
bps
 = (
p
[
i
+23]<<16)|p[i+22];

777 ià((
bps
!=8)&&(bps!=16)è 
SDL_FALSE
;

780 
bps
 /= 8;

782 
fmt£’
 = 
SDL_TRUE
;

784 ià(
	`memcmp
(&
p
[
i
], "data", 4) == 0)

786 
d©a
 = &
p
[
i
+8];

787 
d©®’
 = 
chunkËn
;

791 
i
 +ð
chunkËn
+8;

796 
smaxl
 = -70000;

797 
smšl
 = 70000;

798 
smaxr
 = -70000;

799 
smšr
 = 70000;

801 
i
=0; i<
d©®’
; i+=
smpd–
)

803 
smp
 = 
	`g‘smp
(&
d©a
[
i
], 
bps
==1);

804 ià(
smp
 < 
smšl
) sminl = smp;

805 ià(
smp
 > 
smaxl
) smaxl = smp;

807 ià(
¡”eo
)

809 
smp
 = 
	`g‘smp
(&
d©a
[
i
+
bps
], bps==1);

810 ià(
smp
 < 
smšr
) sminr = smp;

811 ià(
smp
 > 
smaxr
) smaxr = smp;

816 ià((
¡”eo
è&& ((
smaxr
-
smšr
)>(
smaxl
-
smšl
)))

818 
u£right
 = 
SDL_TRUE
;

822 
u£right
 = 
SDL_FALSE
;

825 
dcoff§v
 = 
äeq
 / 700;

826 ià(
dcoff§v
)

828 
Ï¡smps
 = 
	`m®loc
(
dcoff§v
 * ());

829 ià(
Ï¡smps
è
	`mem£t
Öa¡smps, 0, 
dcoff§v
 * ());

831 
dcoff§v
--;

834 
j
 = 0;

835 
i
=0; i<
d©®’
; i+=
smpd–
)

837 ià(
u£right
)

838 
smp
 = 
	`g‘smp
(&
d©a
[
i
+
bps
], bps==1);

840 
smp
 = 
	`g‘smp
(&
d©a
[
i
], 
bps
==1);

842 ià(
Ï¡smps
)

844 
smaxl
 = 
smp
;

845 
smšl
 = 
smp
;

847 
k
=0; k<
dcoff§v
; k++)

849 
Ï¡smps
[
k
] =†astsmps[k+1];

851 ià(
Ï¡smps
[
k
] < 
smšl
) sminl =†astsmps[k];

852 ià(
Ï¡smps
[
k
] > 
smaxl
) smaxl =†astsmps[k];

854 
dcoffs
 = ((
smaxl
-
smšl
)/2)+sminl;

857 ià(
j
 >ð
Üic
->
³Ën
)

864 
Üic
->
³buf
[
j
++] = (
smp
>
dcoffs
) ? 1 : 0;

871 
ýs
 = 500000 / (()
äeq
);

874 
ÜŽ’
 = 5;

875 
i
 = 
Üic
->
³buf
[0];

876 
couÁ
 = 0.0f;

877 
pcouÁ
 = 0.0f;

878 
k
=1; k<
j
; k++)

880 ià(
Üic
->
³buf
[
k
] !ð
i
)

882 
i
 = 
Üic
->
³buf
[
k
];

883 ià((()
couÁ
) < 1)

886 ià(
ÜŽ’
>5) ortlen--;

887 
couÁ
 +ð
pcouÁ
;

889 ià((()
couÁ
) < 0xfc)

891 
ÜŽ’
++;

892 
pcouÁ
 = 
couÁ
;

893 
couÁ
 = 0.0f;

895 ià((()
couÁ
) < 0x100)

897 
ÜŽ’
+=2;

898 
pcouÁ
 = 
couÁ
;

899 
couÁ
 = 0.0f;

903 
ÜŽ’
+=3;

904 
pcouÁ
 = 
couÁ
;

905 
couÁ
 = 0.0f;

908 
couÁ
+=
ýs
;

911 
	`ä“
Ð
Ï¡smps
 );

913 
Ütbuf
 = 
	`m®loc
(
ÜŽ’
);

914 ià(!
Ütbuf
è 
SDL_FALSE
;

917 
	`memýy
(
Ütbuf
, "ORT\0", 4);

920 
i
 = 
Üic
->
³buf
[0];

921 
Ütbuf
[4] = 
i
;

922 
couÁ
 = 0.0f;

923 
pcouÁ
 = 0.0f;

924 
l
 = 5;

925 
k
=1; k<
j
; k++)

927 ià(
Üic
->
³buf
[
k
] !ð
i
)

929 
i
 = 
Üic
->
³buf
[
k
];

930 ià((()
couÁ
) < 1)

933 ià(
l
==5)

934 
Ütbuf
[4] = 
i
;

936 
l
--;

937 
couÁ
 +ð
pcouÁ
;

939 ià((()
couÁ
) < 0xfc)

941 
Ütbuf
[
l
++] = 
couÁ
;

942 
pcouÁ
 = 
couÁ
;

943 
couÁ
 = 0.0f;

945 ià((()
couÁ
) < 0x100)

947 
Ütbuf
[
l
++] = 0xfc;

948 
Ütbuf
[
l
++] = 
couÁ
;

949 
pcouÁ
 = 
couÁ
;

950 
couÁ
 = 0.0f;

954 
Ütbuf
[
l
++] = 0xfd;

955 
Ütbuf
[
l
++] = ((()
couÁ
)>>8)&0xff;

956 
Ütbuf
[
l
++] = (()
couÁ
)&0xff;

957 
pcouÁ
 = 
couÁ
;

958 
couÁ
 = 0.0f;

961 
couÁ
+=
ýs
;

966 
ÜŽ’
 = 
	`p£ùiÚs
(
Ütbuf
, o¹Ën, 
Üic
->
³buf
, 
SDL_FALSE
);

967 
ÜŽ’
 = 
	`p£ùiÚs
(
Ütbuf
, o¹Ën, 
Üic
->
³buf
, 
SDL_TRUE
);

970 
	`ä“
(
Üic
->
³buf
);

971 
Üic
->
³buf
 = 
Ütbuf
;

972 
Üic
->
³Ën
 = 
ÜŽ’
;

974  
SDL_TRUE
;

975 
	}
}

978 
SDL_boÞ
 
	$³_lßd_p
Ð
machše
 *
Üic
, *
âame
 )

980 
FILE
 *
f
;

983 
f
 = 
	`fÝ’
Ð
âame
, "rb" );

984 ifÐ!
f
 )  
SDL_FALSE
;

987 
	`³_ejeù
Ð
Üic
 );

990 
	`f£ek
Ð
f
, 0, 
SEEK_END
 );

991 
Üic
->
³Ën
 = ()
	`á–l
Ð
f
 );

992 
	`f£ek
Ð
f
, 0, 
SEEK_SET
 );

994 ifÐ
Üic
->
³Ën
 <= 4 )

996 
	`fþo£
Ð
f
 );

997  
SDL_FALSE
;

1001 
Üic
->
³buf
 = 
	`m®loc
ÐÜic->
³Ën
+1 );

1002 ifÐ!
Üic
->
³buf
 )

1004 
	`fþo£
Ð
f
 );

1005 
Üic
->
³Ën
 = 0;

1006  
SDL_FALSE
;

1009 ifÐ
	`ä—d
Ð&
Üic
->
³buf
[0], oric->
³Ën
, 1, 
f
 ) != 1 )

1011 
	`fþo£
Ð
f
 );

1012 
	`³_ejeù
Ð
Üic
 );

1013  
SDL_FALSE
;

1016 
	`fþo£
Ð
f
 );

1019 ià((
Üic
->
³Ën
 >= 36) &&

1020 (
	`memcmp
(
Üic
->
³buf
, "RIFF", 4) == 0) &&

1021 (
	`memcmp
(
Üic
->
³buf
+8, "WAVE", 4) == 0))

1023 ià(!
	`wav_cÚv”t
Ð
Üic
 ))

1025 
	`msgbox
Ð
Üic
, 
MSGBOX_OK
, "Invalid wav file" );

1026 
	`³_ejeù
Ð
Üic
 );

1027  
SDL_FALSE
;

1030 
Üic
->
¿w³
 = 
SDL_TRUE
;

1033 ià(
	`memcmp
(
Üic
->
³buf
, "ORT\0", 4) == 0)

1035 
Üic
->
¿w³
 = 
SDL_TRUE
;

1038 ià(
	`memcmp
(
Üic
->
³buf
, "\x16\x16\x16", 3) == 0)

1040 
Üic
->
¿w³
 = 
SDL_FALSE
;

1044 
Üic
->
³Ën
++;

1049 
	`³_ejeù
Ð
Üic
 );

1050 
	`msgbox
Ð
Üic
, 
MSGBOX_OK
, "Unrecognisedape format" );

1051  
SDL_FALSE
;

1055 
	`³_»wšd
Ð
Üic
 );

1058 ifÐ
	`¡¾’
Ð
âame
 ) > 31 )

1060 
	`¡ºýy
Ð
Üic
->
³Çme
, &
âame
[
	`¡¾’
(fname)-31], 32 );

1061 
Üic
->
³Çme
[0] = 22;

1063 
	`¡ºýy
Ð
Üic
->
³Çme
, 
âame
, 32 );

1065 
Üic
->
³Çme
[31] = 0;

1068 
	`³_pÝup
Ð
Üic
 );

1070  
SDL_TRUE
;

1071 
	}
}

1073 
	$³_autoš£¹
Ð
machše
 *
Üic
 )

1075 *
odœ
;

1076 
i
;

1077 
SDL_boÞ
 
³_found
;

1079 ifÐ
	`¡ºcmp
Ð(*)&
Üic
->
mem
[Üic->
pch_fd_g‘Çme_addr
], oric->
Ï¡³fže
, 16 ) == 0 )

1080 
Üic
->
mem
[Üic->
pch_fd_g‘Çme_addr
] = 0;

1083 
	`¡rýy
Ð
³fže
, 
Üic
->
Ï¡³fže
 );

1084 
i
 = ()
	`¡¾’
(
³fže
);

1086 
odœ
 = 
	`g‘cwd
Ð
NULL
, 0 );

1087 
	`chdœ
Ð
³·th
 );

1088 
³_found
 = 
	`³_lßd_p
Ð
Üic
, 
³fže
 );

1089 ifÐ!
³_found
 )

1092 
	`¡rýy
Ð&
³fže
[
i
], ".tap" );

1093 
³_found
 = 
	`³_lßd_p
Ð
Üic
, 
³fže
 );

1095 ifÐ!
³_found
 )

1098 
	`¡rýy
Ð&
³fže
[
i
], ".ort" );

1099 
	`³_lßd_p
Ð
Üic
, 
³fže
 );

1102 ifÐ
Üic
->
³buf
 )

1105 
Üic
->
Ï¡³fže
[0] = 0;

1108 
	`chdœ
Ð
odœ
 );

1109 
	`ä“
Ð
odœ
 );

1110 
	}
}

1112 
	$³_¡Ý_§v•©ch
Ð
machše
 *
Üic
 )

1114 ifÐ!
Üic
->
t§vf
 ) ;

1116 ifÐ
Üic
->
t§vf
 =ðÜic->
³ÿp
 )

1118 
bufd©a
[2];

1119 
	`f£ek
Ð
Üic
->
t§vf
, oric->
³ÿp§voffs
, 
SEEK_SET
 );

1120 
bufd©a
[0] = (
Üic
->
³ÿp§vby‹s
>>8)&0xff;

1121 
bufd©a
[1] = 
Üic
->
³ÿp§vby‹s
&0xff;

1122 
	`fwr™e
Ð
bufd©a
, 2, 1, 
Üic
->
t§vf
 );

1123 
Üic
->
³ÿp§voffs
 = 0;

1124 
Üic
->
³ÿp§vby‹s
 = 0;

1128 
	`fþo£
Ð
Üic
->
t§vf
 );

1131 
Üic
->
t§vf
 = 
NULL
;

1132 
	}
}

1135 
	$³_·tches
Ð
machše
 *
Üic
 )

1137 
Sšt32
 
i
, 
j
;

1139 ifÐ
Üic
->
romÚ
 )

1141 ifÐ
Üic
->
pch_fd_avažabË
 )

1146 ifÐÐ
Üic
->
ýu
.
ÿlýc
 =ðÜic->
pch_fd_þßd_g‘Çme_pc
 ) ||

1147 Ð
Üic
->
ýu
.
ÿlýc
 =ðÜic->
pch_fd_»ÿÎ_g‘Çme_pc
 ) )

1150  
i
=0; i<16; i++ )

1152 
j
 = 
Üic
->
ýu
.
	`»ad
Ð&Üic->ýu, oric->
pch_fd_g‘Çme_addr
+
i
 );

1153 ifÐ!
j
 ) ;

1154 
Üic
->
Ï¡³fže
[
i
] = 
j
;

1156 
Üic
->
Ï¡³fže
[
i
] = 0;

1158 ifÐÐ
Üic
->
ýu
.
	`»ad
Ð&Üic->ýu, oric->
pch_fd_g‘Çme_addr
 ) != 0 ) &&

1159 Ð
Üic
->
autoš£¹
 ) )

1163 ifÐÐ!
Üic
->
³buf
 ) ||

1164 Ð
Üic
->
³offs
 >ðÜic->
³Ën
 -1 ) ||

1165 ÐÐ
i
 > 3 ) && ( 
	`¡rÿ£cmp
Ð&
Üic
->
Ï¡³fže
[i-4], ".tap" ) == 0 ) ) ||

1166 ÐÐ
i
 > 3 ) && ( 
	`¡rÿ£cmp
Ð&
Üic
->
Ï¡³fže
[i-4], ".ort" ) == 0 ) ) ||

1167 ÐÐ
i
 > 3 ) && ( 
	`¡rÿ£cmp
Ð&
Üic
->
Ï¡³fže
[i-4], ".wav" ) == 0 ) ) )

1169 
	`³_autoš£¹
Ð
Üic
 );

1170 
Üic
->
ýu
.
	`wr™e
Ð&Üic->ýu, oric->
pch_fd_g‘Çme_addr
, 0 );

1174 ifÐÐÐ
Üic
->
ýu
.
ÿlýc
 =ðÜic->
pch_fd_c§ve_g‘Çme_pc
 ) ||

1175 Ð
Üic
->
ýu
.
ÿlýc
 =ðÜic->
pch_fd_¡Üe_g‘Çme_pc
 ) ) &&

1176 ÐÐ!
Üic
->
³ÿp
 ) || ( oric->
³turbo
 ) ) )

1179 ifÐ
Üic
->
t§vf
 )

1180 
	`³_¡Ý_§v•©ch
Ð
Üic
 );

1183 ifÐ
Üic
->
³ÿp
 )

1185 
Üic
->
t§vf
 = oric->
³ÿp
;

1186 ifÐ
Üic
->
³ÿpcouÁ
 < 0 )

1187 
	`åutc
Ð0, 
Üic
->
³ÿp
 );

1188 
	`åutc
Ð0xff, 
Üic
->
³ÿp
 );

1189 
Üic
->
³ÿp§voffs
 = ()
	`á–l
(Üic->
³ÿp
);

1190 
	`åutc
Ð0x00, 
Üic
->
³ÿp
 );

1191 
	`åutc
Ð0x00, 
Üic
->
³ÿp
 );

1192 
Üic
->
³ÿp§vby‹s
 = 0;

1196 *
odœ
 = 
NULL
;

1199  
i
=0; i<16; i++ )

1201 
j
 = 
Üic
->
ýu
.
	`»ad
Ð&Üic->ýu, oric->
pch_fd_g‘Çme_addr
+
i
 );

1202 ifÐ!
j
 ) ;

1203 
tm±­’ame
[
i
] = 
j
;

1205 
tm±­’ame
[
i
] = 0;

1208 ifÐ
tm±­’ame
[0] == 0 )

1210 ifÐ!
	`fž”eque¡”
Ð
Üic
, "SavtØ³", 
³·th
, 
tm±­’ame
, 
FR_TAPESAVETAP
 ) )

1211 
tm±­’ame
[0] = 0;

1215 ifÐ
tm±­’ame
[0] )

1217 ifÐ(
	`¡¾’
(
tm±­’ame
è< 4è|| (
	`¡rÿ£cmp
(&tmptapename[strlen(tmptapename)-4], ".tap") != 0) )

1219 ià(
	`¡¾’
(
tm±­’ame
)+5<(tmptapename))

1220 
	`¡ºÿt
(
tm±­’ame
, ".p", 
	`¡¾’
(tmptapename)+5);

1221 
tm±­’ame
[(tmptapename)-1] = 0;

1225 
odœ
 = 
	`g‘cwd
Ð
NULL
, 0 );

1226 ifÐ
odœ
 )

1228 
	`chdœ
Ð
³·th
 );

1229 
Üic
->
t§vf
 = 
	`fÝ’
(
tm±­’ame
, "wb");

1230 
	`chdœ
Ð
odœ
 );

1231 
	`ä“
Ð
odœ
 );

1235 ifÐÐ
Üic
->
ýu
.
ÿlýc
 =ðÜic->
pch_‰_c§ve_’d_pc
 ) ||

1236 Ð
Üic
->
ýu
.
ÿlýc
 =ðÜic->
pch_‰_¡Üe_’d_pc
 ) )

1238 
SDL_boÞ
 
ju¡p
 = (
Üic
->
t§vf
 !ðÜic->
³ÿp
);

1239 
	`³_¡Ý_§v•©ch
Ð
Üic
 );

1240 ifÐ
ju¡p
 )

1243 
	`¢´štf
Ð
fž‘mp
, 4096+512+4-1, "\x0f\x10 SavedØ%s", 
tm±­’ame
 );

1244 
fž‘mp
[31] = 0;

1245 ià(
	`¡¾’
(
tm±­’ame
) > 20)

1247 
fž‘mp
[30] = '\x16';

1249 
	`do_pÝup
Ð
Üic
, 
fž‘mp
 );

1251 
tm±­’ame
[0] = 0;

1255 ifÐÐ
Üic
->
pch_‰_§ve_avažabË
 ) && ( ( !Üic->
³ÿp
 ) || ( oric->
³turbo
 ) ) )

1257 ifÐ
Üic
->
ýu
.
ÿlýc
 =ðÜic->
pch_‰_putby‹_pc
 )

1259 ifÐ
Üic
->
t§vf
 )

1261 
	`åutc
Ð
Üic
->
ýu
.
a
, oric->
t§vf
 );

1262 ifÐ
Üic
->
t§vf
 =ðÜic->
³ÿp
 )

1263 
Üic
->
³ÿp§vby‹s
++;

1266 
Üic
->
ýu
.
ÿlýc
 = oric->
pch_‰_putby‹_’d_pc
;

1267 
Üic
->
ýu
.
ÿlcÝ
 = oric->ýu.
	`»ad
Ð&Üic->ýu, oric->ýu.
ÿlýc
 );

1269 ifÐ
Üic
->
ýu
.
ÿlýc
 =ðÜic->
pch_‰_wr™–—d”_pc
 )

1271 ifÐ
Üic
->
t§vf
 )

1273 
Ëad”
[] = { 0x16, 0x16, 0x16, 0x16 };

1274 
	`fwr™e
Ð
Ëad”
, 4, 1, 
Üic
->
t§vf
 );

1275 ifÐ
Üic
->
t§vf
 =ðÜic->
³ÿp
 )

1276 
Üic
->
³ÿp§vby‹s
 += 4;

1279 
Üic
->
ýu
.
ÿlýc
 = oric->
pch_‰_wr™–—d”_’d_pc
;

1280 
Üic
->
ýu
.
ÿlcÝ
 = oric->ýu.
	`»ad
Ð&Üic->ýu, oric->ýu.
ÿlýc
 );

1288 ifÐÐ!
Üic
->
³buf
 ) || ( !Üic->
³mÙÜ
 ) )

1290 ifÐÐ
Üic
->
pch_‰_avažabË
 ) && ( oric->
³turbo
 ) && ( oric->
romÚ
 ) && ( oric->
ýu
.
ÿlýc
 =ðÜic->
pch_‰_g‘sync_pc
 ) )

1291 
Üic
->
³turbo_sync¡ack
 = oric->
ýu
.
¥
;

1295 ifÐÐ
Üic
->
³turbo_fÜûoff
 ) && ( oric->
pch_‰_avažabË
 ) && ( oric->
romÚ
 ) && ( oric->
ýu
.
ÿlýc
 =ðÜic->
pch_‰_g‘sync_’d_pc
 ) )

1296 
Üic
->
³turbo_fÜûoff
 = 
SDL_FALSE
;

1300 if(Ð
Üic
->
¿w³
 ) && ( oric->
³offs
 >ðÜic->
nÚ¿w’d
 )) ;

1302 if(Ð!
Üic
->
³buf
 ) || ( oric->
³offs
 >ðÜic->
³Ën
 )) ;

1305 ifÐÐ
Üic
->
pch_‰_avažabË
 ) && ( oric->
³turbo
 ) && ( !Üic->
³turbo_fÜûoff
 ) && ( oric->
romÚ
 ) )

1307 
SDL_boÞ
 
dosyný©ch
;

1309 
dosyný©ch
 = 
SDL_FALSE
;

1311 ifÐ
Üic
->
ýu
.
ÿlýc
 =ðÜic->
pch_‰_g‘sync_loÝ_pc
 )

1320 ifÐ
Üic
->
³turbo_sync¡ack
 == -1 )

1323 
Üic
->
³turbo_fÜûoff
 = 
SDL_TRUE
;

1328 
Üic
->
ýu
.
¥
 = oric->
³turbo_sync¡ack
;

1329 
Üic
->
³turbo_sync¡ack
 = -1;

1330 
dosyný©ch
 = 
SDL_TRUE
;

1333 ifÐÐ
Üic
->
ýu
.
ÿlýc
 =ðÜic->
pch_‰_g‘sync_pc
 ) || ( 
dosyný©ch
 ) )

1336 ifÐ
Üic
->
³buf
[Üic->
³offs
] != 0x16 )

1341 
Üic
->
³offs
++;

1344 ifÐ
Üic
->
³offs
 >ðÜic->
³Ën
 )

1346 
»äesh³
 = 
SDL_TRUE
;

1349 }  
Üic
->
³buf
[Üic->
³offs
] != 0x16 );

1353 
Üic
->
ýu
.
ÿlýc
 = oric->
pch_‰_g‘sync_’d_pc
;

1354 
Üic
->
ýu
.
ÿlcÝ
 = oric->ýu.
	`»ad
(&Üic->ýu, oric->ýu.
ÿlýc
);

1358 ifÐ
Üic
->
ýu
.
ÿlýc
 =ðÜic->
pch_‰_»adby‹_pc
 )

1361 
Üic
->
ýu
.
a
 = oric->
³buf
[Üic->
³offs
++];

1364 
Üic
->
ýu
.
f_z
 = oric->ýu.
a
 == 0;

1365 
Üic
->
ýu
.
f_c
 = oric->
pch_‰_»adby‹_£tÿ¼y
 ? 1 : 0;

1368 ifÐ
Üic
->
pch_‰_»adby‹_¡Üeby‹_addr
 !ð-1 ) oric->
ýu
.
	`wr™e
Ð&Üic->ýu, oric->pch_‰_»adby‹_¡Üeby‹_addr, oric->ýu.
a
 );

1369 ifÐ
Üic
->
pch_‰_»adby‹_¡Üez”o_addr
 !ð-1 ) oric->
ýu
.
	`wr™e
( &oric->cpu, oric->pch_tt_readbyte_storezero_addr, 0x00 );

1372 
Üic
->
ýu
.
ÿlýc
 = oric->
pch_‰_»adby‹_’d_pc
;

1373 
Üic
->
ýu
.
ÿlcÝ
 = oric->ýu.
	`»ad
Ð&Üic->ýu, oric->ýu.
ÿlýc
 );

1374 ifÐ
Üic
->
³offs
 >ðÜic->
³Ën
 ) 
»äesh³
 = 
SDL_TRUE
;

1377 
	}
}

1380 
	$³_ticktock
Ð
machše
 *
Üic
, 
cyþes
 )

1382 
Sšt32
 
j
;

1385 ifÐÐ
Üic
->
³ÿp
 ) && ( oric->
³ÿpcouÁ
 != -1 ) )

1386 
Üic
->
³ÿpcouÁ
 +ð
cyþes
;

1398 ifÐ
Üic
->
vsynchack
 )

1400 
j
 = (0 =ð
Üic
->
vsync
 || 260 < oric->vsync);

1401 ifÐ
Üic
->
vŸ
.
cb1
 !ð
j
 )

1402 
	`vŸ_wr™e_CB1
Ð&
Üic
->
vŸ
, 
j
 );

1405 ifÐ
Üic
->
vsync
 > 0 )

1407 
Üic
->
vsync
 -ð
cyþes
;

1408 ifÐ
Üic
->
vsync
 < 0 )

1409 
Üic
->
vsync
 = 0;

1413 ifÐÐ!
Üic
->
³buf
 ) || ( !Üic->
³mÙÜ
 ) )

1417 ifÐÐ
Üic
->
³offs
 < 0 ) || ( oric->³off >ðÜic->
³Ën
 ) )

1419 ifÐ
Üic
->
³h™’d
 > 2 )

1422 ifÐÐ
Üic
->
Ï¡³fže
[0] ) && ( oric->
autoš£¹
 ) )

1424 
	`³_autoš£¹
Ð
Üic
 );

1425 
Üic
->
Ï¡³fže
[0] = 0;

1431 ifÐÐ
Üic
->
pch_‰_avažabË
 ) && ( oric->
³turbo
 ) && ( !Üic->
³turbo_fÜûoff
 ) && ( oric->
romÚ
 ) && ( !Üic->
¿w³
 ) )

1434 ifÐ
Üic
->
³h™’d
 > 2 )

1437 ifÐÐ
Üic
->
³hd»nd
 !ð0 ) && ( oric->
³offs
 == oric->tapehdrend ) )

1439 
Üic
->
³d–ay
 = 1281;

1440 
Üic
->
³hd»nd
 = 0;

1445 ifÐ
Üic
->
³couÁ
 > 
cyþes
 )

1447 
Üic
->
³couÁ
 -ð
cyþes
;

1448 ifÐ
Üic
->
³d–ay
 > 0 )

1450 
Üic
->
³d–ay
 -ð
cyþes
;

1451 ifÐ
Üic
->
³d–ay
 < 0 )

1452 
Üic
->
³d–ay
 = 1;

1458 
Üic
->
³out
 ^= 1;

1459 ifÐ!
Üic
->
vsynchack
 )

1462 ifÐ
Üic
->
³noi£
 )

1464 
	`ay_lockaudio
Ð&
Üic
->
ay
 );

1465 ifÐ
Üic
->
ay
.
do_logcyþe_»£t
 )

1467 
Üic
->
ay
.
logcyþe
 = oric->ay.
Ãwlogcyþe
;

1468 
Üic
->
ay
.
do_logcyþe_»£t
 = 
SDL_FALSE
;

1470 ifÐ
Üic
->
ay
.
Žogged
 < 
TAPELOG_SIZE
 )

1472 
Üic
->
ay
.
³log
[Üic->ay.
Žogged
 ].
cyþe
 = oric->ay.
logcyþe
;

1473 
Üic
->
ay
.
³log
[Üic->ay.
Žogged
++].
v®
 = oric->
³out
;

1478 
	`vŸ_wr™e_CB1
Ð&
Üic
->
vŸ
, oric->
³out
 );

1481 ifÐ
Üic
->
³d–ay
 > 0 )

1483 
Üic
->
³d–ay
 -ð
cyþes
;

1484 ifÐ
Üic
->
³d–ay
 <= 0)

1486 ifÐ
Üic
->
³b™
 == 1 )

1487 
Üic
->
³d–ay
 = 1;

1489 
Üic
->
³d–ay
 = 0;

1491 
Üic
->
³couÁ
 = 
TAPE_1_PULSE
;

1495 ifÐ
Üic
->
³offs
 >ðÜic->
³Ën
 )

1497  
Üic
->
³h™’d
 )

1499 0: 
Üic
->
³couÁ
 = 
TAPE_1_PULSE
; ;

1500 1: 
Üic
->
³couÁ
 = 0x36*2; ;

1502 
Üic
->
³h™’d
++;

1503 
»äesh³
 = 
SDL_TRUE
;

1508 ifÐ
Üic
->
¿w³
 )

1511 ifÐ
Üic
->
³offs
 >ðÜic->
nÚ¿w’d
 )

1513 
	`³_Ãxt_¿w_couÁ
Ð
Üic
 );

1514 ifÐ
Üic
->
³h™’d
 > 2 )

1515 
»äesh³
 = 
SDL_TRUE
;

1522 ifÐ
Üic
->
³out
 )

1524  
Üic
->
³b™
 )

1527 
Üic
->
³time
 = 
TAPE_1_PULSE
;

1531 
Üic
->
³time
 = 
TAPE_0_PULSE
;

1532 
Üic
->
³·r™y
 = 1;

1536 ifÐ
Üic
->
³buf
[Üic->
³offs
]&(1<<(Üic->
³b™
-2)) )

1538 
Üic
->
³time
 = 
TAPE_1_PULSE
;

1539 
Üic
->
³·r™y
 ^= 1;

1541 
Üic
->
³time
 = 
TAPE_0_PULSE
;

1546 ifÐ
Üic
->
³·r™y
 )

1547 
Üic
->
³time
 = 
TAPE_1_PULSE
;

1549 
Üic
->
³time
 = 
TAPE_0_PULSE
;

1555 
Üic
->
³time
 = 
TAPE_1_PULSE
;

1560 
Üic
->
³b™
 = (oric->tapebit+1)%14;

1561 ifÐ!
Üic
->
³b™
 )

1563 ifÐ
Üic
->
³dupby‹s
 > 0 )

1564 
Üic
->
³dupby‹s
--;

1566 
Üic
->
³offs
++;

1569 
Üic
->
³couÁ
 = oric->
³time
;

1570 
	}
}

	@tape.h

21 
	#TAPE_0_PULSE
 416

	)

22 
	#TAPE_1_PULSE
 208

	)

24 
	#TAPE_DECODE_0_MIN
 (
TAPE_1_PULSE
+(TAPE_1_PULSE/5))

	)

25 
	#TAPE_DECODE_0_MAX
 (
TAPE_0_PULSE
*2)

	)

26 
	#TAPE_DECODE_1_MIN
 (
TAPE_1_PULSE
/4)

	)

27 
	#TAPE_DECODE_1_MAX
 (
TAPE_DECODE_0_MIN
)

	)

29 
	#TIME_TO_BIT
(
t
è(Ñ<
TAPE_DECODE_1_MIN
)?-1:(Ñ<
TAPE_DECODE_0_MIN
)?1:0))

	)

31 
³_ejeù
Ð
machše
 *
Üic
 );

32 
³_»wšd
Ð
machše
 *
Üic
 );

33 
SDL_boÞ
 
³_lßd_p
Ð
machše
 *
Üic
, *
âame
 );

34 
³_ticktock
Ð
machše
 *
Üic
, 
cyþes
 );

35 
³_£tmÙÜ
Ð
machše
 *
Üic
, 
SDL_boÞ
 
mÙÜÚ
 );

36 
³_·tches
Ð
machše
 *
Üic
 );

37 
toggË³ÿp
Ð
machše
 *
Üic
, 
osdm’u™em
 *
m™em
, 
dummy
 );

38 
³_Übchªge
(
vŸ
 *via);

39 
³_¡Ý_§v•©ch
Ð
machše
 *
Üic
 );

	@ula.c

22 
	~<¡dlib.h
>

23 
	~<¡ršg.h
>

25 
	~"sy¡em.h
"

26 
	~"6502.h
"

27 
	~"vŸ.h
"

28 
	~"8912.h
"

29 
	~"disk.h
"

30 
	~"gui.h
"

31 
	~"mÚ™Ü.h
"

32 
	~"6551.h
"

33 
	~"machše.h
"

34 
	~"uÏ.h
"

35 
	~"avi.h
"

37 
avi_hªdË
 *
vidÿp
;

38 
SDL_boÞ
 
w¬p¥“d
;

40 
	gb™b
[8*8*64*8];

43 
šlše
 
	$uÏ_»äesh_ch¬£t
Ð
machše
 *
Üic
 )

45 ifÐ
Üic
->
vid_‹x‰rs
 & 1 )

47 
Üic
->
vid_ch_d©a
 = &Üic->
vid_ch_ba£
[128*8];

49 
Üic
->
vid_ch_d©a
 = oric->
vid_ch_ba£
;

51 
	}
}

54 
šlše
 
	$uÏ_decode_©Œ
Ð
machše
 *
Üic
, 
©Œ
, 
y
 )

56  
©Œ
 & 0x18 )

59 
Üic
->
vid_fg_cÞ
 = 
©Œ
 & 0x07;

60 
Üic
->
vid_b™±r
 = (
Ušt16
 *)(&
b™b
[(Üic->
vid_fg_cÞ
<<12è| (Üic->
vid_bg_cÞ
<<9)]);

61 
Üic
->
vid_šv_b™±r
 = (
Ušt16
 *)(&
b™b
[((Üic->
vid_fg_cÞ
^7)<<12è| ((Üic->
vid_bg_cÞ
^7)<<9)]);

65 
Üic
->
vid_‹x‰rs
 = 
©Œ
 & 0x07;

66 
Üic
->
vid_blškmask
 = 
©Œ
 & 0x04 ? 0x00 : 0x3f;

67 
	`uÏ_»äesh_ch¬£t
Ð
Üic
 );

68 ifÐ
Üic
->
vid_‹x‰rs
 & 0x02 )

69 
Üic
->
vid_chlše
 = (
y
>>1) & 0x07;

71 
Üic
->
vid_chlše
 = 
y
 & 0x07;

75 
Üic
->
vid_bg_cÞ
 = 
©Œ
 & 0x07;

76 
Üic
->
vid_b™±r
 = (
Ušt16
 *)(&
b™b
[(Üic->
vid_fg_cÞ
<<12è| (Üic->
vid_bg_cÞ
<<9)]);

77 
Üic
->
vid_šv_b™±r
 = (
Ušt16
 *)(&
b™b
[((Üic->
vid_fg_cÞ
^7)<<12è| ((Üic->
vid_bg_cÞ
^7)<<9)]);

81 
Üic
->
vid_mode
 = 
©Œ
 & 0x07;

84 ifÐ
Üic
->
vid_mode
 & 4 )

86 
Üic
->
vid_addr
 = oric->
vidba£s
[0];

87 
Üic
->
vid_ch_ba£
 = &Üic->
mem
[Üic->
vidba£s
[1]];

89 
Üic
->
vid_addr
 = oric->
vidba£s
[2];

90 
Üic
->
vid_ch_ba£
 = &Üic->
mem
[Üic->
vidba£s
[3]];

93 
	`uÏ_»äesh_ch¬£t
Ð
Üic
 );

96 
	}
}

98 
šlše
 
	$uÏ_¿¡”_deçuÉ
Ð
machše
 *
Üic
 )

100 
Üic
->
vid_fg_cÞ
 = 7;

101 
Üic
->
vid_‹x‰rs
 = 0;

102 
Üic
->
vid_blškmask
 = 0x3f;

103 
Üic
->
vid_bg_cÞ
 = 0;

104 
Üic
->
vid_b™±r
 = (
Ušt16
 *)(&
b™b
[(Üic->
vid_fg_cÞ
<<12è| (Üic->
vid_bg_cÞ
<<9)]);

105 
Üic
->
vid_šv_b™±r
 = (
Ušt16
 *)(&
b™b
[((Üic->
vid_fg_cÞ
^7)<<12è| ((Üic->
vid_bg_cÞ
^7)<<9)]);

106 
	`uÏ_»äesh_ch¬£t
Ð
Üic
 );

107 
	}
}

109 
	$uÏ_pow”up_deçuÉ
Ð
machše
 *
Üic
 )

111 
	`uÏ_decode_©Œ
Ð
Üic
, 0x1a, 0 );

112 
	}
}

115 
	$uÏ_»nd”_block
Ð
machše
 *
Üic
, 
SDL_boÞ
 
šv”‹d
, 
d©a
, 
y
 )

117 
Ušt16
 *
±r
;

119 ifÐ
šv”‹d
 )

121 
±r
 = 
Üic
->
vid_šv_b™±r
 + (
d©a
<<2);

125 
±r
 = 
Üic
->
vid_b™±r
 + (
d©a
<<2);

128 *((
Ušt16
 *)
Üic
->
sü±
èð*(
±r
++); oric->scrpt+=2;

129 *((
Ušt16
 *)
Üic
->
sü±
èð*(
±r
++); oric->scrpt+=2;

130 *((
Ušt16
 *)
Üic
->
sü±
èð*(
±r
++); oric->scrpt+=2;

131 
	}
}

133 
	$uÏ_»nd”_block_checkdœty
Ð
machše
 *
Üic
, 
SDL_boÞ
 
šv”‹d
, 
d©a
, 
y
 )

135 
Ušt16
 *
±r
;

136 
i
;

138 ifÐ
šv”‹d
 )

140 
±r
 = 
Üic
->
vid_šv_b™±r
 + (
d©a
<<2);

144 
±r
 = 
Üic
->
vid_b™±r
 + (
d©a
<<2);

147  
i
=0; i<3; i++)

149 ià(*((
Ušt16
 *)
Üic
->
sü±
è!ð*
±r
)

151 *((
Ušt16
 *)
Üic
->
sü±
èð*
±r
;

152 
Üic
->
vid_dœty
[
y
] = 
SDL_TRUE
;

153 
Üic
->
vid_block_func
 = 
uÏ_»nd”_block
;

155 
Üic
->
sü±
+=2;

156 
±r
++;

158 
	}
}

161 
	$uÏ_»nd”sü“n
Ð
machše
 *
Üic
 )

163 
Ušt8
 *
sü±
, *
½Œ
;

164 
b
, 
y
, 
c
, 
cy
, 
b™mask
;

165 
SDL_boÞ
 
hœes
;

167 
sü±
 = 
Üic
->scrpt;

168 
Üic
->
sü±
 = oric->
sü
;

169  
y
=0; y<224; y++)

171 
cy
 = (
y
>>3) * 40;

174 
	`uÏ_¿¡”_deçuÉ
Ð
Üic
 );

175 
Üic
->
vid_chlše
 = 
y
 & 0x07;

177 ifÐ
y
 < 200 )

179 ifÐ
Üic
->
vid_mode
 & 0x04 )

181 
hœes
 = 
SDL_TRUE
;

182 
½Œ
 = &
Üic
->
mem
[Üic->
vid_addr
 + 
y
*40 -1];

184 
hœes
 = 
SDL_FALSE
;

185 
½Œ
 = &
Üic
->
mem
[Üic->
vid_addr
 + 
cy
 -1];

188 
hœes
 = 
SDL_FALSE
;

190 
½Œ
 = &
Üic
->
mem
[Üic->
vidba£s
[2] + 
cy
 -1];

192 
b™mask
 = (
Üic
->
äames
&0x10)?0x3f:Üic->
vid_blškmask
;

194  
b
=0; b<40; b++ )

196 
c
 = *(++
½Œ
);

199 ifÐÐ
c
 & 0x60 ) == 0 )

201 
	`uÏ_decode_©Œ
Ð
Üic
, 
c
, 
y
 );

202 
	`uÏ_»nd”_block
Ð
Üic
, (
c
 & 0x80)!=0, 0, 
y
 );

203 ifÐ
y
 < 200 )

205 ifÐ
Üic
->
vid_mode
 & 0x04 )

207 
hœes
 = 
SDL_TRUE
;

208 
½Œ
 = &
Üic
->
mem
[Üic->
vid_addr
 + 
b
 + 
y
*40];

210 
hœes
 = 
SDL_FALSE
;

211 
½Œ
 = &
Üic
->
mem
[Üic->
vid_addr
 + 
b
 + 
cy
];

214 
hœes
 = 
SDL_FALSE
;

216 
½Œ
 = &
Üic
->
mem
[Üic->
vidba£s
[2] + 
b
 + 
cy
];

218 
b™mask
 = (
Üic
->
äames
&0x10)?0x3f:Üic->
vid_blškmask
;

221 ifÐ
hœes
 )

223 
	`uÏ_»nd”_block
Ð
Üic
, (
c
 & 0x80)!=0, c & 
b™mask
, 
y
 );

225 
ch_ix
, 
ch_d©
;

227 
ch_ix
 = 
c
 & 0x7f;

228 
ch_d©
 = 
Üic
->
vid_ch_d©a
[ (
ch_ix
<<3è| oric->
vid_chlše
 ] & 
b™mask
;

230 
	`uÏ_»nd”_block
Ð
Üic
, (
c
 & 0x80)!=0, 
ch_d©
, 
y
 );

235 
Üic
->
sü±
 = scrpt;

236 
	}
}

239 
SDL_boÞ
 
	$uÏ_dÜa¡”
Ð
machše
 *
Üic
 )

241 
b
, 
c
, 
b™mask
;

242 
SDL_boÞ
 
hœes
, 
Ãed»nd”
;

243 
y
, 
cy
;

244 
Ušt8
 *
½Œ
;

246 
Ãed»nd”
 = 
SDL_FALSE
;

248 
Üic
->
vid_¿¡”
++;

249 ifÐ
Üic
->
vid_¿¡”
 =ðÜic->
vid_max¿¡
 )

251 ifÐ
vidÿp
 )

255 iàÐÐ!
vidÿp
->
do¢d
 ) || ( !
w¬p¥“d
 ) )

258 ifÐ
vidÿp
->
is50hz
 =ð
Üic
->
vid_äeq
 )

260 
	`ay_lockaudio
Ð&
Üic
->
ay
 );

261 
	`avi_addäame
Ð&
vidÿp
, 
Üic
->
sü
 );

264 ifÐ
vidÿp
->
is50hz
 )

267 ifÐ(
vidÿp
->
äam—dju¡
%6) != 5 )

269 
	`ay_lockaudio
Ð&
Üic
->
ay
 );

270 
	`avi_addäame
Ð&
vidÿp
, 
Üic
->
sü
 );

273 
vidÿp
->
äam—dju¡
++;

279 
	`ay_lockaudio
Ð&
Üic
->
ay
 );

280 
	`avi_addäame
Ð&
vidÿp
, 
Üic
->
sü
 );

282 ifÐ(
vidÿp
->
äam—dju¡
%5) == 4 )

283 
	`avi_addäame
Ð&
vidÿp
, 
Üic
->
sü
 );

285 
vidÿp
->
äam—dju¡
++;

290 
Üic
->
vid_¿¡”
 = 0;

293 
Üic
->
vid_off£t
 = oric->
vŸ
.
t1c
/64;

314 
Üic
->
vsync
 = 12 + 260;

316 
Ãed»nd”
 = 
SDL_TRUE
;

317 
Üic
->
äames
++;

319 ifÐ
Üic
->
vid_äeq
 !ð(Üic->
vid_mode
&2) )

321 
Üic
->
vid_äeq
 = oric->
vid_mode
&2;

332 ifÐ
Üic
->
vid_äeq
 )

335 
Üic
->
cyþe¥”¿¡”
 = 64;

336 
Üic
->
vid_max¿¡
 = 308 + 4;

337 
Üic
->
vid_¡¬t
 = (Üic->
vid_max¿¡
 - 224) /2;

338 
Üic
->
vid_’d
 = oric->
vid_¡¬t
 + 224;

341 
Üic
->
cyþe¥”¿¡”
 = 64;

342 
Üic
->
vid_max¿¡
 = 260 + 4;

343 
Üic
->
vid_¡¬t
 = (Üic->
vid_max¿¡
 - 224) /2;

344 
Üic
->
vid_’d
 = oric->
vid_¡¬t
 + 224;

350 ifÐÐ
Üic
->
vid_¿¡”
 < oric->
vid_¡¬t
 ) ||

351 Ð
Üic
->
vid_¿¡”
 >ðÜic->
vid_’d
 ) )  
Ãed»nd”
;

353 
y
 = 
Üic
->
vid_¿¡”
 - oric->
vid_¡¬t
;

354 
Üic
->
sü±
 = &Üic->
sü
[
y
*240];

356 
cy
 = (
y
>>3) * 40;

359 
	`uÏ_¿¡”_deçuÉ
Ð
Üic
 );

360 
Üic
->
vid_chlše
 = 
y
 & 0x07;

363 
Üic
->
vid_block_func
 = oric->
vid_dœty
[
y
] ? 
uÏ_»nd”_block
 : 
uÏ_»nd”_block_checkdœty
;

365 ifÐ
y
 < 200 )

367 ifÐ
Üic
->
vid_mode
 & 0x04 )

369 
hœes
 = 
SDL_TRUE
;

370 
½Œ
 = &
Üic
->
mem
[Üic->
vid_addr
 + 
y
*40 -1];

372 
hœes
 = 
SDL_FALSE
;

373 
½Œ
 = &
Üic
->
mem
[Üic->
vid_addr
 + 
cy
 -1];

376 
hœes
 = 
SDL_FALSE
;

378 
½Œ
 = &
Üic
->
mem
[Üic->
vidba£s
[2] + 
cy
 -1];

380 
b™mask
 = (
Üic
->
äames
&0x10)?0x3f:Üic->
vid_blškmask
;

382  
b
=0; b<40; b++ )

384 
c
 = *(++
½Œ
);

387 ifÐÐ
c
 & 0x60 ) == 0 )

389 
	`uÏ_decode_©Œ
Ð
Üic
, 
c
, 
y
 );

390 
Üic
->
	`vid_block_func
ÐÜic, (
c
 & 0x80)!=0, 0, 
y
 );

391 ifÐ
y
 < 200 )

393 ifÐ
Üic
->
vid_mode
 & 0x04 )

395 
hœes
 = 
SDL_TRUE
;

396 
½Œ
 = &
Üic
->
mem
[Üic->
vid_addr
 + 
b
 + 
y
*40];

398 
hœes
 = 
SDL_FALSE
;

399 
½Œ
 = &
Üic
->
mem
[Üic->
vid_addr
 + 
b
 + 
cy
];

402 ià(
hœes
)

404 
hœes
 = 
SDL_FALSE
;

405 
½Œ
 = &
Üic
->
mem
[Üic->
vidba£s
[2] + 
b
 + 
cy
];

408 
b™mask
 = (
Üic
->
äames
&0x10)?0x3f:Üic->
vid_blškmask
;

410 ifÐ
hœes
 )

412 
Üic
->
	`vid_block_func
ÐÜic, (
c
 & 0x80)!=0, c & 
b™mask
, 
y
 );

414 
ch_ix
, 
ch_d©
;

416 
ch_ix
 = 
c
 & 0x7f;

417 
ch_d©
 = 
Üic
->
vid_ch_d©a
[ (
ch_ix
<<3è| oric->
vid_chlše
 ] & 
b™mask
;

419 
Üic
->
	`vid_block_func
ÐÜic, (
c
 & 0x80)!=0, 
ch_d©
, 
y
 );

424  
Ãed»nd”
;

425 
	}
}

427 
	$uÏ_£t_dœty
Ð
machše
 *
Üic
 )

429 
i
;

431  
i
=0; i<224; i++ )

433 
Üic
->
vid_dœty
[
i
] = 
SDL_TRUE
;

435 
	}
}

437 
	$´eš™_uÏ
Ð
machše
 *
Üic
 )

439 
Üic
->
sü
 = 
NULL
;

440 
Üic
->
¬©io
 = 
SDL_TRUE
;

441 
Üic
->
h¡»tch
 = 
SDL_TRUE
;

442 
Üic
->
sÿÆšes
 = 
SDL_FALSE
;

443 
Üic
->
·lgho¡
 = 
SDL_TRUE
;

444 
	}
}

446 
SDL_boÞ
 
	$š™_uÏ
Ð
machše
 *
Üic
 )

448 
fg
, 
bg
, 
b™s
, 
offs
, 
mask
;

450 
Üic
->
sü
 = (
Ušt8
 *)
	`m®loc
( 240*224 );

451 ifÐ!
Üic
->
sü
 )  
SDL_FALSE
;

453 
	`mem£t
(
Üic
->
sü
, 0, 240*224);

454 
	`uÏ_£t_dœty
Ð
Üic
 );

457  
fg
=0; fg<8; fg++ )

459  
bg
=0; bg<8; bg++ )

461  
b™s
=0; bits<64; bits++)

464 
offs
 = (
fg
<<12)|(
bg
<<9)|(
b™s
<<3);

465  
mask
=0x20; mask; mask>>=1 )

467 
b™b
[
offs
++] = (
b™s
&
mask
è? 
fg
 : 
bg
;

473  
SDL_TRUE
;

474 
	}
}

476 
	$shut_uÏ
Ð
machše
 *
Üic
 )

478 ifÐ
Üic
->
sü
 ) 
	`ä“
( oric->scr );

479 
Üic
->
sü
 = 
NULL
;

480 
	}
}

	@ula.h

22 
´eš™_uÏ
Ð
machše
 *
Üic
 );

23 
SDL_boÞ
 
š™_uÏ
Ð
machše
 *
Üic
 );

24 
shut_uÏ
Ð
machše
 *
Üic
 );

25 
SDL_boÞ
 
uÏ_dÜa¡”
Ð
machše
 *
Üic
 );

26 
uÏ_pow”up_deçuÉ
Ð
machše
 *
Üic
 );

27 
uÏ_»nd”sü“n
Ð
machše
 *
Üic
 );

28 
uÏ_£t_dœty
Ð
machše
 *
Üic
 );

	@via.c

25 
	~<¡dio.h
>

26 
	~<¡dlib.h
>

27 
	~<¡ršg.h
>

29 
	~"sy¡em.h
"

30 
	~"6502.h
"

31 
	~"vŸ.h
"

32 
	~"8912.h
"

33 
	~"gui.h
"

34 
	~"disk.h
"

35 
	~"mÚ™Ü.h
"

36 
	~"6551.h
"

37 
	~"machše.h
"

38 
	~"joy¡ick.h
"

39 
	~"³.h
"

46 
	$Írštch¬
Ð
machše
 *
Üic
, 
c
 )

48 ifÐ
Üic
->
´š‹ÇbË
 )

51 ifÐÐ!
Üic
->
´štfž‹r
 ) || ( 
c
 == 9 ) || ( c == 10 ) || ( c == 13 ) || ( c == 17 ) ||

52 Ð
c
 == 18 ) || ( c == 27 ) || (( c >= 32 ) && ( c <= 127 )) )

56 ifÐ!
Üic
->
´f
 )

58 
Üic
->
´f
 = 
	`fÝ’
( "printer_out.txt", "a" );

59 ifÐ!
Üic
->
´f
 )

61 
	`do_pÝup
Ð
Üic
, "Printing failed :-(" );

65 
	`do_pÝup
Ð
Üic
, "Printingo 'printer_out.txt'" );

69 
	`åutc
Ð
c
, 
Üic
->
´f
 );

70 
Üic
->
´þock
 = 40;

71 
Üic
->
´þo£
 = 64*312*50*5;

74 
	`vŸ_wr™e_CA1
Ð&
Üic
->
vŸ
, 1 );

76 
	}
}

80 
šlše
 
	$vŸ_check_œq
Ð
vŸ
 *
v
 )

82 ifÐÐ
v
->
›r
 & v->
iä
 )&0x7f )

84 
v
->
Üic
->
ýu
.
œq
 |ðv->
œqb™
;

85 
v
->
iä
 |= 0x80;

87 
v
->
Üic
->
ýu
.
œq
 &ð~v->
œqb™
;

88 
v
->
iä
 &= 0x7f;

90 
	}
}

93 
šlše
 
	$vŸ_£t_œq
Ð
vŸ
 *
v
, 
b™
 )

95 
v
->
iä
 |ð
b™
;

96 ifÐÐ
v
->
›r
 & v->
iä
 )&0x7f )

97 
v
->
iä
 |= 0x80;

99 ifÐÐ
v
->
›r
 & 
b™
 ) == 0 ) ;

100 
v
->
Üic
->
ýu
.
œq
 |ðv->
œqb™
;

101 
	}
}

104 
šlše
 
	$vŸ_þr_œq
Ð
vŸ
 *
v
, 
b™
 )

106 ifÐ
b™
 & 
VIRQF_CA1
 )

107 
v
->
œ®
 = v->
œa
;

109 ifÐ
b™
 & 
VIRQF_CA2
 )

110 
v
->
œbl
 = v->
œb
;

112 
v
->
iä
 &ð~
b™
;

113 ifÐ(Ð
v
->
›r
 & v->
iä
 )&0x7f) == 0 )

115 
v
->
Üic
->
ýu
.
œq
 &ð~v->
œqb™
;

116 
v
->
iä
 &= 0x7f;

118 
	}
}

121 
	$vŸ_maš_w_iÜb
Ð
vŸ
 *
v
, 
ÞdÜb
 )

124 ifÐÐ(
ÞdÜb
&
v
->
ddrb
&0x10) != 0 ) &&

125 Ð(
v
->
Üb
&v->
ddrb
&0x10) == 0 ) )

127 
	`Írštch¬
Ð
v
->
Üic
, v->
Üa
 );

130 
	`³_£tmÙÜ
Ð
v
->
Üic
, (v->
Üb
&v->
ddrb
&0x40) != 0 );

132 ifÐ(
v
->
pü
&
PCRF_CB2CON
) == 0x80 )

133 
	`ay_£t_bdœ
Ð&
v
->
Üic
->
ay
, 0 );

135 
	`ay_upd©e_keyb™s
Ð&
v
->
Üic
->
ay
 );

136 
	}
}

138 
	$vŸ_maš_w_iÜa
Ð
vŸ
 *
v
 )

140 ifÐ(
v
->
pü
&
PCRF_CA2CON
) == 0x08 )

141 
	`ay_£t_bc1
Ð&
v
->
Üic
->
ay
, 0 );

143 
	`ay_mode£t
Ð&
v
->
Üic
->
ay
 );

144 
	`joy_buždmask
Ð
v
->
Üic
 );

145 
	}
}

147 
	$vŸ_maš_w_iÜa2
Ð
vŸ
 *
v
 )

149 
	`ay_mode£t
Ð&
v
->
Üic
->
ay
 );

150 
	`joy_buždmask
Ð
v
->
Üic
 );

151 
	}
}

153 
	$vŸ_maš_w_dd¿
Ð
vŸ
 *
v
 )

155 
	`joy_buždmask
Ð
v
->
Üic
 );

156 
	}
}

158 
	$vŸ_maš_w_ddrb
Ð
vŸ
 *
v
 )

160 
	`joy_buždmask
Ð
v
->
Üic
 );

161 
	`ay_upd©e_keyb™s
Ð&
v
->
Üic
->
ay
 );

162 
	}
}

164 
	$vŸ_maš_w_pü
Ð
vŸ
 *
v
 )

166 
SDL_boÞ
 
upd©—y
 = 
SDL_FALSE
;

168  
v
->
pü
 & 
PCRF_CA2CON
 )

171 
upd©—y
 = 
SDL_TRUE
;

177  
v
->
pü
 & 
PCRF_CB2CON
 )

181 
upd©—y
 = 
SDL_TRUE
;

186 ifÐ
upd©—y
 ) 
	`ay_£t_bcmode
Ð&
v
->
Üic
->
ay
, v->
ÿ2
, v->
cb2
 );

187 
	}
}

189 
	$vŸ_maš_w_ÿ2ext
Ð
vŸ
 *
v
 )

191  
v
->
pü
 & 
PCRF_CA2CON
 )

197 
	`ay_£t_bc1
Ð&
v
->
Üic
->
ay
, v->
ÿ2
 );

202 
	}
}

204 
	$vŸ_maš_w_cb2ext
Ð
vŸ
 *
v
 )

206  
v
->
pü
 & 
PCRF_CB2CON
 )

212 
	`ay_£t_bdœ
Ð&
v
->
Üic
->
ay
, v->
cb2
 );

215 
	}
}

217 
	$vŸ_maš_r_iÜa
Ð
vŸ
 *
v
 )

219 
	`ay_mode£t
Ð&
v
->
Üic
->
ay
 );

220 ifÐ(
v
->
pü
&
PCRF_CA2CON
) == 0x08 )

221 
	`ay_£t_bc1
Ð&
v
->
Üic
->
ay
, 0 );

222 
	}
}

224 
	$vŸ_maš_r_iÜa2
Ð
vŸ
 *
v
 )

226 
	`ay_mode£t
Ð&
v
->
Üic
->
ay
 );

227 
	}
}

229 
	$vŸ_maš_r_iÜb
Ð
vŸ
 *
v
 )

231 ifÐ(
v
->
pü
&
PCRF_CB2CON
) == 0x80 )

232 
	`ay_£t_bdœ
Ð&
v
->
Üic
->
ay
, 0 );

233 
	}
}

235 
	$vŸ_maš_ÿ2pul£d
Ð
vŸ
 *
v
 )

237 
	`ay_£t_bc1
Ð&
v
->
Üic
->
ay
, 1 );

238 
	}
}

240 
	$vŸ_maš_cb2pul£d
Ð
vŸ
 *
v
 )

242 
	`ay_£t_bdœ
Ð&
v
->
Üic
->
ay
, v->
cb2
 );

243 
	}
}

245 
	$vŸ_‹Ë_w_iÜa
Ð
vŸ
 *
v
 )

247 
švdd¿
 = (
v
->
dd¿
&7)^7;

248 
v
->
Üic
->
‹Ë_cu¼bªk
 = (v->Üic->‹Ë_cu¼bªk&
švdd¿
)|(v->
Üa
&v->
dd¿
&0x07);

249 
v
->
Üic
->
‹Ë_bªkty³
 = v->Üic->
‹Ë_bªk
[v->Üic->
‹Ë_cu¼bªk
].
ty³
;

250 
v
->
Üic
->
rom
 = v->Üic->
‹Ë_bªk
[v->Üic->
‹Ë_cu¼bªk
].
±r
;

251 
	}
}

253 
	$vŸ_‹Ë_w_iÜa2
Ð
vŸ
 *
v
 )

255 
švdd¿
 = (
v
->
dd¿
&7)^7;

256 
v
->
Üic
->
‹Ë_cu¼bªk
 = (v->Üic->‹Ë_cu¼bªk&
švdd¿
)|(v->
Üa
&v->
dd¿
&0x07);

257 
v
->
Üic
->
‹Ë_bªkty³
 = v->Üic->
‹Ë_bªk
[v->Üic->
‹Ë_cu¼bªk
].
ty³
;

258 
v
->
Üic
->
rom
 = v->Üic->
‹Ë_bªk
[v->Üic->
‹Ë_cu¼bªk
].
±r
;

259 
	}
}

261 
	$vŸ_‹Ë_w_dd¿
Ð
vŸ
 *
v
 )

263 
švdd¿
 = (
v
->
dd¿
&7)^7;

264 
v
->
Üic
->
‹Ë_cu¼bªk
 = (v->Üic->‹Ë_cu¼bªk&
švdd¿
)|(v->
Üa
&v->
dd¿
&0x07);

265 
v
->
Üic
->
‹Ë_bªkty³
 = v->Üic->
‹Ë_bªk
[v->Üic->
‹Ë_cu¼bªk
].
ty³
;

266 
v
->
Üic
->
rom
 = v->Üic->
‹Ë_bªk
[v->Üic->
‹Ë_cu¼bªk
].
±r
;

267 
	}
}

270 
	$vŸ_»ad_pÜ
Ð
vŸ
 *
v
 )

272  
v
->
Üa
 & v->
dd¿
;

273 
	}
}

275 
	$vŸ_»ad_pÜtb
Ð
vŸ
 *
v
 )

277  
v
->
Üb
 & v->
ddrb
;

278 
	}
}

281 
	$vŸ_maš_wr™e_pÜ
Ð
vŸ
 *
v
, 
mask
, 
d©a
 )

283 
v
->
œa
 = (v->œa&~
mask
)|(
d©a
&mask);

285 ifÐ(!(
v
->
aü
&
ACRF_PALATCH
)) ||

286 (!(
v
->
iä
&
VIRQF_CA1
)) )

287 
v
->
œ®
 = v->
œa
;

288 
	}
}

290 
	$vŸ_‹Ë_wr™e_pÜ
Ð
vŸ
 *
v
, 
mask
, 
d©a
 )

292 
v
->
œa
 = (v->œa&~
mask
)|(
d©a
&mask);

294 ifÐ(!(
v
->
aü
&
ACRF_PALATCH
)) ||

295 (!(
v
->
iä
&
VIRQF_CA1
)) )

296 
v
->
œ®
 = v->
œa
;

297 
	}
}

299 
	$vŸ_wr™e_pÜtb
Ð
vŸ
 *
v
, 
mask
, 
d©a
 )

301 
Ï¡pb6
;

303 
Ï¡pb6
 = 
v
->
œb
&0x40;

304 
v
->
œb
 = (v->œb&~
mask
)|(
d©a
&mask);

306 ifÐ(!(
v
->
aü
&
ACRF_PBLATCH
)) ||

307 (!(
v
->
aü
&
VIRQF_CB1
)) )

308 
v
->
œbl
 = v->
œb
;

311 ifÐÐ
v
->
aü
 & 
ACRF_T2CON
 ) == 0 ) ;

314 ifÐÐ!
Ï¡pb6
 ) || ( 
v
->
œb
&0x40 ) ) ;

317 
v
->
t2c
--;

318 ifÐ
v
->
t2run
 )

320 ifÐ
v
->
t2c
 == 0 )

322 
	`vŸ_£t_œq
Ð
v
, 
VIRQF_T2
 );

323 
v
->
t2run
 = 
SDL_FALSE
;

326 
	}
}

329 
	$vŸ_š™
Ð
vŸ
 *
v
, 
machše
 *
Üic
, 
vŸty³
 )

331 
v
->
Üb
 = 0;

332 
v
->
Üa
 = 0;

333 
v
->
œb
 = 0xff;

334 
v
->
œa
 = 0xff;

335 
v
->
œbl
 = 0xff;

336 
v
->
œ®
 = 0xff;

337 
v
->
dd¿
 = 0;

338 
v
->
ddrb
 = 0;

339 
v
->
t1l_l
 = 0;

340 
v
->
t1l_h
 = 0;

341 
v
->
t1c
 = 0;

342 
v
->
t1»lßd
 = 0;

343 
v
->
t2l_l
 = 0;

344 
v
->
t2l_h
 = 0;

345 
v
->
t2c
 = 0;

346 
v
->
t2»lßd
 = 0;

347 
v
->
¤
 = 0;

348 
v
->
aü
 = 0;

349 
v
->
pü
 = 0;

350 
v
->
iä
 = 0;

351 
v
->
›r
 = 0;

352 
v
->
ÿ1
 = 0;

353 
v
->
ÿ2
 = 0;

354 
v
->
cb1
 = 0;

355 
v
->
cb2
 = 0;

356 
v
->
¤couÁ
 = 0;

357 
v
->
¤time
 = 0;

358 
v
->
¤Œigg”
 = 
SDL_FALSE
;

359 
v
->
t1run
 = 
SDL_FALSE
;

360 
v
->
t2run
 = 
SDL_FALSE
;

361 
v
->
ÿ2pul£
 = 
SDL_FALSE
;

362 
v
->
cb2pul£
 = 
SDL_FALSE
;

363 
v
->
Üic
 = oric;

365  
vŸty³
 )

367 
VIA_MAIN
:

368 
v
->
w_iÜb
 = 
vŸ_maš_w_iÜb
;

369 
v
->
w_iÜa
 = 
vŸ_maš_w_iÜa
;

370 
v
->
w_iÜa2
 = 
vŸ_maš_w_iÜa2
;

371 
v
->
w_dd¿
 = 
vŸ_maš_w_dd¿
;

372 
v
->
w_ddrb
 = 
vŸ_maš_w_ddrb
;

373 
v
->
w_pü
 = 
vŸ_maš_w_pü
;

374 
v
->
w_ÿ2ext
 = 
vŸ_maš_w_ÿ2ext
;

375 
v
->
w_cb2ext
 = 
vŸ_maš_w_cb2ext
;

376 
v
->
r_iÜa
 = 
vŸ_maš_r_iÜa
;

377 
v
->
r_iÜa2
 = 
vŸ_maš_r_iÜa2
;

378 
v
->
r_iÜb
 = 
vŸ_maš_r_iÜb
;

379 
v
->
ÿ2pul£d
 = 
vŸ_maš_ÿ2pul£d
;

380 
v
->
cb2pul£d
 = 
vŸ_maš_cb2pul£d
;

381 
v
->
cb2shiáed
 = 
vŸ_maš_cb2pul£d
;

382 
v
->
Übchªge
 = 
³_Übchªge
;

383 
v
->
œqb™
 = 
IRQF_VIA
;

384 
v
->
»ad_pÜt_a
 = 
vŸ_»ad_pÜ
;

385 
v
->
»ad_pÜt_b
 = 
vŸ_»ad_pÜtb
;

386 
v
->
wr™e_pÜt_a
 = 
vŸ_maš_wr™e_pÜ
;

387 
v
->
wr™e_pÜt_b
 = 
vŸ_wr™e_pÜtb
;

390 
VIA_TELESTRAT
:

391 
v
->
w_iÜb
 = 
NULL
;

392 
v
->
w_iÜa
 = 
vŸ_‹Ë_w_iÜa
;

393 
v
->
w_iÜa2
 = 
vŸ_‹Ë_w_iÜa2
;

394 
v
->
w_dd¿
 = 
vŸ_‹Ë_w_dd¿
;

395 
v
->
w_ddrb
 = 
NULL
;

396 
v
->
w_pü
 = 
NULL
;

397 
v
->
w_ÿ2ext
 = 
NULL
;

398 
v
->
w_cb2ext
 = 
NULL
;

399 
v
->
r_iÜa
 = 
NULL
;

400 
v
->
r_iÜa2
 = 
NULL
;

401 
v
->
r_iÜb
 = 
NULL
;

402 
v
->
ÿ2pul£d
 = 
NULL
;

403 
v
->
cb2pul£d
 = 
NULL
;

404 
v
->
cb2shiáed
 = 
NULL
;

405 
v
->
Übchªge
 = 
NULL
;

406 
v
->
œqb™
 = 
IRQF_VIA2
;

407 
v
->
»ad_pÜt_a
 = 
vŸ_»ad_pÜ
;

408 
v
->
»ad_pÜt_b
 = 
vŸ_»ad_pÜtb
;

409 
v
->
wr™e_pÜt_a
 = 
vŸ_‹Ë_wr™e_pÜ
;

410 
v
->
wr™e_pÜt_b
 = 
vŸ_wr™e_pÜtb
;

411 
v
->
Üa
 = 7;

412 
v
->
dd¿
 = 7;

415 
	}
}

418 
	$vŸ_þock
Ð
vŸ
 *
v
, 
cyþes
 )

420 
üem
;

423 
	`³_ticktock
Ð
v
->
Üic
, 
cyþes
 );

425 ifÐ!
cyþes
 ) ;

428 ifÐ
v
->
Üic
->
´þock
 > 0 )

430 
v
->
Üic
->
´þock
 -ð
cyþes
;

431 ifÐ
v
->
Üic
->
´þock
 <= 0 )

433 
v
->
Üic
->
´þock
 = 0;

434 ifÐ
v
->
Üic
->
´š‹ÇbË
 )

435 
	`vŸ_wr™e_CA1
Ð
v
, 0 );

442 ifÐ
v
->
Üic
->
´þo£
 > 0 )

444 
v
->
Üic
->
´þo£
 -ð
cyþes
;

445 ifÐ
v
->
Üic
->
´þo£
 <= 0 )

447 
v
->
Üic
->
´þo£
 = 0;

448 ifÐ
v
->
Üic
->
´f
 )

449 
	`fþo£
Ð
v
->
Üic
->
´f
 );

450 
v
->
Üic
->
´f
 = 
NULL
;

454 ifÐ
v
->
ÿ2pul£
 )

456 
v
->
ÿ2
 = 1;

457 ifÐ
v
->
ÿ2pul£d
 ) v->
	`ÿ2pul£d
( v );

458 
v
->
ÿ2pul£
 = 
SDL_FALSE
;

461 ifÐ
v
->
cb2pul£
 )

465 
v
->
cb2
 = 1;

466 ifÐ
v
->
cb2pul£d
 ) v->
	`cb2pul£d
( v );

468 
v
->
cb2pul£
 = 
SDL_FALSE
;

472  
v
->
aü
&
ACRF_T1CON
 )

476 ifÐ
v
->
t1run
 )

478 ifÐ
cyþes
 > 
v
->
t1c
 )

480 
	`vŸ_£t_œq
Ð
v
, 
VIRQF_T1
 );

481 ifÐ
v
->
aü
&0x80 )

483 
v
->
Üb
 |= 0x80;

484 ià(
v
->
Übchªge
èv->
	`Übchªge
( v );

486 
v
->
t1run
 = 
SDL_FALSE
;

489 
v
->
t1c
 -ð
cyþes
;

494 
üem
 = 
cyþes
;

496 ifÐ
v
->
t1»lßd
 )

498 
üem
--;

499 
v
->
t1c
 = (v->
t1l_h
<<8)|v->
t1l_l
;

500 
v
->
t1»lßd
 = 
SDL_FALSE
;

503  
üem
 > 
v
->
t1c
 )

505 
üem
 -ð(
v
->
t1c
+1);

506 
v
->
t1c
 = 0xffff;

507 
	`vŸ_£t_œq
Ð
v
, 
VIRQF_T1
 );

508 ifÐ
v
->
aü
&0x80 )

510 
v
->
Üb
 ^= 0x80;

511 ifÐ
v
->
Übchªge
 ) v->
	`Übchªge
( v );

514 ifÐ!
üem
 )

516 
v
->
t1»lßd
 = 
SDL_TRUE
;

520 
üem
--;

521 
v
->
t1c
 = (v->
t1l_h
<<8)|v->
t1l_l
;

524 
v
->
t1c
 -ð
üem
;

529 ifÐÐ
v
->
aü
 & 
ACRF_T2CON
 ) == 0 )

531 
üem
 = 
cyþes
;

532 ifÐ
v
->
t2»lßd
 )

534 
üem
--;

535 
v
->
t2»lßd
 = 0;

539 ifÐ
v
->
t2run
 )

541 ifÐ
üem
 > 
v
->
t2c
 )

543 
	`vŸ_£t_œq
Ð
v
, 
VIRQF_T2
 );

544 
v
->
t2run
 = 
SDL_FALSE
;

547 
v
->
t2c
 -ð
üem
;

550  
v
->
aü
 & 
ACRF_SRCON
 )

557 ifÐ
v
->
iä
&
VIRQF_SR
 )

558 
	`vŸ_þr_œq
Ð
v
, 
VIRQF_SR
 );

559 
v
->
¤couÁ
 = 0;

560 
v
->
¤Œigg”
 = 
SDL_FALSE
;

564 ifÐ!
v
->
¤Œigg”
 ) ;

567 
v
->
¤time
 -ð
cyþes
;

568  
v
->
¤time
 <= 0 )

571 
v
->
¤time
 +ðv->
t2l_l
+1;

574 
v
->
cb1
 ^= 1;

577 ifÐ!
v
->
cb1
 )

579 
v
->
cb2
 = (v->
¤
 & 0x80) ? 1 : 0;

580 
v
->
¤
 = (v->¤<<1)|v->
cb2
;

581 ifÐ
v
->
cb2shiáed
 ) v->
	`cb2shiáed
( v );

583 
v
->
¤couÁ
 = (v->srcount+1)%8;

589 ifÐ!
v
->
¤Œigg”
 ) ;

590 ifÐ
v
->
¤couÁ
 == 8 ) ;

593 
v
->
¤time
 -ð
cyþes
;

594  
v
->
¤time
 <= 0 )

597 
v
->
¤time
 +ðv->
t2l_l
+1;

600 
v
->
cb1
 ^= 1;

603 ifÐ!
v
->
cb1
 )

605 
v
->
cb2
 = (v->
¤
 & 0x80) ? 1 : 0;

606 
v
->
¤
 = (v->¤<<1)|v->
cb2
;

607 ifÐ
v
->
cb2shiáed
 ) v->
	`cb2shiáed
( v );

609 
v
->
¤couÁ
++;

610 ifÐ
v
->
¤couÁ
 == 8 )

612 
	`vŸ_£t_œq
Ð
v
, 
VIRQF_SR
 );

613 
v
->
¤time
 = 0;

614 
v
->
¤Œigg”
 = 
SDL_FALSE
;

622 ifÐ!
v
->
¤Œigg”
 ) ;

623 ifÐ
v
->
¤couÁ
 == 8 ) ;

626 
v
->
cb1
 ^= 1;

629 ifÐ!
v
->
cb1
 )

631 
v
->
cb2
 = (v->
¤
 & 0x80) ? 1 : 0;

632 
v
->
¤
 = (v->¤<<1)|v->
cb2
;

633 ifÐ
v
->
cb2shiáed
 ) v->
	`cb2shiáed
( v );

635 
v
->
¤couÁ
++;

636 ifÐ
v
->
¤couÁ
 == 8 )

638 
	`vŸ_£t_œq
Ð
v
, 
VIRQF_SR
 );

639 
v
->
¤Œigg”
 = 
SDL_FALSE
;

644 
	}
}

647 
	$vŸ_wr™e
Ð
vŸ
 *
v
, 
off£t
, 
d©a
 )

649 
tmp
;

650 
off£t
 &= 0xf;

652  
off£t
 )

654 
VIA_IORB
:

655 
tmp
 = 
v
->
Üb
;

656 
v
->
Üb
 = 
d©a
;

658 
	`vŸ_þr_œq
Ð
v
, 
VIRQF_CB1
 );

659  
v
->
pü
 & 
PCRF_CB2CON
 )

663 
	`vŸ_þr_œq
Ð
v
, 
VIRQF_CB2
 );

667 
v
->
cb2pul£
 = 
SDL_TRUE
;

670 
v
->
cb2
 = 0;

673 ifÐ
v
->
w_iÜb
 ) v->
	`w_iÜb
Ðv, 
tmp
 );

674 ifÐ
v
->
Übchªge
 ) v->
	`Übchªge
( v );

676 
VIA_IORA
:

677 
v
->
Üa
 = 
d©a
;

678 
	`vŸ_þr_œq
Ð
v
, 
VIRQF_CA1
 );

679  
v
->
pü
 & 
PCRF_CA2CON
 )

683 
	`vŸ_þr_œq
Ð
v
, 
VIRQF_CA2
 );

687 
v
->
ÿ2pul£
 = 
SDL_TRUE
;

689 
v
->
ÿ2
 = 0;

692 ifÐ
v
->
w_iÜa
 ) v->
	`w_iÜa
( v );

694 
VIA_DDRB
:

695 
v
->
ddrb
 = 
d©a
;

696 ifÐ
v
->
w_ddrb
 ) v->
	`w_ddrb
( v );

698 
VIA_DDRA
:

699 
v
->
dd¿
 = 
d©a
;

700 ifÐ
v
->
w_dd¿
 ) v->
	`w_dd¿
( v );

702 
VIA_T1C_H
:

703 
v
->
t1l_h
 = 
d©a
;

704 
v
->
t1c
 = (v->
t1l_h
<<8)|v->
t1l_l
;

705 
v
->
t1»lßd
 = 1;

706 
	`vŸ_þr_œq
Ð
v
, 
VIRQF_T1
 );

707 
v
->
t1run
 = 
SDL_TRUE
;

708 ifÐ(
v
->
aü
&
ACRF_T1CON
) == 0x80 )

710 
v
->
Üb
 &= 0x7f;

711 ifÐ
v
->
Übchªge
 ) v->
	`Übchªge
( v );

714 
VIA_T1C_L
:

715 
VIA_T1L_L
:

716 
v
->
t1l_l
 = 
d©a
;

718 
VIA_T1L_H
:

719 
v
->
t1l_h
 = 
d©a
;

720 
	`vŸ_þr_œq
Ð
v
, 
VIRQF_T1
 );

722 
VIA_T2C_L
:

723 
v
->
t2l_l
 = 
d©a
;

725 
VIA_T2C_H
:

726 
v
->
t2l_h
 = 
d©a
;

727 
v
->
t2c
 = (v->
t2l_h
<<8)|v->
t2l_l
;

728 
v
->
t2»lßd
 = 1;

729 
	`vŸ_þr_œq
Ð
v
, 
VIRQF_T2
 );

730 
v
->
t2run
 = 
SDL_TRUE
;

732 
VIA_SR
:

733 
v
->
¤
 = 
d©a
;

734 
v
->
¤couÁ
 = 0;

735 
v
->
¤time
 = 0;

736 
v
->
¤Œigg”
 = 
SDL_TRUE
;

737 
	`vŸ_þr_œq
Ð
v
, 
VIRQF_SR
 );

739 
VIA_ACR
:

759 
v
->
aü
 = 
d©a
;

760 ifÐÐÐ
d©a
 & 
ACRF_T1CON
 ) != 0x40 ) &&

761 ÐÐ
d©a
 & 
ACRF_T1CON
 ) != 0xc0 ) )

762 
v
->
t1»lßd
 = 
SDL_FALSE
;

767 
VIA_PCR
:

768 
v
->
pü
 = 
d©a
;

769  
v
->
pü
 & 
PCRF_CA2CON
 )

772 
v
->
ÿ2
 = 0;

773 
v
->
ÿ2pul£
 = 
SDL_FALSE
;

777 
v
->
ÿ2
 = 1;

783  
v
->
pü
 & 
PCRF_CB2CON
 )

786 
v
->
cb2
 = 0;

787 
v
->
cb2pul£
 = 
SDL_FALSE
;

791 
v
->
cb2
 = 1;

796 ifÐ
v
->
w_pü
 ) v->
	`w_pü
( v );

798 
VIA_IFR
:

799 ifÐ
d©a
 & 
VIRQF_CA1
 ) 
v
->
œ®
 = v->
œa
;

800 ifÐ
d©a
 & 
VIRQF_CB1
 ) 
v
->
œbl
 = v->
œb
;

802 
v
->
iä
 &ð(~
d©a
)&0x7f;

803 ifÐÐ
v
->
›r
 & v->
iä
 )&0x7f )

804 
v
->
iä
 |= 0x80;

806 
v
->
Üic
->
ýu
.
œq
 &ð~v->
œqb™
;

808 
VIA_IER
:

809 ifÐ
d©a
 & 0x80 )

810 
v
->
›r
 |ð(
d©a
&0x7f);

812 
v
->
›r
 &ð~(
d©a
&0x7f);

813 
	`vŸ_check_œq
Ð
v
 );

815 
VIA_IORA2
:

816 
v
->
Üa
 = 
d©a
;

817 ifÐ
v
->
w_iÜa2
 ) v->
	`w_iÜa2
( v );

820 
	}
}

823 
	$vŸ_mÚ_»ad
Ð
vŸ
 *
v
, 
off£t
 )

825 
off£t
 &= 0xf;

827  
off£t
 )

829 
VIA_IORB
:

830  (
v
->
Üb
&v->
ddrb
)|(v->
œbl
&(~v->ddrb));

831 
VIA_IORA
:

832  (
v
->
Üa
&v->
dd¿
)|(v->
œ®
&(~v->ddra));

833 
VIA_DDRB
:

834  
v
->
ddrb
;

835 
VIA_DDRA
:

836  
v
->
dd¿
;

837 
VIA_T1C_L
:

838  
v
->
t1c
&0xff;

839 
VIA_T1C_H
:

840  
v
->
t1c
>>8;

841 
VIA_T1L_L
:

842  
v
->
t1l_l
;

843 
VIA_T1L_H
:

844  
v
->
t1l_h
;

845 
VIA_T2C_L
:

846  
v
->
t2c
&0xff;

847 
VIA_T2C_H
:

848  
v
->
t2c
>>8;

849 
VIA_SR
:

850  
v
->
¤
;

851 
VIA_ACR
:

852  
v
->
aü
;

853 
VIA_PCR
:

854  
v
->
pü
;

855 
VIA_IFR
:

856  
v
->
iä
;

857 
VIA_IER
:

858  
v
->
›r
|0x80;

859 
VIA_IORA2
:

860  (
v
->
Üa
&v->
dd¿
)|(v->
œ®
&(~v->ddra));

864 
	}
}

867 
	$vŸ_»ad
Ð
vŸ
 *
v
, 
off£t
 )

869 
off£t
 &= 0xf;

871  
off£t
 )

873 
VIA_IORB
:

874 
	`vŸ_þr_œq
Ð
v
, 
VIRQF_CB1
 );

875  
v
->
pü
 & 
PCRF_CB2CON
 )

879 
	`vŸ_þr_œq
Ð
v
, 
VIRQF_CB2
 );

883 
v
->
cb2pul£
 = 
SDL_TRUE
;

887 
v
->
cb2
 = 0;

891 ifÐ
v
->
r_iÜb
 ) v->
	`r_iÜb
( v );

892  (
v
->
Üb
&v->
ddrb
)|(v->
œbl
&(~v->ddrb));

893 
VIA_IORA
:

894 
	`vŸ_þr_œq
Ð
v
, 
VIRQF_CA1
 );

895  
v
->
pü
 & 
PCRF_CA2CON
 )

899 
	`vŸ_þr_œq
Ð
v
, 
VIRQF_CA2
 );

903 
v
->
ÿ2pul£
 = 
SDL_TRUE
;

905 
v
->
ÿ2
 = 0;

908 ifÐ
v
->
r_iÜa
 ) v->
	`r_iÜa
( v );

909  (
v
->
Üa
&v->
dd¿
)|(v->
œ®
&(~v->ddra));

910 
VIA_DDRB
:

911  
v
->
ddrb
;

912 
VIA_DDRA
:

913  
v
->
dd¿
;

914 
VIA_T1C_L
:

915 
	`vŸ_þr_œq
Ð
v
, 
VIRQF_T1
 );

916  
v
->
t1c
&0xff;

917 
VIA_T1C_H
:

918  
v
->
t1c
>>8;

919 
VIA_T1L_L
:

920  
v
->
t1l_l
;

921 
VIA_T1L_H
:

922  
v
->
t1l_h
;

923 
VIA_T2C_L
:

924 
	`vŸ_þr_œq
Ð
v
, 
VIRQF_T2
 );

925  
v
->
t2c
&0xff;

926 
VIA_T2C_H
:

927  
v
->
t2c
>>8;

928 
VIA_SR
:

929 
v
->
¤couÁ
 = 0;

930 
v
->
¤time
 = 0;

931 
v
->
¤Œigg”
 = 
SDL_TRUE
;

932 
	`vŸ_þr_œq
Ð
v
, 
VIRQF_SR
 );

933  
v
->
¤
;

934 
VIA_ACR
:

935  
v
->
aü
;

936 
VIA_PCR
:

937  
v
->
pü
;

938 
VIA_IFR
:

939  
v
->
iä
;

940 
VIA_IER
:

941  
v
->
›r
|0x80;

942 
VIA_IORA2
:

943  (
v
->
Üa
&v->
dd¿
)|(v->
œ®
&(~v->ddra));

947 
	}
}

950 
	$vŸ_mÚ_wr™e_iä
Ð
vŸ
 *
v
, 
d©a
 )

952 ifÐ!Ð
d©a
 & 
VIRQF_CA1
 ) ) 
v
->
œ®
 = v->
œa
;

953 ifÐ!Ð
d©a
 & 
VIRQF_CB1
 ) ) 
v
->
œbl
 = v->
œb
;

955 
v
->
iä
 = 
d©a
&0x7f;

956 ifÐÐ
v
->
›r
 & v->
iä
 )&0x7f )

957 
v
->
iä
 |= 0x80;

959 
v
->
Üic
->
ýu
.
œq
 &ð~v->
œqb™
;

960 
	}
}

963 
	$vŸ_wr™e_CA1
Ð
vŸ
 *
v
, 
d©a
 )

965 ifÐÐ!
v
->
ÿ1
 ) && ( 
d©a
 != 0 ) )

967 ifÐ
v
->
pü
 & 
PCRF_CA1CON
 )

968 
	`vŸ_£t_œq
Ð
v
, 
VIRQF_CA1
 );

969 } ifÐÐ
v
->
ÿ1
 ) && ( 
d©a
 == 0 ) ) {

970 ifÐ!(
v
->
pü
 & 
PCRF_CA1CON
) )

971 
	`vŸ_£t_œq
Ð
v
, 
VIRQF_CA1
 );

974 
v
->
ÿ1
 = 
d©a
 != 0;

975 
	}
}

977 
	$vŸ_wr™e_CA2
Ð
vŸ
 *
v
, 
d©a
 )

979  
v
->
pü
 & 
PCRF_CA2CON
 )

983 ifÐÐ
v
->
ÿ2
 ) && ( 
d©a
 == 0 ) )

984 
	`vŸ_£t_œq
Ð
v
, 
VIRQF_CA2
 );

985 
v
->
ÿ2
 = 
d©a
 != 0;

990 ifÐÐ!
v
->
ÿ2
 ) && ( 
d©a
 != 0 ) )

991 
	`vŸ_£t_œq
Ð
v
, 
VIRQF_CA2
 );

992 
v
->
ÿ2
 = 
d©a
 != 0;

998 ifÐ
v
->
w_ÿ2ext
 ) v->
	`w_ÿ2ext
( v );

999 
	}
}

1001 
	$vŸ_wr™e_CB1
Ð
vŸ
 *
v
, 
d©a
 )

1003 ifÐÐ!
v
->
cb1
 ) && ( 
d©a
 != 0 ) )

1005 ifÐ
v
->
pü
 & 
PCRF_CB1CON
 )

1006 
	`vŸ_£t_œq
Ð
v
, 
VIRQF_CB1
 );

1007 } ifÐÐ
v
->
cb1
 ) && ( 
d©a
 == 0 ) ) {

1008 ifÐ!(
v
->
pü
 & 
PCRF_CB1CON
) )

1009 
	`vŸ_£t_œq
Ð
v
, 
VIRQF_CB1
 );

1012 
v
->
cb1
 = 
d©a
 != 0;

1013 
	}
}

1015 
	$vŸ_wr™e_CB2
Ð
vŸ
 *
v
, 
d©a
 )

1017  
v
->
pü
 & 
PCRF_CB2CON
 )

1021 ifÐÐ
v
->
cb2
 ) && ( 
d©a
 == 0 ) )

1022 
	`vŸ_£t_œq
Ð
v
, 
VIRQF_CB2
 );

1023 
v
->
cb2
 = 
d©a
 != 0;

1028 ifÐÐ!
v
->
cb2
 ) && ( 
d©a
 != 0 ) )

1029 
	`vŸ_£t_œq
Ð
v
, 
VIRQF_CB2
 );

1030 
v
->
cb2
 = 
d©a
 != 0;

1034 ifÐ
v
->
w_cb2ext
 ) v->
	`w_cb2ext
( v );

1035 
	}
}

	@via.h

23 
	mVIA_MAIN
 = 0,

24 
	mVIA_TELESTRAT


27 
	svŸ


30 
	miä
;

31 
	mœb
, 
	mÜb
, 
	mœbl
;

32 
	mœa
, 
	mÜa
, 
	mœ®
;

33 
	mdd¿
;

34 
	mddrb
;

35 
	mt1l_l
;

36 
	mt1l_h
;

37 
	mt1c
;

38 
	mt2l_l
;

39 
	mt2l_h
;

40 
	mt2c
;

41 
	m¤
;

42 
	maü
;

43 
	mpü
;

44 
	m›r
;

47 
	mÿ1
, 
	mÿ2
;

48 
	mcb1
, 
	mcb2
;

49 
	m¤couÁ
;

50 
	mt1»lßd
, 
	mt2»lßd
;

51 
Sšt16
 
	m¤time
;

54 
SDL_boÞ
 
	mt1run
, 
	mt2run
;

55 
SDL_boÞ
 
	mÿ2pul£
, 
	mcb2pul£
;

56 
SDL_boÞ
 
	m¤Œigg”
;

58 (*
	mw_iÜb
)(
	mvŸ
 *,);

59 (*
	mw_iÜa
)(
	mvŸ
 *);

60 (*
	mw_iÜa2
)(
	mvŸ
 *);

61 (*
	mw_dd¿
)(
	mvŸ
 *);

62 (*
	mw_ddrb
)(
	mvŸ
 *);

63 (*
	mw_pü
)(
	mvŸ
 *);

64 (*
	mw_ÿ2ext
)(
	mvŸ
 *);

65 (*
	mw_cb2ext
)(
	mvŸ
 *);

66 (*
	mr_iÜa
)(
	mvŸ
 *);

67 (*
	mr_iÜa2
)(
	mvŸ
 *);

68 (*
	mr_iÜb
)(
	mvŸ
 *);

69 (*
	mÿ2pul£d
)(
	mvŸ
 *);

70 (*
	mcb2pul£d
)(
	mvŸ
 *);

71 (*
	mcb2shiáed
)(
	mvŸ
 *);

72 (*
	mÜbchªge
)(
	mvŸ
 *);

74 (*
	m»ad_pÜt_a
)(
	mvŸ
 *);

75 (*
	m»ad_pÜt_b
)(
	mvŸ
 *);

76 (*
	mwr™e_pÜt_a
)(
vŸ
 *
	mv
, , );

77 (*
	mwr™e_pÜt_b
)(
vŸ
 *
	mv
, , );

79 
machše
 *
	mÜic
;

80 
	mœqb™
;

83 
	#VIA_IORB
 0

	)

84 
	#VIA_IORA
 1

	)

85 
	#VIA_DDRB
 2

	)

86 
	#VIA_DDRA
 3

	)

87 
	#VIA_T1C_L
 4

	)

88 
	#VIA_T1C_H
 5

	)

89 
	#VIA_T1L_L
 6

	)

90 
	#VIA_T1L_H
 7

	)

91 
	#VIA_T2C_L
 8

	)

92 
	#VIA_T2C_H
 9

	)

93 
	#VIA_SR
 10

	)

94 
	#VIA_ACR
 11

	)

95 
	#VIA_PCR
 12

	)

96 
	#VIA_IFR
 13

	)

97 
	#VIA_IER
 14

	)

98 
	#VIA_IORA2
 15

	)

100 
	#PCRB_CA1CON
 0

	)

101 
	#PCRF_CA1CON
 (1<<
PCRB_CA1CON
)

	)

102 
	#PCRF_CA2CON
 (0x0e)

	)

103 
	#PCRB_CB1CON
 4

	)

104 
	#PCRF_CB1CON
 (1<<
PCRB_CB1CON
)

	)

105 
	#PCRF_CB2CON
 (0xe0)

	)

107 
	#ACRB_PALATCH
 0

	)

108 
	#ACRF_PALATCH
 (1<<
ACRB_PALATCH
)

	)

109 
	#ACRB_PBLATCH
 1

	)

110 
	#ACRF_PBLATCH
 (1<<
ACRB_PBLATCH
)

	)

111 
	#ACRF_SRCON
 (0x1c)

	)

112 
	#ACRB_T2CON
 5

	)

113 
	#ACRF_T2CON
 (1<<
ACRB_T2CON
)

	)

114 
	#ACRF_T1CON
 (0xc0)

	)

116 
	#VIRQB_CA2
 0

	)

117 
	#VIRQF_CA2
 (1<<
VIRQB_CA2
)

	)

118 
	#VIRQB_CA1
 1

	)

119 
	#VIRQF_CA1
 (1<<
VIRQB_CA1
)

	)

120 
	#VIRQB_SR
 2

	)

121 
	#VIRQF_SR
 (1<<
VIRQB_SR
)

	)

122 
	#VIRQB_CB2
 3

	)

123 
	#VIRQF_CB2
 (1<<
VIRQB_CB2
)

	)

124 
	#VIRQB_CB1
 4

	)

125 
	#VIRQF_CB1
 (1<<
VIRQB_CB1
)

	)

126 
	#VIRQB_T2
 5

	)

127 
	#VIRQF_T2
 (1<<
VIRQB_T2
)

	)

128 
	#VIRQB_T1
 6

	)

129 
	#VIRQF_T1
 (1<<
VIRQB_T1
)

	)

131 
³_ejeù
Ð
machše
 *
Üic
 );

132 
³_»wšd
Ð
machše
 *
Üic
 );

133 
SDL_boÞ
 
³_lßd_p
Ð
machše
 *
Üic
, *
âame
 );

134 
³_ticktock
Ð
machše
 *
Üic
, 
cyþes
 );

137 
vŸ_š™
Ð
vŸ
 *
v
, 
machše
 *
Üic
, 
vŸty³
 );

140 
vŸ_þock
Ð
vŸ
 *
v
, 
cyþes
 );

143 
vŸ_wr™e
Ð
vŸ
 *
v
, 
off£t
, 
d©a
 );

146 
vŸ_»ad
Ð
vŸ
 *
v
, 
off£t
 );

150 
vŸ_wr™e_CA1
Ð
vŸ
 *
v
, 
d©a
 );

151 
vŸ_wr™e_CA2
Ð
vŸ
 *
v
, 
d©a
 );

152 
vŸ_wr™e_CB1
Ð
vŸ
 *
v
, 
d©a
 );

153 
vŸ_wr™e_CB2
Ð
vŸ
 *
v
, 
d©a
 );

156 
vŸ_mÚ_wr™e_iä
Ð
vŸ
 *
v
, 
d©a
 );

159 
vŸ_mÚ_»ad
Ð
vŸ
 *
v
, 
off£t
 );

	@
1
.
0
70
844
6502.c
6502.h
6551.c
6551.h
6551_com.c
6551_loopback.c
6551_modem.c
8912.c
8912.h
XCode/Oricutron/Oricutron/SDLMain.h
avi.c
avi.h
disk.c
disk.h
disk_pravetz.c
disk_pravetz.h
filereq.h
filereq_amiga.c
filereq_beos.cpp
filereq_gtk.c
filereq_sdl.c
filereq_win32.c
font.c
gui.c
gui.h
gui_beos.cpp
gui_win.c
gui_x11.c
joystick.c
joystick.h
keyboard.c
keyboard.h
machine.c
machine.h
main.c
main.h
monitor.c
monitor.h
msgbox.h
msgbox_beos.cpp
msgbox_gtk.c
msgbox_os2.c
msgbox_os4.c
msgbox_sdl.c
msgbox_win32.c
msvc/strcasecmp.h
msvc/unistd.h
plugins/ch376/ch376.c
plugins/ch376/ch376.h
plugins/ch376/oric_ch376_plugin.c
plugins/ch376/oric_ch376_plugin.h
render_gl.c
render_gl.h
render_null.c
render_null.h
render_sw.c
render_sw.h
render_sw8.c
render_sw8.h
snapshot.c
snapshot.h
system.h
system_sdl.c
system_sdl.h
tape.c
tape.h
ula.c
ula.h
via.c
via.h
